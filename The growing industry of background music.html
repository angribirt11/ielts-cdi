<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Reading Test - The Growing Industry of Background Music</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Main styles */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
            background-color: #f0f8ff; /* Pale blue background */
        }
        .test-wrapper {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .test-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        /* Header styles */
        .header {
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header__logo img {
            height: 40px;
        }
        .header__timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            background-color: #e6f2ff; /* Lighter blue for timer */
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }
        .header__icons {
            display: flex;
            gap: 15px;
        }
        .header__icon {
            font-size: 1.2rem;
            color: #666;
            cursor: pointer;
        }
        /* Settings Modal */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .settings-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
            background-color: #f0f8ff;
        }
        .settings-header h2 {
            margin: 0;
            font-size: 1.2rem;
        }
        .settings-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        .settings-body {
            padding: 20px;
        }
        .settings-option {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .settings-option:last-child {
            border-bottom: none;
        }
        .settings-option i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
            color: #2a6c96;
        }
        .settings-option span {
            flex: 1;
        }
        .sectionRubric {
            margin: 1em;
            width: calc(100% - 4em - 3px);
            border-radius: 4px;
            padding: 0.75em 1em;
            background: white;
            border: 1px solid #d5d5d5;
        }
        .sectionRubric h2, .sectionRubric p {
            margin: 0;
        }
        .sectionRubric h2 {
            font-size: 1rem;
            margin-bottom: 0.25em;
        }
        /* Passage container */
        .passage-container {
            width: 45%;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            background-color: #f0f8ff; /* Pale blue */
            position: relative;
            -webkit-user-select: text;
            user-select: text;
        }
        /* Questions container */
        .questions-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            background-color: #f0f8ff; /* Pale blue */
            -webkit-user-select: text;
            user-select: text;
        }
        /* Highlight styles */
        .highlight {
            position: relative;
            border-radius: 2px;
            padding: 0 1px;
            margin: 0 -1px;
        }
        .highlight.yellow {
            background-color: rgba(255, 255, 0, 0.3);
        }
        .highlight.green {
            background-color: rgba(0, 255, 0, 0.3);
        }
        .highlight.pink {
            background-color: rgba(255, 105, 180, 0.3);
        }
        .highlight.blue {
            background-color: rgba(0, 191, 255, 0.3);
        }
        .highlight-toolbar {
            position: fixed;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            padding: 5px;
            transform: translate(-50%, -100%);
            margin-top: -5px;
        }
        .highlight-toolbar button {
            background: none;
            border: none;
            width: 24px;
            height: 24px;
            cursor: pointer;
            margin: 0 2px;
            border-radius: 3px;
        }
        .highlight-toolbar button:hover {
            background: #f0f0f0;
        }
        .highlight-toolbar button.remove {
            color: #ff0000;
        }
        /* Divider styling */
        .divider {
            width: 10px;
            background: #ddd;
            cursor: col-resize;
            position: relative;
        }
        .divider-handle {
            width: 4px;
            height: 40px;
            background: #999;
            border-radius: 2px;
            position: absolute;
            top: 50%;
            left: 3px;
            transform: translateY(-50%);
        }
        /* Question styling */
        .question {
            margin-bottom: 30px;
        }
        .question-rubric {
            margin-bottom: 15px;
            font-weight: bold;
        }
        .question-options {
            list-style-type: none;
            padding: 0;
        }
        .question-options li {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        /* Matching questions */
        .matching-option {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .matching-option select {
            min-width: 50px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-left: 10px;
        }
        /* Summary completion styles */
        .summary-completion-container {
            margin-top: 20px;
        }
        .summary-text p {
            line-height: 2.5;
            font-size: 16px;
        }
        .summary-input {
            width: 150px;
            padding: 5px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            font-size: 15px;
            font-weight: bold;
            background-color: #e3f2fd;
        }
        .summary-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
            border-style: solid;
        }
        .summary-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            border-style: solid;
        }
        .summary-feedback {
            display: inline-block;
            margin-left: 10px;
            font-size: 14px;
        }
        .summary-feedback.correct {
            color: #28a745;
        }
        .summary-feedback.incorrect {
            color: #dc3545;
        }
        /* Footer styles */
        .footer {
            background: #f5f5f5;
            border-top: 1px solid #ddd;
            padding: 10px;
        }
        .nav-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .footer__questionWrapper {
            display: flex;
            align-items: center;
        }
        .footer__questionNo {
            background: none;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-weight: bold;
        }
        .footer__subquestionWrapper {
            display: flex;
            flex-wrap: wrap;
            margin-left: 10px;
        }
        .subQuestion {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid #ccc;
            background: #f0f0f0;
            margin: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        .subQuestion.active {
            background: #0066cc;
            color: white;
            border-color: #0066cc;
        }
        .subQuestion.attempted {
            background: #0066cc;
            color: white;
        }
        .footer__deliverButton {
            background: #0066cc;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .footer__deliverButton:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
        /* Highlight color buttons */
        .highlight-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            cursor: pointer;
            border: 1px solid #ccc;
        }
        .highlight-color.yellow { background-color: #ffff00; }
        .highlight-color.green { background-color: #00ff00; }
        .highlight-color.pink { background-color: #ff69b4; }
        .highlight-color.blue { background-color: #00bfff; }
        /* Time warning styles */
        .timer-warning {
            color: #ff0000;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        /* Submission modal styles */
        .submission-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .submission-content {
            background-color: white;
            width: 80%;
            max-width: 800px;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
            max-height: 80vh;
            overflow-y: auto;
        }
        .submission-content h2 {
            margin-top: 0;
            color: #0066cc;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 10px;
        }
        .submission-content p {
            margin-bottom: 20px;
            color: #333;
        }
        .answers-section {
            margin-top: 20px;
        }
        .answers-section h3 {
            color: #0066cc;
            margin-bottom: 15px;
        }
        .answer-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            border-left: 4px solid #ddd;
            background-color: #f9f9f9;
        }
        .answer-item.correct {
            border-left-color: #4CAF50;
            background-color: #f0fff0;
        }
        .answer-item.incorrect {
            border-left-color: #f44336;
            background-color: #fff0f0;
        }
        .answer-text {
            font-weight: bold;
        }
        .correct-answer {
            color: #4CAF50;
            margin-left: 10px;
        }
        .incorrect-answer {
            color: #f44336;
            margin-left: 10px;
        }
        .answer-status {
            float: right;
            margin-left: 15px;
        }
        .correct-status {
            color: #4CAF50;
        }
        .incorrect-status {
            color: #f44336;
        }
        .submission-buttons {
            margin-top: 25px;
            text-align: right;
            clear: both;
        }
        .submission-buttons button {
            padding: 8px 15px;
            margin-left: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .submission-buttons .confirm {
            background: #0066cc;
            color: white;
            border: none;
        }
        /* Disabled state */
        input:disabled, select:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        /* Score display styles */
        .score-display {
            text-align: center;
            margin-bottom: 20px;
        }
        .score-number {
            font-size: 3rem;
            font-weight: bold;
            color: #0066cc;
            margin: 10px 0;
        }
        .score-total {
            font-size: 1.5rem;
            color: #666;
        }
        .performance-rating {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .excellent {
            color: #2E7D32;
            background-color: #E8F5E9;
        }
        .very-good {
            color: #388E3C;
            background-color: #E8F5E9;
        }
        .good {
            color: #689F38;
            background-color: #F1F8E9;
        }
        .fair {
            color: #F57C00;
            background-color: #FFF3E0;
        }
        .poor {
            color: #D32F2F;
            background-color: #FFEBEE;
        }
        /* IELTS Band Score */
        .band-score {
            font-size: 2rem;
            font-weight: bold;
            color: #0066cc;
            margin: 10px 0;
        }
        /* Correct answer highlight */
        .correct-highlight {
            background-color: rgba(76, 175, 80, 0.3);
            padding: 2px;
            border-radius: 2px;
        }
        /* Incorrect answer highlight */
        .incorrect-highlight {
            background-color: rgba(244, 67, 54, 0.3);
            padding: 2px;
            border-radius: 2px;
        }
        /* Answer comparison section */
        .answer-comparison {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
            display: none;
        }
        .answer-comparison h3 {
            margin-top: 0;
            color: #0066cc;
        }
        /* Time spent indicator */
        .time-spent {
            font-size: 1rem;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
        }
        /* Dropdown answer display */
        .dropdown-answer {
            display: inline-block;
            margin-left: 10px;
            font-weight: normal;
        }
        .dropdown-answer.correct {
            color: #4CAF50;
        }
        .dropdown-answer.incorrect {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="test-wrapper">
        <!-- Header with Timer -->
        <header class="header">
            <div class="header__logo">
                <img src="https://d2snzxottmona5.cloudfront.net/releases/3.46.0/images/logo/ielts.svg" alt="IELTS Logo">
            </div>
            <div class="header__timer" id="testTimer">00:00</div>
            <div class="header__icons">
                <i class="fas fa-wifi header__icon"></i>
                <i class="fas fa-bell header__icon"></i>
                <i class="fas fa-cog header__icon" id="settingsButton"></i>
            </div>
        </header>

        <!-- Settings Modal -->
        <div class="settings-modal" id="settingsModal">
            <div class="settings-content">
                <div class="settings-header">
                    <h2>Options</h2>
                    <button class="settings-close" id="settingsClose">&times;</button>
                </div>
                <div class="settings-body">
                    <div class="settings-option">
                        <i class="fas fa-paper-plane"></i>
                        <span>Go to submission page</span>
                    </div>
                    <div class="settings-option" id="contrastOption">
                        <i class="fas fa-adjust"></i>
                        <span>Contrast</span>
                    </div>
                    <div class="settings-option" id="textSizeOption">
                        <i class="fas fa-search-plus"></i>
                        <span>Text size</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section Rubric -->
        <div class="sectionRubric" id="sectionRubric">
            <h2>Part 2</h2>
            <p>Read the text and answer questions 17-32.</p>
        </div>

        <div class="test-container">
            <!-- Passage Section -->
            <div class="passage-container" id="passage-container">
                <div class="highlight-toolbar" id="highlightToolbar">
                    <button class="highlight-color yellow" data-color="yellow" title="Yellow highlight"></button>
                    <button class="highlight-color green" data-color="green" title="Green highlight"></button>
                    <button class="highlight-color pink" data-color="pink" title="Pink highlight"></button>
                    <button class="highlight-color blue" data-color="blue" title="Blue highlight"></button>
                    <button class="remove" title="Remove highlight"><i class="fas fa-times"></i></button>
                </div>

                <div id="passageContent">
                    <h2 style="text-align: center;">The growing industry of background music</h2>
                    <p style="text-align: center; font-style: italic;">The background music industry has become more sophisticated and more influential than many people realise.</p>
                    <p><strong>A</strong> Music can be surprisingly powerful, even when it is played in the background and is barely noticeable. Over recent decades, creating background music has become a booming industry. Researchers have found that music played in commercial settings can have an impact on how much time we think has passed while waiting in a queue, how engaged customers are with sales staff, and even how sweet or bitter food tastes.</p>
                    <p><strong>B</strong> Rob Wood is the founder of Music Concierge in the UK, a company that chooses background music for businesses. Some clients hire Wood because they want to influence behaviour, others seek to create a certain atmosphere, culture or ambience. The core of a music consultant's work is creating distinct, cohesive musical identities for brands. In 2018, Wood worked on music for a new hotel. His brief was to produce distinct playlists for separate areas: the lobby, the restaurant and the gym. The hotel manager explained every detail: the build materials, the history, and a prediction of the average restaurant bill. Much of Wood's job involves taking abstract suggestions and turning them into music. A large amount of intuition is also required. It is a complex process and part of his job is comprehending what businesses really want, which can be very demanding. It is sometimes hard to know whether he should deliver something that will precisely match expectations or pleasantly surprise them.</p>
                    <p><strong>C</strong> In the 1920s, George Owen Squier, a former US army officer, developed a new way to transmit audio through wires. His idea led to the creation of Wired Music (renamed Muzak), which enabled businesses to play music throughout offices and commercial premises. In its early days, Muzak sold itself on the basis that its music would enhance job performance. Its programme for offices and factories played classical recordings in 15-minute sequences, alternated with silence. Each time the music sequence resumed, it rose in intensity. Muzak set the template for background music that would persist for decades. In terms of distribution, Muzak used wires to convey its music; the company sent a bulky cartridge to its customers through the post and it was then played through a specially designed device. In the 1970s, the introduction of affordable multi-deck tape players suddenly made it easy for businesses to choose and play music continuously. The CD was the first digital format for music and, by the late 1990s, it had enabled background music companies to develop digital libraries where tracks could be organised according to preference. But that was just a taste of the new world of infinite choice that was to come.</p>
                    <p><strong>D</strong> Despite technological advances, it's the influence that background music has on customer behaviour which is driving its growth. Psychologists believe that music influences consumers in two main ways. The first is physical; numerous studies have confirmed that we often subconsciously match what we are doing to what we hear. For instance, one study found that diners chewed faster when higher-tempo music was played. The second approach focuses on the associations that music can trigger. Another study revealed that diners in a cafeteria were willing to part with more money when classical music was played in the background than when there was none at all. One explanation, researchers suggested, was that diners associated classical music with quality.</p>
                    <p><strong>E</strong> However, it is the inoffensive nature of this kind of background music that creates some of the industry's fiercest critics. A UK group, Pipedown, founded by Nigel Rodgers, campaigns 'for freedom from unwanted music in public places'. The group claims that such music is impossible to escape and adds to the overall levels of noise pollution in public. 'You're not going for a special sort of atmosphere, you're just going to do your shopping,' Rodgers said. One of Pipedown's boldest claims is that there is 'no genuine evidence' that background music increases sales. Opinions vary on this question, although most professionals do not share Pipedown's position. Adrian North, a psychology professor at Curtin University in Perth, Australia, argues that small purchases are where it is most possible to influence consumers. He conducted a study that found that customers were more likely to choose either French or German wine, depending on which of the respective countries' music they heard, something he contrasted with a decision like buying a car where music would not have such an impact.</p>
                    <p><strong>F</strong> Others argue that it makes more sense to think about the influence of background music in terms of subtle, long-term benefits, rather than immediate impact on sales. Rhonda Hadi, marketing professor at Oxford University, UK, believes companies that provide an experience, such as flights or accommodation, can reap the greatest rewards. She believes that people 'rely on any cues they can to gauge the quality of the service that they've received'. Companies have capitalised on the sweeping changes to the world of retail in recent years. Many businesses are no longer just functional places to buy things, they are presented as an experience. Since 2008, streaming music via the internet has become the way most people listen to music. For background music companies, streaming is both a threat and an opportunity. On the one hand, companies can select and tailor the music they deliver to businesses with greater speed, flexibility and precision than ever before. On the other hand, access to vast music libraries has made everyone a music specialist. However, Richard Hampson at Imagesound believes a real-life curator is indispensable. He emphasises the intuitive side to his job. 'It's always been about feel and human touch,' he argues. 'Human taste is really important.'</p>
                </div>
            </div>

            <!-- Draggable Divider -->
            <div class="divider" id="divider">
                <div class="divider-handle"></div>
            </div>

            <!-- Questions Section -->
            <div class="questions-container" id="questions-container">
                <!-- Questions 17-22 - Matching Information -->
                <div class="question">
                    <div class="question-rubric">
                        <h3>Questions 17-22</h3>
                        <p>Reading Passage 2 has six paragraphs, <strong>A-F</strong>.</p>
                        <p>Which paragraph contains the following information?</p>
                        <p>Write the correct letter, <strong>A-F</strong>, in boxes <strong>17-22</strong> on your answer sheet.</p>
                        <p><strong>NB</strong> You may use any letter more than once.</p>
                    </div>
                    <div class="question-content">
                        <div class="question-item">
                            <p><span class="question-number">17</span> details of how modern developments have created positive and negative consequences for the industry</p>
                            <div class="matching-option">
                                <select name="q17" id="q17">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">18</span> an account of opposition to the use of background music</p>
                            <div class="matching-option">
                                <select name="q18" id="q18">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">19</span> a comparison of customer spending patterns with and without background music</p>
                            <div class="matching-option">
                                <select name="q19" id="q19">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">20</span> a mention of how background music can make shoppers more responsive to shop assistants</p>
                            <div class="matching-option">
                                <select name="q20" id="q20">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">21</span> details of a project which required different music in various parts of a building</p>
                            <div class="matching-option">
                                <select name="q21" id="q21">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">22</span> a mention of how the pace of the music influences how quickly food is consumed</p>
                            <div class="matching-option">
                                <select name="q22" id="q22">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Questions 23-27 - Matching Statements to Experts -->
                <div class="question">
                    <div class="question-rubric">
                        <h3>Questions 23-27</h3>
                        <p>Look at the following statements (Questions <strong>23-27</strong>) and the list of people below.</p>
                        <p>Match each statement with the correct person, <strong>A-E</strong>.</p>
                        <p>Write the correct letter, <strong>A-E</strong>, in boxes <strong>23-27</strong> on your answer sheet.</p>
                    </div>
                    <div class="question-content">
                        <div class="question-item">
                            <p><span class="question-number">23</span> It is difficult to understand a client's specific wish.</p>
                            <div class="matching-option">
                                <select name="q23" id="q23">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">24</span> Background music is especially beneficial to the tourism industry.</p>
                            <div class="matching-option">
                                <select name="q24" id="q24">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">25</span> Background music has more effect on people who are spending less.</p>
                            <div class="matching-option">
                                <select name="q25" id="q25">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">26</span> A creative music expert is crucial for businesses choosing background music.</p>
                            <div class="matching-option">
                                <select name="q26" id="q26">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                </select>
                            </div>
                        </div>
                        <div class="question-item">
                            <p><span class="question-number">27</span> Buying goods does not require a particular environment.</p>
                            <div class="matching-option">
                                <select name="q27" id="q27">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                </select>
                            </div>
                        </div>
                        <h3>List of Experts</h3>
                        <p><strong>A</strong> Rob Wood</p>
                        <p><strong>B</strong> Nigel Rodgers</p>
                        <p><strong>C</strong> Adrian North</p>
                        <p><strong>D</strong> Rhonda Hadi</p>
                        <p><strong>E</strong> Richard Hampson</p>
                    </div>
                </div>

                <!-- Questions 28-32 - Summary Completion -->
                <div class="question">
                    <div class="question-rubric">
                        <h3>Questions 28-32</h3>
                        <p>Complete the summary below.</p>
                        <p>Choose ONE WORD ONLY from the passage for each answer.</p>
                        <p>Write your answers in boxes <strong>28-32</strong> on your answer sheet.</p>
                    </div>
                    <div class="question-content">
                        <div class="summary-completion-container">
                            <div class="summary-text">
                                <p style="text-align: center;"><strong>The history of background music</strong></p>
                                <p>In 1920, George Squier developed a way of transmitting music using a system of wires. His company claimed that <input type="text" class="summary-input" id="q28" name="q28"> at work could be improved with the use of its audio programmes. However, in this audio format there was <input type="text" class="summary-input" id="q29" name="q29"> between each short musical section. Gradually, the <input type="text" class="summary-input" id="q30" name="q30"> of the music increased. Muzak became the template for music in businesses for years to come. Different ways existed however; some companies delivered pre-recorded music in the form of a <input type="text" class="summary-input" id="q31" name="q31">. Later, in the 1970s, tapes were used, but the real change came with the move to CDs. With these, background music specialists were able to arrange music selections into <input type="text" class="summary-input" id="q32" name="q32"> on a computer.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <nav class="nav-row perScorableItem" aria-label="Questions">
                <div class="footer__questionWrapper selected multiple" role="tablist">
                    <button role="tab" class="footer__questionNo" data-sectionid="128121930" tabindex="-1">
                        <span>
                            <span aria-hidden="true" class="section-prefix">Part </span>
                            <span class="sectionNr" aria-hidden="true">2</span>
                        </span>
                    </button>
                    <div class="footer__subquestionWrapper">
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="17" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 17</span>
                            <span aria-hidden="true">17</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="18" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 18</span>
                            <span aria-hidden="true">18</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="19" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 19</span>
                            <span aria-hidden="true">19</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="20" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 20</span>
                            <span aria-hidden="true">20</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="21" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 21</span>
                            <span aria-hidden="true">21</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="22" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 22</span>
                            <span aria-hidden="true">22</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="23" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 23</span>
                            <span aria-hidden="true">23</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="24" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 24</span>
                            <span aria-hidden="true">24</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="25" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 25</span>
                            <span aria-hidden="true">25</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="26" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 26</span>
                            <span aria-hidden="true">26</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="27" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 27</span>
                            <span aria-hidden="true">27</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="28" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 28</span>
                            <span aria-hidden="true">28</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="29" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 29</span>
                            <span aria-hidden="true">29</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="30" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 30</span>
                            <span aria-hidden="true">30</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="31" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 31</span>
                            <span aria-hidden="true">31</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                        <button class="subQuestion" data-contentrevisionid="128121896" data-ordernumber="32" data-sectionid="128121930" tabindex="0">
                            <span class="sr-only">Question 32</span>
                            <span aria-hidden="true">32</span>
                            <span class="sr-only">Not attempted</span>
                        </button>
                    </div>
                </div>
                <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton">
                    <i class="fas fa-check"></i> Submit
                </button>
            </nav>
        </footer>
    </div>

    <!-- Submission Modal -->
    <div class="submission-modal" id="submissionModal">
        <div class="submission-content">
            <h2 id="submissionTitle">Test Results</h2>
            <div class="score-display">
                <div>Your Score:</div>
                <div class="score-number" id="userScore">0</div>
                <div class="score-total">out of <span id="totalQuestions">16</span></div>
                <div class="band-score" id="bandScore">Band: 0.0</div>
                <div class="performance-rating" id="performanceRating">Poor - Needs Improvement</div>
            </div>
            <div class="time-spent" id="timeSpent"></div>
            <p id="submissionMessage">Here are your answers with the correct solutions:</p>
            <div class="answers-section">
                <h3>Your Answers:</h3>
                <div id="answersList"></div>
            </div>
            <div class="submission-buttons">
                <button class="confirm" id="closeSubmission">Close</button>
            </div>
        </div>
    </div>

    <!-- Answer Comparison Section -->
    <div class="answer-comparison" id="answerComparison">
        <h3>Answer Comparison</h3>
        <p>Your answers are highlighted below. Correct answers are marked in <span class="correct-highlight">green</span>, incorrect answers in <span class="incorrect-highlight">red</span>.</p>
    </div>

    <script>
        // Correct answers
        const correctAnswers = {
            17: "F",
            18: "E",
            19: "D",
            20: "A",
            21: "B",
            22: "D",
            23: "A",
            24: "D",
            25: "C",
            26: "E",
            27: "B",
            28: "performance",
            29: "silence",
            30: "intensity",
            31: "cartridge",
            32: "libraries"
        };

        // Timer functionality - stopwatch (count up from zero)
        let totalSeconds = 0;
        const timerElement = document.getElementById('testTimer');
        let testSubmitted = false;
        let warningShown = false;
        let userAnswers = {};
        let startTime = new Date();
        let resultsShown = false;

        function updateTimer() {
            if (testSubmitted) return;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            timerElement.textContent = formattedTime;
            totalSeconds++;
        }

        function handleTimeExpired() {
            // Remove this function since we're using a stopwatch now
            // Timer will continue counting up indefinitely
        }

        function disableAllInputs() {
            document.querySelectorAll('input[type="text"], select').forEach(input => {
                input.disabled = true;
            });
            document.getElementById('deliver-button').disabled = true;
            document.removeEventListener('mouseup', handleTextSelection);
        }

        function showSubmissionModal(title, message) {
            const modal = document.getElementById('submissionModal');
            document.getElementById('submissionTitle').textContent = title;
            document.getElementById('submissionMessage').textContent = message;

            // Calculate time spent
            const endTime = new Date();
            const timeDiff = endTime - startTime;
            const minutes = Math.floor(timeDiff / 60000);
            const seconds = Math.floor((timeDiff % 60000) / 1000);
            document.getElementById('timeSpent').textContent = `Time spent: ${minutes}m ${seconds}s`;

            const answersList = document.getElementById('answersList');
            answersList.innerHTML = '';

            let score = 0;
            userAnswers = {};

            // Process Matching Information questions (17-22)
            for (let i = 17; i <= 22; i++) {
                const select = document.querySelector(`select[name="q${i}"]`);
                const userAnswer = select.value || 'Not answered';
                userAnswers[i] = userAnswer;
                const correctAnswer = correctAnswers[i];
                const isCorrect = userAnswer === correctAnswer;

                if (isCorrect) score++;

                const answerItem = document.createElement('div');
                answerItem.className = `answer-item ${isCorrect ? 'correct' : 'incorrect'}`;
                answerItem.innerHTML = `
                    <div class="answer-text">Question ${i}: ${userAnswer}</div>
                    <span class="${isCorrect ? 'correct-answer' : 'incorrect-answer'}">(Correct answer: ${correctAnswer})</span>
                    <span class="answer-status ${isCorrect ? 'correct-status' : 'incorrect-status'}">
                        ${isCorrect ? '' : ''}
                    </span>
                `;
                answersList.appendChild(answerItem);
            }

            // Process Matching Statements to Experts questions (23-27)
            for (let i = 23; i <= 27; i++) {
                const select = document.querySelector(`select[name="q${i}"]`);
                const userAnswer = select.value || 'Not answered';
                userAnswers[i] = userAnswer;
                const correctAnswer = correctAnswers[i];
                const isCorrect = userAnswer === correctAnswer;

                if (isCorrect) score++;

                const answerItem = document.createElement('div');
                answerItem.className = `answer-item ${isCorrect ? 'correct' : 'incorrect'}`;
                const expertName = {
                    'A': 'Rob Wood',
                    'B': 'Nigel Rodgers',
                    'C': 'Adrian North',
                    'D': 'Rhonda Hadi',
                    'E': 'Richard Hampson'
                }[correctAnswer] || correctAnswer;
                answerItem.innerHTML = `
                    <div class="answer-text">Question ${i}: ${userAnswer}</div>
                    <span class="${isCorrect ? 'correct-answer' : 'incorrect-answer'}">(Correct answer: ${correctAnswer} - ${expertName})</span>
                    <span class="answer-status ${isCorrect ? 'correct-status' : 'incorrect-status'}">
                        ${isCorrect ? '' : ''}
                    </span>
                `;
                answersList.appendChild(answerItem);
            }

            // Process Summary Completion questions (28-32)
            for (let i = 28; i <= 32; i++) {
                const input = document.querySelector(`input[name="q${i}"]`);
                const userAnswer = input.value.trim().toLowerCase() || 'Not answered';
                userAnswers[i] = userAnswer;
                const correctAnswer = correctAnswers[i];
                const isCorrect = userAnswer === correctAnswer.toLowerCase();

                if (isCorrect) score++;

                const answerItem = document.createElement('div');
                answerItem.className = `answer-item ${isCorrect ? 'correct' : 'incorrect'}`;
                answerItem.innerHTML = `
                    <div class="answer-text">Question ${i}: ${userAnswer}</div>
                    <span class="${isCorrect ? 'correct-answer' : 'incorrect-answer'}">(Correct answer: ${correctAnswer})</span>
                    <span class="answer-status ${isCorrect ? 'correct-status' : 'incorrect-status'}">
                        ${isCorrect ? '' : ''}
                    </span>
                `;
                answersList.appendChild(answerItem);
            }

            // Update score display
            document.getElementById('userScore').textContent = score;
            document.getElementById('totalQuestions').textContent = "16";

            // Calculate IELTS band score
            const bandScore = calculateBandScore(score);
            document.getElementById('bandScore').textContent = `Band: ${bandScore.toFixed(1)}`;

            // Calculate performance rating
            const percentage = (score / 16) * 100;
            let rating, ratingClass;
            if (score >= 14) {
                rating = "Excellent!";
                ratingClass = "excellent";
            } else if (score >= 12) {
                rating = "Very Good";
                ratingClass = "very-good";
            } else if (score >= 10) {
                rating = "Good";
                ratingClass = "good";
            } else if (score >= 8) {
                rating = "Fair";
                ratingClass = "fair";
            } else {
                rating = "Poor - Needs Improvement";
                ratingClass = "poor";
            }
            const ratingElement = document.getElementById('performanceRating');
            ratingElement.textContent = rating;
            ratingElement.className = `performance-rating ${ratingClass}`;

            // Highlight answers
            if (testSubmitted) {
                highlightAnswers(correctAnswers);
            }

            modal.style.display = 'flex';
            resultsShown = true;

            const submitButton = document.getElementById('deliver-button');
            submitButton.innerHTML = '<i class="fas fa-eye"></i> Show My Results';
            submitButton.disabled = false;
        }

        function calculateBandScore(score) {
            if (score >= 14) return 9.0;
            if (score >= 13) return 8.5;
            if (score >= 12) return 8.0;
            if (score >= 11) return 7.5;
            if (score >= 10) return 7.0;
            if (score >= 9) return 6.5;
            if (score >= 8) return 6.0;
            if (score >= 7) return 5.5;
            if (score >= 6) return 5.0;
            if (score >= 5) return 4.5;
            return 0.0;
        }

        function highlightAnswers(correctAnswers) {
            // Highlight Matching Information questions (17-22)
            for (let i = 17; i <= 22; i++) {
                const select = document.querySelector(`select[name="q${i}"]`);
                const userAnswer = userAnswers[i];
                const correctAnswer = correctAnswers[i];
                select.classList.remove('correct', 'incorrect');
                if (userAnswer && userAnswer !== 'Not answered') {
                    select.classList.add(userAnswer === correctAnswer ? 'correct' : 'incorrect');
                    const feedback = document.createElement('span');
                    feedback.className = `dropdown-answer ${userAnswer === correctAnswer ? 'correct' : 'incorrect'}`;
                    feedback.textContent = userAnswer === correctAnswer ? ' Correct' : ` Correct: ${correctAnswer}`;
                    if (!select.nextElementSibling || !select.nextElementSibling.classList.contains('dropdown-answer')) {
                        select.parentNode.appendChild(feedback);
                    }
                }
            }

            // Highlight Matching Statements to Experts questions (23-27)
            for (let i = 23; i <= 27; i++) {
                const select = document.querySelector(`select[name="q${i}"]`);
                const userAnswer = userAnswers[i];
                const correctAnswer = correctAnswers[i];
                select.classList.remove('correct', 'incorrect');
                if (userAnswer && userAnswer !== 'Not answered') {
                    select.classList.add(userAnswer === correctAnswer ? 'correct' : 'incorrect');
                    const feedback = document.createElement('span');
                    feedback.className = `dropdown-answer ${userAnswer === correctAnswer ? 'correct' : 'incorrect'}`;
                    const expertName = {
                        'A': 'Rob Wood',
                        'B': 'Nigel Rodgers',
                        'C': 'Adrian North',
                        'D': 'Rhonda Hadi',
                        'E': 'Richard Hampson'
                    }[correctAnswer] || correctAnswer;
                    feedback.textContent = userAnswer === correctAnswer ? ' Correct' : ` Correct: ${correctAnswer} - ${expertName}`;
                    if (!select.nextElementSibling || !select.nextElementSibling.classList.contains('dropdown-answer')) {
                        select.parentNode.appendChild(feedback);
                    }
                }
            }

            // Highlight Summary Completion questions (28-32)
            for (let i = 28; i <= 32; i++) {
                const input = document.querySelector(`input[name="q${i}"]`);
                const userAnswer = userAnswers[i];
                const correctAnswer = correctAnswers[i];
                input.classList.remove('correct', 'incorrect');
                if (userAnswer && userAnswer !== 'Not answered') {
                    input.classList.add(userAnswer === correctAnswer.toLowerCase() ? 'correct' : 'incorrect');
                    const feedback = document.createElement('span');
                    feedback.className = `summary-feedback ${userAnswer === correctAnswer.toLowerCase() ? 'correct' : 'incorrect'}`;
                    feedback.textContent = userAnswer === correctAnswer.toLowerCase() ? ' Correct' : ` Correct: ${correctAnswer}`;
                    if (!input.nextElementSibling || !input.nextElementSibling.classList.contains('summary-feedback')) {
                        input.parentNode.insertBefore(feedback, input.nextSibling);
                    }
                }
            }

            document.getElementById('answerComparison').style.display = 'block';
        }

        // Handle manual submission
        document.getElementById('deliver-button').addEventListener('click', function() {
            if (resultsShown) {
                document.getElementById('submissionModal').style.display = 'flex';
                return;
            }
            if (testSubmitted) return;
            if (confirm('Are you sure you want to submit your test? You won\'t be able to make changes after submission.')) {
                clearInterval(timerInterval);
                testSubmitted = true;
                disableAllInputs();
                showSubmissionModal('Test Submitted', 'Thank you for completing the test.');
            }
        });

        // Close submission modal and show answer comparison
        document.getElementById('closeSubmission').addEventListener('click', function() {
            document.getElementById('submissionModal').style.display = 'none';
            highlightAnswers(correctAnswers);
        });

        // Start the timer
        const timerInterval = setInterval(updateTimer, 1000);

        // Settings Modal functionality
        const settingsButton = document.getElementById('settingsButton');
        const settingsModal = document.getElementById('settingsModal');
        const settingsClose = document.getElementById('settingsClose');

        settingsButton.addEventListener('click', function() {
            settingsModal.style.display = 'flex';
        });

        settingsClose.addEventListener('click', function() {
            settingsModal.style.display = 'none';
        });

        window.addEventListener('click', function(event) {
            if (event.target === settingsModal) {
                settingsModal.style.display = 'none';
            }
            if (event.target === document.getElementById('submissionModal')) {
                document.getElementById('submissionModal').style.display = 'none';
            }
        });

        // Draggable Divider Functionality
        const divider = document.getElementById('divider');
        const passageContainer = document.getElementById('passage-container');
        const questionsContainer = document.getElementById('questions-container');

        let isDragging = false;
        let startX, startPassageWidth;

        divider.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startPassageWidth = parseInt(document.defaultView.getComputedStyle(passageContainer).width, 10);
            document.body.style.cursor = 'col-resize';
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
            e.preventDefault();
        });

        function onMouseMove(e) {
            if (!isDragging) return;
            const containerWidth = document.querySelector('.test-container').offsetWidth;
            const newPassageWidth = startPassageWidth + e.clientX - startX;
            const minWidth = containerWidth * 0.3;
            const maxWidth = containerWidth * 0.7;
            if (newPassageWidth >= minWidth && newPassageWidth <= maxWidth) {
                passageContainer.style.width = `${newPassageWidth}px`;
            }
        }

        function onMouseUp() {
            isDragging = false;
            document.body.style.cursor = '';
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
        }

        divider.addEventListener('selectstart', (e) => {
            if (isDragging) e.preventDefault();
        });

        // Question navigation functionality
        document.querySelectorAll('.subQuestion').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.subQuestion').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                const questionNumber = parseInt(this.textContent.trim());
                if (questionNumber >= 17 && questionNumber <= 22) {
                    document.querySelector('.question:nth-of-type(1)').scrollIntoView({ behavior: 'smooth' });
                } else if (questionNumber >= 23 && questionNumber <= 27) {
                    document.querySelector('.question:nth-of-type(2)').scrollIntoView({ behavior: 'smooth' });
                } else if (questionNumber >= 28 && questionNumber <= 32) {
                    document.querySelector('.question:nth-of-type(3)').scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Enhanced Highlighting functionality
        const highlightToolbar = document.getElementById('highlightToolbar');
        let selectedText = '';
        let selectedRange = null;
        let currentHighlightColor = null;

        document.querySelectorAll('#passageContent, .questions-container').forEach(element => {
            element.style.userSelect = 'text';
            element.style.webkitUserSelect = 'text';
        });

        function handleTextSelection() {
            const selection = window.getSelection();
            selectedText = selection.toString().trim();
            if (selectedText.length > 0 && isTextInContent(selection)) {
                selectedRange = selection.getRangeAt(0);
                const rangeRect = selectedRange.getBoundingClientRect();
                highlightToolbar.style.display = 'block';
                highlightToolbar.style.top = `${rangeRect.top + window.scrollY - 35}px`;
                highlightToolbar.style.left = `${rangeRect.left + window.scrollX + (rangeRect.width / 2)}px`;
            } else {
                highlightToolbar.style.display = 'none';
            }
        }

        function isTextInContent(selection) {
            if (!selection.rangeCount) return false;
            const range = selection.getRangeAt(0);
            const contentAreas = document.querySelectorAll('#passageContent, .question-content');
            return Array.from(contentAreas).some(area => area.contains(range.commonAncestorContainer));
        }

        document.addEventListener('mouseup', handleTextSelection);

        document.addEventListener('mousedown', function(e) {
            if (!highlightToolbar.contains(e.target)) {
                highlightToolbar.style.display = 'none';
            }
        });

        document.querySelectorAll('.highlight-color').forEach(button => {
            button.addEventListener('click', function() {
                currentHighlightColor = this.dataset.color;
                applyHighlight();
            });
        });

        function applyHighlight() {
            if (selectedText.length > 0 && selectedRange) {
                const hasHighlights = checkForHighlightsInRange(selectedRange);
                if (hasHighlights) {
                    removeHighlightsInRange(selectedRange);
                } else if (currentHighlightColor) {
                    const span = document.createElement('span');
                    span.className = `highlight ${currentHighlightColor}`;
                    selectedRange.surroundContents(span);
                }
                window.getSelection().removeAllRanges();
                highlightToolbar.style.display = 'none';
            }
        }

        function checkForHighlightsInRange(range) {
            const documentFragment = range.cloneContents();
            const tempDiv = document.createElement('div');
            tempDiv.appendChild(documentFragment);
            return tempDiv.querySelector('.highlight') !== null;
        }

        function removeHighlightsInRange(range) {
            const documentFragment = range.cloneContents();
            const tempDiv = document.createElement('div');
            tempDiv.appendChild(documentFragment);
            const highlights = tempDiv.querySelectorAll('.highlight');
            if (highlights.length > 0) {
                const newRange = range.cloneRange();
                const fragment = newRange.extractContents();
                const textFragment = document.createDocumentFragment();
                extractTextNodes(fragment, textFragment);
                newRange.insertNode(textFragment);
            }
        }

        function extractTextNodes(source, destination) {
            const walker = document.createTreeWalker(
                source,
                NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,
                null,
                false
            );
            let node;
            while (node = walker.nextNode()) {
                if (node.nodeType === Node.TEXT_NODE) {
                    destination.appendChild(document.createTextNode(node.nodeValue));
                } else if (!node.classList.contains('highlight')) {
                    const container = node.cloneNode(false);
                    extractTextNodes(node, container);
                    destination.appendChild(container);
                }
            }
        }

        document.querySelector('.highlight-toolbar .remove').addEventListener('click', function() {
            if (selectedText.length > 0 && selectedRange) {
                removeHighlightsInRange(selectedRange);
                window.getSelection().removeAllRanges();
                highlightToolbar.style.display = 'none';
            }
        });

        // Mark questions as attempted when answered
        document.querySelectorAll('select, input[type="text"]').forEach(input => {
            input.addEventListener('change', function() {
                const questionNumber = parseInt(this.name.replace('q', ''));
                const questionButton = document.querySelector(`.subQuestion[data-ordernumber="${questionNumber}"]`);
                if (questionButton && (this.value || this.value.trim())) {
                    questionButton.classList.add('attempted');
                }
            });
        });
    </script>
</body>
</html>