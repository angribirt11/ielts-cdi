<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS CDI Listening Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
            padding-bottom: 90px; /* nav-row height (80px) + some extra spacing */
        }

        /* Page watermark */
        body::after {
            content: "@Avazbeks_media";
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 72px;
            font-weight: 800;
            letter-spacing: 2px;
            color: #000000;
            opacity: 0.02; /* subtle */
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
            color: #3e3e3e;
            text-decoration: none;
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border: 2px solid #3e3e3e;
            border-radius: 9999px;
            background-color: #ffffff;
            line-height: 1;
        }

        .telegram-link:hover {
            background-color: #f6f6f6;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            background: #ffffff;
            padding-bottom: 100px; /* Space for bottom nav */
        }

        .main-container.results-mode {
            display: flex;
            flex-direction: row;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
            transition: width 0.4s ease;
        }

        .main-container.results-mode .left-panel {
            width: 75%;
            overflow-y: auto;
            height: calc(100vh - 195px);
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
            height: calc(100vh - 195px);
        }

        #transcription-container h2 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #transcription-text {
            white-space: pre-wrap; /* preserve line breaks from source */
            font-family: inherit;
            font-size: 15px;
            line-height: 1.7;
        }
        
        .transcription-instruction {
            display: block;
            margin: 1em 0;
            font-style: italic;
            color: #444;
        }

        .main-container.results-mode .right-panel {
            display: block;
            width: 25%;
            border-left: 1px solid #e0e0e0;
            border-top: none;
            height: calc(100vh - 195px);
            overflow-y: auto;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        /* Inline correct answer hint (shown after checking) */
        .correct-inline {
            color: #28a745;
            font-weight: 700;
            margin-left: 10px;
            display: inline-block;
            vertical-align: middle;
            white-space: nowrap;
        }
        .correct-inline::before {
            content: "\2192  "; /* right arrow */
            font-weight: 700;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        #part-1 table td {
            line-height: 1.8;
        }
        /* Increase line height for tables in Part 4 */
        #part-4 table td {
            line-height: 2.0;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        #part-4 table td div { margin: 8px 0; }
        /* Increase line height for Part 3 table (Questions 24-30) */
        #part-3 table td {
            line-height: 2.0;
            padding-top: 10px;
            padding-bottom: 10px;
            vertical-align: top;
        }
        /* Geosequestration table styling */
        .geo-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .geo-table th, .geo-table td { border: 1px solid #e5e7eb; padding: 14px; vertical-align: top; }
        .geo-table thead th { background: #f7f9fc; text-align: center; font-weight: 700; }
        .geo-table .arrow-row td { text-align: center; font-size: 20px; color: #6b7280; }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        .centered-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px auto;
            width: 100%;
            max-width: 600px;
            display: block;
        }
        .map-container img {
            width: 100%;
            display: block;
        }
        .map-drop-zone {
            position: absolute;
            width: 13%;
            height: 15%;
            border: 2px dashed #999;
            background-color: rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #555;
            border-radius: 4px;
            padding: 2px;
        }
        .map-drop-zone:hover {
            background-color: rgba(230, 244, 255, 0.7);
            border-color: #4a90e2;
        }
        .map-drop-zone .drag-item {
            font-size: 14px;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
        }
        .map-options-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .map-options-list .drag-item {
            width: calc(25% - 10px);
            text-align: center;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 101;
        }

        .nav-arrow {
            width: 50px;
            height: 50px;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
        }

        .nav-arrow:hover {
            background: #555;
        }

        .nav-arrow:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;

            /* Allow horizontal scrolling on smaller screens */
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent "Score/Band" button text overflow on small screens */
        .footer__deliverButton___3FM07 {
            max-width: 42%;
            white-space: normal;          /* allow wrapping */
            word-break: break-word;       /* break long text if needed */
            line-height: 1.2;
        }
        @media (max-width: 768px) {
            .footer__deliverButton___3FM07 {
                max-width: 55%;
                padding: 10px 12px;
                font-size: 14px;
            }
        }
        @media (max-width: 480px) {
            .footer__deliverButton___3FM07 {
                max-width: 65%;
                padding: 8px 10px;
                font-size: 13px;
            }
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
            flex-shrink: 0;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 1024px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s, border-color 0.2s;
            min-width: 170px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #e0e0e0;
            border-color: #bbb;
        }
        /* Success style for "My Results" button after checking */
        .footer__deliverButton___3FM07.success {
            background-color: #28a745;
            color: #fff;
            border-color: #28a745;
        }
        .footer__deliverButton___3FM07.success:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #ddd;
        }

        .fa-check::before {
            content: "✓";
        }

        .hidden {
            display: none;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #9aa3ad;
            border-radius: 4px;
            background-color: #fff;
            padding: 4px 8px;
            font-size: 16px;
            text-align: left; /* start typing from left */
            margin-right: 4px;
            width: 140px;
            max-width: 160px;
            min-width: 120px;
            word-break: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            height: 28px;
            min-height: 28px;
            line-height: 1.2;
            vertical-align: middle;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }
        .answer-input::placeholder {
            color: #999;
            font-weight: bold;
            text-align: center; /* numbers centered until typing starts */
        }
        .answer-input:focus {
            outline: none;
            border-color: #2c6bed;
            border-width: 2px;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            min-height: 200px;
        }
        .drag-item {
            background: white;
    border: 1px solid #9c9c9c;
    font-weight: 600;
    padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            height: 25px;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px 5px;
            display: flex;
            align-items: center;
            position: relative;
            color: #b3b3b3;
            font-weight: 600;
            min-width: 200px;
            width: auto;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        /* Letter pill displayed inside drop-zones */
        .drop-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 22px;
            height: 20px;
            padding: 0 6px;
            border: 1px solid #4a90e2;
            color: #0f5bd7;
            background: #eef5ff;
            border-radius: 9999px;
            font-weight: 700;
            cursor: move;
            user-select: none;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone .drag-item {
            cursor: default;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 1px #4a90e2;
        }
        .questions-container {
            width: 50%;
        }
        /* When transcription (results mode) is visible, give questions container 80% of left panel */
        .main-container.results-mode .questions-container {
            width: 80%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        .part-header p {
            margin: 0;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            margin: 20px 0;
        }

        .timer-container {
            display: none; /* Timer hidden */
            color: #333;
            font-size: 16px;
            font-weight: 500;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        @keyframes flash {
            0% { background-color: #e6f4ff; }
            100% { background-color: transparent; }
        }

        .question.flash {
            animation: flash 1s ease-out;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            font-size: 24px;
            color: #333;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #888;
            line-height: 1;
        }
        .modal-close-btn:hover {
            color: #333;
        }
        #score-summary {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        #result-details table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        #result-details th, #result-details td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            vertical-align: middle;
        }
        #result-details th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        #result-details td:nth-child(1) {
            font-weight: bold;
            text-align: center;
        }
        .result-correct {
            color: #28a745;
            font-weight: bold;
        }
        .result-incorrect {
            color: #dc3545;
            font-weight: bold;
        }

        .context-menu-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        .matching-container {
            display: flex;
            justify-content: space-between;
            gap: 40px;
            margin-top: 20px;
            align-items: flex-start;
        }
        /* Two-column drag-and-drop layout like screenshot */
        .dnd-col-title { font-weight: 700; margin-bottom: 10px; }
        .matching-question-container { display: flex; gap: 30px; align-items: flex-start; }
        .matching-options-bank { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .matching-questions { flex: 2; display: flex; flex-direction: column; gap: 24px; }
        .matching-questions .matching-question-item { display: flex; align-items: center; gap: 16px; padding: 6px 0; }
        .matching-questions .matching-question-item span { min-width: 180px; }
        .matching-questions .drop-zone { width: 100%; min-width: 360px; height: 34px; border: 2px dashed #aab3bd; border-radius: 4px; background: #fff; display: flex; align-items: center; padding: 0 8px; justify-content: flex-start; text-align: left; }
        .matching-questions .drop-zone .placeholder { color: #6b7280; font-weight: 700; }
        .matching-options-bank .drag-item { border-radius: 6px; padding: 6px 12px; background: #ffffff; border: 1px solid #d1d5db; font-weight: 600; box-shadow: 0 1px 0 rgba(0,0,0,0.02); }
        .matching-table {
            flex: 4;
            border-collapse: collapse;
        }
        .matching-table th, .matching-table td {
            padding: 6px 12px;
            text-align: left;
            vertical-align: middle;
        }
        .matching-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .matching-table .drop-zone {
            /* Unify with global drop-zone styling */
            border: 2px dashed #aaa;
            border-radius: 4px;
            height: 25px;
            width: 100%;
            max-width: none;
            min-width: 200px;
            padding: 0.5px 5px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            flex-wrap: nowrap;
            background-color: transparent;
            word-break: break-word;
            overflow-wrap: break-word;
            text-align: left;
            line-height: 1.2;
            color: #b3b3b3;
            font-weight: 600;
        }
        .matching-table .drop-zone .drag-item {
            width: auto;
            max-width: none;
            text-align: left;
            padding: 6px 8px;
            font-size: 14px;
            line-height: 1.2;
            word-break: break-word;
            overflow-wrap: break-word;
            box-sizing: border-box;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 2px;
        }
        .matching-options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            background-color: transparent;
            padding: 0;
            border: none;
            min-height: 250px;
            min-width: 280px; /* ensure enough width for long option text to stay on one line */
        }
        .matching-options-list .drag-item {
            width: 100%;
        }
        .matching-question-item .drop-zone .placeholder {
            color: #999;
            font-weight: bold;
        }

        /* Clickable cell styles for matching questions */
        .clickable-cell {
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            min-width: 50px;
            min-height: 50px;
            border: 2px solid #e0e0e0;
            position: relative;
            background-color: #f8f9fa;
            margin: 2px;
        }
       
        .clickable-cell:hover {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .clickable-cell.selected {
            background-color: #75a8e4 !important;
            color: white !important;
        }
       
        .clickable-cell.correct {
            background-color: #28a745 !important;
            color: white !important;
        }
        .clickable-cell.correct::after {
            content: "✓";
            font-weight: bold;
        }
        .clickable-cell.incorrect {
            background-color: #dc3545 !important;
            color: white !important;
        }
        .clickable-cell.incorrect::after {
            content: "✗";
            font-weight: bold;
        }
        

        
        .statement {
            font-weight: 500;
            padding-right: 20px;
        }

        .option strong,
        .question ul li label strong {
            display: none;
        }

        /* Mobile selection toolbar */
        .mobile-selection-menu {
            position: absolute;
            background: #333;
            color: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            display: flex;
            gap: 8px;
            z-index: 3000;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
        }
        .mobile-selection-menu button {
            background: transparent;
            border: 1px solid #fff;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        .mobile-selection-menu.hidden {
            display: none;
        }

        /* === Matching table styling for Questions 13-16 === */
        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .matching-table th,
        .matching-table td {
            border: 1px solid #ddd;
            padding: 8px 4px;
            vertical-align: middle;
            text-align: center;
        }
        .matching-table .clickable-cell {
            padding: 8px 4px;
            min-width: 50px;
            min-height: 50px;
        }
        .matching-table th {
            background-color: #1e6de6;
            color: #ffffff;
            font-weight: 600;
            text-align: center;
        }
        .matching-table th:first-child {
            text-align: left;
            background-color: #f8f9fa;
            color: #333;
        }
        .matching-table tbody td:first-child {
            font-weight: 500;
            text-align: left;
            background-color: #f8f9fa;
        }
        .matching-table tr:nth-child(even) td {
            background-color: #f8faff;
        }

        /* === MCQ table styling for Questions 11-15 === */
        .mcq-table {
            width: 100%;
            border-collapse: collapse;
        }
        .mcq-table th,
        .mcq-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            vertical-align: middle;
            text-align: center;
        }
        .mcq-table th {
            background-color: #1e6de6; /* vibrant blue header like screenshot */
            color: #ffffff;
            font-weight: 600;
            text-align: center;
        }
        .mcq-table th:first-child {
            text-align: left;
        }
        .mcq-table tbody td:first-child {
            font-weight: 500;
            text-align: left;
        }
        .mcq-table tr:nth-child(even) td {
            background-color: #f8faff; /* subtle alternating row colour */
        }
        .mcq-table input[type="radio"] {
            transform: scale(1.1);
            cursor: pointer;
        }
        /* list of options (A, B, C) shown above the table */
        .mcq-options {
            list-style: none;
            padding-left: 0;
            margin: 10px 0;
        }
        .mcq-options li {
            margin-bottom: 4px;
            font-size: 16px;
        }

        /* MCQ design: full-width selectable panels */
        .multi-choice-question { margin: 12px 0 18px; }
        .multi-choice-option { display:block; width:100%; padding: 12px 14px;  background-color: #fff; border: 1px solid transparent;  transition: background-color 0.2s ease, border-color 0.2s ease; }
        .multi-choice-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .multi-choice-option:has(input[type="radio"]:checked) { background-color: #cfe3f9; }
        .multi-choice-option label { display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 16px; width:100%; }

        .aligned-form .question-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .aligned-form .question-label {
            width: 230px;
            padding-right: 10px;
        }

        /* Responsive adjustments for tablets */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .right-panel, .main-container.results-mode .right-panel {
                display: none;
            }
            .left-panel, .main-container.results-mode .left-panel {
                width: 100%;
                padding: 20px 10px;
                height: auto; /* Reset height for mobile */
            }
            .questions-container {
                width: 100%;
            }
        }

        .single-choice label.correct {
            color: #155724;
            font-weight: bold;
        }
        .single-choice label.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .single-choice label.incorrect {
            color: #721c24;
            text-decoration: line-through;
        }
        .single-choice label.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }
        .mcq-table tbody tr.correct {
            background-color: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }
        .mcq-table tbody tr.incorrect {
            background-color: #f8d7da !important;
            text-decoration: line-through;
        }
        .mcq-table tbody tr.incorrect td {
            color: #721c24;
        }

        /* New Audio Player Styles */
        .audio-player-container {
            position: fixed;
            top: 65px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            max-width: 90%;
            height: 40px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 99;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .main-container {
            margin-top: 115px;
        }
        .player-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .player-btn svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }
        .progress-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #progress-bar {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 3px;
            cursor: pointer;
        }
        #progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
        }
        #progress-bar::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
            border: none;
        }
        #current-time, #total-duration {
            font-size: 12px;
            color: #555;
            min-width: 35px;
            text-align: center;
        }
        .controls-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .volume-container {
            display: flex;
            align-items: center;
            position: relative;
        }
        #new-volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 60px;
            height: 3px;
            background: #ccc;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
            margin-left: 8px;
            display: block; 
        }
    
        #new-volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
        }
        #new-volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            border: none;
        }
        .speed-container {
            position: relative;
        }
        #speed-btn {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 4px 8px;
        }
        #speed-options {
            position: absolute;
            top: calc(100% + 5px); /* Position below the button with a small gap */
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 100;
        }
        #speed-options div {
            padding: 8px 15px;
            cursor: pointer;
        }
        #speed-options div:hover {
            background-color: #f0f0f0;
        }

        /* Flowchart styles */
        .flowchart-container {
            border: 1px solid #ccc;
            padding: 0 20px;
        }
        .flowchart-step {
            text-align: center;
            margin: 0;
            padding: 20px 0;
            border-top: 1px solid #ddd;
        }
        .flowchart-step:first-child {
            border-top: none;
            padding-top: 20px;
            margin-top: 0;
        }
        .flowchart-arrow {
            text-align: center;
            margin: 0;
            padding: 15px 0;
            font-size: 20px;
            color: #555;
            border-top: 1px solid #ddd;
        }
        .flowchart-split {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            gap: 20px;
            border-top: 1px solid #ddd;
        }
        .flowchart-split-col {
            width: 48%;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .flowchart-split .flowchart-step {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
        }
        .flowchart-split .flowchart-arrow {
            border-top: none;
            padding: 15px 0;
        }


        /* Responsive adjustments for tablets */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .right-panel, .main-container.results-mode .right-panel {
                display: none;
            }
            .left-panel, .main-container.results-mode .left-panel {
                width: 100%;
                padding: 20px 10px;
                height: auto; /* Reset height for mobile */
            }
            .questions-container {
                width: 100%;
            }
            
            /* Adjust input boxes for tablets */
            .answer-input {
                width: 90px;
                max-width: 110px;
                font-size: 15px;
            }
            
            .drop-zone {
                max-width: 110px;
                min-width: 90px;
            }
            
            .matching-table .drop-zone {
                max-width: 110px;
                min-width: 90px;
            }
        }
        
        /* Responsive adjustments for mobile phones */
        @media (max-width: 768px) {
            .answer-input {
                width: 80px;
                max-width: 100px;
                font-size: 14px;
                padding: 2px 4px;
            }
            
            .drop-zone {
                max-width: 100px;
                min-width: 80px;
                font-size: 14px;
            }
            
            .matching-table .drop-zone {
                max-width: 100px;
                min-width: 80px;
            }
            
            .drag-item {
                font-size: 13px;
                padding: 4px 6px;
            }
            
            .matching-table .drop-zone .drag-item {
                font-size: 12px;
            }
            
            /* Ensure drag-drop containers are more mobile-friendly */
            .drag-drop-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .matching-container {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .answer-input {
                width: 70px;
                max-width: 90px;
                font-size: 13px;
            }
            
            .drop-zone {
                max-width: 90px;
                min-width: 70px;
            }
            
            .matching-table .drop-zone {
                max-width: 90px;
                min-width: 70px;
            }
        }

        /* ===== Imported designs from Reading 4.html ===== */
        /* TRUE/FALSE/NOT GIVEN styles */
        .tf-question { margin-bottom: 25px; padding: 10px 0; border-radius: 4px; }
        .tf-question-line { display: flex; align-items: flex-start; margin-bottom: 15px; padding: 5px 0; border-radius: 4px; }
        .tf-question-number, .question-number-box { border: 2px solid #ccc; padding: 2px 8px; margin-right: 10px; border-radius: 3px; font-weight: bold; display: inline-block; }
        .tf-question.active-question .tf-question-number { border-color: #4a90e2; }
        .tf-question-text { padding-top: 3px; }
        .tf-options { padding-left: 5px; }
        .tf-option { display: flex; align-items: center; padding: 10px 12px; background-color: #fff; transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease; }
        .tf-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .tf-option.correct { background-color: #d4edda !important; border-color: #28a745 !important; }
        .tf-option.incorrect { background-color: #f8d7da !important; border-color: #dc3545 !important; }
        .tf-option input[type="radio"] { margin-right: 10px; transform: scale(1.2); }
        .tf-question.correct .tf-question-line { background-color: #e9f7ef; }
        .tf-question.incorrect .tf-question-line { background-color: #f8d7da; }

        /* Multi-choice question styles */
        .multi-choice-question { margin-bottom: 20px; padding: 10px; border-radius: 4px; border: 3px solid transparent; }
        .multi-choice-question .question-prompt p > strong:first-child { display: inline-flex; align-items: center; justify-content: center; min-width: 24px; padding: 2px 6px; margin-right: 8px; border: 1px solid #d0d7e2; border-radius: 6px; background: #fff; }
        .multi-choice-question.active-question .question-prompt p > strong:first-child { border-color: #4a90e2; border-width: 2px; }
        .multi-choice-option { padding: 10px 12px; background-color: #fff; transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease; }
        .multi-choice-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .multi-choice-option.correct { background-color: #d4edda !important;  }
        .multi-choice-option.incorrect { background-color: #f8d7da !important;  }
        .multi-choice-option label { display: flex; align-items: center; cursor: pointer; font-size: 16px; }
        .multi-choice-option input[type="checkbox"], .multi-choice-option input[type="radio"] { margin-right: 12px; transform: scale(1.3); accent-color: #4a90e2; }

        /* Checkbox TWO-answers block (match screenshot) */
        .checkbox-question .question-prompt p > strong:first-child {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
           
            background: #fff;
        }
        .checkbox-group { display: flex; flex-direction: column;  }
        .checkbox-group label { display: flex; align-items: center; padding: 10px 12px; border: 1px solid transparent; background: #fff; transition: background-color 0.2s, border-color 0.2s; }
        .checkbox-group label:hover { background: #f1f7ff; border-color: #c6dcfb; }
        .checkbox-group label:has(input[type="checkbox"]:checked) { background: #cfe3f9; }
        .checkbox-group input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); }
        .checkbox-group label.correct { background-color: #d4edda !important; }
        .checkbox-group label.incorrect { background-color: #f8d7da !important;  }
        .checkbox-group label.correct::before { content: '✔ '; color: #28a745; font-weight: 600; margin-right: 6px; }
        .checkbox-group label.incorrect::before { content: '✖ '; color: #dc3545; font-weight: 600; margin-right: 6px; }

        /* Drag & Drop enhancements */
        /* When filled, hide zone border and show a blue outlined pill around the dropped option */
        .drop-zone.filled { 
            background: transparent; 
            border: none !important; 
            padding: 0; 
            justify-content: flex-start; 
            width: auto;
            min-width: fit-content;
        }
        .drop-zone.filled .drag-item { 
            width: auto; 
            height: auto; 
            display: inline-block; 
            white-space: nowrap; 
            border: 1px solid #2c6bed; 
            border-radius: 4px; 
            padding: 2px 6px; 
            font-weight: 600; 
            background: #fff; 
            color: #222; 
        }

        /* ===== Results Modal UI ===== */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.55); display: flex; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
        .modal-content { background: #ffffff; width: 100%; max-width: 900px; max-height: 85vh; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; border-bottom: 1px solid #e5e7eb; background: #f8fafc; position: sticky; top: 0; z-index: 1; }
        .modal-header h2 { margin: 0; font-size: 20px; font-weight: 700; color: #111827; }
        .modal-close-btn { background: transparent; border: none; font-size: 26px; line-height: 1; cursor: pointer; color: #6b7280; }
        .modal-close-btn:hover { color: #111827; }
        .modal-body { padding: 16px 18px; overflow: auto; }
        #score-summary { font-size: 16px; font-weight: 600; color: #111827; background: #f1f5f9; border: 1px solid #e2e8f0; padding: 10px 12px; border-radius: 8px; display: inline-block; }
        .result-controls { display: flex; align-items: center; gap: 12px; margin: 12px 0; }
        .result-controls .spacer { flex: 1; }
        .result-controls label { display: inline-flex; align-items: center; gap: 6px; color: #374151; }
        .btn-secondary { padding: 6px 10px; border: 1px solid #cbd5e1; border-radius: 6px; background: #ffffff; color: #111827; cursor: pointer; }
        .btn-secondary:hover { background: #f8fafc; }
        #result-details { overflow: auto; }
        #result-details table { width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; }
        #result-details th, #result-details td { padding: 10px 12px; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 14px; }
        #result-details thead th { position: sticky; top: 0; background: #f1f5f9; z-index: 1; }
        #result-details tr:nth-child(even) td { background: #fafafa; }
        #result-details td.result-correct { color: #0f5132; font-weight: 600; }
        #result-details td.result-incorrect { color: #842029; font-weight: 600; }
    </style>
</head>
<body>
    <div class="header">
        <div class="timer-container">
            <span class="timer-display">60:00</span>
        </div>
        <a href="https://t.me/Avazbeks_Media" target="_blank" class="telegram-link">
            Avazbeks_Media
        </a>
        <div class="header-icons">
        
        </div>
    </div>

    <div class="audio-player-container">
        <button id="play-pause-btn" class="player-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
        <div class="progress-container">
            <span id="current-time">0:00</span>
            <input type="range" id="progress-bar" value="0" step="1" style="width: 100%;">
            <span id="total-duration">0:00</span>
        </div>
        <div class="controls-container">
            <div class="volume-container">
                <button id="volume-btn" class="player-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                </button>
                <input type="range" id="new-volume-slider" min="0" max="1" step="0.01" value="1">
            </div>
            <div class="speed-container">
                <button id="speed-btn" class="player-btn">1x</button>
                <div id="speed-options" class="hidden">
                    <div data-speed="0.5">0.5x</div>
                    <div data-speed="0.75">0.75x</div>
                    <div data-speed="1">1x</div>
                    <div data-speed="1.25">1.25x</div>
                    <div data-speed="1.5">1.5x</div>
                    <div data-speed="2">2x</div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Left Panel -->
        <div class="left-panel">
            
            <div id="part-1" class="question-part">
                <div class="part-header">
                    <p><strong>Part 1</strong></p>
                    <p>Listen and answer questions 1–10.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 1-10</strong></p>
                            <p>Write <strong>NO MORE THAN TWO WORDS AND/OR A NUMBER</strong> for each answer.</p>
                        </div>
                        
                            <p class="centered-title">Fearnley Sports Center Lifeguard Application Form</p>
                            
                            <div class="example-box">
                                <p><strong>Example</strong> Name: <strong>Peter Smith</strong></p>
                            </div>
                            
                            <table class="people-table" style="margin-top: 10px; width: 100%;">
                                <tbody>
                                    <tr>
                                        <td style="font-weight: 600;">Personal details</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Name:</td>
                                        <td>Peter Smith</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Home address:</td>
                                        <td>130 South Main Street, Lake <input type="text" id="q1" class="answer-input" placeholder="1" style="width: 200px;" autocomplete="off"></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Contact number:</td>
                                        <td><input type="text" id="q2" class="answer-input" placeholder="2" style="width: 200px;" autocomplete="off"> (cell phone)</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Present occupation:</td>
                                        <td>
                                            <ul style="list-style-type: none; padding-left: 0;">
                                                <li>&bull;&nbsp;&nbsp;has temporary job as a part-time <input type="text" id="q3" class="answer-input" placeholder="3" style="width: 200px;" autocomplete="off"></li>
                                                <li>&bull;&nbsp;&nbsp;is studying PE</li>
                                                <li>&bull;&nbsp;&nbsp;wants to be a high school <input type="text" id="q4" class="answer-input" placeholder="4" style="width: 200px;" autocomplete="off"> coach</li>
                                            </ul>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Qualifications</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Already holds:</td>
                                        <td>water safety certificate</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Certificate expires in:</td>
                                        <td><input type="text" id="q5" class="answer-input" placeholder="5" style="width: 200px;" autocomplete="off"></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Relevant work experience</td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Lifeguard at:</td>
                                        <td>the <input type="text" id="q6" class="answer-input" placeholder="6" style="width: 200px;" autocomplete="off"> in Fearnley</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Additional relevant skills:</td>
                                        <td><input type="text" id="q7" class="answer-input" placeholder="7" style="width: 200px;" autocomplete="off"></td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Other Information:</td>
                                        <td>is happy to</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;"></td>
                                        <td>
                                            <ul style="list-style-type: none; padding-left: 0;">
                                                <li>&bull;&nbsp;&nbsp;work on <input type="text" id="q8" class="answer-input" placeholder="8" style="width: 200px;" autocomplete="off"> mornings</li>
                                                <li>&bull;&nbsp;&nbsp;start at <input type="text" id="q9" class="answer-input" placeholder="9" style="width: 200px;" autocomplete="off"> o'clock</li>
                                            </ul>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">How did the applicant find out about this job?</td>
                                        <td>on the <input type="text" id="q10" class="answer-input" placeholder="10" style="width: 200px;" autocomplete="off"></td>
                                    </tr>
                                </tbody>
                            </table>
                    </div>
                </div>
            </div>

            <div id="part-2" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 2</strong></p>
                    <p>Listen and answer questions 11–20.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 11-16</strong></p>
                            <p>Choose the correct answer</p>
                            <p class="centered-title">Becoming a millionaire</p>
                        </div>
                        
                        <div style="margin-bottom: 18px;">
                            <p><strong>11</strong>&nbsp;&nbsp;Arthur feels that when starting a business, mistakes should be</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q11" value="A"> seen as an opportunity to learn.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q11" value="B"> predicted and minimised.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q11" value="C"> avoided at all costs</label></div>
                            </div>

                            <p><strong>12</strong>&nbsp;&nbsp;Recent American studies found that confidence will</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q12" value="A"> sometimes reduce people's chances of success.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q12" value="B"> be increased by reading self-help books.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q12" value="C"> ensure good results on business courses.</label></div>
                            </div>

                            <p><strong>13</strong>&nbsp;&nbsp;The American studies recommended that new entrepreneurs</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q13" value="A"> listen to their colleagues' advice.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q13" value="B"> get professional help when things go wrong.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q13" value="C"> remain concentrated on their aims.</label></div>
                            </div>

                            <p><strong>14</strong>&nbsp;&nbsp;What does Arthur say about his own experience of marketing?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q14" value="A"> He relied on what he already knew.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q14" value="B"> He hired an expert to take care of it.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q14" value="C"> He realised its importance too late.</label></div>
                            </div>

                            <p><strong>15</strong>&nbsp;&nbsp;What does Arthur think is an important quality shared by good leaders?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q15" value="A"> They are ambitious for their company.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q15" value="B"> They can deal with difficult people.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q15" value="C"> They earn the respect of their workforce.</label></div>
                            </div>

                            <p><strong>16</strong>&nbsp;&nbsp;What does Arthur say about taking risks?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q16" value="A"> He advises being cautious.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q16" value="B"> He favours a long-term view.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q16" value="C"> He believes it is financially advantageous.</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-prompt" style="margin-top: 60px;">
                            <p><strong>Questions 17-20</strong></p>
                            <p>Choose <strong>TWO</strong> correct answers.</p><br>
                            <p>
                                <strong>17-18</strong> Which <strong>TWO</strong> things does Arthur say people should focus on when developing their business idea?</strong>
                            </p>
                        </div>
                        
                        <div style="margin-bottom: 18px;">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="q17-18" value="A"> making sure the idea is original</label>
                                <label><input type="checkbox" name="q17-18" value="B"> offering a better deal than competitors</label>
                                <label><input type="checkbox" name="q17-18" value="C"> being committed to it</label>
                                <label><input type="checkbox" name="q17-18" value="D"> paying attention to detail</label>
                                <label><input type="checkbox" name="q17-18" value="E"> fixing realistic prices</label>
                        </div>
                    </div>
                                </div>

                    <div class="question">
                        <div class="question-prompt" style="margin-top: 60px;">
                            <p>
                                <strong>19-20</strong> Which <strong>TWO</strong> things does Arthur say helped him get his business started?</strong>
                            </p>
                                </div>
                        
                        <div style="margin-bottom: 18px;">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="q19-20" value="A"> family support</label>
                                <label><input type="checkbox" name="q19-20" value="B"> getting a loan from a bank</label>
                                <label><input type="checkbox" name="q19-20" value="C"> good business advice</label>
                                <label><input type="checkbox" name="q19-20" value="D"> a favourable economic climate</label>
                                <label><input type="checkbox" name="q19-20" value="E"> an effective approach to business</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="part-3" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 3</strong></p>
                    <p>Listen and answer questions 21–30.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 21-25</strong></p>
                            <p>Choose the correct answer</p>
                        </div>
                        
                        <p class="centered-title">The role of health visitors</p>
                        <div style="margin-bottom: 18px;">
                            <p><strong>21</strong>&nbsp;&nbsp;In the context of Lisa's research project, Dr Harris suggests she should</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q21" value="A"> re-think the focus of her research.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q21" value="B"> be prepared to be flexible.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q21" value="C"> narrow the scope.</label></div>
                            </div>

                            <p><strong>22</strong>&nbsp;&nbsp;Which topic area does Dr Harris advise Lisa to avoid investigating?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q22" value="A"> pre-schools</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q22" value="B"> nurseries</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q22" value="C"> child-minders</label></div>
                            </div>

                            <p><strong>23</strong>&nbsp;&nbsp;The main reason why Lisa wants to film very young children is</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q23" value="A"> to watch how they play.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q23" value="B"> to look at their relationships.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q23" value="C"> to study their language.</label></div>
                            </div>

                            <p><strong>24</strong>&nbsp;&nbsp;According to Dr Harris, how might the arrival of a new baby affect a family?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q24" value="A"> Other children may feel jealous.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q24" value="B"> Parents may be put under pressure.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q24" value="C"> Sufficient support may not be available.</label></div>
                            </div>

                            <p><strong>25</strong>&nbsp;&nbsp;Dr Harris agrees with Lisa that she needs to find out about</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q25" value="A"> legal constraints.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q25" value="B"> family considerations.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q25" value="C"> medical circumstances.</label></div>
                            </div>
                            </div>
                            
                        <div class="question-prompt" style="margin-top: 60px;">
                            <p><strong>Questions 26-30</strong></p>
                            <p>What features are identified for each of the following textbooks?</p>
                            </div>
                        
                        <div style="margin-bottom: 18px;">
                            <div class="drag-drop-container" style="margin-top: 12px;">
                                <div class="questions-container">
                                    <p style="font-weight: bold; margin-bottom: 15px;">Textbooks</p>
                                    <div style="margin-bottom: 15px;">
                                        26. Worldwide Healthcare Policies&nbsp;&nbsp;
                                        <div class="drop-zone" data-question="26" data-question-id="26"><span class="placeholder">&nbsp;</span></div>
                            </div>
                                    <div style="margin-bottom: 15px;">
                                        27. Supporting Vulnerable Families&nbsp;&nbsp;
                                        <div class="drop-zone" data-question="27" data-question-id="27"><span class="placeholder">&nbsp;</span></div>
                        </div>
                                    <div style="margin-bottom: 15px;">
                                        28. Health Visitors and Child Protection&nbsp;&nbsp;
                                        <div class="drop-zone" data-question="28" data-question-id="28"><span class="placeholder">&nbsp;</span></div>
                    </div>
                                    <div style="margin-bottom: 15px;">
                                        29. The Future of Health Visiting&nbsp;&nbsp;
                                        <div class="drop-zone" data-question="29" data-question-id="29"><span class="placeholder">&nbsp;</span></div>
                                    </div>
                                    <div style="margin-bottom: 15px;">
                                        30. Resources for Health Visitors&nbsp;&nbsp;
                                        <div class="drop-zone" data-question="30" data-question-id="30"><span class="placeholder">&nbsp;</span></div>
                                    </div>
                                </div>
                                <div class="recommendations-box" id="part3-options-box">
                                    <p style="font-weight: bold; margin-bottom: 15px;">Features:</p>
                                    <div class="drag-item" id="optA" draggable="true" data-value="A" data-letter="A">A. global coverage but sometimes inaccurate</div>
                                    <div class="drag-item" id="optB" draggable="true" data-value="B" data-letter="B">B. interesting but rather unrealistic</div>
                                    <div class="drag-item" id="optC" draggable="true" data-value="C" data-letter="C">C. practical and full of thoughtful tips</div>
                                    <div class="drag-item" id="optD" draggable="true" data-value="D" data-letter="D">D. up-to-date with an international approach</div>
                                    <div class="drag-item" id="optE" draggable="true" data-value="E" data-letter="E">E. wide-ranging but poorly organized</div>
                                    <div class="drag-item" id="optF" draggable="true" data-value="F" data-letter="F">F. good value despite some omissions</div>
                                    <div class="drag-item" id="optG" draggable="true" data-value="G" data-letter="G">G. extremely costly but comprehensive</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="part-4" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 4</strong></p>
                    <p>Listen and answer questions 31–40.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 31-40</strong></p>
                            <p>Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                        </div>
                        
                        <div class="example-box" style="margin-top: 12px;">
                            <p class="centered-title">Sea lion tracking study (Western Australia)</p>
                            
                            <div style="margin-bottom: 20px;">
                                <p><strong>Reason for the study</strong></p>
                                <ul style="list-style-type: none; padding-left: 20px;">
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;The Australian sea lion is an endangered species.</li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;Until 1892, numbers were affected by hunting.</li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;Sea lions are now affected by nets used to control <input type="text" id="q31" class="answer-input" placeholder="31" style="width: 200px;" autocomplete="off"></li>
                                </ul>
                            </div>

                            <div style="margin-bottom: 20px;">
                                <p><strong>Animal tracking systems</strong></p>
                                <ul style="list-style-type: none; padding-left: 20px;">
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;Considerations when choosing a tracking method include <input type="text" id="q32" class="answer-input" placeholder="32" style="width: 200px;" autocomplete="off"> and ease of use.</li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;Plastic tags: the animal must be easy to <input type="text" id="q33" class="answer-input" placeholder="33" style="width: 200px;" autocomplete="off"></li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;GPS tracking will not work in the <input type="text" id="q34" class="answer-input" placeholder="34" style="width: 200px;" autocomplete="off"></li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;In isolated regions, some animals are tracked by <input type="text" id="q35" class="answer-input" placeholder="35" style="width: 200px;" autocomplete="off"> (e.g. the polar bear)</li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;Some animals are identified by markings (e.g. the dolphin is identified by its scars).</li>
                                </ul>
                        </div>

                            <div style="margin-bottom: 20px;">
                                <p><strong>Challenges of tracking sea lions</strong></p>
                                <ul style="list-style-type: none; padding-left: 20px;">
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;Perth study: the sea lions lost their tags. (They rubbed against <input type="text" id="q36" class="answer-input" placeholder="36" style="width: 200px;" autocomplete="off"> to remove them.)</li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;Californian researchers used <input type="text" id="q37" class="answer-input" placeholder="37" style="width: 200px;" autocomplete="off"> to identify sea lions. (This was unreliable due to regular loss of fur.)</li>
                                </ul>
                        </div>

                            <div style="margin-bottom: 20px;">
                                <p><strong>Our study</strong></p>
                                <p><strong>Aims:</strong></p>
                                <ul style="list-style-type: none; padding-left: 20px;">
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;i) to find out if sea lions' whiskers can be used to identify them</li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;ii) to create a <input type="text" id="q38" class="answer-input" placeholder="38" style="width: 200px;" autocomplete="off"> to use as a guide</li>
                                </ul>
                                <p><strong>Methods:</strong></p>
                                <ul style="list-style-type: none; padding-left: 20px;">
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;i) contacting <input type="text" id="q39" class="answer-input" placeholder="39" style="width: 200px;" autocomplete="off"> in Australia for photographs</li>
                                    <li style="margin-bottom: 15px;">&bull;&nbsp;&nbsp;ii) asking the <input type="text" id="q40" class="answer-input" placeholder="40" style="width: 200px;" autocomplete="off"> to get involved</li>
                                </ul>
                        </div>
                        </div>


                    </div>
                </div>
            </div>

        <!-- Right Panel -->
    </div>
    <div class="right-panel">
        <div id="transcription-container">
            <h2>Transcription</h2>
            <div id="transcription-text"></div>
        </div>
    </div>

    <div id="transcription-data" style="display:none;">
        <div data-part="1"><strong>SECTION 1</strong>

You will hear a number of different recordings, and you will have to answer questions on what you hear. There will be time for you to read the instructions and questions, and you will have a chance to check your work. All the recordings will be played once only.

The test is in four parts. Write all your answers in the listening question booklet. At the end of the test, you will be given 10 minutes to transfer your answers to an answer sheet.

Now turn to Part 1 on page 2 of your question booklet. Part 1. You will hear a man called Peter phoning a sports center manager about a job. First, you have some time to look at questions 1 to 4. Now listen carefully and answer questions 1 to 4. Hello, Fernley Sports Center.

How can I help you? Yes, I'd like to apply for one of the lifeguard jobs you advertised this week. Right, we can do that now over the phone. I'll just need some information from you.

Let me get a form. Okay, so let's start with your name. Peter Smith.

Okay, can you let me have your home address? It's 130 South Main Street, Lake Elsinore. Okay, I'm new around here. Can you spell that for me? Yes, it's E-L-S-I-N-O-R-E.

Okay, got that. And your phone number? My home number's 9-5-1-6-7-4-3-1-2-4, but it's best to ring me on my cell phone. That's 0-7-7-8-9-6-2-4-5.

Okay, now what do you do? Are you still in college or are you working full time? I'm in my second year here at Fernley, and this vacation, I've got a job as a part-time waiter. Okay, I guess if you're at Fernley College, you'll be studying physical education? They all seem to do that there. That's right.

Then I hope to go on and coach baseball in high school, something like that. I guess it all depends on how I do in my final exams. Okay, sounds good to me.

Before you hear the rest of the conversation, you have some time to look at questions 5 to 10. Now listen and answer questions 5 to 10. Now, the next part of the form deals with qualifications.

Do you have the water safety certificate? We absolutely insist on that. Yes, I do. So, how long will it last before you have to do a refresher course? I took it last November, so it'll run out in October.

Okay, good. Now, what about work experience as a lifeguard? Well, I've had about four months' experience. Which swimming pool was that at? I need to have details of your employer, obviously, so we can get a reference.

Oh, it was at the beach here in Fernley. I can get the number of the person you need to contact. Good.

And do you have any other additional skills I can put down? You can put down diving. I've done that for a long time now. I'm also keen on rock climbing, but that's not really relevant here.

No. Okay, and I need to ask when you would prefer to work. You can choose either Saturday mornings or any time Monday to Friday.

We've got enough people on Sundays at the moment. Well, not Monday to Friday, because I'm at the restaurant weekday evenings. Okay.

We open at six. Could you start that early? No, that's fine. I prefer that to working late.

Okay. Now I need to speak to the committee who run the sports center here, but you should hear back from us pretty soon, and then they'll probably arrange an interview. Thanks very much.

Great. Now, before you go, I'd just like to ask you how you found out about our advertisement. We always ask this.

Was it from the newspaper or the radio? I heard the advertisement this morning when I was driving into college. I don't usually read the local paper. All right.

Thanks. Well, that's all. Hope to see you soon.

That is the end of part one. You now have one minute to check your answers to part one.
        </div>
        <div data-part="2"><strong>SECTION 2</strong>

Part two. You will hear part of a radio program in which a successful businessman is advising listeners on how to become a self-made millionaire. First, you have some time to look at questions 11 to 16. Now listen carefully and answer questions 11 to 16.

Everybody dreams of becoming a millionaire one day. So we asked Arthur Knowles, who made his millions in the plumbing business, to give the budding entrepreneurs among you a few tips on how to make your first million. Arthur, welcome to the program.

Thanks, Sue. So, Arthur, what advice do you have for our listeners? Well, one thing I've heard people say is that when you're starting up a business, you can't afford to make mistakes. Well, I believe in the old saying, a person who never made a mistake never made anything.

You can't really predict when you'll make mistakes and you have to look at them as a positive experience and one that means you won't make the same mistake again. You need to be able to cope with the world of business. But according to recent American Business School studies, believing in yourself isn't enough by itself to guarantee success.

Confidence can be a good thing, but a person can have too much confidence. And people who try to learn to be confident by buying those how-to-succeed books are just wasting their time. The advice given in these American studies was that being a successful entrepreneur comes down to having the right attitude.

It's no good getting depressed every time something goes wrong. Always keep your goals in mind and never give up. And don't listen to all the people around you who say, oh, this will never work.

One thing I've learned in business is that you don't have to be an expert in everything. Marketing, for example. When I started my business, I tried to do it all myself.

But I soon realized that although I knew everything there was to know about plumbing, I didn't have much idea about how to sell my ideas. So I got someone who knew more about this to take care of the marketing side of things for me. And as for leadership, well, you've got to be someone your workers look up to because you've been seen to make the right decisions.

You have to be able to control people but listen to them at the same time. Some people are driven to make their companies successful, but that too often leads to a ruthless approach. Then there's the question of taking risks, even calculated ones.

I personally feel it's actually better to tread carefully when it comes to taking short-term risks. You need a degree of vision, certainly. But it's easy to get carried away by your desire to increase profits.

And if things go wrong, you can end up losing more than you gain. Before you hear the rest of the programme, you have some time to look at questions 17 to 20. Now listen and answer questions 17 to 20.

So, if you have a great idea for a business, what should you do next? Well, the first thing to ask yourself is whether there's a need for your product or service. Can you cater for people's needs better than existing companies? You don't need to worry about whether it's original or not because there isn't always enough of a demand for completely new ideas. And the second thing to ask yourself is not what colour should the packet be or how much should it cost, but do I care enough about this idea to dedicate the next 10 years of my life to it? Because realistically, that's how long it will take.

Tell us how you got started, Arthur. How do you explain your early success? Well, I started my business just as the economy was going into a recession, which wasn't the best time and I was lucky to survive, especially as the banks weren't being particularly supportive to small businesses at that time. If I'd listened to the business advice I was given back then, I'd never have got started.

My strengths were that I knew I could provide a better service than my competitors, who really hadn't spotted the opportunities that were out there, and that my wife had a good job and was able to pay the household bills while I was getting the company on its feet. The first couple of years were very tough, but I knew I would make it eventually. OK, now we're going to take some calls from listeners...
        </div>
        <div data-part="3"><strong>SECTION 3</strong>

Part 3. Hi Lisa, good to see you again, especially since you've chosen to do your masters with us.

Well, I enjoyed my first degree in nursing and I've decided I want to become a health visitor. You know, someone who promotes health and wellbeing and is part of a team within a community. Getting out and meeting people of all ages.

So that's why I chose this research project. Excellent, and your focus, the role of a health visitor in the community, is spot on. But at this stage, you need to keep an open mind so you can respond to initial findings once you get underway.

From what I've read, the role seems to vary quite considerably. Yes, some health visitors tend to focus on liaising with family doctors, others work independently with new patients. The work of health visitors in future is most likely to rely on the relationship between these roles and I think that would be an interesting angle for you to pursue at some stage.

Yes, what I really want to look at is the programme of physical development checks, which start with babies when they're only a few days old. Fine. Another area which I'm thinking of investigating is the monitoring of nurseries, which is currently under review, and there's the issue of pre-schools and at what age they should take very young children.

I thought I'd also include childminders, the individuals in their own homes who may not be qualified but who look after young children. That's an area I'd steer clear of as it's very complex. OK, will do.

Anyway, I'd also like to make a short film about a few children. A good idea, but it will depend on building up a relationship with one or two health visitors willing to introduce you to a family. An opportunity like that would allow you to look at how young children begin to form words, for example.

And peer relationships between children, as well as the ways in which they relate and play with each other, especially when they're around two to three years old. Although early use of language is my main interest. OK, but there are other topic areas I'd like you to consider before we finalise the content and structure of your research.

An equally important area is a child's home environment and the effect of a newborn baby. Right. You need to consider the impact of this on the parents, particularly if the family lives in poor economic circumstances.

Of course, the additional expense could be a worry, especially if there are other children. Certainly all those matters are very sensitive and not necessarily easy to detect. There's plenty of help available, but many people often feel too proud to ask for it.

This is the area where I'll need to be familiar with family law, isn't it? Very much so. By all means, be aware of the medical conditions, and you also need to consider social factors, but you'll find that in most circumstances, you will have to refer to the law to understand how far a health visitor can intervene. Yes, I appreciate that.

Before you hear the rest of the discussion, you have some time to look at questions 26 to 30. Now listen and answer questions 26 to 30. Now, your book list.

I'm glad to see Worldwide Healthcare Policies tops your list. Well, I wasn't sure how relevant it would be, but it's a new edition, so the information is current. Yes, some of it may not be relevant, but it's important to keep abreast of developments in other countries which may inform our own government's legislation.

I understand. What about Supporting Vulnerable Families? It's not as costly as some of the other books on my list. It's an excellent buy considering the price, even though it does leave a few things out.

I've already ordered Health Visitors and Child Protection. I hope that was right. Well, it's very expensive, but it's a sound investment and there aren't many textbooks which cover as much detail as this.

It'll be a valuable reference even if the style is occasionally boring. And what about The Future of Health Visiting? I'm unsure how useful it'll be. Useful in a utilitarian sense? Probably not, but it's stimulating in the way the writer considers what health visiting could be like in a perfect world.

I'd suggest dipping into it to discover the improvements which could be made if money were no object. And Resources for Health Visitors? Strangely enough, it's not as helpful as the title suggested. It offers a huge variety of activities and strategies which are great when working with young children, but they're presented in a rather haphazard way and the index isn't much use either.

Be very careful when using it. OK. That is the end of Part 3. You now have 30 seconds to check your answers to Part 3.
                </div>
        <div data-part="4"><strong>SECTION 4</strong>

Part 4. You will hear part of a presentation to biology students on new research into sea lions. First you have some time to look at questions 31 to 40. Now listen carefully and answer questions 31 to 40. Hello everybody.

I'm here today to tell you about a new research study that my team here at the university is doing on the sea lions that live along the coast of Western Australia. You may be wondering why we've been studying this animal. Well, Australian sea lions have been identified as an endangered species, so there's a real need to count them and find out just how many there are.

Up until 1892, the population of these animals was severely depleted because of hunting. That's no longer allowed. But today there is a new danger.

Sea lions often forage for food in the same areas along the coastlines where there are nets used to catch sharks. Unfortunately, they tend to get caught up in the nets by accident and drown. Now we wanted to monitor the population of sea lions in this area, but we weren't sure of the best way to do it.

There are several different animal tracking methods, which vary in their effectiveness, and there are different factors to consider. One of the most important of these is the cost, but you also have to consider how easy your chosen method is to use. You may choose a traditional method, like a plastic tag.

They're relatively straightforward to attach, but they're really only suitable to use with animals that you can catch quite easily. You might also go with a more modern method like GPS tracking, which uses satellite technology to transmit data on the animal around the clock. One drawback for marine animals, though, is that they don't transmit a signal in the ocean.

You only get data when they're on land. There are certain large animals in remote areas that have to be tracked using a helicopter. The polar bear is a good example.

Now, an important part of tracking is being able to clearly identify the animal. Some, like zebras, are identified by markings such as their stripes, while the dolphin usually has distinguishing scars on its body that can help tell them apart. Sea lions don't have any markings like this, which is just one of the challenges of tracking them.

When researchers in Perth tried to use electronic tags in a sea lion study, they found that the sea lions had removed their tracking devices by deliberately rubbing up against rocks. This was something the researchers hadn't anticipated. Researchers in California studying American sea lions tried a different method.

They applied paint to the animals. They thought this would be a better, less invasive means of identification. Unfortunately, this didn't work so well either because sea lions molt every year and shed their fur along with the identifying mark.

So let's look at our current study. We have several aims that we'd like to achieve. The first of these is to try to establish whether sea lions can be identified from the whiskers on their face.

These are much coarser than a cat's whiskers, so easier to see. Our theory is that the pattern of these whiskers may be as individual as a fingerprint on a human. If this is in fact true, then we think this could be an effective way to identify them.

Our second aim is to come up with a diagram of sea lion whisker patterns, so this can be used as a guide for us and other studies. We're using a few different methods to help us do all this. We know that we need to build up a wide range of visual data, so firstly we've been in touch with zoos around Australia to gather photographs from them of the faces of any sea lions they have.

This won't be enough to achieve our purpose though, so we're also broadening our search by inviting the public to take part in our research. We're hoping this will result in hundreds of useful images we can use.

When it comes to tracking marine animals, researchers have several methods to choose from. The key considerations when selecting a tracking method include cost and ease of use. Plastic tags are one option, but for these to work effectively, the animal must be easy to capture and handle. GPS tracking devices are another possibility, but they won't work in the water - the signals can't penetrate through the ocean surface.

In isolated regions like the Arctic, some animals are tracked by satellite imagery. For example, polar bears are monitored this way, which allows researchers to study their movements without direct contact. Some animals can also be identified by natural markings - the dolphin, for instance, is often identified by its unique scars and markings.

However, tracking sea lions presents specific challenges. In a previous study conducted in Perth, researchers found that the sea lions frequently lost their tracking tags. It was discovered that they were rubbing against rocks to remove the devices, which made long-term monitoring difficult.

Californian researchers tried a different approach, using fur samples to identify individual sea lions. Unfortunately, this method proved unreliable due to the regular loss of fur that occurs naturally in these animals.

Our current study has two main aims. First, we want to determine if sea lions' whiskers can be used as a reliable method of identification. Second, we aim to create a database that can serve as a guide for future research and conservation efforts.

To achieve these goals, we're using two main methods. We're contacting researchers in Australia to collect photographs of sea lions, and we're also asking the public to get involved by reporting sightings and contributing to our data collection efforts.

This collaborative approach should give us a more comprehensive understanding of sea lion populations and help develop better conservation strategies. That is the end of section four. You now have half a minute to check your answers.

That is the end of the listening test. In the IELTS test, you will now have ten minutes to transfer your answers to an answer sheet.
        </div>
    </div>

    <!-- Answer Key -->
    <div id="answer-key" style="display:none;">
        <h3>Correct Answers:</h3>
        <p><strong>Part 1 (Questions 1-10):</strong></p>
        <p>1. View<br>2. 555-0123<br>3. waiter<br>4. swimming<br>5. June 2025<br>6. community pool<br>7. first aid<br>8. weekend<br>9. 7<br>10. internet</p>
        
        <p><strong>Part 2 (Questions 11-20):</strong></p>
        <p>11. A<br>12. A<br>13. C<br>14. C<br>15. C<br>16. A<br>17. A<br>18. C<br>19. A<br>20. C</p>
        
        <p><strong>Part 3 (Questions 21-30):</strong></p>
        <p>21. A<br>22. A<br>23. B<br>24. B<br>25. A<br>26. A<br>27. B<br>28. C<br>29. D<br>30. E</p>
        
        <p><strong>Part 4 (Questions 31-40):</strong></p>
        <p>31. sharks<br>32. cost<br>33. capture<br>34. water<br>35. satellite<br>36. rocks<br>37. fur<br>38. database<br>39. researchers<br>40. public</p>
    </div>

    <audio id="global-audio-player" class="hidden"></audio>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow" onclick="previousPart()" id="prevBtn">‹</button>
        <button class="nav-arrow" onclick="nextPart()" id="nextBtn">›</button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)">
                    <span class="sr-only">Question 12</span>
                    <span aria-hidden="true">12</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)">
                    <span class="sr-only">Question 13</span>
                    <span aria-hidden="true">13</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)">
                    <span class="sr-only">Question 14</span>
                    <span aria-hidden="true">14</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)">
                    <span class="sr-only">Question 15</span>
                    <span aria-hidden="true">15</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)">
                    <span class="sr-only">Question 16</span>
                    <span aria-hidden="true">16</span>
                </button>
                <button class="subQuestion active scorable-item" onclick="goToQuestion(17)">
                    <span class="sr-only">Question 17</span>
                    <span aria-hidden="true">17</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)">
                    <span class="sr-only">Question 18</span>
                    <span aria-hidden="true">18</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)">
                    <span class="sr-only">Question 19</span>
                    <span aria-hidden="true">19</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)">
                    <span class="sr-only">Question 20</span>
                    <span aria-hidden="true">20</span>
                </button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(4)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">4</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" id="highlight-item" onclick="highlightText()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M15.24 12.32L12.28 9.36l-1.04 1.04-1.04-1.04-1.04 1.04-1.04-1.04-1.04 1.04-1.04-1.04-3.12 3.12c-.59.58-1.54.58-2.12 0l-1.04-1.04c-.58-.59-.58-1.54 0-2.12L7.88.88c.59-.58 1.54-.58 2.12 0l1.04 1.04 1.04-1.04 1.04 1.04 1.04-1.04 1.04 1.04 1.04-1.04 3.12 3.12c.58.59.58 1.54 0 2.12l-1.04 1.04c-.58.59-1.54.59-2.12 0zM12 15l-3 3-7-7 3-3 7 7zm-9-5l-2.29 2.29c-.39.39-.39 1.02 0 1.41l8.29 8.29c.39.39 1.02.39 1.41 0L22.7 8.41c.39-.39.39-1.02 0-1.41L14.42.29c-.39-.39-1.02-.39-1.41 0L3 10z"/></svg>
            </span>
            <span>Highlight</span>
        </div>
        <div class="context-menu-item" id="comment-item" onclick="addComment()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 12H5.17L4 15.17V4h16v10z"/></svg>
            </span>
            <span>Comment</span>
        </div>
        <div class="context-menu-item" id="clear-item" onclick="clearHighlight()" style="display:none;">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
            </span>
            <span>Clear</span>
        </div>
        <div class="context-menu-item" onclick="clearAllHighlights()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M16 9h-2.29l3-3-1.42-1.42-3 3V5h-2v2.29l-3-3-1.42 1.42 3 3H5v2h2.29l-3 3 1.42 1.42 3-3V17h2v-2.29l3 3 1.42-1.42-3-3H17V9h-2zm-4 4h-2v-2h2v2z"/></svg>
            </span>
            <span>Clear All</span>
        </div>
    </div>

    <!-- Mobile highlight/comment toolbar -->
    <div id="mobile-selection-menu" class="mobile-selection-menu hidden">
        <button onclick="highlightText()">Highlight</button>
        <button onclick="addComment()">Comment</button>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Your Results</h2>
                <button id="modal-close-button" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p id="score-summary"></p>
                <div id="result-details"></div>
            </div>
        </div>
    </div>

    <script>
        let currentPart = 1;
        let currentQuestion = 1;
        let selectedText = '';
        let selectedRange = null;
        let draggedElement = null;
        let testStarted = false;
        let timeInSeconds = 3600;
        let isHovering = false;
        let timerInterval;
        let contextElement = null;

        function updateAnsweredIndicators() {
            for (let qNum = 1; qNum <= 40; qNum++) {
                const btn = document.querySelector(`.subQuestion[onclick=\"goToQuestion(${qNum})\"]`);
                if (!btn) continue;

                // Do not change style if it's already marked correct or incorrect
                if (btn.classList.contains('correct') || btn.classList.contains('incorrect')) {
                    continue;
                }

                let isAnswered = false;

                // Special handling for grouped checkbox questions 17-18 and 19-20
                if (qNum === 17 || qNum === 18) {
                    const count1718 = document.querySelectorAll('input[name="q17-18"]:checked').length;
                    isAnswered = qNum === 17 ? (count1718 >= 1) : (count1718 >= 2);
                } else if (qNum === 19 || qNum === 20) {
                    const count1920 = document.querySelectorAll('input[name="q19-20"]:checked').length;
                    isAnswered = qNum === 19 ? (count1920 >= 1) : (count1920 >= 2);
                } else {
                    const textInput = document.getElementById(`q${qNum}`);
                    const radioInput = document.querySelector(`input[name=\"q${qNum}\"]:checked`);
                    const dropZone = document.querySelector(`.drop-zone[data-question-id=\"${qNum}\"]`);
                    const clickableCell = document.querySelector(`.clickable-cell[data-question=\"${qNum}\"].selected`);

                    if (textInput && textInput.value.trim() !== '') {
                        isAnswered = true;
                    } else if (radioInput) {
                        isAnswered = true;
                    } else if (dropZone && dropZone.querySelector('.drag-item')) {
                        isAnswered = true;
                    } else if (clickableCell) {
                        isAnswered = true;
                    }
                }

                if (isAnswered) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            }
            // Keep attempted count in sync with latest interactions
            updateAttemptedCount(currentPart);
        }

        const audioPlayer = document.getElementById('global-audio-player');
        const timerContainer = document.querySelector('.timer-container');
        const timerDisplay = document.querySelector('.timer-display');
        const volumeSlider = document.getElementById('new-volume-slider');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeEl = document.getElementById('current-time');
        const totalDurationEl = document.getElementById('total-duration');
        const speedBtn = document.getElementById('speed-btn');
        const speedOptions = document.getElementById('speed-options');
        const volumeBtn = document.getElementById('volume-btn');

        const audioSource = 'https://ia600206.us.archive.org/20/items/mix-27m-46s-audio-joiner.com-copy-copy-copy-copy-copy-copy-copy-copy-copy-copy-copy-copy-copy-copy/mix_27m46s%20%28audio-joiner.com%29%20-%20CopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopy.mp3';
        audioPlayer.src = audioSource;

        const correctAnswers = {
            /* --- Part 1 --- */
            'q1': ['elsinore'],
            'q2': ['077896245'],
            'q3': ['waiter'],
            'q4': ['baseball'],
            'q5': ['October'],
            'q6': ['beach'],
            'q7': ['diving'],
            'q8': ['Saturday'],
            'q9': ['6', 'six'],
            'q10': ['radio'],

            /* --- Part 2 --- */
            'q11': 'A',
            'q12': 'A',
            'q13': 'C',
            'q14': 'B',
            'q15': 'C',
            'q16': 'A',
            // Part 2 checkbox groups (two answers each)
            'q17-18': ['B','C'],
            'q19-20': ['A','E'],

            /* --- Part 3 --- */
            'q21': 'B',
            'q22': 'C',
            'q23': 'C',
            'q24': 'B',
            'q25': 'A',
            'q26': 'D',
            'q27': 'F',
            'q28': 'G',
            'q29': 'B',
            'q30': 'E',

            /* --- Part 4 --- */
            'q31': ['sharks'],
            'q32': ['cost'],
            'q33': ['catch'],
            'q34': ['ocean'],
            'q35': ['helicopter'],
            'q36': ['rocks'],
            'q37': ['paint'],
            'q38': ['diagram'],
            'q39': ['zoos'],
            'q40': ['public']
        };
        
        const questionTypes = {
            'q1': 'text', 'q2': 'text', 'q3': 'text', 'q4': 'text', 'q5': 'text',
            'q6': 'text', 'q7': 'text', 'q8': 'text', 'q9': 'text', 'q10': 'text',
            'q11': 'mcq', 'q12': 'mcq', 'q13': 'mcq', 'q14': 'mcq', 'q15': 'mcq',
            'q16': 'mcq', 'q17-18': 'checkbox', 'q19-20': 'checkbox',
            'q21': 'mcq', 'q22': 'mcq', 'q23': 'mcq', 'q24': 'mcq', 'q25': 'mcq', 'q26': 'dragdrop', 'q27': 'dragdrop', 'q28': 'dragdrop', 'q29': 'dragdrop', 'q30': 'dragdrop',
            'q31': 'text', 'q32': 'text', 'q33': 'text', 'q34': 'text', 'q35': 'text',
            'q36': 'text', 'q37': 'text', 'q38': 'text', 'q39': 'text', 'q40': 'text'
        };


        function setupCheckboxLimits() {
            function enforceMaxSelections(groupName, maxAllowed) {
                const checkboxes = Array.from(document.querySelectorAll(`input[name="${groupName}"]`));
                if (checkboxes.length === 0) return;

                function updateState() {
                    const checked = checkboxes.filter(cb => cb.checked);
                    const atLimit = checked.length >= maxAllowed;
                    checkboxes.forEach(cb => {
                        if (!cb.checked) {
                            cb.disabled = atLimit;
                        } else {
                            cb.disabled = false;
                        }
                    });
                }

                function onChange(e) {
                    const checked = checkboxes.filter(cb => cb.checked);
                    if (checked.length > maxAllowed) {
                        e.currentTarget.checked = false;
                    }
                    updateState();
                }

                checkboxes.forEach(cb => cb.addEventListener('change', onChange));
                updateState();
            }

            enforceMaxSelections('q17-18', 2);
            enforceMaxSelections('q19-20', 2);
        }

        // Test function to verify clickable cells are working
        function testClickableCells() {
            console.log('Testing clickable cells...');
            const cells = document.querySelectorAll('.clickable-cell');
            console.log(`Found ${cells.length} clickable cells`);
            cells.forEach((cell, index) => {
                const question = cell.getAttribute('data-question');
                const value = cell.getAttribute('data-value');
                const onclick = cell.getAttribute('onclick');
                console.log(`Cell ${index}: question=${question}, value=${value}, onclick=${onclick}`);
            });
        }
        
        function selectCell(cell, questionNumber, value) {
            try {
                console.log(`selectCell called: question ${questionNumber}, value ${value}`);
                console.log('Cell element:', cell);
                console.log('Cell classes:', cell.className);
                console.log('Cell data-question:', cell.getAttribute('data-question'));
                console.log('Cell data-value:', cell.getAttribute('data-value'));
                
                // Remove previous selection for this question
                const row = cell.closest('tr');
                if (!row) {
                    console.error('Could not find row for cell');
                    return;
                }
                
                const cells = row.querySelectorAll('.clickable-cell');
                console.log(`Found ${cells.length} clickable cells in row`);
                cells.forEach(c => {
                    c.classList.remove('selected');
                    console.log(`Removed 'selected' class from cell with value: ${c.getAttribute('data-value')}`);
                });
                
                // Select the clicked cell
                cell.classList.add('selected');
                console.log(`Added 'selected' class to cell with value: ${value}`);
                console.log('Cell classes after selection:', cell.className);
                
                // Store the answer in the hidden input
                const hiddenInput = document.getElementById(`q${questionNumber}`);
                if (hiddenInput) {
                    hiddenInput.value = value;
                    console.log(`Hidden input q${questionNumber} value set to: ${value}`);
                } else {
                    console.error(`Hidden input q${questionNumber} not found`);
                }

                // Update answered indicators
                updateAnsweredIndicators();
                
                // Force a visual update
                cell.style.display = 'none';
                cell.offsetHeight; // Force reflow
                cell.style.display = '';
                
            } catch (error) {
                console.error('Error in selectCell:', error);
            }
        }

        function switchToPart(partNumber, andPlay = false) {
            if (currentPart !== partNumber) {
                const firstQuestionOfPart = (partNumber - 1) * 10 + 1;
                currentQuestion = firstQuestionOfPart;
            }
            
            currentPart = partNumber;

            updateNavigation();
            document.querySelectorAll('.question-part').forEach(part => part.classList.add('hidden'));
            const partToShow = document.getElementById(`part-${partNumber}`);
            if (partToShow) {
                partToShow.classList.remove('hidden');
            }

            if (document.querySelector('.main-container.results-mode')) {
                const transcriptionSource = document.querySelector(`#transcription-data [data-part="${partNumber}"]`);
                const transcriptionTarget = document.getElementById('transcription-text');
                if (transcriptionSource && transcriptionTarget) {
                    transcriptionTarget.innerHTML = transcriptionSource.innerHTML;
                }
            }

            updateNavigation();
        }

        function updateNavigation() {
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.remove('selected');
                updateAttemptedCount(index + 1);
            });
            const currentWrapper = document.querySelectorAll('.footer__questionWrapper___1tZ46')[currentPart - 1];
            if (currentWrapper) {
                currentWrapper.classList.add('selected');
            }
            document.getElementById('prevBtn').disabled = currentQuestion === 1;
            document.getElementById('nextBtn').disabled = currentQuestion === 40;
        }

        function goToQuestion(questionNumber) {
            currentQuestion = questionNumber;
            let partNumber = 1;
            if (questionNumber > 10 && questionNumber <= 20) partNumber = 2;
            else if (questionNumber > 20 && questionNumber <= 30) partNumber = 3;
            else if (questionNumber > 30) partNumber = 4;
            if (currentPart !== partNumber) {
                switchToPart(partNumber);
            }
            document.querySelectorAll('.subQuestion').forEach(btn => btn.classList.remove('active'));
            const questionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${questionNumber})"]`);
            if (questionBtn) questionBtn.classList.add('active');

            // Scroll to the question
            let questionElement;
            if (questionNumber >= 27 && questionNumber <= 28) {
               questionElement = document.querySelector('input[name="q27-28"]');
            } else if (questionNumber >= 29 && questionNumber <= 30) {
               questionElement = document.querySelector('input[name="q29-30"]');
            } else {
                questionElement = document.getElementById(`q${questionNumber}`) || // text inputs
                                document.querySelector(`[data-question-id="${questionNumber}"]`) || // drag-drop
                                document.querySelector(`input[name="q${questionNumber}"]`); // radio buttons
            }
            
            if (questionElement) {
                const questionContainer = questionElement.closest('.question');
                if(questionContainer) {
                    questionContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    questionContainer.classList.add('flash');
                    setTimeout(() => {
                        questionContainer.classList.remove('flash');
                    }, 1000);
                }
            }
            updateNavigation();
        }

        function nextPart() {
            if (currentQuestion < 40) {
                goToQuestion(currentQuestion + 1);
            }
        }

        function previousPart() {
            if (currentQuestion > 1) {
                goToQuestion(currentQuestion - 1);
            }
        }

        function highlightText() {
            if (!selectedRange || selectedRange.collapsed) {
                closeContextMenu();
                return;
            }
            
            try {
                // Check if selection spans multiple elements
                const startContainer = selectedRange.startContainer;
                const endContainer = selectedRange.endContainer;
                
                if (startContainer === endContainer && startContainer.nodeType === Node.TEXT_NODE) {
                    // Simple case: selection within a single text node
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    selectedRange.surroundContents(span);
                } else {
                    // Complex case: selection spans multiple elements
                    // Handle partial text selections and complex DOM structures
                    
                    // First, handle partial text at the start
                    const startOffset = selectedRange.startOffset;
                    const endOffset = selectedRange.endOffset;
                    
                    if (startContainer.nodeType === Node.TEXT_NODE && startOffset > 0) {
                        // Split the start text node if selection starts in the middle
                        const startText = startContainer.textContent;
                        const beforeText = startText.substring(0, startOffset);
                        const selectedStartText = startText.substring(startOffset);
                        
                        const beforeNode = document.createTextNode(beforeText);
                        const selectedNode = document.createTextNode(selectedStartText);
                        
                        const parent = startContainer.parentNode;
                        parent.insertBefore(beforeNode, startContainer);
                        parent.insertBefore(selectedNode, startContainer);
                        parent.removeChild(startContainer);
                        
                        // Update the range to start from the new node
                        selectedRange.setStart(selectedNode, 0);
                    }
                    
                    if (endContainer.nodeType === Node.TEXT_NODE && endOffset < endContainer.textContent.length) {
                        // Split the end text node if selection ends in the middle
                        const endText = endContainer.textContent;
                        const selectedEndText = endText.substring(0, endOffset);
                        const afterText = endText.substring(endOffset);
                        
                        const selectedNode = document.createTextNode(selectedEndText);
                        const afterNode = document.createTextNode(afterText);
                        
                        const parent = endContainer.parentNode;
                        parent.insertBefore(selectedNode, endContainer);
                        parent.insertBefore(afterNode, endContainer);
                        parent.removeChild(endContainer);
                        
                        // Update the range to end at the new node
                        selectedRange.setEnd(selectedNode, selectedNode.textContent.length);
                    }
                    
                    // Now extract the contents and highlight all text nodes
                    const fragment = selectedRange.extractContents();
                    
                    // Create a tree walker to find all text nodes
                    const walker = document.createTreeWalker(
                        fragment,
                        NodeFilter.SHOW_TEXT,
                        {
                            acceptNode: function(node) {
                                // Accept text nodes that have content (not just whitespace)
                                return node.textContent.trim() ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;
                            }
                        },
                        false
                    );
                    
                    const textNodes = [];
                    let node;
                    while (node = walker.nextNode()) {
                        textNodes.push(node);
                    }
                    
                    // Wrap each text node in a highlight span
                    textNodes.forEach(textNode => {
                        const span = document.createElement('span');
                        span.className = 'highlight';
                        const parent = textNode.parentNode;
                        if (parent) {
                            parent.insertBefore(span, textNode);
                            span.appendChild(textNode);
                        }
                    });
                    
                    // Insert the highlighted fragment back
                    selectedRange.insertNode(fragment);
                }
            } catch(err) {
                console.warn('Primary highlighting failed, trying robust fallback:', err);
                
                // Robust fallback for complex selections
                try {
                    const selection = window.getSelection();
                    if (selection.rangeCount > 0) {
                        const range = selection.getRangeAt(0);
                        
                        // Get all nodes in the selection
                        const startContainer = range.startContainer;
                        const endContainer = range.endContainer;
                        const commonAncestor = range.commonAncestorContainer;
                        
                        // Create a temporary range to work with
                        const tempRange = document.createRange();
                        tempRange.selectNodeContents(commonAncestor);
                        
                        // Find the start and end positions
                        const startPos = range.startOffset;
                        const endPos = range.endOffset;
                        
                        // Extract and highlight the content
                        const contents = range.extractContents();
                        
                        // Recursively highlight all text content
                        function highlightAllText(node) {
                            if (node.nodeType === Node.TEXT_NODE) {
                                if (node.textContent.trim()) {
                                    const span = document.createElement('span');
                                    span.className = 'highlight';
                                    span.style.backgroundColor = '#ffff00';
                                    const parent = node.parentNode;
                                    if (parent) {
                                        parent.insertBefore(span, node);
                                        span.appendChild(node);
                                    }
                                }
                            } else if (node.nodeType === Node.ELEMENT_NODE) {
                                Array.from(node.childNodes).forEach(child => {
                                    highlightAllText(child);
                                });
                            }
                        }
                        
                        highlightAllText(contents);
                        range.insertNode(contents);
                    }
                } catch(e2) {
                    console.warn('Robust fallback failed, using final method:', e2);
                    // Final fallback - use execCommand
                    try {
                        document.execCommand('backColor', false, 'yellow');
                    } catch(e3) {
                        console.error('All highlighting methods failed:', e3);
                        // Show user feedback
                        alert('Highlighting failed for this selection. Please try selecting smaller portions of text.');
                    }
                }
            }
            
            window.getSelection().removeAllRanges();
            closeContextMenu();
        }

        function addComment() {
            const commentText = prompt('Enter your comment:');
            if (!commentText || !selectedRange || selectedRange.collapsed) {
                closeContextMenu();
                return;
            }
            try {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = commentText;
                span.appendChild(tooltip);
                selectedRange.surroundContents(span);
            }catch(err){
                console.warn('Complex selection – cannot comment');
            }
            window.getSelection().removeAllRanges();
            closeContextMenu();
        }

        function clearHighlight() {
           const elementToClear = contextElement;
           if (!elementToClear) {
               closeContextMenu();
               return;
           }
           const parent = elementToClear.parentNode;
           
           while (elementToClear.firstChild) {
               if (!elementToClear.firstChild.classList?.contains('comment-tooltip')) {
                   parent.insertBefore(elementToClear.firstChild, elementToClear);
               } else {
                   elementToClear.removeChild(elementToClear.firstChild);
               }
           }
           parent.removeChild(elementToClear);
           parent.normalize();
           closeContextMenu();
        }

        function clearAllHighlights() {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(element => {
                const parent = element.parentNode;
                const fragment = document.createDocumentFragment();

                while (element.firstChild) {
                    if (element.firstChild.nodeType === 1 && element.firstChild.classList.contains('comment-tooltip')) {
                        element.removeChild(element.firstChild);
                    } else {
                        fragment.appendChild(element.firstChild);
                    }
                }
                parent.replaceChild(fragment, element);
            });
            closeContextMenu();
        }
        
        function closeContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
            contextElement = null;
        }

        function updateAttemptedCount(partNumber) {
            const partContainer = document.getElementById(`part-${partNumber}`);
            if (!partContainer) return;
            let answeredCount = 0;
            const answeredGroups = {};

            // Special handling for grouped checkbox questions q17-18 and q19-20 (in Part 2)
            const count1718 = partContainer.querySelectorAll('input[name="q17-18"]:checked').length;
            const count1920 = partContainer.querySelectorAll('input[name="q19-20"]:checked').length;
            if (count1718 > 0) {
                answeredCount += Math.min(2, count1718 >= 2 ? 2 : 1);
                answeredGroups['q17-18'] = true;
            }
            if (count1920 > 0) {
                answeredCount += Math.min(2, count1920 >= 2 ? 2 : 1);
                answeredGroups['q19-20'] = true;
            }

            const inputs = partContainer.querySelectorAll('input.answer-input:not([disabled]):not([type="hidden"]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled])');
            inputs.forEach(input => {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    // skip grouped checkbox names (counted above)
                    if (input.name === 'q17-18' || input.name === 'q19-20') return;
                    if (input.name === 'q24-25') {
                        const checkedCount = partContainer.querySelectorAll('input[name="q24-25"]:checked').length;
                        const keyFirst = 'q24-25-first';
                        const keySecond = 'q24-25-second';
                        if (checkedCount >= 1 && !answeredGroups[keyFirst]) {
                            answeredCount++;
                            answeredGroups[keyFirst] = true;
                        }
                        if (checkedCount >= 2 && !answeredGroups[keySecond]) {
                            answeredCount++;
                            answeredGroups[keySecond] = true;
                        }
                    } else if (input.checked && !answeredGroups[input.name]) {
                        answeredCount++;
                        answeredGroups[input.name] = true;
                    }
                } else {
                    if (input.value.trim() !== '') answeredCount++;
                }
            });
            // Include drag/drop filled zones as answered
            const zones = partContainer.querySelectorAll('.drop-zone[data-question-id]');
            zones.forEach(zone => {
                if (zone.querySelector('.drag-item')) {
                    answeredCount++;
                }
            });
            
            // Include clickable cells as answered
            const clickableCells = partContainer.querySelectorAll('.clickable-cell.selected');
            clickableCells.forEach(cell => {
                const questionNum = cell.getAttribute('data-question');
                if (questionNum && !answeredGroups[`clickable-${questionNum}`]) {
                    answeredCount++;
                    answeredGroups[`clickable-${questionNum}`] = true;
                }
            });
            const countDisplay = document.querySelector(`.footer__questionWrapper___1tZ46:nth-child(${partNumber}) .attemptedCount`);
            if (countDisplay) countDisplay.textContent = `${answeredCount} of 10`;
        }

        function checkAnswers() {
            let score = 0;
            let resultsData = [];
            document.querySelectorAll('.correct, .incorrect, .correct-answer-text, .correct-inline').forEach(el => {
                if (el.classList.contains('correct-answer-text') || el.classList.contains('correct-inline')) {
                    el.remove();
                } else {
                    el.classList.remove('correct', 'incorrect');
                }
            });
            
            Object.keys(correctAnswers).forEach(key => {
                const correctAnswer = correctAnswers[key];
                let userAnswer = '';
                let isCorrect = false;
                const questionType = questionTypes[key];
                
                // Handle different question types
                if (key.includes('-')) {
                    // Multi-question keys like 'q11-12', 'q13-14'
                    const [startQ, endQ] = key.split('-').map(q => parseInt(q.replace('q', '')));
                    
                    switch(questionType) {
                        case 'checkbox':
                            const checkedBoxes = document.querySelectorAll(`input[name="${key}"]:checked`);
                            const userAnswers = Array.from(checkedBoxes).map(cb => cb.value).sort();
                            userAnswer = userAnswers.join(', ');
                            const correctAnswersSorted = Array.isArray(correctAnswer) ? [...correctAnswer].sort() : [correctAnswer];
                            
                            // Count how many correct answers the user selected
                            const correctUserAnswers = userAnswers.filter(ans => correctAnswersSorted.includes(ans));
                            
                            // Additive-only scoring: 1 point per correct selected; no penalty for incorrect
                            const questionScore = correctUserAnswers.length;
                            score += questionScore;
                            
                            // Mark group as fully correct only if all correct options are selected and no extra are selected
                            isCorrect = (correctUserAnswers.length === correctAnswersSorted.length && userAnswers.length === correctAnswersSorted.length);
                            
                            // Mark individual checkboxes
                            checkedBoxes.forEach(cb => {
                                const label = cb.closest('label');
                                if (label) {
                                    if (correctAnswersSorted.includes(cb.value)) {
                                        label.classList.add('correct');
                                    } else {
                                        label.classList.add('incorrect');
                                    }
                                }
                            });
                            
                            // Mark correct answers that weren't selected
                            correctAnswersSorted.forEach(correctVal => {
                                const correctCheckbox = document.querySelector(`input[name="${key}"][value="${correctVal}"]`);
                                if (correctCheckbox && !correctCheckbox.checked) {
                                    const correctLabel = correctCheckbox.closest('label');
                                    if (correctLabel) {
                                        correctLabel.classList.add('correct');
                                    }
                                }
                            });
                            break;
                    }
                    
                    // Mark buttons for the question range
                    for (let qNum = startQ; qNum <= endQ; qNum++) {
                        const btn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                        if (btn) {
                            btn.classList.remove('answered');
                            btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }
                    
                    resultsData.push({
                        question: `${startQ}-${endQ}`,
                        userAnswer: userAnswer || 'No Answer',
                        correctAnswer: Array.isArray(correctAnswer) ? correctAnswer.join(', ') : String(correctAnswer),
                        isCorrect: isCorrect
                    });
                    
                    // For checkbox questions in multi-question keys, score was already added in switch statement
                    // Don't add additional score here - return early to skip the final score increment
                    return;
                } else {
                   const qNum = parseInt(key.replace('q', ''));
                   const btn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                   const element = document.getElementById(key) || document.querySelector(`input[name="${key}"]`);

                   // Determine question type: prefer explicit mapping over DOM input type
                   let questionType = questionTypes[key];
                   if (!questionType) {
                       if (element?.type === 'radio') questionType = 'mcq';
                       else if (element?.type === 'text') questionType = 'text';
                   }
                   
                    switch (questionType) {
                       case 'text':
                           userAnswer = element.value.trim();
                           const acceptedAnswers = Array.isArray(correctAnswer) ? correctAnswer : [String(correctAnswer)];
                           isCorrect = acceptedAnswers.some(ans => ans.toLowerCase() === userAnswer.toLowerCase());
                           element.classList.add(isCorrect ? 'correct' : 'incorrect');
                           if (!isCorrect) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-inline';
                                correctAnswerSpan.textContent = acceptedAnswers[0];
                                element.insertAdjacentElement('afterend', correctAnswerSpan);
                           }
                           break;
                        case 'mcq':
                            const radioChecked = document.querySelector(`input[name="${key}"]:checked`);
                            userAnswer = radioChecked ? radioChecked.value : 'No Answer';
                            isCorrect = userAnswer === correctAnswer;
                            const radios = document.querySelectorAll(`input[name="${key}"]`);
                            radios.forEach(radio => {
                                const label = radio.closest('label');
                                const wrapper = radio.closest('.multi-choice-option') || label;
                                if (radio.value === correctAnswer) {
                                    wrapper.classList.add('correct');
                                } else if (radio.checked) {
                                    wrapper.classList.add('incorrect');
                                }
                            });
                            break;
                        case 'dragdrop': {
                            const dz = document.querySelector(`.drop-zone[data-question-id="${qNum}"]`);
                            const dropped = dz ? dz.querySelector('.drag-item') : null;
                            // Prefer hidden input (kept in sync on drop), then dataset/attribute
                            const hiddenVal = element ? element.value.trim() : '';
                            if (hiddenVal) {
                                userAnswer = hiddenVal;
                            } else if (dropped) {
                                const dataLetter = dropped.getAttribute('data-letter') || dropped.dataset.letter;
                                userAnswer = (dataLetter && dataLetter.trim()) || dropped.textContent.trim();
                            } else {
                                userAnswer = '';
                            }
                            const accepted = Array.isArray(correctAnswer) ? correctAnswer.map(a=>String(a).toLowerCase()) : [String(correctAnswer).toLowerCase()];
                            isCorrect = userAnswer && accepted.includes(String(userAnswer).toLowerCase());
                            if (!isCorrect) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-inline';
                                // show canonical uppercase answer for letters
                                const showVal = Array.isArray(correctAnswer) ? String(correctAnswer[0]) : String(correctAnswer);
                                correctAnswerSpan.textContent = showVal;
                                // Make sure it sits inline with the question row
                                correctAnswerSpan.style.display = 'inline-block';
                                correctAnswerSpan.style.marginLeft = '8px';
                                const anchor = dz || element; // prefer drop-zone, fallback to hidden input
                                if (anchor) {
                                    anchor.insertAdjacentElement('afterend', correctAnswerSpan);
                                }
                            }
                            break; }
                       case 'clickable':
                           console.log(`Checking clickable question ${qNum}, correct answer: ${correctAnswer}`);
                           const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"].selected`);
                           console.log(`Selected cell for question ${qNum}:`, selectedCell);
                           userAnswer = selectedCell ? selectedCell.getAttribute('data-value') : 'No Answer';
                           console.log(`User answer for question ${qNum}: ${userAnswer}`);
                           isCorrect = userAnswer === correctAnswer;
                           console.log(`Question ${qNum} is correct: ${isCorrect}`);
                           
                           // Mark cells as correct/incorrect
                           const allCells = document.querySelectorAll(`.clickable-cell[data-question="${qNum}"]`);
                           allCells.forEach(cell => {
                               if (cell.getAttribute('data-value') === correctAnswer) {
                                   cell.classList.add('correct');
                               } else if (cell.classList.contains('selected')) {
                                   cell.classList.add('incorrect');
                               }
                           });
                           break;
                       case 'checkbox':
                           const checkedBoxes = document.querySelectorAll(`input[name="${key}"]:checked`);
                           const userAnswers = Array.from(checkedBoxes).map(cb => cb.value).sort();
                           userAnswer = userAnswers.join(', ');
                           const correctAnswersSorted = Array.isArray(correctAnswer) ? correctAnswer.sort() : [correctAnswer];
                           
                           // Count how many correct answers the user selected
                           const correctUserAnswers = userAnswers.filter(ans => correctAnswersSorted.includes(ans));
                           
                           // Additive-only scoring: 1 point per correct selected; no penalty for incorrect
                           const questionScore = correctUserAnswers.length;
                           score += questionScore;
                           
                           // Mark group as fully correct only if all correct options are selected and no extra are selected
                           isCorrect = (correctUserAnswers.length === correctAnswersSorted.length && userAnswers.length === correctAnswersSorted.length);
                           
                           // Mark individual checkboxes
                           checkedBoxes.forEach(cb => {
                               const label = cb.closest('label');
                               if (label) {
                                   if (correctAnswersSorted.includes(cb.value)) {
                                       label.classList.add('correct');
                                   } else {
                                       label.classList.add('incorrect');
                                   }
                               }
                           });
                           
                           // Mark correct answers that weren't selected
                           correctAnswersSorted.forEach(correctVal => {
                               const correctCheckbox = document.querySelector(`input[name="${key}"][value="${correctVal}"]`);
                               if (correctCheckbox && !correctCheckbox.checked) {
                                   const correctLabel = correctCheckbox.closest('label');
                                   if (correctLabel) {
                                       correctLabel.classList.add('correct');
                                   }
                               }
                           });
                           break;
                   }

                   if (btn) {
                       btn.classList.remove('answered');
                       btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                   }

                   resultsData.push({
                       question: qNum,
                       userAnswer: userAnswer || 'No Answer',
                       correctAnswer: Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : String(correctAnswer),
                       isCorrect: isCorrect
                   });
               }

                // For checkbox questions, score was already added in the switch statement
                // Only add score for non-checkbox questions
                if (questionType !== 'checkbox' && isCorrect) {
                   score++;
               }
            });

            const deliverButton = document.getElementById('deliver-button');
            const band = (function(raw){
                if(raw>=39) return 9;
                if(raw>=37) return 8.5;
                if(raw>=35) return 8;
                if(raw>=32) return 7.5;
                if(raw>=30) return 7;
                if(raw>=26) return 6.5;
                if(raw>=23) return 6;
                if(raw>=18) return 5.5;
                if(raw>=16) return 5;
                if(raw>=13) return 4.5;
                if(raw>=10) return 4;
                if(raw>=8)  return 3.5;
                if(raw>=6)  return 3;
                if(raw>=4)  return 2.5;
                if(raw>=2)  return 2;
                if(raw===1) return 1.5;
                return 0;
            })(score);

            // Disable all inputs after grading
            document.querySelectorAll('.answer-input, input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.disabled = true;
            });
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over'); // Ensure no lingering hover styles
            });

            // Results mode layout with transcription
            document.querySelector('.main-container').classList.add('results-mode');
            switchToPart(currentPart); // Show the transcription for the current part

            // Populate modal content (but do not force-open yet)
            const modal = document.getElementById('result-modal');
            const scoreSummary = document.getElementById('score-summary');
            const resultDetails = document.getElementById('result-details');
            
            scoreSummary.textContent = `You scored ${score} out of 40 (Band ${band}).`;
            
            let tableHTML = '<table><thead><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Result</th></tr></thead><tbody>';
            resultsData.sort((a,b) => parseInt(a.question, 10) - parseInt(b.question, 10)).forEach(res => {
                tableHTML += `
                    <tr>
                        <td>${res.question}</td>
                        <td>${res.userAnswer}</td>
                        <td>${res.correctAnswer}</td>
                        <td class="${res.isCorrect ? 'result-correct' : 'result-incorrect'}">
                            ${res.isCorrect ? '✔ Correct' : '✖ Incorrect'}
                        </td>
                    </tr>
                `;
            });
            tableHTML += '</tbody></table>';
            // Controls: filter toggles and export
            const controls = document.createElement('div');
            controls.className = 'result-controls';
            controls.innerHTML = `
                <label><input type="checkbox" id="toggle-correct" checked> Show correct</label>
                <label><input type="checkbox" id="toggle-incorrect" checked> Show incorrect</label>
                <span class="spacer"></span>
                <button id="export-csv" class="btn-secondary">Export CSV</button>
            `;
            // Apply to modal
            resultDetails.innerHTML = '';
            resultDetails.appendChild(controls);
            const tableContainer = document.createElement('div');
            tableContainer.innerHTML = tableHTML;
            resultDetails.appendChild(tableContainer);
            
            // Wire up filters
            const toggleCorrect = controls.querySelector('#toggle-correct');
            const toggleIncorrect = controls.querySelector('#toggle-incorrect');
            function applyFilters(){
                tableContainer.querySelectorAll('tbody tr').forEach(row => {
                    const isCorrect = row.querySelector('td.result-correct') !== null;
                    const isIncorrect = row.querySelector('td.result-incorrect') !== null;
                    let visible = true;
                    if (isCorrect && !toggleCorrect.checked) visible = false;
                    if (isIncorrect && !toggleIncorrect.checked) visible = false;
                    row.style.display = visible ? '' : 'none';
                });
            }
            toggleCorrect.addEventListener('change', applyFilters);
            toggleIncorrect.addEventListener('change', applyFilters);
            applyFilters();
            
            // CSV export
            controls.querySelector('#export-csv').addEventListener('click', () => {
                const rows = [['Question','Your Answer','Correct Answer','Result']];
                tableContainer.querySelectorAll('tbody tr').forEach(tr => {
                    if (tr.style.display === 'none') return; // respect filters
                    const tds = tr.querySelectorAll('td');
                    const resultCell = tds[3];
                    const resultText = resultCell.classList.contains('result-correct') ? 'Correct' : 'Incorrect';
                    rows.push([tds[0].textContent.trim(), tds[1].textContent.trim(), tds[2].textContent.trim(), resultText]);
                });
                const csv = rows.map(r => r.map(v => '"' + v.replace(/"/g,'""') + '"').join(',')).join('\n');
                const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'listening_results.csv';
                a.click();
                URL.revokeObjectURL(url);
            });
            resultDetails.innerHTML = tableHTML;

            // Turn the deliver button into a green "My Results" button
            deliverButton.classList.add('success');
            deliverButton.innerHTML = '<span>My Results</span>';
            deliverButton.disabled = false;

            // Rebind click handler to open the results modal from now on
            const myResultsBtn = deliverButton.cloneNode(true);
            deliverButton.parentNode.replaceChild(myResultsBtn, deliverButton);
            myResultsBtn.addEventListener('click', () => {
                const modalEl = document.getElementById('result-modal');
                if (modalEl) modalEl.style.display = 'flex';
            });

            // Open the modal immediately after grading
            modal.style.display = 'flex';
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    checkAnswers();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }

        // Event Listeners
        playPauseBtn.addEventListener('click', () => {
            if (!testStarted) {
                testStarted = true; // Timer removed, skip startTimer
                switchToPart(currentPart, true);
            } else {
                if (audioPlayer.paused) {
                    // If paused, ensure the audio source is for the current part
                    if (!audioPlayer.src.includes(audioSource)) {
                        audioPlayer.src = audioSource;
                    }
                    audioPlayer.play();
                } else {
                    audioPlayer.pause();
                }
            }
        });
        
        audioPlayer.addEventListener('play', () => {
            playPauseBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>`;
        });

        audioPlayer.addEventListener('pause', () => {
            playPauseBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
        });

        audioPlayer.addEventListener('ended', () => {
            if (currentPart < 4) {
                switchToPart(currentPart + 1, true);
            }
        });

        audioPlayer.addEventListener('loadedmetadata', () => {
            progressBar.max = audioPlayer.duration;
            totalDurationEl.textContent = formatTime(audioPlayer.duration);
        });

        audioPlayer.addEventListener('timeupdate', () => {
            progressBar.value = audioPlayer.currentTime;
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
        });

        progressBar.addEventListener('input', () => {
            audioPlayer.currentTime = progressBar.value;
        });

        volumeSlider.addEventListener('input', (e) => audioPlayer.volume = e.target.value);

        speedBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            speedOptions.classList.toggle('hidden');
        });

        speedOptions.addEventListener('click', (e) => {
            if (e.target.dataset.speed) {
                const speed = parseFloat(e.target.dataset.speed);
                audioPlayer.playbackRate = speed;
                speedBtn.textContent = `${speed}x`;
                speedOptions.classList.add('hidden');
            }
        });
        
        document.addEventListener('click', () => {
            if (!speedOptions.classList.contains('hidden')) {
                speedOptions.classList.add('hidden');
            }
        });

        document.getElementById('deliver-button').addEventListener('click', checkAnswers);
        
        // ===== Drag & Drop handlers for Questions 17-20 =====
        (function initDragDrop(){
            // make items draggable with data transfer id
            function handleDragStart(e){
                const id = e.target.id;
                if (!id) {
                    // ensure each option has an id
                    const letter = e.target.getAttribute('data-letter') || e.target.getAttribute('data-value');
                    e.target.id = 'opt_' + letter;
                }
                e.dataTransfer.setData('text/plain', e.target.id);
            }
            function handleDragOver(e){
                e.preventDefault();
                const zone = e.currentTarget;
                zone.classList.add('drag-over');
            }
            function handleDragLeave(e){
                e.currentTarget.classList.remove('drag-over');
            }
            function placeItemInZone(itemEl, zone){
                // Only allow one item per zone
                const existing = zone.querySelector('.drag-item');
                if (existing){
                    // move existing back to options box
                    const bank = document.getElementById('part2-options-box');
                    if (bank) bank.appendChild(existing);
                }
                // ensure letter badge is visible along with text
                // keep full item so it remains draggable and shows its letter
                itemEl.classList.add('in-zone');
                zone.textContent = '';
                zone.appendChild(itemEl);
                // sync hidden input for this question
                const qid = zone.getAttribute('data-question-id') || zone.getAttribute('data-question');
                const hidden = document.getElementById('q' + qid);
                if (hidden){
                    const letter = itemEl.getAttribute('data-letter') || itemEl.getAttribute('data-value');
                    hidden.value = letter;
                }
                updateAnsweredIndicators();
            }
            function handleDrop(e){
                e.preventDefault();
                const zone = e.currentTarget;
                zone.classList.remove('drag-over');
                const id = e.dataTransfer.getData('text/plain');
                const itemEl = document.getElementById(id);
                if (!itemEl) return;
                placeItemInZone(itemEl, zone);
                const ph = zone.querySelector('.placeholder');
                if (ph) ph.style.display = 'none';
            }
            function handleBankDrop(e){
                e.preventDefault();
                const bank = e.currentTarget;
                const id = e.dataTransfer.getData('text/plain');
                const itemEl = document.getElementById(id);
                if (!itemEl) return;
                // If coming from a zone, clear that zone's hidden input
                const fromZone = itemEl.parentElement && itemEl.parentElement.classList.contains('drop-zone') ? itemEl.parentElement : null;
                if (fromZone){
                    const qid = fromZone.getAttribute('data-question-id') || fromZone.getAttribute('data-question');
                    const hidden = document.getElementById('q' + qid);
                    if (hidden) hidden.value = '';
                    // Restore the drop zone to show placeholder
                    fromZone.classList.remove('filled');
                    fromZone.innerHTML = '';
                    const placeholder = document.createElement('span');
                    placeholder.className = 'placeholder';
                    placeholder.innerHTML = '&nbsp;';
                    fromZone.appendChild(placeholder);
                }
                itemEl.classList.remove('in-zone');
                bank.appendChild(itemEl);
                updateAnsweredIndicators();
            }
            // Attach listeners
            document.querySelectorAll('#part-2 .drag-item').forEach(el=>{
                el.addEventListener('dragstart', handleDragStart);
            });
            document.querySelectorAll('#part-2 .drop-zone').forEach(zone=>{
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
            const bank = document.getElementById('part2-options-box');
            if (bank){
                bank.addEventListener('dragover', handleDragOver);
                bank.addEventListener('dragleave', handleDragLeave);
                bank.addEventListener('drop', handleBankDrop);
            }
        })();
        
        // Go To Question Widget Logic
        const gotoWidget = document.getElementById('goto-widget');
        const gotoInput = document.getElementById('goto-input');
        const gotoBtn = document.getElementById('goto-btn');

        document.addEventListener('keydown', (e) => {
            if (e.key >= '0' && e.key <= '9' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                gotoWidget.classList.remove('hidden');
                gotoInput.focus();
                gotoInput.value = e.key;
            }
            if (e.key === 'Enter' && document.activeElement === gotoInput) {
                gotoBtn.click();
            }
            if (e.key === 'Escape') {
                gotoWidget.classList.add('hidden');
                gotoInput.value = '';
            }
        });

        if (gotoBtn) {
            gotoBtn.addEventListener('click', () => {
                const qNum = parseInt(gotoInput.value, 10);
                if (qNum >= 1 && qNum <= 40) {
                    goToQuestion(qNum);
                    gotoWidget.classList.add('hidden');
                    gotoInput.value = '';
                } else {
                    alert('Please enter a number between 1 and 40.');
                }
            });
        }

        // Add listener for the modal close button
        document.getElementById('modal-close-button').addEventListener('click', () => {
            document.getElementById('result-modal').style.display = 'none';
        });

        // === Tap-to-select & tap-to-drop for drag items (mobile support) ===
            document.body.addEventListener('click', function(e){
            const item = e.target.closest('.drag-item');
            if(item && item.getAttribute('draggable')){
                // Toggle selection
                document.querySelectorAll('.drag-item.selected').forEach(i=>i.classList.remove('selected'));
                item.classList.add('selected');
                draggedElement = item;
                return;
            }
            const dz = e.target.closest('.drop-zone');
            if(dz && draggedElement){
                // Skip if this is a Part 2 drop zone (let the Part 2 specific handler handle it)
                if (dz.closest('#part-2')) {
                    return;
                }
                // If already filled, move old back
                const container = dz.closest('.matching-container') || dz.closest('.matching-question-container') || document;
                const optionsList = container.querySelector('.matching-options-list') || document.querySelector('.matching-options-list');
                if(dz.children.length>0 && dz.firstElementChild!==draggedElement){
                    // restore original label (with letter) when returning to bank
                    const old = dz.firstElementChild;
                    if (old && old.dataset && old.dataset.fullLabel) {
                        old.textContent = old.dataset.fullLabel;
                    }
                    optionsList.appendChild(old);
                    // clear hidden value for the zone now emptied
                    const qIdOld = dz.getAttribute('data-question-id');
                    const hiddenOld = document.getElementById(`q${qIdOld}`);
                    if (hiddenOld) hiddenOld.value = '';
                    // Restore the drop zone to show placeholder
                    dz.classList.remove('filled');
                    dz.innerHTML = '';
                    const placeholder = document.createElement('span');
                    placeholder.className = 'placeholder';
                    placeholder.innerHTML = '&nbsp;';
                    dz.appendChild(placeholder);
                }
                // save full label before mutating
                if (!draggedElement.dataset.fullLabel) {
                    draggedElement.dataset.fullLabel = draggedElement.textContent.trim();
                }
                // show only the option text (strip leading "A. ", "B. ", etc.)
                const full = draggedElement.dataset.fullLabel;
                const letter = (full.match(/^\s*([A-G])\s*[\.)-]?/i) || [,''])[1].toUpperCase();
                const plain = full.replace(/^\s*[A-G]\s*[\.)-]?\s*/i, '');
                if (!draggedElement.dataset.letter && letter) {
                    draggedElement.dataset.letter = letter;
                }
                                    // Create a new element with the letter pill and plain text
                    const newElement = document.createElement('div');
                    newElement.className = 'drag-item';
                    newElement.setAttribute('draggable', 'true');
                    newElement.setAttribute('data-letter', letter);
                    newElement.setAttribute('data-value', letter);
                    newElement.setAttribute('data-fullLabel', full);
                    newElement.style.width = 'auto';
                    newElement.style.minWidth = 'fit-content';
                    
                    // Create the letter pill
                    const letterPill = document.createElement('span');
                    letterPill.className = 'drop-letter';
                    letterPill.textContent = letter;
                    
                    // Create the text span
                    const textSpan = document.createElement('span');
                    textSpan.textContent = plain;
                    textSpan.style.marginLeft = '8px';
                    textSpan.style.whiteSpace = 'nowrap';
                    
                    newElement.appendChild(letterPill);
                    newElement.appendChild(textSpan);
                    
                    // Replace the original element
                    draggedElement.parentNode.replaceChild(newElement, draggedElement);
                    draggedElement = newElement;
                dz.appendChild(draggedElement);
                draggedElement.classList.remove('selected');
                draggedElement=null;
                // style as filled pill and hide placeholder
                dz.classList.add('filled');
                const placeholder = dz.querySelector('.placeholder');
                if (placeholder) placeholder.style.display = 'none';
                // sync hidden input to the letter
                const qId = dz.getAttribute('data-question-id');
                const hiddenInput = document.getElementById(`q${qId}`);
                if (hiddenInput) hiddenInput.value = letter || '';
                updateAnsweredIndicators();
            }
        });

        // === Mobile highlight/comment toolbar ===
        const mobileToolbar = document.getElementById('mobile-selection-menu');
        function positionToolbar(){
            const sel = window.getSelection();
            if(sel.rangeCount===0 || sel.isCollapsed){
                mobileToolbar.classList.add('hidden');
                return;
            }
            const range = sel.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            mobileToolbar.style.top = window.scrollY + rect.top - mobileToolbar.offsetHeight - 8 + 'px';
            mobileToolbar.style.left = window.scrollX + rect.left + 'px';
            mobileToolbar.classList.remove('hidden');
        }
        document.addEventListener('selectionchange', () => {
            const sel = window.getSelection();
            if(sel && sel.rangeCount>0 && !sel.isCollapsed){
                selectedRange = sel.getRangeAt(0);
                selectedText = sel.toString();
            }
            if('ontouchstart' in window || navigator.maxTouchPoints>0){
                setTimeout(positionToolbar, 0);
            }
        });
        document.addEventListener('click', (e)=>{
            if(!e.target.closest('#mobile-selection-menu')){
                mobileToolbar.classList.add('hidden');
            }
        });

        /* ---------------- Drag and Drop for Matching Questions ---------------- */

        (function initDragAndDrop() {
            const container = document.querySelector('.left-panel');
            if (!container) return;

            container.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('drag-item')) {
                    draggedElement = e.target;
                    setTimeout(() => {
                        e.target.classList.add('dragging');
                    }, 0);
                }
            });

            container.addEventListener('dragend', (e) => {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                }
            });

            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                const target = e.target;
                const dropZone = target.closest('.drop-zone');
                const optionsList = target.closest('.matching-options-list');

                if (dropZone || optionsList) {
                    const overElement = dropZone || optionsList;
                    document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                    overElement.classList.add('drag-over');
                }
            });

            container.addEventListener('dragleave', (e) => {
                const target = e.target;
                const dropZone = target.closest('.drop-zone');
                const optionsList = target.closest('.matching-options-list');
                if (dropZone || optionsList) {
                    const overElement = dropZone || optionsList;
                    overElement.classList.remove('drag-over');
                }
            });


            container.addEventListener('drop', (e) => {
                e.preventDefault();
                if (!draggedElement) return;

                const dropTarget = e.target.closest('.drop-zone, .matching-options-list');
                if (!dropTarget) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                    return;
                }

                // Skip if this is a Part 2 drop zone (let the Part 2 specific handler handle it)
                if (dropTarget.closest('#part-2')) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                    return;
                }

                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                
                const existingItem = dropTarget.matches('.drop-zone') ? dropTarget.querySelector('.drag-item') : null;
                const originalParent = draggedElement.parentNode;

                // If there's an item in the target dropzone, swap them
                if (existingItem) {
                    // when moving existing item back, restore its full label
                    if (existingItem.dataset && existingItem.dataset.fullLabel) {
                        existingItem.textContent = existingItem.dataset.fullLabel;
                    }
                    originalParent.appendChild(existingItem);
                    // If the original parent is a drop-zone and now empty, unfill it
                    if (originalParent.classList && originalParent.classList.contains('drop-zone')) {
                        originalParent.classList.remove('filled');
                        // Clear the drop zone and restore placeholder
                        originalParent.innerHTML = '';
                        const placeholder = document.createElement('span');
                        placeholder.className = 'placeholder';
                        placeholder.innerHTML = '&nbsp;';
                        originalParent.appendChild(placeholder);
                        // Clear the hidden input
                        const qId = originalParent.getAttribute('data-question-id');
                        const hiddenInput = document.getElementById(`q${qId}`);
                        if (hiddenInput) hiddenInput.value = '';
                    }
                }
                
                dropTarget.appendChild(draggedElement);

                if(dropTarget.matches('.drop-zone')) {
                    const placeholder = dropTarget.querySelector('.placeholder');
                    if (placeholder) placeholder.style.display = 'none';
                    dropTarget.classList.add('filled');
                    // save full label once and show plain text only inside zone
                    if (!draggedElement.dataset.fullLabel) {
                        draggedElement.dataset.fullLabel = draggedElement.textContent.trim();
                    }
                    const full = draggedElement.dataset.fullLabel;
                    const letter = (full.match(/^\s*([A-G])\s*[\.)-]?/i) || [,''])[1].toUpperCase();
                    const plain = full.replace(/^\s*[A-G]\s*[\.)-]?\s*/i, '');
                    if (!draggedElement.dataset.letter && letter) {
                        draggedElement.dataset.letter = letter;
                    }
                    // Create a new element with the letter pill and plain text
                    const newElement = document.createElement('div');
                    newElement.className = 'drag-item';
                    newElement.setAttribute('draggable', 'true');
                    newElement.setAttribute('data-letter', letter);
                    newElement.setAttribute('data-value', letter);
                    newElement.setAttribute('data-fullLabel', full);
                    newElement.style.width = 'auto';
                    newElement.style.minWidth = 'fit-content';
                    
                    // Create the letter pill
                    const letterPill = document.createElement('span');
                    letterPill.className = 'drop-letter';
                    letterPill.textContent = letter;
                    
                    // Create the text span
                    const textSpan = document.createElement('span');
                    textSpan.textContent = plain;
                    textSpan.style.marginLeft = '8px';
                    textSpan.style.whiteSpace = 'nowrap';
                    
                    newElement.appendChild(letterPill);
                    newElement.appendChild(textSpan);
                    
                    // Replace the original element
                    draggedElement.parentNode.replaceChild(newElement, draggedElement);
                    draggedElement = newElement;
                    // sync hidden input (use data-letter if present, else text)
                    const qId = dropTarget.getAttribute('data-question-id');
                    const hiddenInput = document.getElementById(`q${qId}`);
                    if (hiddenInput) {
                        const val = draggedElement.getAttribute('data-letter') || letter || (draggedElement.dataset.fullLabel ? draggedElement.dataset.fullLabel.trim().charAt(0).toUpperCase() : draggedElement.textContent.trim());
                        hiddenInput.value = val;
                    }
                }

                draggedElement.classList.remove('dragging');
                draggedElement = null;
                updateAnsweredIndicators();
            });
        })();


        document.addEventListener('DOMContentLoaded', () => {
            switchToPart(1);
            goToQuestion(1);
            setupCheckboxLimits();
            
            // Initialize drag and drop and clickable cells
            initAllDragAndDrop();
            
            // Test clickable cells after a short delay
            setTimeout(() => {
                testClickableCells();
            }, 1000);

            document.body.addEventListener('contextmenu', function (e) {
                const text = window.getSelection().toString();
                if (!text) return;
                e.preventDefault();
                const menu = document.getElementById('contextMenu');
                menu.style.left = e.pageX + 'px';
                menu.style.top = e.pageY + 'px';
                menu.style.display = 'block';

                const target = e.target;
                const clearItem = document.getElementById('clear-item');
                contextElement = target.closest('.highlight, .comment-highlight');
                if(contextElement){
                    clearItem.style.display = 'block';
                } else {
                    clearItem.style.display = 'none';
                }
            });
            
            document.body.addEventListener('click', function(e) {
                if (e.target.closest('.context-menu')) return;
                document.getElementById('contextMenu').style.display = 'none';
            });
        });

        // Initial setup on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            updateAnsweredIndicators();
            
            // Add specific event listeners for questions 17-20 radio buttons
            document.querySelectorAll('input[name="q17"], input[name="q18"], input[name="q19"], input[name="q20"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const questionNumber = this.name.substring(1); // Remove 'q' prefix
                    const hiddenInput = document.getElementById(`q${questionNumber}`);
                    if (hiddenInput) {
                        hiddenInput.value = this.value;
                        console.log(`Question ${questionNumber} selected: ${this.value}`);
                    }
                });
            });
        });

        document.querySelectorAll('.mcq-table td').forEach(cell => {
            cell.addEventListener('click', (e) => {
                if (e.target.tagName !== 'INPUT') {
                    const radio = cell.querySelector('input[type="radio"]');
                    if (radio && !radio.disabled) {
                        radio.checked = true;
                    }
                }
            });
        });

        document.querySelectorAll('.answer-input, input[type="radio"], input[type="checkbox"]').forEach(input => {
            input.addEventListener('input', updateAnsweredIndicators);
            input.addEventListener('change', updateAnsweredIndicators);
        });

        function initAllDragAndDrop() {
            const dragItems = document.querySelectorAll('.drag-item');
            const dropZones = document.querySelectorAll('.drop-zone');

            dragItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });

            // Initialize clickable cells for questions 27-31
            initClickableCells();
        }

        function initClickableCells() {
            const clickableCells = document.querySelectorAll('.clickable-cell');
            clickableCells.forEach(cell => {
                cell.addEventListener('click', function() {
                    const questionNumber = this.getAttribute('data-question');
                    const value = this.getAttribute('data-value');
                    selectCell(this, questionNumber, value);
                });
            });
        }

            function handleDragStart(e) {
                draggedElement = e.target;
                setTimeout(() => e.target.classList.add('dragging'), 0);
            }

            function handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            function handleDragOver(e) {
                e.preventDefault();
                const zone = e.target.closest('.drop-zone');
                if (zone) zone.classList.add('drag-over');
            }

            function handleDragLeave(e) {
                const zone = e.target.closest('.drop-zone');
                if (zone) zone.classList.remove('drag-over');
            }

            function handleDrop(e) {
                e.preventDefault();
                const targetZone = e.target.closest('.drop-zone');
                if (!targetZone || !draggedElement) return;
                
                // Skip if this is a Part 2 drop zone (let the Part 2 specific handler handle it)
                if (targetZone.closest('#part-2')) {
                    return;
                }
                
                targetZone.classList.remove('drag-over');

                const sourceContainer = draggedElement.parentNode;
                const itemInTargetZone = targetZone.querySelector('.drag-item');
                
                // Prevent dropping on self or non-droppable area inside zone
                if (e.target.classList.contains('drag-item') && e.target !== draggedElement) {
                    return; // Or handle swap explicitly here if needed
                }
                
                if (itemInTargetZone && itemInTargetZone !== draggedElement) {
                    // If source is an options list, move the existing item back
                    const optionsList = findParentOptionsList(targetZone);
                    if (sourceContainer.classList.contains('matching-options-list') || sourceContainer.classList.contains('map-options-list')) {
                        if (itemInTargetZone.dataset && itemInTargetZone.dataset.fullLabel) {
                            itemInTargetZone.textContent = itemInTargetZone.dataset.fullLabel;
                        }
                        optionsList.appendChild(itemInTargetZone);
                    } 
                    // If source is another drop zone (swapping)
                    else if (sourceContainer.classList.contains('drop-zone')) {
                        if (itemInTargetZone.dataset && itemInTargetZone.dataset.fullLabel) {
                            itemInTargetZone.textContent = itemInTargetZone.dataset.fullLabel;
                        }
                        sourceContainer.appendChild(itemInTargetZone);
                        // Restore placeholder in the source drop zone
                        sourceContainer.classList.remove('filled');
                        sourceContainer.innerHTML = '';
                        const placeholder = document.createElement('span');
                        placeholder.className = 'placeholder';
                        placeholder.innerHTML = '&nbsp;';
                        sourceContainer.appendChild(placeholder);
                        // Clear the hidden input for the source zone
                        const sourceQId = sourceContainer.getAttribute('data-question-id');
                        const sourceHiddenInput = document.getElementById(`q${sourceQId}`);
                        if (sourceHiddenInput) sourceHiddenInput.value = '';
                    }
                }

                targetZone.appendChild(draggedElement);
                if (targetZone.querySelector('.placeholder')) {
                    targetZone.querySelector('.placeholder').style.display = 'none';
                }
                targetZone.classList.add('filled');
                // Sync hidden input for drag/drop questions so checking works and counters update
                const qId = targetZone.getAttribute('data-question-id');
                const hiddenInput = document.getElementById(`q${qId}`);
                if (hiddenInput) {
                    // Set to letter using data-letter if available; otherwise infer from full label
                    const letter = draggedElement.getAttribute('data-letter');
                    if (letter) {
                        hiddenInput.value = letter;
                    } else if (draggedElement.dataset.fullLabel) {
                        hiddenInput.value = draggedElement.dataset.fullLabel.trim().charAt(0).toUpperCase();
                    } else {
                        hiddenInput.value = draggedElement.textContent.trim();
                    }
                }
                
                updateAnsweredIndicators();
            }

            function findParentOptionsList(element) {
                // Specific for map
                if (element.closest('#map-drag-container')) {
                    return document.getElementById('map-options-q11-15');
                }
                // Generic for matching
                const container = element.closest('.matching-container');
                if (container) {
                    return container.querySelector('.matching-options-list');
                }
                return null;
            }
        

        let transcriptionHighlighted = false;
        function highlightAnswersInTranscription() {
            if (transcriptionHighlighted) return;

            const highlightedTranscripts = { 1: '', 2: '', 3: '', 4: '' };

            for (let i = 1; i <= 4; i++) {
                const partElement = document.querySelector(`#transcription-data [data-part="${i}"]`);
                if (partElement) highlightedTranscripts[i] = partElement.innerHTML;
            }

            for (const key in correctAnswers) {
                const answers = Array.isArray(correctAnswers[key]) ? correctAnswers[key] : [correctAnswers[key]];
                if (answers.every(answer => /^[A-G]$/.test(answer))) {
                    continue;
                }

                const qNum = parseInt(key.match(/\d+/)[0]);
                let partNumber = 1;
                if (qNum > 10 && qNum <= 20) partNumber = 2;
                else if (qNum > 20 && qNum <= 30) partNumber = 3;
                else if (qNum > 30) partNumber = 4;

                if (!highlightedTranscripts[partNumber]) continue;

                let answersToHighlight = correctAnswers[key];
                if (!Array.isArray(answersToHighlight)) {
                    answersToHighlight = [answersToHighlight];
                }

                for (const answer of answersToHighlight) {
                    if (/^[A-G]$/.test(answer)) continue;
                    
                    let searchTerm = answer.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                    searchTerm = searchTerm.replace(/\\\(s\\\)/g, '(s)?');
                    
                    const regex = new RegExp(`\\b(${searchTerm})\\b`, 'gi');
                    
                    highlightedTranscripts[partNumber] = highlightedTranscripts[partNumber].replace(
                        regex,
                        '<span class="highlight">$1</span>'
                    );
                }
            }

            for (let i = 1; i <= 4; i++) {
                const partElement = document.querySelector(`#transcription-data [data-part="${i}"]`);
                if(partElement) partElement.innerHTML = highlightedTranscripts[i];
            }
            transcriptionHighlighted = true;
        }
        
        function closeContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
            contextElement = null;
        }

        (function() {
            function enforceMaxSelections(groupName, maxAllowed) {
                var checkboxes = Array.prototype.slice.call(document.querySelectorAll('input[name="' + groupName + '"]'));

                function updateState() {
                    var checked = checkboxes.filter(function(cb) { return cb.checked; });
                    var atLimit = checked.length >= maxAllowed;
                    checkboxes.forEach(function(cb) {
                        if (!cb.checked) {
                            cb.disabled = atLimit;
                        } else {
                            cb.disabled = false;
                        }
                    });
                }

                function onChange(event) {
                    var checked = checkboxes.filter(function(cb) { return cb.checked; });
                    if (checked.length > maxAllowed) {
                        event.currentTarget.checked = false;
                    }
                    updateState();
                }

                checkboxes.forEach(function(cb) { cb.addEventListener('change', onChange); });
                updateState();
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    enforceMaxSelections('q17_18', 2);
                    enforceMaxSelections('q19_20', 2);
                });
            } else {
                enforceMaxSelections('q17_18', 2);
                enforceMaxSelections('q19_20', 2);
            }
        })();
    </script>
</body>
</html>
