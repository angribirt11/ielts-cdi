
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            overflow: hidden;
        }

        .loading-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f9fafb;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 9999;
        }

        .loading-content {
            text-align: center;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-title {
            font-size: 1.2rem;
            color: #6b7280;
            margin-bottom: 20px;
        }

        .loading-subtitle {
            font-size: 1rem;
            color: #9ca3af;
        }

        .start-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f9fafb;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 9998;
        }

        .start-content {
            text-align: center;
        }

        .start-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 24px;
        }

        .start-subtitle {
            color: #6b7280;
            margin-bottom: 24px;
        }

        .start-button {
            padding: 12px 32px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .start-button:hover {
            background-color: #1d4ed8;
        }

        .hidden {
            display: none !important;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        header {
            background-color: #ffffff;
            color: #333;
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .passage-info {
            font-size: 0.9rem;
            font-weight: 500;
            color: #2d3748;
        }

        .timer {
            background-color: rgba(255, 193, 193, 0.5);
            padding: 6px 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
            min-width: 80px;
            text-align: center;
            font-size: 0.9rem;
            color: #c53030;
            border: 1px solid rgba(255, 120, 120, 0.3);
        }

        .timer.warning {
            color: #9b2c2c;
            background-color: rgba(254, 178, 178, 0.7);
            border-color: rgba(245, 101, 101, 0.5);
        }

        .logo-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);
            cursor: pointer;
        }

        .logo-area:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }

        .logo-area i {
            font-size: 1.1rem;
        }

        .progress-container {
            background-color: #f8f9fa;
            padding: 4px 20px;
            z-index: 100;
            flex-shrink: 0;
            border-top: 1px solid #e2e8f0;
        }

        .progress-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
        }

        .progress-items {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .nav-buttons {
            display: flex;
            gap: 6px;
        }

        .progress-item {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4a5568;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            border: 1px solid #cbd5e0;
        }

        .progress-item.current {
            background-color: #4299e1;
            color: white;
            transform: scale(1.1);
            border-color: #2b6cb0;
        }

        .progress-item.answered {
            background-color: #9ae6b4;
            color: #22543d;
            border-color: #68d391;
        }

        .progress-item.correct {
            background-color: #48bb78;
            color: white;
            border-color: #38a169;
        }

        .progress-item.incorrect {
            background-color: #fed7d7;
            color: #c53030;
            border-color: #feb2b2;
        }

        .progress-item:hover {
            background-color: #cbd5e0;
            transform: scale(1.05);
        }

        .btn {
            padding: 6px 14px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.95rem;
            background-color: #f7fafc;
            color: #4a5568;
        }

        .btn i {
            font-size: 1rem;
        }

        .btn:hover {
            background-color: #edf2f7;
            border-color: #a0aec0;
        }

        .btn-primary {
            background-color: #f7fafc;
            color: #4a5568;
            border: 1px solid #cbd5e0;
        }

        .btn-primary:hover {
            background-color: #edf2f7;
            border-color: #a0aec0;
        }

        .btn-secondary {
            background-color: #f7fafc;
            color: #4a5568;
            border: 1px solid #cbd5e0;
        }

        .btn-secondary:hover {
            background-color: #edf2f7;
            border-color: #a0aec0;
        }

        .btn-submit {
            background-color: #48bb78;
            color: white;
            font-weight: 900;
            border: 1px solid #38a169;
        }

        .btn-submit:hover {
            background-color: #38a169;
            border-color: #2f855a;
        }

        .btn-submit:disabled {
            background-color: #9ae6b4;
            color: #718096;
            cursor: not-allowed;
            border: 1px solid #68d391;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .passage-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #fafafa;
            position: relative;
        }

        .resizer {
            width: 4px;
            background-color: #cbd5e0;
            cursor: col-resize;
            position: relative;
            transition: background-color 0.2s;
        }

        .resizer:hover {
            background-color: #a0aec0;
        }

        .resizer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 60px;
            background-color: rgba(203, 213, 224, 0.5);
            border-radius: 4px;
            pointer-events: none;
        }

        .questions-container {
            width: 40%;
            padding: 20px;
            overflow-y: auto;
            background-color: white;
            border-left: 1px solid #e2e8f0;
        }

        .passage {
            max-width: 800px;
            margin: 0 auto;
        }

        .passage h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .passage-content p {
            margin-top: 15px;
            margin-bottom: 20px;
            text-align: justify;
        }

        .passage h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .passage p {
            margin-top: 20px;
            margin-bottom: 25px;
            text-align: justify;
        }

        .question-section {
            max-width: 800px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        .question {
            margin-bottom: 25px;
            padding: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background-color: #ffffff;
            transition: box-shadow 0.2s;
        }

        .question:hover {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .question-text {
            font-weight: 500;
            margin-bottom: 12px;
            color: #2d3748;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .option:hover {
            background-color: #f7fafc;
            border-color: #cbd5e0;
        }

        .option input {
            margin-right: 2px;
            width: 16px;
            height: 16px;
        }

        .input-field {
            padding: 8px 10px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            width: 20%;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .input-field:focus {
            border-color: #4299e1;
            outline: none;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.2);
        }

        select.input-field {
            padding: 8px 10px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            width: 20%;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        th,
        td {
            border: 1px solid #e2e8f0;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f1f5f9;
            font-weight: 600;
            color: #2d3748;
        }

        .answer-indicator {
            background-color: #e6fffa;
            border: 1px solid #38b2ac;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .answer-indicator.correct {
            background-color: #e6fffa;
            border-color: #38b2ac;
            color: #234e52;
        }

        .answer-indicator.incorrect {
            background-color: #fed7d7;
            border-color: #fc8181;
            color: #742a2a;
        }

        .question-group {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .question-group-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: #2d3748;
            font-size: 1rem;
        }

        .highlight {
            background-color: #ffff00;
            cursor: pointer;
        }

        #highlight-btn,
        #remove-highlight-btn {
            position: absolute;
            z-index: 9999;
            display: none;
            padding: 6px 12px;
            font-size: 14px;
            border: 1px solid #888;
            border-radius: 4px;
            cursor: pointer;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .score-display {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 20px 0;
            color: #2d3748;
        }

        .score-breakdown {
            margin: 20px 0;
            text-align: left;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.95rem;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .questions-container {
                width: 100%;
                border-left: none;
                border-top: 1px solid #e2e8f0;
            }

            .resizer {
                width: 100%;
                height: 4px;
                cursor: row-resize;
            }

            .resizer::before {
                width: 60px;
                height: 30px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .progress-item {
                width: 32px;
                height: 32px;
                font-size: 0.85rem;
            }

            .passage-info {
                font-size: 0.9rem;
            }

            header {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }

            .logo-area {
                order: 1;
            }

            .passage-info {
                order: 2;
            }

            .timer {
                order: 3;
            }
        }

        @media (max-width: 480px) {
            .progress-item {
                width: 32px;
                height: 32px;
                font-size: 0.85rem;
            }

            .passage-info {
                font-size: 0.9rem;
            }
        }
    </style>
</head>



<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2 class="loading-title">Your test will begin shortly</h2>
            <p class="loading-subtitle">Please wait</p>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="startScreen" class="start-screen hidden">
        <div class="start-content">
            <h1 class="start-title">IELTSwithJurabek</h1>
            <p class="start-subtitle">Ready to begin your reading test?</p>
            <button class="start-button" onclick="startTest()">Start Test</button>
        </div>
    </div>

    <!-- Test Container -->
    <div class="container hidden" id="testContainer">
        <!-- Header -->
        <header>
            <div class="passage-info">IELTSwithJurabek</div>

            <!-- timer -->
            <div class="timer" id="globalTimer">
                <i class="fas fa-clock"></i>
                <span>60:00</span>
            </div>

            <!-- promo button -->
            <div class="logo-area" onclick="window.open('https://t.me/IELTSwithJurabek', '_blank')">
                <i class="fas fa-paper-plane"></i>
                <span>Click for more TESTS</span>
            </div>

            <div class="passage-info" id="headerPassageTitle">Passage 1 of 3</div>
        </header>

        <!-- Floating highlight buttons -->
        <button id="highlight-btn" type="button">Highlight</button>
        <button id="remove-highlight-btn" type="button">Remove Highlight</button>

        <div class="main-content">
            <!-- ===== PASSAGE 1 ===== -->
            <div class="passage-container" id="p1_passagePanel" role="region" aria-label="Reading Passage">
                <h2 class="section-title">READING PASSAGE 1</h2>
                <div class="passage-content" id="passage1">
                    <h3>The Clipper Races: an era of competition between cargo ships</h3>

                    <p>During the seventeenth and eighteenth centuries, the British East India Company had the monopoly on trade with China and India. This meant that because no rival could legally import tea or other goods from these countries at this time, the company was rarely in a hurry to transport its merchandise. Instead, its priority was to minimise costs by carrying as much as possible on each ship. This meant that its ships - known as East Indiamen - were enormous, strong and very slow.</p>

                    <p>By 1800, the average East Indiaman could carry 1,200 tons of merchandise. The trading pattern for China tea usually meant the East Indiamen set sail from Britain in January, sailed round the Cape of Good Hope at the southernmost tip of Africa, and arrived in China in September. There they would load up that year's tea harvest, set off again and, depending on the wind and weather, aim to arrive back by the following September. So even with favourable sailing conditions, the round trip lasted almost two years, and if anything went wrong it could take a lot longer.</p>

                    <p>However, by 1834 the company had lost its trading monopolies, and tea had become a freely traded item. Having no more use for its great ships, the company sold them off, and many were bought by merchants or their captains, who continued to plough the seas between Britain and China. But now that tea could be traded freely, a few smart sailors began to realise that whoever brought each new harvest of tea to Britain first, stood to make the most money.</p>

                    <p>This was partly because if you were home first, you could sell your shipment of tea before your competitors even arrived, and partly because consumers in Britain in the nineteenth century believed that the fresher and earlier-picked the tea, the better the resulting drink. Tea traders now needed faster, sleeker ships to bring their precious cargo back. Nevertheless, in Britain this idea only caught on slowly, and while the 1840s saw a few faster ships launched, for the time being many merchants remained satisfied with the slow but reliable East Indiamen.</p>

                    <p>In fact it was the Americans who pioneered the first clipper ships. These vessels were fast and slender, with a narrow hull that was deeper at the back than at the front and masses of sails on tall masts. They earned their name from the way that they clipped off journey times. British merchants resolved to build their own clippers to rival the Americans and the first British tea clipper, Stornaway, was built in Aberdeen in 1850. More tea clippers were designed and built in Britain throughout the 1850s and 1860s; they had a narrower beam than their American equivalents, making them less powerful during storms, but faster in calmer weather.</p>

                    <p>There was a great spirit of competition between the British and American ships plying the tea trade, but to begin with the Americans had the edge. Then in 1851 a British ship owner, Richard Green, built the aptly named clipper Challenger, with the stated intention of beating the American ships. Loaded with tea, Challenger left China for London in 1852 at the same time as the American clipper Challenge, a much larger, older ship, already greatly admired for its speed. Large sums were bet on which would complete the journey first. In the event, the British ship beat its rival to London by two days, amid much jubilation. From then on, such international races grew in popularity.</p>

                    <p>After 1855, American participation in the British tea trade gradually stopped. But even without the Anglo-American rivalry, the competitive spirit continued. It was really ignited when new ports were opened up for trade in China. These included Fouchow, which was much closer to the tea-producing areas than Canton, the port used previously. As a result, tea could be loaded onboard earlier and fresher, and the clippers could set off in late May or early June - sometimes not even taking time to fill out the official paperwork - racing back to Britain whatever the difficulties.</p>

                    <p>They sped down through the South China Sea and into the Indian Ocean, then raced to get round the southernmost tip of Africa at the Cape of Good Hope. Then it was north across the vast Atlantic, past the Azores, through the English Channel and into the estuary of the River Thames. Once there, they would be towed by tugs, up the river and into the docks.</p>

                    <p>The cargo of the winning ship could earn a premium of up to sixpence per pound - and so the captain and crew were rewarded by the owners of the cargo. But the races were about more than just money: the crews, about 40 men on each clipper, were expert sailors, proud of their ships, and they delighted in competing against each other. Without their enthusiasm, the races would never have happened, since getting the ship home as fast as possible required the crew to be totally dedicated and to sacrifice much of their rest for the duration of the race.</p>
                </div>
            </div>

            <!-- Resizer -->
            <div class="resizer" id="resizer"></div>

            <!-- Questions for Passage 1 -->
            <div class="questions-container" id="p1_questionsPanel" role="region" aria-label="Questions">
                <h2 class="section-title">Questions 1–13</h2>

                <div class="question-group">
                    <div class="question-group-title">Questions 1–6 – TRUE / FALSE / NOT GIVEN</div>
                    <div class="question" data-question="1">
                        <div class="question-text">1. In the seventeenth and eighteenth centuries, the British East India Company faced a lot of competition.</div>
                        <div class="options">
                            <label><input type="radio" name="q1" value="TRUE"> TRUE</label>
                            <label><input type="radio" name="q1" value="FALSE"> FALSE</label>
                            <label><input type="radio" name="q1" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="2">
                        <div class="question-text">2. Before 1800, cargo size was the most important consideration for the East India Company.</div>
                        <div class="options">
                            <label><input type="radio" name="q2" value="TRUE"> TRUE</label>
                            <label><input type="radio" name="q2" value="FALSE"> FALSE</label>
                            <label><input type="radio" name="q2" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="3">
                        <div class="question-text">3. At best, voyages of the East Indiamen to China and back took nearly two years to complete.</div>
                        <div class="options">
                            <label><input type="radio" name="q3" value="TRUE"> TRUE</label>
                            <label><input type="radio" name="q3" value="FALSE"> FALSE</label>
                            <label><input type="radio" name="q3" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="4">
                        <div class="question-text">4. Before 1834, voyages to and from China were considered to be highly dangerous.</div>
                        <div class="options">
                            <label><input type="radio" name="q4" value="TRUE"> TRUE</label>
                            <label><input type="radio" name="q4" value="FALSE"> FALSE</label>
                            <label><input type="radio" name="q4" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="5">
                        <div class="question-text">5. After 1834, the ships which had served the East India Company stopped being used for commercial purposes.</div>
                        <div class="options">
                            <label><input type="radio" name="q5" value="TRUE"> TRUE</label>
                            <label><input type="radio" name="q5" value="FALSE"> FALSE</label>
                            <label><input type="radio" name="q5" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="6">
                        <div class="question-text">6. In the nineteenth century, British drinkers preferred tea made from mature leaves to that made from younger leaves.</div>
                        <div class="options">
                            <label><input type="radio" name="q6" value="TRUE"> TRUE</label>
                            <label><input type="radio" name="q6" value="FALSE"> FALSE</label>
                            <label><input type="radio" name="q6" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                </div>

                <div class="question-group">
                    <div class="question-group-title">Questions 7–13 – Notes completion (ONE WORD ONLY)</div>
                    <p><strong>Clipper races</strong></p>
                    <p><em>The ships</em><br>
                        Clipper ships were first used for trading by American merchants.<br>
                        • The ships were remarkable for the number of <span class="question-text">7</span> <input type="text" name="q7" maxlength="30"> they had.<br>
                        • The performance of British tea clippers was particularly affected when there were <span class="question-text">8</span> <input type="text" name="q8" maxlength="30"> at sea.
                    </p>
                    <p><em>The races</em><br>
                        • It was in a ship called <span class="question-text">9</span> <input type="text" name="q9" maxlength="30"> that the British first competed successfully against the Americans. Richard Green's ship arrived two days ahead of its competitor.<br>
                        • Competition increased when additional Chinese trading <span class="question-text">10</span> <input type="text" name="q10" maxlength="30"> were established.<br>
                        • Merchants were occasionally in such a hurry that they failed to complete the <span class="question-text">11</span> <input type="text" name="q11" maxlength="30"> before leaving China.<br>
                        • At the end of their journey, the ships needed the help of <span class="question-text">12</span> <input type="text" name="q12" maxlength="30">.
                    </p>
                    <p><em>The rewards</em><br>
                        • The crews were motivated by both <span class="question-text">13</span> <input type="text" name="q13" maxlength="30"> and their enthusiasm for the competition.
                    </p>
                </div>
            </div> <!-- /p1_questionsPanel -->

            <!-- ===== PASSAGE 2 ===== -->
            <div class="passage-container hidden" id="p2_passagePanel" role="region" aria-label="Reading Passage">
                <h2 class="section-title">READING PASSAGE 2</h2>
                <div class="passage-content" id="passage2">
                    <h3>Orientation of birds</h3>

                    <p><strong>A</strong> For many of us, the way birds are able to orientate is both astounding and difficult to appreciate fully. For instance, the annual migration of the golden plover of the Pacific takes it from Alaska to Hawaii on a flight of well over 3000 kilometres, and if it were to deviate by only one degree, it would miss the island on which it nests.</p>

                    <p><strong>B</strong> The first systematic studies on orientation in birds were made possible by the 'homing instinct' exhibited by so many species. Birds are caught at a time when they show an attachment to their territory, especially during the nesting season. They are taken to some spot, released, and the percentage of returns is recorded. The distance can be varied, and the direction, as well as the method of transporting them, and then the influence of climatic and other factors on their ability to find their way home can be studied. These experiments have shown a wide variation in ability to home, and three types of homing behaviour have been identified.</p>

                    <p><strong>C</strong> In the first type, birds methodically explore the area in which they are released until they pick up some familiar feature, and then they quickly find their way back to the nest. Such birds possess a highly developed visual memory, as experiments with pigeons have shown. Domestic pigeons have been trained to peck at a certain point on an aerial photograph, with a system of rewards, and four years later the birds were still able to respond to this training when placed on the aerial photograph. Birds' eyes have a power of resolution two to three times greater than ours, enabling them to pick up very fine details. If a bird uses only this type of homing behaviour, however, it can only succeed if the point of release is not too far away. If the birds are transported 800 kilometres from their nest, it is only by good fortune that they find their way back as a result of long exploratory flights. Usually, the area known to a bird is its feeding territory. Released within this area, the birds soon make their return; release them outside it and far fewer return. However, if a bird is released for a second time in the same place, its visual memory comes into play, and the bird, no longer requiring tedious exploratory flights, will return much more quickly.</p>

                    <p><strong>D</strong> The second type of homing behaviour is shown by birds that are capable of choosing their flight direction and holding to it for the rest of their journey. How do they decide what direction to take? They appear to choose their normal migration direction even if they are released in a different place from their usual starting point. If, for example, birds which normally fly to the north-east to reach latitude 45 degrees north are released at that latitude, they will immediately start flying north-east anyway. So if they're released further to the west, they'll maintain the correct direction, but fly west of their destination, and so fail to arrive.</p>

                    <p><strong>E</strong> The third type of homing behaviour shows the highest degree of orientation. Released at one point, the birds immediately take stock of it, compare its position with that of the nest, decide on the direction and fly off. This happens even if the birds are in a country right off their migration routes, where they have never been before. In one example, a laysan albatross returned to its nesting area on Midway Island in the middle of the Pacific, having flown over 5000 kilometres from the west coast of the USA in just over ten days. This is a perfect example of the third type of homing, for the albatross clearly couldn't rely on any landmarks over the vast expanse of the Pacific Ocean.</p>

                    <p><strong>F</strong> The percentage of successful birds varies greatly, being highest in those species with a strong migratory behaviour. Thus the lesser black-backed gull is more migratory than the herring gull and more often reaches 'home'. Great migrants such as the swift have the highest percentage of returns. In one case, seven out of nine alpine swifts were recaptured at their nests after being displaced some 1400 kilometres; one made the journey in three days.</p>

                    <p><strong>G</strong> What part does heredity play in all this? Two research studies suggest that instinctive, i.e. genetically inherited, behaviour patterns play a part in navigation. The first was carried out by Ernst Schuz and it is highly significant. Schuz caught first year European storks and released them later, after the departure of the adult storks at a time when they normally make their south-west autumn migration to Africa. The recaptures showed that, in spite of the fact that there were no adults to guide them, the birds unanimously headed south-west. This was a most striking finding, for it showed that the birds had an innate and unlearned attraction for the African wintering area that they have occupied for thousands of years.</p>

                    <p><strong>H</strong> The case of starlings is a little different. These birds have a great aptitude for homing, but this behaviour differs in the different age groups. Birds that were shifted to the south-east of their normal migration route split into two lots. The adults, in full possession of their gift for orientation, found their wintering area by modifying their direction by 90 degrees, whereas the juveniles sought their winter quarters to the south-east of their real position.</p>
                </div>
            </div>

            <div class="questions-container hidden" id="p2_questionsPanel" role="region" aria-label="Questions">
                <h2 class="section-title">Questions 14–26</h2>

                <div class="question-group">
                    <div class="question-group-title">Questions 14–18 – Summary completion (NO MORE THAN TWO WORDS)</div>
                    <p><strong>Types of homing behaviour</strong></p>
                    <p><em>First type:</em> Birds rely on their sophisticated <span class="question-text">14</span> <input type="text" name="q14" maxlength="40">. However, they are generally most successful if they are released within their feeding territory.</p>
                    <p><em>Second type:</em> Birds select their accustomed <span class="question-text">15</span> <input type="text" name="q15" maxlength="40">, no matter where they are released. As a result, they may miss their <span class="question-text">16</span> <input type="text" name="q16" maxlength="40">.</p>
                    <p><em>Third type:</em> Birds orientate correctly, even when they are released in an unfamiliar place and have no <span class="question-text">17</span> <input type="text" name="q17" maxlength="40"> to make use of. One bird with this type of skill is the <span class="question-text">18</span> <input type="text" name="q18" maxlength="40">.</p>
                </div>

                <div class="question-group">
                    <div class="question-group-title">Questions 19–22 – Which paragraph contains the information?</div>
                    <div class="question" data-question="19">
                        <div class="question-text">19. the effects of distance on some birds' ability to find their nests</div>
                        <div class="options">
                            <select name="q19"><option value="">Select</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option><option>H</option></select>
                        </div>
                    </div>
                    <div class="question" data-question="20">
                        <div class="question-text">20. a methodology for testing the general ability of birds to find their nests</div>
                        <div class="options">
                            <select name="q20"><option value="">Select</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option><option>H</option></select>
                        </div>
                    </div>
                    <div class="question" data-question="21">
                        <div class="question-text">21. one aspect of physical ability in humans and birds</div>
                        <div class="options">
                            <select name="q21"><option value="">Select</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option><option>H</option></select>
                        </div>
                    </div>
                    <div class="question" data-question="22">
                        <div class="question-text">22. how some birds' migration was delayed for experimental purposes</div>
                        <div class="options">
                            <select name="q22"><option value="">Select</option><option>A</option><option>B</option><option>C</option><option>D</option><option>E</option><option>F</option><option>G</option><option>H</option></select>
                        </div>
                    </div>
                </div>

                <div class="question-group">
                    <div class="question-group-title">Questions 23–26 – Match the bird to the point (A–G)</div>
                    <p><em>Birds:</em></p>
                    <div class="question" data-question="23">
                        <div class="question-text">23. domestic pigeon</div>
                        <div class="options">
                            <select name="q23">
                                <option value="">Select</option>
                                <option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option>
                            </select>
                        </div>
                    </div>
                    <div class="question" data-question="24">
                        <div class="question-text">24. alpine swift</div>
                        <div class="options">
                            <select name="q24">
                                <option value="">Select</option>
                                <option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option>
                            </select>
                        </div>
                    </div>
                    <div class="question" data-question="25">
                        <div class="question-text">25. European stork</div>
                        <div class="options">
                            <select name="q25">
                                <option value="">Select</option>
                                <option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option>
                            </select>
                        </div>
                    </div>
                    <div class="question" data-question="26">
                        <div class="question-text">26. starling</div>
                        <div class="options">
                            <select name="q26">
                                <option value="">Select</option>
                                <option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option>
                            </select>
                        </div>
                    </div>
                    <p><em>List of points:</em> A = an ability to orientate without previous training; B = the speed at which birds can fly; C = the ability to remember things seen previously; D = the effect of age on homing ability; E = the strength required to fly a great distance; F = a high success rate in finding nests; G = the importance of seasonal cues for migrating birds</p>
                </div>
            </div> <!-- /p2_questionsPanel -->

            <!-- ===== PASSAGE 3 ===== -->
            <div class="passage-container hidden" id="p3_passagePanel" role="region" aria-label="Reading Passage">
                <h2 class="section-title">READING PASSAGE 3</h2>
                <div class="passage-content" id="passage3">
                    <h3>The role of accidents in business</h3>

                    <p>In 1894 Dr John Kellogg and his brother, Will, were supervising a hospital and health spa in Michigan. The patients were on a restricted diet. One day, the brothers left cooked wheat untended for more than 24 hours. When they returned, they saw what they had done. It was no good to eat, but they decided to run the stale wheat through rollers, just to see how it would turn out. Normally, the process produced long sheets, but they were surprised to discover that this time the rollers created flat flakes. They baked them, and then tried the same thing with corn. From this accidental discovery came the cornflakes that generations have now been eating for breakfast.</p>

                    <p>Accidents happen; there is nothing predictable and orderly about innovation. Nobel laureate Sir Alan Hodgkin, who discovered how nerve cells transmit electrical impulses between the skin and the brain, commented: 'I believe that the record of my published papers conveys an impression of directedness and planning which does not at all coincide with the actual sequence of events.'</p>

                    <p>The same rule applies in business. The mistake that gave us cornflakes keeps repeating itself in the history of disruptive innovation, the kind that transforms markets. Louis Daguerre, for instance, discovered the technique that gave us photography in the 1830s, when drops of mercury from a shattered thermometer produced a photographic image. The microwave was discovered when Percy Spencer, a scientist with Raytheon, was testing a new vacuum tube and discovered that the sweet in his pocket had melted. The artificial sweetener, saccharin, was the unintentional result of a medical scientist's work on a chemical treatment for gastric ulcers. While working for the firm 3M, researcher Art Fry had no idea he was taking the first steps towards Post-It Notes when he used bits of adhesive office paper that could be easily lifted off the page to replace the scrap paper bookmarks that kept falling out of his hymn book.</p>

                    <p>Breakthrough and disruptive innovation are rarely driven by orderly process. Usually they come out of a chaotic, haphazard mess, which is why big companies, full of managers schooled in business programmes designed to eliminate random variation and mistakes, struggle with them. In these sorts of environments, accidents are called failures and are discouraged.</p>

                    <p>It is no surprise then that research from the late British economist Paul Geroski and London Business School's Constantinos Markides found that companies that were skilled at innovation were usually not that skilled when it came to commercialisation, and vice versa. Their book, <em>Fast Second</em>, divides businesses into 'colonists' and 'consolidators'. Small and nimble, colonists are adept at creating market niches but are terrible institution builders. Consolidators, with their strong cultures of discipline and cost control, know how to take clever ideas from other firms and turn them into mass-market items. Microsoft is a prime instance of this.</p>

                    <p>With companies spending hundreds of billions of dollars on research and development, US academics Robert Austin and Lee Devin examined how managers can encourage productive slip-ups. In their article <em>Accident, Intention and Expectation in the Innovation Process</em>, they argue that business processes actually prevent helpful mis-steps from occurring. According to their catalogue of accidents, not all false steps and mishaps are equal. Accidents, they say, come from unlikely mental associations such as memories and vague connections, looking for something and finding it in an unexpected way, looking for one thing and finding something else, and not looking for anything but finding something valuable.</p>

                    <p>Accident-prone innovation, they say, requires companies to get outside the 'cone of expectation'. It means throwing together groups from diverse backgrounds, and combining ideas in unpredictable ways. Other strategies also include having systems that watch out for accidents and examine them for value, generating them when they do not happen often enough, seizing all the useful ones, capturing their valuable features, and building on them to add value and give potential for useful accidents.</p>

                    <p>All this, however, requires thinking that is often counter-intuitive to the way businesses operate. In other words, it is the kind of thinking that goes against the beliefs of most business managers. It runs counter to the notion frequently pushed by consultants that you can 'harness' creativity and direct it to line up with intention. 'The cost of accidents in business,' people tend to call such efforts failure.</p>

                    <p>There are tentative signs that more companies are starting to realise that failure can lead to commercial gain, and that this is part of the risk-taking that underpins innovation. Australia's largest brewing company, for example, made a bad error when it launched a new beer called Empire Lager, pitched at younger consumers. Having spent a fortune creating a beer with a sweeter taste, designing a great-looking bottle and a television campaign, Foster's was left with a drink that no-one wanted to buy. The target market was more interested in brands built up by word of mouth.</p>

                    <p>Instead of wiping the unsuccessful product launch, Foster's used this lesson learned to go on and develop other brands instead. One of them, Pure Blonde, is now ranked as Australia's fifth-largest beer brand. Unlike Empire Lager, there has been almost no promotion and its sales are generated more by word of mouth.</p>

                    <p>Other companies are taking similar steps to study their own slip-ups. Intuit, the company behind financial tools such as Quicken, holds regular 'When Learning Hurts' sessions. But this sort of transformation is never easy. In a market that focuses on the short-term, convincing employees and shareholders to tolerate failure and not play it safe is a big thing to ask.</p>
                </div>
            </div>

            <div class="questions-container hidden" id="p3_questionsPanel" role="region" aria-label="Questions">
                <h2 class="section-title">Questions 27–40</h2>

                <div class="question-group">
                    <div class="question-group-title">Questions 27–31 – YES / NO / NOT GIVEN</div>
                    <div class="question" data-question="27">
                        <div class="question-text">27. The delay in the process used by the Kellogg brothers affected the final product.</div>
                        <div class="options">
                            <label><input type="radio" name="q27" value="YES"> YES</label>
                            <label><input type="radio" name="q27" value="NO"> NO</label>
                            <label><input type="radio" name="q27" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="28">
                        <div class="question-text">28. Sir Alan Hodgkin is an example of someone whose work proceeded in a logical and systematic way.</div>
                        <div class="options">
                            <label><input type="radio" name="q28" value="YES"> YES</label>
                            <label><input type="radio" name="q28" value="NO"> NO</label>
                            <label><input type="radio" name="q28" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="29">
                        <div class="question-text">29. Daguerre is an exception to the general rule of innovation.</div>
                        <div class="options">
                            <label><input type="radio" name="q29" value="YES"> YES</label>
                            <label><input type="radio" name="q29" value="NO"> NO</label>
                            <label><input type="radio" name="q29" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="30">
                        <div class="question-text">30. The discovery of saccharin occurred by accident during drug research.</div>
                        <div class="options">
                            <label><input type="radio" name="q30" value="YES"> YES</label>
                            <label><input type="radio" name="q30" value="NO"> NO</label>
                            <label><input type="radio" name="q30" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                    <div class="question" data-question="31">
                        <div class="question-text">31. The company 3M should have supported Art Fry by funding his idea of Post-It Notes.</div>
                        <div class="options">
                            <label><input type="radio" name="q31" value="YES"> YES</label>
                            <label><input type="radio" name="q31" value="NO"> NO</label>
                            <label><input type="radio" name="q31" value="NOT GIVEN"> NOT GIVEN</label>
                        </div>
                    </div>
                </div>

                <div class="question-group">
                    <div class="question-group-title">Questions 32–35 – Complete the sentence with A–H</div>
                    <p>
                        32. The usual business environment …<br>
                        33. Geroski and Markides's book …<br>
                        34. Microsoft is an example of a company which …<br>
                        35. The origin of useful accidents …
                    </p>
                    <div class="options" style="margin:8px 0 12px;">
                        <em>Endings:</em> A can be found in unusual thoughts and chance events. B can be taught in business schools. C has made a success from someone else's invention. D is designed to nurture differences. E is unlikely to lead to creative innovation. F says that all mistakes are the same. G shows that businesses are good at either inventing or selling. H suggests ways of increasing the number of mistakes.
                    </div>
                    <div class="question" data-question="32">
                        <div class="options">
                            <select name="q32"><option value="">Select</option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option><option value="H">H</option></select>
                        </div>
                    </div>
                    <div class="question" data-question="33">
                        <div class="options">
                            <select name="q33"><option value="">Select</option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option><option value="H">H</option></select>
                        </div>
                    </div>
                    <div class="question" data-question="34">
                        <div class="options">
                            <select name="q34"><option value="">Select</option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option><option value="H">H</option></select>
                        </div>
                    </div>
                    <div class="question" data-question="35">
                        <div class="options">
                            <select name="q35"><option value="">Select</option><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option><option value="H">H</option></select>
                        </div>
                    </div>
                </div>

                <div class="question-group">
                    <div class="question-group-title">Questions 36–40 – Choose the correct letter, A–D</div>
                    <div class="question" data-question="36">
                        <div class="question-text">36. How do Austin and Devin advise companies to get out of the 'cone of expectation'?</div>
                        <div class="options">
                            <label><input type="radio" name="q36" value="A"> A. by decreasing the number of company systems</label>
                            <label><input type="radio" name="q36" value="B"> B. by forming teams of different types of people</label>
                            <label><input type="radio" name="q36" value="C"> C. by hiring new and creative people</label>
                            <label><input type="radio" name="q36" value="D"> D. by holding regular brainstorming meetings</label>
                        </div>
                    </div>
                    <div class="question" data-question="37">
                        <div class="question-text">37. In recommending 'counter-intuitive' thinking, what do Austin and Devin imply?</div>
                        <div class="options">
                            <label><input type="radio" name="q37" value="A"> A. that failing at business is bad for staff morale</label>
                            <label><input type="radio" name="q37" value="B"> B. that innovation cannot be planned for</label>
                            <label><input type="radio" name="q37" value="C"> C. that most businesses should be devoted to avoiding mistakes</label>
                            <label><input type="radio" name="q37" value="D"> D. that the cost of mistakes is an important consideration</label>
                        </div>
                    </div>
                    <div class="question" data-question="38">
                        <div class="question-text">38. The writer describes the Empire Lager disaster in order to show that …</div>
                        <div class="options">
                            <label><input type="radio" name="q38" value="A"> A. success can come out of a business failure</label>
                            <label><input type="radio" name="q38" value="B"> B. the majority of companies now value risk-taking</label>
                            <label><input type="radio" name="q38" value="C"> C. TV advertising works better on older people</label>
                            <label><input type="radio" name="q38" value="D"> D. young beer drinkers do not like a sweet taste</label>
                        </div>
                    </div>
                    <div class="question" data-question="39">
                        <div class="question-text">39. Pure Blonde has been more successful than Empire Lager because …</div>
                        <div class="options">
                            <label><input type="radio" name="q39" value="A"> A. digital media other than TV were used.</label>
                            <label><input type="radio" name="q39" value="B"> B. it was advertised under a different brand name.</label>
                            <label><input type="radio" name="q39" value="C"> C. it was launched with very little advertising.</label>
                            <label><input type="radio" name="q39" value="D"> D. the advertising budget was larger.</label>
                        </div>
                    </div>
                    <div class="question" data-question="40">
                        <div class="question-text">40. The writer concludes that creating a culture that learns from mistakes …</div>
                        <div class="options">
                            <label><input type="radio" name="q40" value="A"> A. brings short-term financial gains.</label>
                            <label><input type="radio" name="q40" value="B"> B. can be very difficult for some companies.</label>
                            <label><input type="radio" name="q40" value="C"> C. holds no risk for workers.</label>
                            <label><input type="radio" name="q40" value="D"> D. is a popular move with shareholders.</label>
                        </div>
                    </div>
                </div>
            </div> <!-- /p3_questionsPanel -->
        </div> <!-- /main-content -->

        <!-- Bottom progress/navigation -->
        <div class="progress-container">
            <div class="progress-nav">
                <div class="progress-items" style="gap:10px; flex-wrap:wrap;">
                    <div id="bottomPartTabs"
                        style="display:flex; gap:14px; justify-content:center; width:100%; align-items:center; flex-wrap:wrap;">
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="btn btn-secondary" id="prev-btn" disabled><i class="fas fa-arrow-left"></i>
                        Previous</button>
                    <button class="btn btn-secondary" id="next-btn">Next <i class="fas fa-arrow-right"></i></button>
                    <button class="btn btn-submit" id="submit-all-btn">Submit All <i
                            class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>
    </div> <!-- /container -->

    <!-- Results Modal -->
    <div class="modal" id="results-modal">
        <div class="modal-content">
            <h2>Test Results</h2>
            <div class="score-display" id="score-display">0/0</div>
            <div class="score-breakdown" id="score-breakdown"></div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" id="close-modal">Close</button>
                <button class="btn btn-primary" id="review-answers">Review Answers</button>
            </div>
        </div>
    </div>

    <script>
        /* ========= CONFIG ========= */
        const PARTS = [
            { id: 1, title: 'Passage 1', qStart: 1, qEnd: 13, passagePanel: 'p1_passagePanel', questionsPanel: 'p1_questionsPanel' },
            { id: 2, title: 'Passage 2', qStart: 14, qEnd: 26, passagePanel: 'p2_passagePanel', questionsPanel: 'p2_questionsPanel' },
            { id: 3, title: 'Passage 3', qStart: 27, qEnd: 40, passagePanel: 'p3_passagePanel', questionsPanel: 'p3_questionsPanel' },
        ];

        /* ======= ANSWER KEY ======= */
        const correctAnswers = {
            // Passage 1 – Clipper Races (Q1–13)
            q1: "FALSE", q2: "TRUE", q3: "TRUE", q4: "NOT GIVEN", q5: "FALSE", q6: "FALSE",
            q7: "sails", q8: "storms", q9: "Challenger", q10: "ports", q11: "paperwork", q12: "tugs", q13: "money",

            // Passage 2 – Orientation of birds (Q14–26)
            q14: "visual memory", q15: "migration direction", q16: "destination", q17: "landmarks", q18: "albatross",
            q19: "C", q20: "B", q21: "C", q22: "G", q23: "C", q24: "F", q25: "A", q26: "D",

            // Passage 3 – Accidents in business (Q27–40)
            q27: "YES", q28: "NO", q29: "NO", q30: "YES", q31: "NOT GIVEN",
            q32: "F", q33: "G", q34: "C", q35: "A",
            q36: "B", q37: "D", q38: "A", q39: "C", q40: "B"
        };

        /* ========= STATE ========= */
        let currentPart = 1;
        let currentQuestion = 1;
        let seconds = 60 * 60; // total 60 minutes
        let timerInterval;

        /* ========= HELPERS ========= */
        function el(id) { return document.getElementById(id); }
        function inRange(q, pId) { const p = PARTS[pId - 1]; return q >= p.qStart && q <= p.qEnd; }

        /* ===== NAV BUTTONS + TABS ===== */
        function renderBottomTabs() {
            const tabs = el('bottomPartTabs');
            tabs.innerHTML = '';
            PARTS.forEach(p => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-secondary';
                btn.style.fontWeight = (p.id === currentPart) ? '900' : '600';
                btn.innerHTML = (p.id === currentPart) ? `<strong>${p.title}</strong>` : `${p.title}`;
                btn.onclick = () => switchPart(p.id);
                tabs.appendChild(btn);

                const rail = document.createElement('div');
                rail.id = `rail-part-${p.id}`;
                rail.style.display = (p.id === currentPart) ? 'flex' : 'none';
                rail.style.gap = '6px';
                rail.style.flexWrap = 'wrap';
                rail.style.alignItems = 'center';
                for (let q = p.qStart; q <= p.qEnd; q++) {
                    const chip = document.createElement('div');
                    chip.textContent = q;
                    chip.className = 'progress-item' + (q === currentQuestion && p.id === currentPart ? ' current' : '');
                    chip.dataset.question = q;
                    chip.style.width = '30px'; chip.style.height = '20px'; chip.style.borderRadius = '6px';
                    chip.style.fontSize = '14px'; chip.style.padding = '0'; chip.style.lineHeight = '20px';
                    chip.onclick = () => scrollToQuestion(q);
                    rail.appendChild(chip);
                }
                tabs.appendChild(rail);
            });
        }
        function refreshBottomBar() { renderBottomTabs(); }

        function switchPart(partId) {
            if (currentPart === partId) return;
            PARTS.forEach(p => {
                el(p.passagePanel).classList.add('hidden');
                el(p.questionsPanel).classList.add('hidden');
                const r = el(`rail-part-${p.id}`); if (r) r.style.display = 'none';
            });
            currentPart = partId;
            const p = PARTS[currentPart - 1];
            currentQuestion = p.qStart;
            el(p.passagePanel).classList.remove('hidden');
            el(p.questionsPanel).classList.remove('hidden');
            const r = el(`rail-part-${p.id}`); if (r) r.style.display = 'flex';
            el('headerPassageTitle').textContent = `Passage ${currentPart} of 3`;
            scrollToQuestion(currentQuestion, false);
            refreshBottomBar();
        }

        function scrollToQuestion(num, smooth = true) {
            const elQ = document.querySelector(`[data-question="${num}"]`) ||
                document.querySelector(`input[name="q${num}"]`) ||
                document.querySelector(`select[name="q${num}"]`);
            if (elQ) elQ.scrollIntoView({ behavior: smooth ? 'smooth' : 'auto', block: 'center' });
            updateCurrentQuestion(num);
        }

        function updateCurrentQuestion(num) {
            currentQuestion = num;
            document.querySelectorAll(`#rail-part-${currentPart} .progress-item`).forEach(it => {
                it.classList.toggle('current', parseInt(it.dataset.question, 10) === num);
            });
        }

        // mark answered when inputs change
        function attachAnsweredListeners() {
            document.querySelectorAll('input[type="radio"], input[type="text"], select').forEach(input => {
                input.addEventListener('change', () => {
                    const m = input.name && input.name.match(/^q(\d+)$/);
                    if (!m) return;
                    const q = parseInt(m[1], 10);
                    const chip = document.querySelector(`.progress-item[data-question="${q}"]`);
                    if (chip) {
                        const val = (input.type === 'text' ? input.value.trim() : input.value);
                        if (val) chip.classList.add('answered');
                    }
                });
            });
        }

        // Prev/Next navigation (per part)
        el('prev-btn').addEventListener('click', () => {
            const p = PARTS[currentPart - 1];
            if (currentQuestion > p.qStart) scrollToQuestion(currentQuestion - 1);
            el('next-btn').disabled = false;
            if (currentQuestion - 1 <= p.qStart) el('prev-btn').disabled = true;
        });
        el('next-btn').addEventListener('click', () => {
            const p = PARTS[currentPart - 1];
            if (currentQuestion < p.qEnd) scrollToQuestion(currentQuestion + 1);
            el('prev-btn').disabled = false;
            if (currentQuestion + 1 >= p.qEnd) el('next-btn').disabled = true;
        });

        /* ===== SUBMIT ALL ===== */
        el('submit-all-btn').addEventListener('click', () => {
            if (!confirm('Submit the entire test?')) return;

            let score = 0, total = PARTS[PARTS.length - 1].qEnd;
            const results = {};

            for (let q = 1; q <= total; q++) {
                const key = `q${q}`;
                const corr = correctAnswers[key];
                let user = null, isCorrect = false;

                const radios = document.querySelectorAll(`input[name="${key}"][type="radio"]`);
                const text = document.querySelector(`input[name="${key}"][type="text"]`);
                const sel = document.querySelector(`select[name="${key}"]`);

                if (radios && radios.length) {
                    const c = Array.from(radios).find(r => r.checked);
                    if (c) { user = c.value; isCorrect = (user === corr); radios.forEach(r => r.disabled = true); }
                } else if (text) {
                    user = (text.value || '').trim();
                    if (user) {
                        const norm = (s) => String(s).trim().toLowerCase().replace(/\s+/g, ' ');
                        isCorrect = norm(user) === norm(corr);
                        text.disabled = true;
                    }
                } else if (sel) {
                    user = sel.value;
                    if (user) { isCorrect = user === corr; sel.disabled = true; }
                }

                if (isCorrect) score++;
                results[key] = { userAnswer: user || 'No answer', correct: corr, isCorrect };
            }

            // color chips
            for (let q = 1; q <= total; q++) {
                const res = results[`q${q}`];
                const ch = document.querySelector(`.progress-item[data-question="${q}"]`);
                if (ch) {
                    ch.classList.remove('current', 'answered');
                    if (res) ch.classList.add(res.isCorrect ? 'correct' : 'incorrect');
                }
            }

            // modal
            el('score-display').textContent = `${score}/${total}`;
            const breakdown = el('score-breakdown');
            breakdown.innerHTML = PARTS.map(p => {
                const partScore = Array.from({ length: p.qEnd - p.qStart + 1 }, (_, i) => results[`q${p.qStart + i}`])
                    .filter(r => r && r.isCorrect).length;
                return `<div class="score-item"><span>Passage ${p.id}:</span><span>${partScore}/${p.qEnd - p.qStart + 1}</span></div>`;
            }).join('');
            el('results-modal').style.display = 'flex';

            // review handler
            el('review-answers').onclick = () => {
                el('results-modal').style.display = 'none';
                showCorrectIndicators(results);
            };
        });

        // show inline indicators
        function showCorrectIndicators(results) {
            document.querySelectorAll('.answer-indicator').forEach(e => e.remove());
            const total = PARTS[PARTS.length - 1].qEnd;

            for (let q = 1; q <= total; q++) {
                const key = `q${q}`;
                const res = results[key];
                if (!res) continue;

                let target = null;
                const qEl = document.querySelector(`[data-question="${q}"] .options`);
                if (qEl) target = qEl;
                if (!target) {
                    const input = document.querySelector(`input[name="${key}"]`);
                    if (input) target = input.parentNode;
                }
                if (!target) {
                    const sel = document.querySelector(`select[name="${key}"]`);
                    if (sel) target = sel.parentNode;
                }
                if (!target) continue;

                const box = document.createElement('div');
                box.className = 'answer-indicator ' + (res.isCorrect ? 'correct' : 'incorrect');
                box.style.display = 'block';
                box.style.marginTop = '6px';
                box.innerHTML = res.isCorrect
                    ? `<i class="fas fa-check"></i> Correct!`
                    : `<i class="fas fa-times"></i> Incorrect. Your answer: <strong>${res.userAnswer}</strong><br><strong>Correct:</strong> ${Array.isArray(res.correct) ? res.correct.join(', ') : res.correct}`;
                target.appendChild(box);
            }
        }

        // Timer
        const timerSpan = document.querySelector('#globalTimer span');
        const timerContainer = document.querySelector('#globalTimer');
        function updateTimer() {
            seconds--;
            const m = Math.floor(seconds / 60), s = seconds % 60;
            timerSpan.textContent = `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            if (seconds <= 2 * 60) timerContainer.classList.add('warning');
            if (seconds <= 0) { clearInterval(timerInterval); alert('Time is up! Submitting all passages.'); el('submit-all-btn').click(); }
        }

        function startTest() {
            el('startScreen').classList.add('hidden');
            el('testContainer').classList.remove('hidden');
            timerInterval = setInterval(updateTimer, 1000);
        }
        window.startTest = startTest;

        // Init
        setTimeout(() => { el('loadingScreen').classList.add('hidden'); el('startScreen').classList.remove('hidden'); }, 900);

        // default show P1
        PARTS.forEach(p => {
            if (p.id === 1) { el(p.passagePanel).classList.remove('hidden'); el(p.questionsPanel).classList.remove('hidden'); }
            else { el(p.passagePanel).classList.add('hidden'); el(p.questionsPanel).classList.add('hidden'); }
        });
        renderBottomTabs();
        attachAnsweredListeners();

        // Resizer
        let isResizing = false;
        el('resizer').addEventListener('mousedown', () => { isResizing = true; document.body.style.cursor = 'col-resize'; document.body.style.userSelect = 'none'; });
        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            const container = document.querySelector('.main-content');
            const rect = container.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const leftPct = (mouseX / rect.width) * 100;
            const rightPct = 100 - leftPct;
            if (leftPct >= 30 && leftPct <= 70) {
                document.querySelector('.passage-container:not(.hidden)').style.flex = leftPct + '%';
                document.querySelector('.questions-container:not(.hidden)').style.width = rightPct + '%';
            }
        });
        document.addEventListener('mouseup', () => { if (isResizing) { isResizing = false; document.body.style.cursor = ''; document.body.style.userSelect = ''; } });

        // Highlight tools
        const highlightBtn = el('highlight-btn');
        const removeHighlightBtn = el('remove-highlight-btn');
        const passagePanels = PARTS.map(p => el(p.passagePanel));
        const questionsPanels = PARTS.map(p => el(p.questionsPanel));
        let lastSelection = null, highlightTarget = null;

        function getValidSelection() {
            const sel = window.getSelection();
            if (!sel.rangeCount || sel.isCollapsed) return null;
            const range = sel.getRangeAt(0);
            if (passagePanels.some(pp => pp && pp.contains(range.commonAncestorContainer))) {
                return range;
            } else if (questionsPanels.some(qp => qp && qp.contains(range.commonAncestorContainer))) {
                return range;
            } else return null;
        }
        function showHighlightBtn(range) {
            const rect = range.getBoundingClientRect();
            highlightBtn.style.top = (window.scrollY + rect.top - 35) + 'px';
            highlightBtn.style.left = (window.scrollX + rect.left) + 'px';
            highlightBtn.style.display = 'block';
        }
        function hideHighlightBtn() { highlightBtn.style.display = 'none'; }
        function showRemoveBtn(span) {
            const rect = span.getBoundingClientRect();
            removeHighlightBtn.style.top = (window.scrollY + rect.top - 35) + 'px';
            removeHighlightBtn.style.left = (window.scrollX + rect.left) + 'px';
            removeHighlightBtn.style.display = 'block';
            highlightTarget = span;
        }
        function hideRemoveBtn() { removeHighlightBtn.style.display = 'none'; highlightTarget = null; }

        highlightBtn.addEventListener('click', () => {
            if (lastSelection) {
                const span = document.createElement('span');
                span.className = 'highlight';
                span.appendChild(lastSelection.extractContents());
                lastSelection.insertNode(span);
                window.getSelection().removeAllRanges();
                hideHighlightBtn();
            }
        });
        removeHighlightBtn.addEventListener('click', () => {
            if (highlightTarget) {
                const parent = highlightTarget.parentNode;
                while (highlightTarget.firstChild) parent.insertBefore(highlightTarget.firstChild, highlightTarget);
                parent.removeChild(highlightTarget);
                hideRemoveBtn();
            }
        });
        document.addEventListener('selectionchange', () => {
            hideHighlightBtn(); hideRemoveBtn();
            const range = getValidSelection();
            if (range) { lastSelection = range; showHighlightBtn(range); } else { lastSelection = null; }
        });
        document.addEventListener('mousedown', (e) => {
            if (e.target !== highlightBtn && e.target !== removeHighlightBtn) { hideHighlightBtn(); hideRemoveBtn(); }
        });
        document.addEventListener('click', (e) => {
            if (e.target.classList && e.target.classList.contains('highlight')) { e.preventDefault(); showRemoveBtn(e.target); }
        });

        // Modal close
        el('close-modal').addEventListener('click', () => { el('results-modal').style.display = 'none'; });
    </script>
</body>






</html>