<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }



        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;  
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
            color: #3e3e3e;
            text-decoration: none;
    font-weight: 700;
            font-size: 16px;
    display: flex
;
            align-items: center;
            gap: 8px;
    padding: 6px 12px;
    border: 2px solid #3e3e3e;
    border-radius: 9999px;
    background-color: #ffffff;
    line-height: 1;
        }

        .telegram-link:hover {
            text-decoration: underline;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: calc(100vh - 60px); /* Full height minus header */
            position: relative;
        }

        /* Page watermark */
        body::after {
            content: "@Avazbeks_Media";
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 72px;
            font-weight: 800;
            letter-spacing: 2px;
            color: #000000;
            opacity: 0.04; /* subtle */
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        .panels-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
        }

        /* Passage Content */
        .text-center {
            text-align: center;
        }
        .reading-passage h4 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
       
        .reading-passage p {
            margin-bottom: 1.2em;
        }

        .question ul li label {
            display: block;
            margin-top: 8px;
            cursor: pointer;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }

        .resizer {
            width: 10px;
            cursor: col-resize;
            background-color: #f0f0f0;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="30" viewBox="0 0 10 30"><path d="M4 11h2v2H4zM4 15h2v2H4zM4 19h2v2H4z" fill="%23888"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            flex-shrink: 0;
            flex-grow: 0;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .map-svg {
            border: 2px solid #333;
            background: white;
        }

        .map-room {
            fill: #f9f9f9;
            stroke: #333;
            stroke-width: 1;
        }

        .map-text {
            font-family: Arial, sans-serif;
            font-size: 13px;
            text-anchor: middle;
            fill: #333;
        }

        .map-number {
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            fill: #333;
        }

        .room-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .room-label {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .room-label:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .room-label.dragging {
            opacity: 0.5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 6px;
            z-index: 101;
        }

        .nav-arrow {
            width: 48px;
            height: 48px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            transition: transform 0.1s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            outline: none;
        }
        .nav-arrow.prev { background-color: #4b5563; }
        .nav-arrow.next { background-color: #000000; }

        .nav-arrow:hover { transform: translateY(-1px); }
        .nav-arrow:active { transform: translateY(0); }
        .nav-arrow:focus-visible { box-shadow: 0 0 0 3px rgba(59,130,246,0.4); }

        .nav-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 768px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f3f4f6;
            color: #111827;
            border: 1px solid #d1d5db;
            padding: 10px 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.08s ease, background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            min-width: 160px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #ebedf0;
            border-color: #c7ccd4;
        }

        .footer__deliverButton___3FM07:active {
            transform: translateY(1px);
        }

        .footer__deliverButton___3FM07:focus-visible {
            box-shadow: 0 0 0 3px rgba(59,130,246,0.35);
            outline: none;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #eef0f3;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
            box-shadow: none;
        }

        

        .hidden {
            display: none !important;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #bfbfbf;
            border-radius: 4px;
            background-color: #fff;
            padding: 2px 8px;
            font-size: 16px;
            text-align: left;
            font-weight: 700;
            margin-right: 6px;
            margin-left: 6px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            height: 28px;
            min-width: 150px;
        }
        .answer-input.active-input,
        .answer-input:focus {
            border-color: #3581d8;
            border-width: 2px;
            outline: none;
        }
        .answer-input::placeholder {
            color: #666;
            font-weight: 700;
            text-align: center;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .summary-text .answer-input {
            width: 120px;
            height: 24px;
            font-size: 14px;
            margin: 0 4px;
        }
        .answer-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .answer-inputs .answer-input {
            width: 200px;
            height: 30px;
            font-size: 16px;
        }
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 200px;
        }
        .drag-item {
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            width: 50%;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px;
            display: flex;
            align-items: center;
            position: relative;
            color: #afafaf;
            font-weight: 600;
            height: 27px;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone.disabled {
            pointer-events: none;
        }
        .drop-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            padding: 2px;
        }
        .drag-options-container {
            margin-top: 10px;
        }
        .drag-options-container .drag-item {
            display: block;
            width: fit-content;
            font-size: 15px;
            padding: 0.5px 10px;
            margin-bottom: 5px;
        }
        .drag-options-container .drag-item:last-child {
            margin-bottom: 0;
        }
        .q-number {
            color: #888;
            font-size: 14px;
            font-weight: bold;
        }
        .questions-container {
            width: 100%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px 20px;
            border: 1px solid #e0e0e0;
            text-align: left;
            margin: 10px 20px;
            border-radius: 5px;
        }
        .part-header p {
            margin: 0;
        }
        .part-header p:first-child {
            margin-bottom: 5px;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .timer-container {
            display: flex;
            position: relative;
            cursor: default;
            color: #333;
            font-size: 16px;
            font-weight: 500;
            align-items: center;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .timer-controls button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .timer-controls button:hover {
            background: #e0e0e0;
        }

        .timer-controls button svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles for TRUE/FALSE/NOT GIVEN questions */
        .tf-question {
            margin-bottom: 25px;
            padding: 10px 0px;
            border-radius: 4px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .tf-question-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 5px 0px;
            border-radius: 4px;
        }
        .tf-question-number, .question-number-box {
            border: 2px solid #ccc;
            padding: 2px 8px;
            margin-right: 10px;
            border-radius: 3px;
            font-weight: bold;
            transition: border-color 0.3s;
            display: inline-block;
        }
        /* Active question blue outline for TF (clears when navigating away) */
        .tf-question.active-question .tf-question-number {
            border-color: #4a90e2;
        }
        .tf-question-text {
            padding-top: 3px;
        }
        .tf-options {
            padding-left: 5px;
        }
        .tf-option {
            display: block;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 10px 12px;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            background-color: #fff;
        }
        .tf-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .tf-option:has(input[type="radio"]:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for TF/NG */
        .tf-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            border-width: 1px;
        }
        .tf-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            border-width: 1px;
        }
        /* Ensure selected-blue visuals don't conflict once results are shown */
        body.results-mode .tf-option:has(input[type="radio"]:checked) {
            box-shadow: none;
        }
        .tf-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .tf-question.correct .tf-question-line {
            background-color: #e9f7ef;
        }
       
        .matching-question-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
        }
        .matching-options-bank {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .matching-questions {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .matching-question-item {
            display: flex;
            align-items: center;
            gap: 15px;

            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.3s;
        }
        .matching-question-item > span {
            flex: 1;
        }
        .matching-question-item.correct {
            background-color: #e9f7ef;
            border-color: #28a745 !important;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone {
            width: auto;
            min-width: 200px;
            flex-shrink: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-weight: bold;
            color: #aaa;
        }
        .matching-options-bank .drag-item {
            font-size: 15px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            max-width: 700px;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .summary-completion-container {
            margin-top: 20px;
        }
        .summary-text p {
            line-height: 3.0;
            font-size: 16px;
            margin-bottom: 12px;
        }
        .summary-text li {
            line-height: 2.2;
            margin-bottom: 10px;
        }
        .summary-drop-zone {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            max-width:200px;
            height: 25px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            padding: 0 5px;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            color: #aaa;
            font-weight: bold;
        }
        .summary-drop-zone.filled {
            border-color: #4a90e2;
        }
        .summary-drop-zone.active-input {
             border-color: #4a90e2;
             box-shadow: none;
        }
        .summary-drop-zone .drag-item {
            font-size: 15px;
            font-weight: bold;
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .summary-options-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .summary-options-bank .drag-item {
            flex-grow: 1;
            min-width: 100px;
            text-align: center;
        }

        /* Filled drop-zone pill styling */
        .drop-zone.filled {
            background-color: transparent;
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            padding: 0;
        }
        .drop-zone.filled .drag-item {
            width: auto;
            height: auto;
            display: inline-block;
            border: 2px solid #4a90e2;
            border-radius: 10px;
            padding: 4px 10px;
            font-weight: 700;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.15);
            cursor: default;
            white-space: nowrap;
        }
        .multi-choice-question {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
            border: 3px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }
        /* MCQ number badge: style first strong within prompt */
        .multi-choice-question .question-prompt p > strong:first-child {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            padding: 2px 6px;
            margin-right: 8px;
            border: 1px solid #d0d7e2;
            border-radius: 6px;
            background: #fff;
        }
        /* Active question blue outline for MCQ (clears when navigating away) */
        .multi-choice-question.active-question .question-prompt p > strong:first-child {
            border-color: #4a90e2;
            border-width: 2px;
        }
        .multi-choice-option {
            padding: 10px 12px;
            background-color: #fff;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .multi-choice-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .multi-choice-option:has(input:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for MCQ */
        .multi-choice-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            /* box-shadow: inset 0 0 0 2px rgba(40, 167, 69, 0.25) !important; */
            border-width: 1px;
            /* border-radius: 6px; */
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            /* box-shadow: inset 0 0 0 2px rgba(220, 53, 69, 0.25) !important; */
            border-width: 1px;
            /* border-radius: 6px; */
        }
        /* Correct answer reveal for unselected option after checking */
        .tf-option.correct-answer-highlight,
        .multi-choice-option.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }
        body.results-mode .multi-choice-option:has(input:checked) { box-shadow: none; }
        .multi-choice-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }
        .multi-choice-option input[type="checkbox"],
        .multi-choice-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4a90e2;
        }
        .multi-choice-option.correct {
            background-color: #e9f7ef;
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone.filled {
            border-color: #4a90e2;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            height: 40px;
        }
        .paragraph-matching-question {
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 12px;
        }
        .paragraph-matching-question .answer-input {
            width: 80px;
            flex-shrink: 0;
        }

        .matching-form-container {
            margin-top: 20px;
        }
        .matching-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .matching-form-label {
            flex-shrink: 0;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content {
            background: #ffffff;
            padding: 24px;
            border-radius: 14px;
            width: 92%;
            max-width: 780px;
            max-height: 86vh;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #e5e7eb;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        .modal-content h2 {
            text-align: center;
            margin-bottom: 18px;
            color: #111827;
        }
        .results-summary {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 16px;
            text-align: center;
            border-bottom: 1px solid #eef2f7;
            padding-bottom: 12px;
        }
        .results-summary p {
            margin: 0;
            font-size: 14px;
            color: #374151;
        }
        .results-summary p span {
            display: inline-block;
            padding: 4px 10px;
            margin-left: 6px;
            border-radius: 999px;
            background: #f3f4f6;
            font-weight: 700;
            color: #111827;
        }
        .results-details-container {
            overflow-y: auto;
            padding-right: 10px; /* For scrollbar */
            border-radius: 8px;
        }
        .result-row {
            display: grid;
            grid-template-columns: 56px 1fr 1fr;
            gap: 12px;
            padding: 10px 8px;
            border-bottom: 1px solid #eef2f7;
            font-size: 15px;
            align-items: center;
        }
        .result-row.correct {
            background-color: #f3faf5;
        }
        .result-row.incorrect {
            background-color: #fff5f5;
        }
        .result-row .q-num {
            font-weight: 700;
            color: #111827;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 42px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .result-row .user-ans {
            color: #374151;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .result-row .correct-ans {
            color: #065f46;
            font-weight: 600;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .correct-answer-display {
            font-weight: bold;
            color: #28a745;
            margin-left: 10px;
            font-size: 14px;
        }
        
        
        .centered-title {
    text-align: center;
    font-size: 50px;
    font-weight: bold;
    margin-bottom: 15px;
}

        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .matching-table th {
            background-color: #007bff;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }
        
        .matching-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .matching-table .statement {
            text-align: left;
            width: 60%;
        }
        
        .matching-table .table-radio {
            margin: 0;
            transform: scale(1.2);
        }
        
        .matching-table td:not(.statement) {
            text-align: center;
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table th:not(:first-child) {
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table td:not(.statement):has(input:checked) {
            background-color: #e3f2fd;
        }
        
        .matching-table input[type="radio"]:checked {
            accent-color: #007bff;
        }
        
        .matching-table td.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table td.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .options-row {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .matching-table .options-row td {
            font-weight: 500;
            text-align: center;
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .matching-table .options-row td:first-child {
            text-align: left;
            font-weight: normal;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell {
            cursor: pointer;
            transition: background-color 0.2s ease;
            min-height: 40px;
            border: 1px solid #ddd;
            position: relative;
        }
        
        .matching-table .clickable-cell:hover {
            background-color: #f0f8ff;
            border-color: #007bff;
        }
        
        .matching-table .clickable-cell.selected {
            background-color: #e3f2fd;
        }
        
        .matching-table .clickable-cell.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table .clickable-cell::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }
        
        .matching-table .clickable-cell.selected::after {
        }
        
        /* Explanation Section Styles */
        .explanation-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .explanation-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .explanation-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .explanation-content strong {
            color: #4a90e2;
            font-weight: 600;
        }
        
        #show-explanation-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        #show-explanation-btn:hover {
            background-color: #357abd;
        }

        /* Drag & Drop for Part 2 Paragraph Headings */
        .paragraph-drop-zone {
            border: 2px dashed #ccc;
            border-radius: 6px;
            padding: 6px 8px;
            margin: 8px 0;
            max-height: 28px;
            background-color: #f9f9f9;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #666;
            width: 97%;
        }
        .paragraph-drop-zone.drag-over {
            border-color: #4a90e2;
            background-color: #e3f2fd;
        }
        .paragraph-drop-zone.filled {
            border-color: #4caf50;
            background-color: #e8f5e8;
            color: #333;
            cursor: move;
        }
        .heading-options-container {
            /* border: 1px solid #eeeeee; */
            border-radius: 6px;
            /* padding: 10px; */
            /* background: #fafafa; */
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .heading-drag-item {
            /* background-color: #f5f5f5; */
            /* border: 1px solid #dddddd; */
            /* border-radius: 6px; */
            /* padding: 8px 10px; */
            /* cursor: grab; */
            /* user-select: none; */
            /* font-weight: 500; */
            /* transition: all 0.2s ease; */
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .heading-drag-item:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }
        .heading-drag-item.dragging {
            opacity: 0.6;
        }
        .heading-drag-item.used {
            display: none;
        }

        /* Flow Chart Styling */
        .flow-chart {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            margin: 20px 0;
            padding: 20px;
            /* background: #f8f9fa; */
            /* border-radius: 8px; */
            /* border: 1px solid #dee2e6; */
        }

        .flow-step {
            background: white;
            border: 2px solid #333;
            border-radius: 0;
            padding: 15px 20px;
            /* width: 400px; */
            text-align: left;
            position: relative;
            font-size: 14px;
            line-height: 1.4;
            margin: 0;
        }

        .flow-step.input-step {
            background: white;
            border-color: #333;
        }

        .flow-arrow {
            font-size: 24px;
            color: #333;
            font-weight: 600;
            margin: 0;
            padding: 5px 0;
            line-height: 1;
        }

        .flow-step .answer-input {
            margin: 0 2px;
            width: 40px;
            height: 24px;
            background: #fff;
            border: 1px solid #333;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            padding: 2px;
        }

        .flow-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
            text-align: left;
            width: 400px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="timer-container">
            <span class="timer-display">60:00</span>
            <div class="timer-controls">
                <button id="timer-toggle-btn" title="Pause/Resume Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>
                </button>
                <button id="timer-reset-btn" title="Reset Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
                </button>
            </div>
        </div>
        <a href="https://t.me/Avazbeks_Media" target="_blank" class="telegram-link">
            Avazbeks_Media
        </a>
    </div>

    <div class="main-container" id="main-container">
        <div id="passage-header-container">
            <div id="part-header-1" class="part-header">
                <p><strong>Part 1</strong></p>
                <p>Read the text and answer questions 1-13.</p>
            </div>
            <div id="part-header-2" class="part-header hidden">
                <p><strong>Part 2</strong></p>
                <p>Read the text and answer questions 14-26.</p>
            </div>
            <div id="part-header-3" class="part-header hidden">
                <p><strong>Part 3</strong></p>
                <p>Read the text and answer questions 27-40.</p>
            </div>
        </div>
        <div class="panels-container">
            <div class="passage-panel" id="passage-panel">
                <div id="passage-text-1" class="reading-passage">
                    <h4 class="text-center">Chocolate for the masses</h4>
                    <p>For almost three thousand years, chocolate was a drink of the elite and the wealthy, originally in South America and later on in Europe. In the early 19th century, however, chocolate became far more widely available, and consumption shot up dramatically across the populations of Europe in particular.</p>
                    <p>It was 1828 that marked the beginning of the modern era in chocolate making and production. Chocolate as a drink had been known for centuries, but in 1628 a Dutch chemist named Van Houten developed a process for the manufacture of a new kind of powdered chocolate using a hydraulic press. Untreated chocolate liquor' - the end result of grinding the cacao beans from which Chocolate is obtained - contains about 5-3 per cent cacao butter, but this machine removed nearly half of this, leaving a cake that could be pulverized into a fine powder - what is now known as 'cocoa'.</p>
                    <p>In 1547, the British Firm Fry and Sons found a way to mix a blend of cocoa powder and sugar with melted cacao butter to produce a thin paste which could be cast into various shapes. This was the world's first true solid chocolate. Thanks to immediate high Fernand for this product, the price of cacao butter escalated, so the new solid chocolate was only accessible for the elite. But this would eventually change, because of the introduction of cost-cutting methods and mass production.</p>
                    <p>By the latter half of the 19th century, many manufacturers had begun making their own chocolate, and using cocoa powder to hand-coat sugar confections. Cocoa powder also reached wide use in many other products, like ice creams and biscuits. Entrepreneurial families like the Frys and Cadburys in Britain had a social conscience in the midst of all this money-making, unlike many other 19th-century captains of industry. In the Birmingham suburb of Bourneville, where they had established their chocolate factor, the Cadburys created a model town with adequate housing for their workers, and even dining and reading rooms so that their employees had no need to spend anything on entertaining themselves.</p>
                    <p>However, the rising demand for chocolate also made it a target for unscrupulous producers and merchants. Sometimes the expensive cacao butter was completely extracted and replaced with olive or almond oil, or egg yolks. Alternatively, cheaper materials such as potato starch or flour were added. In 1850, a health commission was created in Britain for the analysis of foods suspicions about chocolate proved well-founded - most of the samples contained starch grains from potatoes or other plants. The investigation inspired the British Food and Drug Act of 1860 and the Adulteration of Food Act of 1872.</p>
                    <p>The invention of milk chocolate took place in Switzerland, and was a collaboration between two men. The first was Henri Nestle, a chemist who in 1867 discovered a process to make powdered milk by evaporation, when mixed with water, this could be fed to infants and small children. The second man, Daniel Peter, came up with the idea of using Nestle's milk powder in the manufacture of a new kind of chocolate, and, in 1879, the first milk chocolate bar was produced.</p>
                    <p>Also in 1879 another Swiss, Rodolphe Lindt, invented the conche machine, which vastly improved the quality of Chocolate confectionery. Before Lindt, solid chocolate was usually coarse and gritty. Now, however, it achieved such a degree of smoothness that Lindt named it 'fondant', after the smooth sugar creams of that name. People on both sides of the Atlantic developed a taste for fondant chocolate, and the use of the conche machine for solid chocolate became universal in the business.</p>
                    <p>In the USA, Milton Hershey dominated the chocolate industry. In 1893, after seeing examples of the machinery used in Europe in action at an international exhibition in Chicago, he bought some and began turning out chocolate coatings for the caramels he was already producing. But after a trip to the chocolate centers of Europe, he sold his caramel business for a million dollars, bought a farm in Pennsylvania, and built a chocolate factory there.</p>
                    <p>This became the nucleus of 'Hershey, the Chocolate Town', which contained amongst other things Hershey's imposing mansion, the Hershey Department Store and the Hershey Bank. 'there was, however, no elected mayor or indeed any democratic system in place. The whole town was in essence Milton Hershey's private kingdom, and he ran it as he wanted.</p>
                    <p>This was not the only Hershey town in existence. During a trip which he made to the island of Cuba in 1915, Hershey was inspired to build a new model town centered round a mill for grinding sugar. To transport the refined sugar so that it could be shipped by sea to his chocolate and cocoa factory, Hershey built modern electric railroads too.</p>
                    <p>To help advertise his products, Hershey employed nutritionists to proclaim their health qualities, and his chocolate bars and cocoa soon commanded the American market. Everything was mechanized - a true assembly-line operation. Hershey's best-set King bar contained almonds imported from southern Europe dropped by machines into the waiting molds. Another popular product was 'Hershey's Kisses' - bite-sized, flat-bottomed drops of chocolate, individually wrapped.</p>
                    <p>Nowadays so many tourists visit Hershey that the company no longer offers tours of its factory. Rather, visitors are whisked along on automated carts through an exhibition called 'Chocolate World', where they can see how their favorite products are produced.</p>
                </div>
                <div id="passage-text-2" class="reading-passage hidden">
                    <h4 class="text-center">How to be Happy</h4>
                    <p>Some recent developments in the science of happiness</p>
                    <p><strong>A</strong>&nbsp;&nbsp;Psychiatrist Tony Fernando was walking down the street when he saw a group of young homeless men sitting on the footpath. As Fernando handed out gifts of food, he tried to video the men's reactions in his mind, recording how their gratitude lifted him in return. 'I felt warm, content, meaningful,' he says. Fernando believes the brain can be trained to make us happy and that his 'video method' is one way to achieve this. In fact, a growing body of scientific research internationally is showing how we can learn happiness in the same way we can learn to play the piano. In the soft tissue that forms the brain, there are approximately ten trillion synapses connecting roughly a hundred billion neurons. Active synapses become more sensitive, less active synapses die but new ones grow quickly. This is relatively new thinking - just 30 years ago, neuroscientists believed that adult brain cells couldn't regenerate. One of the pioneers in this field is University of Wisconsin professor Richard Davidson. He studied Buddhist monks using brain scans in his research facility, and found that those trained in meditation had higher levels of activity in the left prefrontal cortex - the area associated with happiness. Davidson believes that the trained brain is physically different from the untrained one.</p>
                    <p><strong>B</strong>&nbsp;&nbsp;The idea that we can train our brains to find more happiness has been called 'mindfulness' by neuropsychologist Rick Hanson, author of Hardwiring Happiness. It was in college that Hanson, quite unintentionally, first recognised the importance of something that would become his life's work. As an unconfident teenager, he discovered he could turn a small event, 'a young woman smiling at me', into a good feeling he could hold on to. To do this, Hanson employs exactly the same imaginary 'video method' as psychiatrist Tony Fernando. 'The brain takes its shape from what the mind rests upon,' says Hanson. If you keep resting your mind on self-criticism and worries, he argues, your brain will be shaped by that. Hanson explains that resting it on pleasant feelings and the things you have accomplished means that over time your brain will take on a different shape, with strength and optimism hardwired into it.</p>
                    <p><strong>C</strong>&nbsp;&nbsp;In New Zealand, the Mental Health Foundation runs mindfulness programmes in 14 schools. Foundation CEO Judi Clements says 'it's a valuable approach because children are told to pay attention, but aren't told how to pay attention.' Preliminary results on the outcomes found that children had sustained increases in well-being. The Foundation recognises five pathways to happiness - being active, connecting with others, taking notice, learning and giving. And, says Clements, 'We're detecting a hunger for it from different organisations and professions as well, so the Foundation is soon going to pilot an online 'well-being game' in several workplaces. The project leader is psychologist Carsten Grimm, who is interested in whether some pathways to happiness are more effective than others. In a study, Grimm recorded the activities and corresponding happiness scores of 173 people. What he found was that people who used several pathways to happiness achieved the best results, suggesting it's better to have a balance than concentrate on the single pathway you most identify with.</p>
                    <p><strong>D</strong>&nbsp;&nbsp;However, Associate Professor of Psychological Medicine Nathan Consedine greets our relentless search for the secrets to happiness with a tired sigh. 'The more you chase it, the less you get it,' he says, quoting studies showing those who value contentment and well-being are, in fact, less happy. The big question, he says, is whether there's any benefit in actively seeking happiness. He cites a study, for example, which showed that people who were happier were less inclined to show sympathy. Consedine says that's probably because happy people are strongly motivated to stay happy, but engaging sympathetically with others typically involves engaging with their distress, and that's going to reduce their own happiness. Consedine's not disagreeing with the theory of mindfulness, but believes there's more work to be done.</p>
                    <p><strong>E</strong>&nbsp;&nbsp;Some of that work is being conducted at Auckland University's Centre for Brain Research. Associate Professor Johanna Montgomery has been studying Hanson's theory - that altering our brain activity at a synaptic level affects our behaviour. She accepts that it's a logical explanation based on studies from animals, but we haven't yet got the technology to prove it scientifically in humans. It's true that MRI scans certainly do indicate an increased flow of blood to different areas of the brain which are experiencing positive stimuli. However, she warns that this is a long way from confirming that the brain itself is developing or strengthening.</p>
                    <p><strong>F</strong>&nbsp;&nbsp;Nonetheless, Montgomery believes she is making progress. In the laboratory, when scientists want to experiment with synaptic connections, they stimulate the brain with electricity, as this copies the high-frequency firings that happen normally in the brain every second. Using this technique, Montgomery has made a number of findings. For example, the hormones that are released routinely in response to good or bad situations - such as adrenaline - act to regulate the brain, in the same way that weather has a regulating effect on human activity more generally. But scientists understand some of these stimuli better than others. More is known about the impact on brain activity of prolonged periods of fear than the effects of 'happiness' hormones that are released by positive events in life. This is one potentially important area that she hopes to investigate further in future.</p>
                </div>
                <div id="passage-text-3" class="reading-passage hidden">
                    <h4 class="text-center">Asian space: return of an Asian invention</h4>
                    <div class="paragraph-drop-zone" data-paragraph="A" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">A</div>
                    <p>Planet Earth is today circled by scores of satellites, orbiting like tiny moons after being sent aloft by rockets to perform a variety of useful tasks. Their story began long ago but rocket technology has progressed considerably since the days when bamboo poles filled with gunpowder were first used in China as fireworks around 500 BC, and since the Sung dynasty when rockets were first used to repel invaders at the battle of Kaifeng (Kai-fung-fu) in AD 1232. In Asia in recent years there has been a dramatic growth in space activities both in the utilisation of space-based services and the production of satellites and launchers. This rapid expansion has led many analysts to predict that Asia will become an important provider of services in space.</p>
                    <div class="paragraph-drop-zone" data-paragraph="B" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">B</div>
                    <p>Worldwide there have been dramatic developments in space technology, and these have been eagerly embraced by Asian nations, which have found them to be especially adaptable for their particular problems. Asia, and Southeast Asia in particular, experiences recurrent large-scale environmental problems including storms and flooding, forest fires, and crop failures. The space application that has attracted the most attention in this region, therefore, is remote sensing. Remote sensing satellites, equipped with instruments to take photographs of the ground using different wavelengths, provide essential information about natural ground cover and planted crops, and this information facilitates work in environmental management, disaster prevention, and sustainable planning.</p>
                    <div class="paragraph-drop-zone" data-paragraph="C" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">C</div>
                    <p>Imaginative and innovative applications of satellites are constantly being explored, with potentially revolutionary effects. To take a specific example, small antennas no more than 40 cm across and 15 cm high are embedded in slabs of stone, which are themselves embedded in the earth. Every 15 seconds a global positioning system measures the distance between each antenna and a satellite. The data is transferred to one of 200 monitoring stations around the world and provide a constant flow of information invaluable for the prediction of earthquakes. Asian nations have also eagerly embraced satellite technology in the field of health and telemedicine: patients in remote rural communities can be diagnosed and carers can be advised on medical treatment. Such things as pictures of the patient, pulse rate temperature, blood pressure and blood oxygen can be monitored and transmitted to doctors thousands of kilometres away for reliable diagnosis and advice. There have also been beneficial advances in distance education programs, and agricultural planning and production have improved.</p>
                    <div class="paragraph-drop-zone" data-paragraph="D" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">D</div>
                    <p>Access to the benefits of satellites was not always as straightforward as it might seem today. For decades, Japan has been the dominant space power in Asia. To achieve its pre-eminence, however, Japan had to face serious time-consuming technological challenges and high risks through many trials. This experimentation was problematic at first because Japan based its satellite manufacturing on traditional and very expensive Western military technological practices.</p>
                    <div class="paragraph-drop-zone" data-paragraph="E" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">E</div>
                    <p>In more recent times, fundamental changes in satellites have dramatically reduced costs. 'Small satellites' have given Asian countries a way to develop low-cost satellite technology and rapidly establish a space capability of their own. The new entrants in the industry are able to shorten the time for trials by as much as a decade or more. Small satellites, which have opened the space age to developing countries, are classified in three groups: nano satellites have a mass less than 10 kg, micro satellites range from 10 to 100 kg and mini satellites are between 100 and 500 kg. Such is the appeal of small satellites that low-cost launcher rockets are being developed exclusively for mini satellites. The saving is even greater for nano and micro satellites, which can be launched as secondary passengers, hitching a ride on large launchers with pay-load to spare. Small satellites allow individual countries to select more convenient orbits for their own particular purposes. A low polar orbit is good for mapping. As the earth rotates from west to east, the satellite orbits north and south allowing it repeatedly to photograph any chosen parts of the Earth's surface.</p>
                    <div class="paragraph-drop-zone" data-paragraph="F" ondrop="drop(event)" ondragover="allowDrop(event)" ondragstart="dragFromZone(event)" draggable="false">F</div>
                    <p>Space technology in Asia has been facilitated by the competitive commercial sector and its production of low-cost mini satellites. The globalisation of industrial and financial markets has improved avenues for transferring technological innovation, and the availability of ready-made commercial technology may well result in a highly competitive Asian satellite industry. The laws of physics are the same all over the world, and the principles of electronics and mechanics know no political or cultural boundaries. However, engineering practice and management practice are not so readily transferable but are influenced by education, culture and history. These practices have an effect on costs, lead times, product designs and, eventually, international sales. Nevertheless, it can be expected that the acquisition of technical expertise, combined with the world-renowned Japanese manufacturing and management techniques, will soon produce world-class satellites at reduced costs.</p>
                </div>
            </div>
            <div class="resizer" id="resizer"></div>
            <div class="questions-panel" id="questions-panel">
                <div id="questions-1" class="question-set">
                    <div class="questions-container">
                        <div class="question" data-q-start="1" data-q-end="6">
                            <div class="question-prompt">
                                <p><strong>Questions 1-6</strong></p>
                                <p>Do the following statements agree with the information given in Reading Passage 1?</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>TRUE</strong> if the statement agrees with the information</li>
                                    <li><strong>FALSE</strong> if the statement contradicts the information</li>
                                    <li><strong>NOT GIVEN</strong> if there is no information on this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="1" data-q-end="1">
                                <div class="tf-question-line"><span class="tf-question-number">1</span><span class="tf-question-text">Chocolate was consumed by greater numbers of people in the nineteenth century than in previous times.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q1" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q1" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q1" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="2" data-q-end="2">
                                <div class="tf-question-line"><span class="tf-question-number">2</span><span class="tf-question-text">Fry's chocolate became more affordable because of the fall in price of one ingredient.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q2" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q2" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q2" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="3" data-q-end="3">
                                <div class="tf-question-line"><span class="tf-question-number">3</span><span class="tf-question-text">Entrepreneurial British chocolate manufacturers paid their employees well.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q3" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q3" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q3" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="4" data-q-end="4">
                                <div class="tf-question-line"><span class="tf-question-number">4</span><span class="tf-question-text">Customers were made ill through the practices of unscrupulous chocolate producers.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q4" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q4" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q4" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="5" data-q-end="5">
                                <div class="tf-question-line"><span class="tf-question-number">5</span><span class="tf-question-text">Fresh milk was used in the production of milk chocolate in Switzerland.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q5" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q5" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q5" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="6" data-q-end="6">
                                <div class="tf-question-line"><span class="tf-question-number">6</span><span class="tf-question-text">Lindt's conche machine was adopted by other manufacturers.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q6" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q6" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q6" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="7" data-q-end="13">
                            <div class="question-prompt">
                                <p><strong>Questions 7-13</strong></p>
                                <p>Complete the notes below. Write <strong>ONE WORD ONLY</strong> from the text for each answer.</p>
                            </div>
                            <div class="summary-text">
                                <p class="centered-title">Milton Hershey and the chocolate industry</p>
                                <ul style="list-style: disc; padding-left: 20px;">
                                    <li>Hershey bought some <input type="text" class="answer-input" id="q7" placeholder="7"> after visiting a trade fair</li>
                                    <li>After selling his caramel business, Hershey purchased a <input type="text" class="answer-input" id="q8" placeholder="8"></li>
                                    <li>The inhabitants of Hershey could not vote for a <input type="text" class="answer-input" id="q9" placeholder="9"></li>
                                    <li>Hershey set up a new town in Cuba around a mill.</li>
                                    <li>Hershey constructed <input type="text" class="answer-input" id="q10" placeholder="10"> to transport material</li>
                                    <li>Hershey brought in <input type="text" class="answer-input" id="q11" placeholder="11"> to improve the image of his chocolate.</li>
                                    <li>One popular chocolate product had <input type="text" class="answer-input" id="q12" placeholder="12"> added to it.</li>
                                    <li>Because of the time demand, tourists can only visit the <input type="text" class="answer-input" id="q13" placeholder="13"> at Hershey.</li>
                                </ul>
                                
                            </div>
                        </div>


                            </div>
                                </div>
                <div id="questions-2" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="14" data-q-end="17">
                            <div class="question-prompt">
                                <p><strong>Questions 14-17</strong></p>
                                <p>Reading Passage 2 has six paragraphs, A-F.</p>
                                <p>Which paragraph contains the following information?</p>
                                <p>Choose the correct letter, A-F, for each question.</p>
                                <p><strong>NB</strong> You may use any letter more than once.</p>
                            </div>
                            <div class="tf-question" data-q-start="14" data-q-end="14">
                                <div class="tf-question-line"><span class="tf-question-number">14</span><span class="tf-question-text">a reference to a fact that two scientists use the same technique to promote their own happiness   <select class="answer-input" id="q14">
                                    <option value="">Select answer</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select></span></div>
                              
                            </div>
                            <div class="tf-question" data-q-start="15" data-q-end="15">
                                <div class="tf-question-line"><span class="tf-question-number">15</span><span class="tf-question-text">the suggestion that scientific opinion about an aspect of brain function has changed over a given time period  <select class="answer-input" id="q15">
                                    <option value="">Select answer</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select></span></div>
                               
                            </div>
                            <div class="tf-question" data-q-start="16" data-q-end="16">
                                <div class="tf-question-line"><span class="tf-question-number">16</span><span class="tf-question-text">an estimate of how numerous some brain components are <select class="answer-input" id="q16">
                                    <option value="">Select answer</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                    <option value="E">E</option>
                                    <option value="F">F</option>
                                </select></span></div>
                               
                            </div>
                            <div class="tf-question" data-q-start="17" data-q-end="17">
                                <div class="tf-question-line"><span class="tf-question-number">17</span><span class="tf-question-text">the reason why some educational courses were set up <select class="answer-input" id="q17">
                                        <option value="">Select answer</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                        <option value="E">E</option>
                                        <option value="F">F</option>
                                    </select></span></div>
                               
                            </div>
                        </div>

                        <div class="question" data-q-start="18" data-q-end="21">
                            <div class="question-prompt">
                                <p><strong>Questions 18-21</strong></p>
                                <p>Match each statement with the correct person by dragging the letter to the drop zone.</p>
                            </div>
                            
                            <div class="matching-question-container">
                                <div class="matching-questions">
                                    <div class="matching-question-item">
                                        <span><strong>18.</strong> It's better to look for a variety of ways to increase happiness than focus on just one.</span>
                                        <div class="drop-zone" id="drop18" data-dnd-group="matching-18-21">
                                        </div>
                                    </div>
                                    
                                    <div class="matching-question-item">
                                        <span><strong>19.</strong> Focusing on personal achievements rather than negative experiences will make people happier.</span>
                                        <div class="drop-zone" id="drop19" data-dnd-group="matching-18-21">
                                        </div>
                                    </div>
                                    
                                    <div class="matching-question-item">
                                        <span><strong>20.</strong> Happy people might have a reason not to display one favourable characteristic.</span>
                                        <div class="drop-zone" id="drop20" data-dnd-group="matching-18-21">
                                        </div>
                                    </div>
                                    
                                    <div class="matching-question-item">
                                        <span><strong>21.</strong> A range of groups are becoming more interested in learning techniques to improve happiness.</span>
                                        <div class="drop-zone" id="drop21" data-dnd-group="matching-18-21">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="matching-options-bank">
                                    <p><strong>List of People</strong></p>
                                    <div class="drag-item" draggable="true" data-value="A" data-dnd-group="matching-18-21">A. Tony Fernando</div>
                                    <div class="drag-item" draggable="true" data-value="B" data-dnd-group="matching-18-21">B. Richard Davidson</div>
                                    <div class="drag-item" draggable="true" data-value="C" data-dnd-group="matching-18-21">C. Rick Hanson</div>
                                    <div class="drag-item" draggable="true" data-value="D" data-dnd-group="matching-18-21">D. Judi Clements</div>
                                    <div class="drag-item" draggable="true" data-value="E" data-dnd-group="matching-18-21">E. Carsten Grimm</div>
                                    <div class="drag-item" draggable="true" data-value="F" data-dnd-group="matching-18-21">F. Nathan Consedine</div>
                                </div>
                            </div>
                            
                            <!-- Hidden inputs for tracking answers -->
                            <div style="display: none;">
                                <input type="text" id="q18" value="">
                                <input type="text" id="q19" value="">
                                <input type="text" id="q20" value="">
                                <input type="text" id="q21" value="">
                            </div>
                        </div>

                        <div class="question" data-q-start="22" data-q-end="26">
                            <div class="question-prompt">
                                <p><strong>Questions 22-26</strong></p>
                                <p>Complete the summary below. Write <strong>ONE WORD ONLY</strong> from the text for each answer.</p>
                            </div>
                            <div class="summary-text">
                                <p class="centered-title"><strong>Auckland University's Centre for Brain Research</strong></p>
                                <p>Associate Professor Johanna Montgomery says that current research into brain activity and behaviour only relates to <input type="text" class="answer-input" id="q22" placeholder="22"> so Hanson's theories have not been proved correct. While scans do show that positive stimuli result in more <input type="text" class="answer-input" id="q23" placeholder="23"> reaching parts of the brain, this isn't proof that the brain is getting stronger.</p>
                                <p>But Montgomery is making progress. In laboratory experiments, scientists use <input type="text" class="answer-input" id="q24" placeholder="24"> to initiate brain activity, because it's similar to natural processes. One finding is that hormones can be compared to the <input type="text" class="answer-input" id="q25" placeholder="25"> because both can change human behaviour. But scientists understand some stimuli, such as <input type="text" class="answer-input" id="q26" placeholder="26">, better than they understand more positive stimuli.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="questions-3" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="27" data-q-end="32">
                            <div class="question-prompt">
                                <p><strong>Questions 27-32</strong></p>
                                <p>The text has six paragraphs. Choose the correct heading for each section and move it into the gap.</p>
                            </div>
                            
                            <div class="matching-question-container">
                                <div class="matching-options-bank">
                                    <p><strong>List of headings</strong></p>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="i">i. Asian need for new space technology</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="ii">ii. Independence through the greater adaptability of satellites</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="iii">iii. Ancient inventions linked to the future</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="iv">iv. An early start but slow initial progress</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="v">v. Non-technical factors affecting Asia's entry to the space age</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="vi">vi. Application of rocket technology to warfare</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="vii">vii. New and wide-ranging uses of space technology</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="viii">viii. The difficulty of identifying types of satellites</div>
                                </div>
                            </div>
                            
                            <!-- Hidden inputs for tracking answers -->
                            <div style="display: none;">
                                <input type="text" id="q27" value="">
                                <input type="text" id="q28" value="">
                                <input type="text" id="q29" value="">
                                <input type="text" id="q30" value="">
                                <input type="text" id="q31" value="">
                                <input type="text" id="q32" value="">
                            </div>
                        </div>

                        <div class="question" data-q-start="33" data-q-end="36">
                            <div class="question-prompt">
                                <p><strong>Questions 33-36</strong></p>
                                <p>Complete each sentence with the correct ending, A-G, below. Drag the correct letter to the drop zone.</p>
                            </div>
                            
                            <div class="matching-question-container">
                                <div class="matching-questions">
                                    <div class="matching-question-item">
                                        <div><strong>33.</strong> Southeast Asian countries wish to photograph vegetation from above because</div>
                                        
                                    </div>
                                    <div class="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)" id="drop33" data-question="33">
                                    </div>
                                    
                                    <div class="matching-question-item">
                                        <span><strong>34.</strong> Asian countries are interested in advances in medical treatment using satellite technology because</span>
                                       
                                    </div>
                                    <div class="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)" id="drop34" data-question="34">
                                    </div>
                                    
                                    <div class="matching-question-item">
                                        <span><strong>35.</strong> Satellites in polar orbits are useful for mapping because</span>
                                        
                                    </div>
                                    <div class="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)" id="drop35" data-question="35">
                                    </div>
                                    
                                    <div class="matching-question-item">
                                        <span><strong>36.</strong> Management practices are not universally adaptable because</span>
                                        
                                    </div>
                                    <div class="drop-zone" ondrop="drop(event)" ondragover="allowDrop(event)" id="drop36" data-question="36">
                                    </div>
                                </div>
                                
                                <div class="matching-options-bank">
                                    <p><strong>List of endings</strong></p>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="A">A. they are seeking plants with medicinal value</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="B">B. they can take pictures of any area required</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="C">C. They depend on what has happened in the past</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="D">D. they do not take up a lot of space aboard rockets</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="E">E. they have locations that are difficult to reach</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="F">F. they help students with their studies</div>
                                    <div class="drag-item" draggable="true" ondragstart="drag(event)" data-value="G">G. they suffer from such things as forest fires</div>
                                </div>
                            </div>
                            
                            <!-- Hidden inputs for tracking answers -->
                            <div style="display: none;">
                                <input type="text" id="q33" value="">
                                <input type="text" id="q34" value="">
                                <input type="text" id="q35" value="">
                                <input type="text" id="q36" value="">
                            </div>
                        </div>

                        <div class="question" data-q-start="37" data-q-end="40">
                            <div class="question-prompt">
                                <p><strong>Questions 37-40</strong></p>
                                <p>Do the following statements agree with the information given in the text?</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>TRUE</strong> if the statement agrees with the information</li>
                                    <li><strong>FALSE</strong> if the statement contradicts the information</li>
                                    <li><strong>NOT GIVEN</strong> if there is no information on this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="37" data-q-end="37">
                                <div class="tf-question-line"><span class="tf-question-number">37</span><span class="tf-question-text">In 500 BC rockets were used in battle in China.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q37" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q37" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q37" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="38" data-q-end="38">
                                <div class="tf-question-line"><span class="tf-question-number">38</span><span class="tf-question-text">The distance between satellites and antennas on Earth can be used to detect movement in the Earth's crust.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q38" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q38" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q38" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="39" data-q-end="39">
                                <div class="tf-question-line"><span class="tf-question-number">39</span><span class="tf-question-text">Distance education has increased literacy levels in Asia.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q39" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q39" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q39" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="40" data-q-end="40">
                                <div class="tf-question-line"><span class="tf-question-number">40</span><span class="tf-question-text">Commercial competition prevents technological innovation spreading.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q40" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q40" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q40" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                        </div>
        </div>
    </div>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow prev" onclick="previousQuestion()" id="prevBtn" aria-label="Previous question">
            <!-- Left arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="nav-arrow next" onclick="nextQuestion()" id="nextBtn" aria-label="Next question">
            <!-- Right arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)"><span class="sr-only">Question 12</span><span aria-hidden="true">12</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)"><span class="sr-only">Question 13</span><span aria-hidden="true">13</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)"><span class="sr-only">Question 14</span><span aria-hidden="true">14</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)"><span class="sr-only">Question 15</span><span aria-hidden="true">15</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)"><span class="sr-only">Question 16</span><span aria-hidden="true">16</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(17)"><span class="sr-only">Question 17</span><span aria-hidden="true">17</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)"><span class="sr-only">Question 18</span><span aria-hidden="true">18</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)"><span class="sr-only">Question 19</span><span aria-hidden="true">19</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)"><span class="sr-only">Question 20</span><span aria-hidden="true">20</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 14</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div id="menu-highlight" class="context-menu-item" onclick="highlightText()">
            Highlight
        </div>
        <div id="menu-note" class="context-menu-item" onclick="addNote()">
            Note
        </div>
        <div id="menu-clear" class="context-menu-item" onclick="clearHighlight()">
            Clear
        </div>
        <div id="menu-clear-all" class="context-menu-item" onclick="clearAllHighlights()">
            Clear All
        </div>
    </div>

    <div id="results-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeResultsModal()">&times;</button>
            <h2>Results</h2>
            <div class="results-summary">
                <p>Score: <span id="results-score"></span> / 40</p>
                <p>IELTS Band: <span id="results-band"></span></p>
            </div>
            <div id="results-details" class="results-details-container">
                <!-- Results for each question will be injected here -->
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- STATE VARIABLES ---
        let currentPassage = 1;
        let currentQuestion = 1;
        let selectedRange = null;
        let timeInSeconds = 3600;
        let timerInterval;
        let draggedItem = null;
        let activeQuestionElement = null;
        let selectedDragItem = null;

        // --- GLOBAL FUNCTIONS ---
        function getFirstQuestionOfPart(part) {
            switch(part) {
                case 1: return 1;
                case 2: return 14;
                case 3: return 27;
                default: return 1;
            }
        }

        // --- DOM ELEMENTS ---
        const timerDisplay = document.querySelector('.timer-display');
        const timerToggleButton = document.getElementById('timer-toggle-btn');
        const timerResetButton = document.getElementById('timer-reset-btn');
        const deliverButton = document.getElementById('deliver-button');
        const resizer = document.getElementById('resizer');
        const passagePanel = document.getElementById('passage-panel');
        const questionsPanel = document.getElementById('questions-panel');
        const contextMenu = document.getElementById('contextMenu');

        // --- ICON SVGs ---
        const playIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>';
        const pauseIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

        // --- ANSWERS ---
        const correctAnswers = {
            // Part 1 (1-13) - Chocolate for the masses
            '1': 'TRUE',
            '2': 'FALSE',
            '3': 'NOT GIVEN',
            '4': 'NOT GIVEN',
            '5': 'FALSE',
            '6': 'TRUE',
            '7': 'machinery',
            '8': 'farm',
            '9': 'mayor',
            '10': 'railroads',
            '11': 'nutritionists',
            '12': 'almonds',
            '13': 'exhibitions',
            // Part 2 (14-26) - How to be Happy
            '14': 'B',
            '15': 'A',
            '16': 'A',
            '17': 'C',
            '18': 'E',
            '19': 'C',
            '20': 'F',
            '21': 'D',
            '22': 'animals',
            '23': 'blood',
            '24': 'electricity',
            '25': 'weather',
            '26': 'fear',
            // Part 3 (27-40) - Asian space: return of an Asian invention
            '27': 'iii',
            '28': 'i',
            '29': 'vii',
            '30': 'iv',
            '31': 'ii',
            '32': 'v',
            '33': 'G',
            '34': 'E',
            '35': 'B',
            '36': 'C',
            '37': 'FALSE',
            '38': 'TRUE',
            '39': 'NOT GIVEN',
            '40': 'FALSE'
        };

        // --- INITIALIZATION ---
        function initialize() {
            console.log(`🚀 Initializing application...`);
            startTimer();
            initializeDragAndDrop();
            setupCheckboxLimits();
            setupExampleHeading();
            console.log(`📋 Setting up initial state - switching to part 1`);
            switchToPart(1); // Also calls goToQuestion(1) and updateNavigation
            
            document.body.addEventListener('input', updateAllIndicators);
            document.body.addEventListener('change', updateAllIndicators);
            deliverButton.addEventListener('click', checkAnswers);
            timerToggleButton.addEventListener('click', toggleTimer);
            timerResetButton.addEventListener('click', resetTimer);

            // Auto-close dropdowns for Questions 14-17 on selection
            ['q14','q15','q16','q17'].forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    sel.addEventListener('change', () => sel.blur());
                }
            });

            // Add click listeners to question containers for navigation
            document.querySelectorAll('[data-q-start]').forEach(el => {
                el.addEventListener('click', (event) => {
                    // Stop event propagation to prevent parent container clicks
                    event.stopPropagation();
                    
                    const qNum = parseInt(el.dataset.qStart, 10);
                    const qEnd = parseInt(el.dataset.qEnd, 10);
                    
                    console.log(`🖱️ Question container clicked - qNum: ${qNum}, qEnd: ${qEnd}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without valid question number, ignoring navigation`);
                        return;
                    }
                    
                    // Only navigate if this is a single question (qStart === qEnd) or if we're clicking on a specific question within a group
                    if (qNum === qEnd || el.classList.contains('tf-question')) {
                        if (currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum}`);
                            goToQuestion(qNum);
                        } else {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed`);
                        }
                    } else {
                        console.log(`ℹ️ Ignoring click on group container (${qNum}-${qEnd})`);
                    }
                });
            });
            
            // Add specific click listeners for individual question elements to prevent parent container interference
            document.querySelectorAll('.tf-question, .summary-text').forEach(el => {
                el.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(el.dataset.qStart, 10);
                    console.log(`🎯 Individual question element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN (like .summary-text containers)
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without specific question number, ignoring navigation`);
                        return;
                    }
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (individual element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (individual element)`);
                    }
                });
            });
            
            // Add specific click listeners for individual input elements in questions 33-36
            document.querySelectorAll('.answer-input[id^="q3"]').forEach(input => {
                input.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(input.id.replace('q', ''), 10);
                    console.log(`📝 Input element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, input:`, input);
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (input element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (input element)`);
                    }
                });
            });
            
            // Add click listeners for the paragraph elements containing questions 33-36
            document.querySelectorAll('.summary-text p').forEach(p => {
                p.addEventListener('click', (event) => {
                    event.stopPropagation();
                    // Extract question number from the paragraph text (e.g., "33" from "<strong>33</strong>")
                    const strongElement = p.querySelector('strong');
                    if (strongElement) {
                        const qNum = parseInt(strongElement.textContent, 10);
                        console.log(`📄 Summary paragraph clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, paragraph:`, p);
                        
                        if (!isNaN(qNum) && currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (summary paragraph)`);
                            goToQuestion(qNum);
                        } else if (!isNaN(qNum)) {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed (summary paragraph)`);
                        }
                    }
                });
            });

            resizer.addEventListener('mousedown', initResize, false);
            initializeContextMenu();
        }

        // --- CORE TEST LOGIC ---

        function checkAnswers() {
            // Disable all inputs to prevent changes
            const allInputs = document.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => {
                input.disabled = true;
            });

            // Disable all drag and drop functionality
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.cursor = 'not-allowed';
                item.style.pointerEvents = 'none';
            });

            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.style.pointerEvents = 'none';
                zone.classList.add('disabled');
            });

            // Disable submit button
            deliverButton.disabled = true;
            deliverButton.style.cursor = 'not-allowed';
            
            clearInterval(timerInterval);
            let score = 0;
            const totalQuestions = 40;
            const resultsDetailsContainer = document.getElementById('results-details');
            resultsDetailsContainer.innerHTML = '';

            document.querySelectorAll('.correct, .incorrect, .correct-answer-highlight').forEach(el => {
                el.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
            });
            document.querySelectorAll('.correct-answer-display').forEach(el => el.remove());

            // Helper to evaluate the special TWO-answers checkbox group (Q20 & Q21) - only if present
            const hasQ20to21Group = document.querySelectorAll('input[name="q20-21"]').length > 0;
            function evaluateQ20to21() {
                const checked = Array.from(document.querySelectorAll('input[name="q20-21"]:checked')).map(el => el.value).sort();
                const isCorrect20 = checked.includes('A');
                const isCorrect21 = checked.includes('E');

                // Mark selected labels
                document.querySelectorAll('input[name="q20-21"]').forEach(input => {
                    const label = input.closest('.multi-choice-option');
                    if (!label) return;
                    label.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
                    if (input.checked) {
                        const good = (input.value === 'A' && isCorrect20) || (input.value === 'E' && isCorrect21);
                        label.classList.add(good ? 'correct' : 'incorrect');
                    }
                    if (!isCorrect20 && input.value === 'A') label.classList.add('correct-answer-highlight');
                    if (!isCorrect21 && input.value === 'E') label.classList.add('correct-answer-highlight');
                });

                const selectedText = checked.join(' & ') || 'Not Answered';
                // Q20 row
                resultsDetailsContainer.innerHTML += `
                    <div class="result-row ${isCorrect20 ? '' : 'incorrect'}">
                        <span class="q-num">20</span>
                        <span class="user-ans">${selectedText}</span>
                        <span class="correct-ans">A</span>
                    </div>`;
                // Q21 row
                resultsDetailsContainer.innerHTML += `
                    <div class="result-row ${isCorrect21 ? '' : 'incorrect'}">
                        <span class="q-num">21</span>
                        <span class="user-ans">${selectedText}</span>
                        <span class="correct-ans">E</span>
                    </div>`;

                // Mark nav buttons
                const nav20 = document.querySelector(`.subQuestion[onclick="goToQuestion(20)"]`);
                if (nav20) { nav20.classList.remove('answered', 'active'); nav20.classList.add(isCorrect20 ? 'correct' : 'incorrect'); }
                const nav21 = document.querySelector(`.subQuestion[onclick="goToQuestion(21)"]`);
                if (nav21) { nav21.classList.remove('answered', 'active'); nav21.classList.add(isCorrect21 ? 'correct' : 'incorrect'); }

                if (isCorrect20) score += 1;
                if (isCorrect21) score += 1;
                return (isCorrect20 || isCorrect21);
            }

            let q20to21Evaluated = false;
            for (let i = 1; i <= totalQuestions; i++) {
                const questionKey = String(i);
                const correctAnswer = correctAnswers[questionKey];
                let userAnswer = '';
                let isCorrect = false;
                
                let userAnswerDisplay = 'Not Answered';
                const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer;

                // Special handling: combined checkbox group for Q20 & Q21
                if ((i === 20 || i === 21) && hasQ20to21Group) {
                    if (!q20to21Evaluated) {
                        evaluateQ20to21();
                        q20to21Evaluated = true;
                    }
                    continue; // Already handled rows, scoring, and marking
                }

                const textInput = document.getElementById(`q${i}`);
                const radioGroup = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);
                
                // Handle Text and Select Inputs
                if (textInput && (textInput.tagName === 'INPUT' || textInput.tagName === 'SELECT')) {
                    const element = textInput.closest('.matching-form-row') || textInput;
                    userAnswer = textInput.value.trim();
                    userAnswerDisplay = userAnswer || 'Not Answered';

                    const normalize = (s) => (s || '')
                        .toString()
                        .toLowerCase()
                        .replace(/[^a-z0-9\s]/g, '')
                        .replace(/\s+/g, ' ')
                        .trim();

                    if (textInput.tagName === 'SELECT') {
                        isCorrect = userAnswer === correctAnswer;
                    } else {
                        const normUser = normalize(userAnswer);
                        if (Array.isArray(correctAnswer)) {
                            isCorrect = correctAnswer.some(ans => normalize(ans) === normUser);
                        } else {
                            isCorrect = normalize(correctAnswer) === normUser;
                        }
                    }

                    // Special visual handling for Paragraph Headings (Q27-32): mark the visible drop-zones
                    const isHeadingQuestion = i >= 27 && i <= 32;
                    let targetForMarking = element;
                    if (isHeadingQuestion) {
                        const letters = ['A','B','C','D','E','F','G'];
                        const paragraphLetter = letters[i - 27];
                        const dropZone = document.querySelector(`.paragraph-drop-zone[data-paragraph="${paragraphLetter}"]`);
                        if (dropZone) {
                            targetForMarking = dropZone;
                        }
                    }
                    
                    if (isCorrect) {
                        score++;
                        targetForMarking.classList.add('correct');
                    } else {
                        targetForMarking.classList.add('incorrect');
                        // Show correct answer hint next to the visible element if available
                        const correctAnswerSpan = document.createElement('span');
                        correctAnswerSpan.className = 'correct-answer-display';
                        correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswerText}</span>`;
                        if (targetForMarking !== element) {
                            targetForMarking.appendChild(correctAnswerSpan);
                        } else {
                            textInput.parentNode.insertBefore(correctAnswerSpan, textInput.nextSibling);
                        }
                    }
                    
                    // Special handling for questions 14-17 (dropdown questions)
                    if (i >= 14 && i <= 17) {
                        // Mark the select element itself
                        textInput.classList.add(isCorrect ? 'correct' : 'incorrect');
                        // Also mark the question container
                        const questionContainer = textInput.closest('.tf-question');
                        if (questionContainer) {
                            questionContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }
                }
                // Handle drag and drop questions (any with a drop-zone for this question)
                else if (document.querySelector(`.drop-zone[data-q-start="${i}"]`) || document.querySelector(`.drop-zone[data-question="${i}"]`)) {
                    console.log(`🔍 Checking drag-and-drop question ${i}`);
                    const dropZone = document.querySelector(`.drop-zone[data-q-start="${i}"]`) || document.querySelector(`.drop-zone[data-question="${i}"]`);
                    const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;
                    
                    console.log(`📍 Drop zone for question ${i}:`, dropZone);
                    console.log(`📍 Dropped item for question ${i}:`, droppedItem);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (droppedItem) {
                        userAnswer = droppedItem.dataset.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        // Mark the drop zone as correct or incorrect
                        dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                        
                        // Show correct answer if wrong
                        if (!isCorrect && correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    } else {
                        // No answer provided - mark as incorrect
                        console.log(`⚠️ No answer provided for question ${i}`);
                        if (dropZone) {
                            dropZone.classList.add('incorrect');
                        }
                        if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    }
                }
                // Handle Radio Button Inputs (T/F, MCQs)
                else if (radioGroup.length > 0) {
                    const questionContainer = radioGroup[0]?.closest('.tf-question') || radioGroup[0]?.closest('.multi-choice-question');
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);

                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;

                        const userLabel = checkedRadio.closest('.tf-option, .multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        // Handle table radio buttons
                        if (checkedRadio.classList.contains('table-radio')) {
                            const tableCell = checkedRadio.closest('td');
                            if (tableCell) {
                                tableCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                            }
                        }
                    }

                    if (isCorrect) {
                        score++;
                    } else {
                        if (questionContainer){
                            const correctOptionEl = questionContainer.querySelector(`input[name="q${i}"][value="${correctAnswerText}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.tf-option, .multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    }
                }
                // Handle checkboxes for questions 24-26 as a single group
                else if (i === 24) {
                    console.log(`🔍 Checking checkbox group questions 24-26`);
                    const checkedCheckboxes = document.querySelectorAll(`input[name="q24"]:checked`);
                    
                    if (checkedCheckboxes.length > 0) {
                        const selectedValues = Array.from(checkedCheckboxes).map(cb => cb.value).sort();
                        userAnswer = selectedValues.join(', ');
                        userAnswerDisplay = userAnswer;
                        
                        // For questions 24-26, the correct set is ['B', 'D', 'F']
                        const correctValues = ['B', 'D', 'F'];
                        const numCorrect = selectedValues.filter(v => correctValues.includes(v)).length;
                        isCorrect = numCorrect === 3; // all three match
                        score += numCorrect; // award 1 point per correct selection (max 3)
                        
                        console.log(`✅ User answer for questions 24-26: "${userAnswer}", Correct set: "${correctValues.join(', ')}", NumCorrect: ${numCorrect}`);
                        
                        // Mark selected checkboxes individually as correct/incorrect
                        checkedCheckboxes.forEach(checkbox => {
                            const parentOption = checkbox.closest('.multi-choice-option');
                            if (parentOption) {
                                const value = checkbox.value;
                                parentOption.classList.add(correctValues.includes(value) ? 'correct' : 'incorrect');
                            }
                        });
                        
                        // Highlight any correct answers that were not selected
                        if (!isCorrect) {
                            correctValues
                                .filter(v => !selectedValues.includes(v))
                                .forEach(answer => {
                                    const correctCheckbox = document.querySelector(`input[name="q24"][value="${answer}"]`);
                                    if (correctCheckbox) {
                                        const parentOption = correctCheckbox.closest('.multi-choice-option');
                                        if (parentOption) parentOption.classList.add('correct-answer-highlight');
                                    }
                                });
                        }
                        
                        // Questions 25 and 26 are handled as a group (do not modify loop index here)
                    } else {
                        console.log(`⚠️ No answer provided for questions 24-26`);
                        userAnswerDisplay = 'Not Answered';
                        // Questions 25 and 26 are handled as a group (do not modify loop index here)
                    }
                }
                // Handle checkboxes for questions 32-34 as a single group
                else if (i === 32) {
                    console.log(`🔍 Checking checkbox group questions 32-34`);
                    const checked = document.querySelectorAll('input[name^="q32"]:checked');
                    const selectedValues = Array.from(checked).map(cb => cb.value).sort();
                    if (selectedValues.length > 0) {
                        userAnswer = selectedValues.join(', ');
                        userAnswerDisplay = userAnswer;
                        const correctValues = ['A', 'E', 'F'];
                        const numCorrect = selectedValues.filter(v => correctValues.includes(v)).length;
                        isCorrect = numCorrect === 3;
                        score += numCorrect; // 1 point per correct selection

                        // Mark selected options
                        checked.forEach(cb => {
                            const parent = cb.closest('.multi-choice-option');
                            if (parent) parent.classList.add(correctValues.includes(cb.value) ? 'correct' : 'incorrect');
                        });

                        // Highlight missed correct answers
                        if (!isCorrect) {
                            correctValues.filter(v => !selectedValues.includes(v)).forEach(val => {
                                const cb = document.querySelector(`input[name^="q32"][value="${val}"]`);
                                if (cb) {
                                    const parent = cb.closest('.multi-choice-option');
                                    if (parent) parent.classList.add('correct-answer-highlight');
                                }
                            });
                        }
                    } else {
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle clickable-cell matrix questions (generic for any i that has clickable cells)
                else if (document.querySelector(`.clickable-cell[data-question="${i}"]`)) {
                    console.log(`🔍 Checking clickable cell question ${i}`);
                    const selectedCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-selected="true"]`);
                    console.log(`📍 Selected cell for question ${i}:`, selectedCell);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (selectedCell) {
                        userAnswer = selectedCell.dataset.answer;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        selectedCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                    
                    // Handle highlighting correct answers for incorrect responses
                    if (!isCorrect) {
                        const correctCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-value="${correctAnswerText}"]`);
                        if (correctCell) {
                            correctCell.classList.add('correct-answer-highlight');
                            console.log(`✅ Highlighted correct answer for question ${i}:`, correctCell);
                        } else {
                            console.log(`⚠️ Could not find correct cell for question ${i} with value "${correctAnswerText}"`);
                        }
                    }
                }
                // Handle text input questions (33-39)
                else if (i >= 33 && i <= 39) {
                    console.log(`🔍 Checking text input question ${i}`);
                    const textInput = document.getElementById(`q${i}`);
                    
                    if (textInput) {
                        userAnswer = textInput.value.trim().toLowerCase();
                        userAnswerDisplay = userAnswer || 'Not Answered';
                        
                        // Handle special case for question 33 which has two answers
                        if (i === 33) {
                            const answers = userAnswer.split('&').map(ans => ans.trim());
                            isCorrect = answers.includes('breathing') && answers.includes('eating');
                        } else {
                            isCorrect = userAnswer === correctAnswer.toLowerCase();
                        }
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        if (isCorrect) {
                            score++;
                            textInput.classList.add('correct');
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            textInput.classList.add('incorrect');
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle question 40 (multiple choice)
                else if (i === 40) {
                    console.log(`🔍 Checking multiple choice question ${i}`);
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);
                    
                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        const userLabel = checkedRadio.closest('.multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                            
                            // Highlight correct answer
                            const correctOptionEl = document.querySelector(`input[name="q${i}"][value="${correctAnswer}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle Checkbox Inputs (Multiple choice questions like 24-26)

                 
                // For showing results in the modal
                // Special handling for checkbox group questions 24-26
                if (i === 24) {
                    // Show single result for the entire group
                    const resultRow = `
                        <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                            <span class="q-num">24-26</span>
                            <span class="user-ans">${userAnswerDisplay}</span>
                            <span class="correct-ans">B, D, F</span>
                        </div>`;
                    resultsDetailsContainer.innerHTML += resultRow;
                } else if (i !== 25 && i !== 26 && i !== 33 && i !== 34) {
                    // Show normal result for other questions
                 const resultRow = `
                    <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                        <span class="q-num">${i}</span>
                        <span class="user-ans">${userAnswerDisplay}</span>
                        <span class="correct-ans">${correctAnswerText}</span>
                    </div>`;
                resultsDetailsContainer.innerHTML += resultRow;
                }
                // For 32-34 group, show a single row
                if (i === 32) {
                    const resultRow = `
                        <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                            <span class="q-num">32-34</span>
                            <span class="user-ans">${userAnswerDisplay}</span>
                            <span class="correct-ans">A, E, F</span>
                        </div>`;
                    resultsDetailsContainer.innerHTML += resultRow;
                }
                
                // Update nav button color
                // Special handling for checkbox group questions 24-26
                if (i === 24) {
                    // Update all three navigation buttons for questions 24-26
                    for (let q = 24; q <= 26; q++) {
                        const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${q})"]`);
                        if (navButton) {
                            navButton.classList.remove('answered', 'active');
                            navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }
                } else if (i !== 25 && i !== 26 && i !== 33 && i !== 34) {
                    // Update navigation button for other questions
                const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${i})"]`);
                if (navButton) {
                    navButton.classList.remove('answered', 'active');
                    navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                    }
                }
                // Update nav buttons for 32-34 group as a whole
                if (i === 32) {
                    for (let q = 32; q <= 34; q++) {
                        const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${q})"]`);
                        if (navButton) {
                            navButton.classList.remove('answered', 'active');
                            navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }
                }
            }

            document.getElementById('results-score').textContent = score;
            document.getElementById('results-band').textContent = calculateBandScore(score);
            document.body.classList.add('results-mode');
            document.getElementById('results-modal').classList.remove('hidden');
            
            // Change button to "My Result" with green styling
            deliverButton.innerHTML = `<span>My Result</span>`;
            deliverButton.style.backgroundColor = '#4CAF50';
            deliverButton.style.color = 'white';
            deliverButton.style.borderColor = '#4CAF50';
            deliverButton.disabled = false;
            deliverButton.style.cursor = 'pointer';
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.addEventListener('click', showResultsModal);
            
            // Highlight correct answers in the passage
            highlightCorrectAnswersInPassage();
        }

        function calculateBandScore(score) {
            if (score >= 39) return '9.0';
            const mapping = {
                40: 9.0, 39: 9.0, 38: 8.5, 37: 8.5, 36: 8.0, 35: 8.0, 34: 7.5,
                33: 7.5, 32: 7.0, 31: 7.0, 30: 7.0, 29: 6.5, 28: 6.5, 27: 6.5,
                26: 6.0, 25: 6.0, 24: 6.0, 23: 5.5, 22: 5.5, 21: 5.5, 20: 5.5,
                19: 5.0, 18: 5.0, 17: 5.0, 16: 5.0, 15: 5.0, 14: 4.5, 13: 4.5,
                12: 4.0, 11: 4.0, 10: 4.0, 9: 3.5, 8: 3.5, 7: 3.0, 6: 3.0,
                5: 2.5, 4: 2.5
            };
            if (score <= 0) return 0.0;
            if (score === 1) return 1.0;
            if (score <= 3) return 2.0;
            if (score <= 5) return 2.5;
            return mapping[score] || 0.0;
        }

        function highlightCorrectAnswersInPassage() {
            // Define the text passages and their corresponding question numbers for Part 1 (Chocolate for the masses)
            const part1Highlights = [
                { question: 1, text: "chocolate became far more widely available, and consumption shot up dramatically across the populations of Europe in particular", answer: "TRUE" },
                { question: 2, text: "the price of cacao butter escalated, so the new solid chocolate was only accessible for the elite", answer: "FALSE" },
                { question: 3, text: "the Cadburys created a model town with adequate housing for their workers, and even dining and reading rooms", answer: "NOT GIVEN" },
                { question: 4, text: "a health commission was created in Britain for the analysis of foods suspicions about chocolate proved well-founded", answer: "NOT GIVEN" },
                { question: 5, text: "Henri Nestle discovered a process to make powdered milk by evaporation", answer: "FALSE" },
                { question: 6, text: "the use of the conche machine for solid chocolate became universal in the business", answer: "TRUE" },
                { question: 7, text: "after seeing examples of the machinery used in Europe in action at an international exhibition in Chicago", answer: "machinery" },
                { question: 8, text: "bought a farm in Pennsylvania, and built a chocolate factory there", answer: "farm" },
                { question: 9, text: "there was, however, no elected mayor or indeed any democratic system in place", answer: "mayor" },
                { question: 10, text: "To transport the refined sugar so that it could be shipped by sea to his chocolate and cocoa factory, Hershey built modern electric railroads too", answer: "railroads" },
                { question: 11, text: "To help advertise his products, Hershey employed nutritionists to proclaim their health qualities", answer: "nutritionists" },
                { question: 12, text: "Hershey's best-set King bar contained almonds imported from southern Europe", answer: "almonds" },
                { question: 13, text: "visitors are whisked along on automated carts through an exhibition called 'Chocolate World'", answer: "exhibitions" }
            ];

            // Define the text passages and their corresponding question numbers for Part 2 (How to be Happy)
            const part2Highlights = [
                { question: 14, text: "a reference to a fact that two scientists use the same technique to promote their own happiness", answer: "B" },
                { question: 15, text: "the suggestion that scientific opinion about an aspect of brain function has changed over a given time period", answer: "A" },
                { question: 16, text: "an estimate of how numerous some brain components are", answer: "A" },
                { question: 17, text: "the reason why some educational courses were set up", answer: "C" },
                { question: 18, text: "It's better to look for a variety of ways to increase happiness than focus on just one", answer: "E" },
                { question: 19, text: "Focusing on personal achievements rather than negative experiences will make people happier", answer: "C" },
                { question: 20, text: "Happy people might have a reason not to display one favourable characteristic", answer: "F" },
                { question: 21, text: "A range of groups are becoming more interested in learning techniques to improve happiness", answer: "D" },
                { question: 22, text: "current research into brain activity and behaviour only relates to animals", answer: "animals" },
                { question: 23, text: "positive stimuli result in more blood reaching parts of the brain", answer: "blood" },
                { question: 24, text: "scientists use electricity to initiate brain activity", answer: "electricity" },
                { question: 25, text: "hormones can be compared to the weather", answer: "weather" },
                { question: 26, text: "scientists understand some stimuli, such as fear, better than they understand more positive stimuli", answer: "fear" }
            ];

            // Define the text passages and their corresponding question numbers for Part 3 (Asian space: return of an Asian invention)
            const part3Highlights = [
                { question: 27, text: "bamboo poles filled with gunpowder were first used in China as fireworks around 500 BC", answer: "iii" },
                { question: 28, text: "Asia experiences recurrent large-scale environmental problems including storms and flooding, forest fires, and crop failures", answer: "i" },
                { question: 29, text: "Imaginative and innovative applications of satellites are constantly being explored, with potentially revolutionary effects", answer: "vii" },
                { question: 30, text: "Japan had to face serious time-consuming technological challenges and high risks through many trials", answer: "iv" },
                { question: 31, text: "Small satellites have given Asian countries a way to develop low-cost satellite technology and rapidly establish a space capability of their own", answer: "ii" },
                { question: 32, text: "engineering practice and management practice are not so readily transferable but are influenced by education, culture and history", answer: "v" },
                { question: 33, text: "Southeast Asia experiences recurrent large-scale environmental problems including storms and flooding, forest fires, and crop failures", answer: "G" },
                { question: 34, text: "patients in remote rural communities can be diagnosed and carers can be advised on medical treatment", answer: "E" },
                { question: 35, text: "As the earth rotates from west to east, the satellite orbits north and south allowing it repeatedly to photograph any chosen parts of the Earth's surface", answer: "B" },
                { question: 36, text: "These practices have an effect on costs, lead times, product designs and, eventually, international sales", answer: "C" },
                { question: 37, text: "In 500 BC rockets were used in battle in China", answer: "FALSE" },
                { question: 38, text: "The distance between satellites and antennas on Earth can be used to detect movement in the Earth's crust", answer: "TRUE" },
                { question: 39, text: "Distance education has increased literacy levels in Asia", answer: "NOT GIVEN" },
                { question: 40, text: "Commercial competition prevents technological innovation spreading", answer: "FALSE" }
            ];

            // Function to apply highlights to a passage
            function applyHighlights(passageElement, highlights) {
                if (!passageElement) return;

                // Clear any existing highlights
                passageElement.querySelectorAll('.answer-highlight').forEach(el => {
                    const parent = el.parentNode;
                    parent.replaceChild(document.createTextNode(el.textContent), el);
                    parent.normalize();
                });

                // Add highlights for each answer
                highlights.forEach(item => {
                    const paragraphs = passageElement.querySelectorAll('p');
                    paragraphs.forEach(paragraph => {
                        const html = paragraph.innerHTML;
                        if (!html || typeof html !== 'string') return;
                        if (html.includes(item.text)) {
                            const escapeRegExp = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const re = new RegExp(escapeRegExp(item.text));
                            const replaced = html.replace(
                                re,
                                `<span class="answer-highlight" data-question="${item.question}" style="
                                    background-color: #ffeb3b;
                                    padding: 2px 4px;
                                    border-radius: 3px;
                                    font-weight: bold;
                                    position: relative;
                                ">${item.text}<span style="
                                    position: absolute;
                                    top: -8px;
                                    right: -8px;
                                    background-color: #2196f3;
                                    color: white;
                                    border-radius: 50%;
                                    width: 20px;
                                    height: 20px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 12px;
                                    font-weight: bold;
                                ">${item.question}</span></span>`
                            );
                            paragraph.innerHTML = replaced;
                        }
                    });
                });
            }

            // Apply highlights to Part 1 (Chocolate for the masses)
            const passageText1 = document.getElementById('passage-text-1');
            applyHighlights(passageText1, part1Highlights);

            // Apply highlights to Part 2 (How to be Happy)
            const passageText2 = document.getElementById('passage-text-2');
            applyHighlights(passageText2, part2Highlights);

            // Apply highlights to Part 3 (Asian space: return of an Asian invention)
            const passageText3 = document.getElementById('passage-text-3');
            applyHighlights(passageText3, part3Highlights);
        }

        function getUserAnswer(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
            const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);

            if (textInput) { // Handles <input type="text"> and <select>
                return { value: textInput.value, text: textInput.value || 'N/A' };
            }
            if (radioInput) {
                return { value: radioInput.value, text: radioInput.value };
            }
            if (dropZone) {
                const droppedItem = dropZone.querySelector('.drag-item');
                return { 
                    value: droppedItem ? droppedItem.dataset.value : null, 
                    text: droppedItem ? droppedItem.textContent.trim() : 'N/A' 
                };
            }
            
            // Handle checkboxes for questions 24-26
            if (qNum >= 24 && qNum <= 26) {
                const checkedCheckboxes = document.querySelectorAll(`input[name="q24"]:checked`);
                if (checkedCheckboxes.length > 0) {
                    const selectedValues = Array.from(checkedCheckboxes).map(cb => cb.value).sort();
                    return { 
                        value: selectedValues, 
                        text: selectedValues.join(', ') || 'N/A' 
                    };
                }
            }
            
            // Handle clickable cells for questions 23-26
            if (qNum >= 23 && qNum <= 26) {
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return { value: selectedCell.dataset.answer, text: selectedCell.dataset.answer };
                }
            }
            return { value: null, text: 'N/A' };
        }

        function displayCorrectAnswer(qNum, correctAnswer) {
            // Handle checkboxes for questions 24-26
            if (qNum >= 24 && qNum <= 26) {
                // For questions 24-26, the correct answer is always ['B', 'D', 'F']
                const correctValues = ['B', 'D', 'F'];
                // Highlight all correct checkboxes
                correctValues.forEach(answer => {
                    const correctCheckbox = document.querySelector(`input[name="q24"][value="${answer}"]`);
                    if (correctCheckbox) {
                        const parentOption = correctCheckbox.closest('.multi-choice-option');
                        if (parentOption) {
                            parentOption.classList.add('correct-answer-highlight');
                        }
                    }
                });
                return;
            }

            // Handle radio button questions by highlighting the correct label
            const correctRadioInput = document.querySelector(`input[name="q${qNum}"][value="${correctAnswer}"]`);
            if (correctRadioInput) {
                const parentOption = correctRadioInput.closest('.tf-option, .multi-choice-option');
                if (parentOption) {
                    parentOption.classList.add('correct-answer-highlight');
                    return;
                }
            }

            // Handle text inputs, select dropdowns, and others by showing the answer next to them
            const inputEl = document.getElementById(`q${qNum}`);
            if (inputEl) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                inputEl.insertAdjacentElement('afterend', displaySpan);
                return; // Done
            }
            
            // Fallback for questions identified by a container (e.g., some T/F/NG questions)
            const element = findQuestionElement(qNum);
            if (element) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                const itemContainer = element.querySelector('.tf-question-text');
                if (itemContainer) {
                     itemContainer.appendChild(displaySpan);
                } else {
                     element.appendChild(displaySpan);
                }
            }
        }
        
        function findQuestionElement(qNum) {
             return document.querySelector(`[data-q-start="${qNum}"]`) || document.querySelector(`[data-question="${qNum}"]`);
        }

        function addResultToModal(qNum, userAnswer, correctAnswer, isCorrect) {
            const resultsDetails = document.getElementById('results-details');
            const row = document.createElement('div');
            row.className = 'result-row';
            if (!isCorrect) {
                row.classList.add('incorrect');
            }
            row.innerHTML = `
                <span class="q-num">${qNum}</span>
                <span class="user-ans">${userAnswer}</span>
                <span class="correct-ans">${correctAnswer}</span>
            `;
            resultsDetails.appendChild(row);
        }

        function showResultsModal() {
            document.getElementById('results-modal').classList.remove('hidden');
        }

        window.closeResultsModal = function() {
            document.getElementById('results-modal').classList.add('hidden');
            document.body.classList.remove('results-mode');
        }
        
        function disableInputs() {
            deliverButton.innerHTML = `<span>Checked! View Results.</span>`;
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.onclick = showResultsModal;

            document.querySelectorAll('input, select').forEach(el => {
                el.disabled = true;
                 if (el.matches('input[type=radio], input[type=checkbox]')) {
                     el.style.cursor = 'not-allowed';
                     el.parentElement.style.cursor = 'not-allowed';
                 }
            });
            document.querySelectorAll('.drag-item').forEach(el => {
                el.setAttribute('draggable', 'false');
                el.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(el => {
                el.classList.add('disabled');
            });
        }

        function checkValue(userValue, correctValue) {
            if (userValue === null || userValue === undefined) return false;
            const formattedUserValue = userValue.trim().toLowerCase();
            if (Array.isArray(correctValue)) {
                return correctValue.map(v => v.toLowerCase()).includes(formattedUserValue);
            } else {
                return formattedUserValue === String(correctValue).toLowerCase();
            }
        }

        function markQuestion(qNum, isCorrect) {
            const subQuestionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
            subQuestionBtn?.classList.add(isCorrect ? 'correct' : 'incorrect');

            const elementsToMark = [
                document.querySelector(`.tf-question[data-q-start="${qNum}"]`),
                document.querySelector(`.multi-choice-question[data-q-start="${qNum}"]`),
                document.querySelector(`.matching-question-item[data-q-start="${qNum}"]`),
                document.querySelector(`.drop-zone[data-q-start="${qNum}"]`) || document.querySelector(`.drop-zone[data-question="${qNum}"]`),
                document.getElementById(`q${qNum}`),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.tf-option'),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.multi-choice-option')
            ];
            
            elementsToMark.forEach(el => {
                if (el) el.classList.add(isCorrect ? 'correct' : 'incorrect');
            });

             if (qNum === 14 || qNum === 15) {
                const multiChoiceContainer = document.querySelector('.multi-choice-question[data-q-start="14"]');
                if (multiChoiceContainer) multiChoiceContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
             } else if (qNum >= 1 && qNum <= 5) {
                const pMatchInput = document.getElementById(`q${qNum}`);
                if (pMatchInput) pMatchInput.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
        }

        function switchToPart(partNumber) {
            console.log(`🔀 switchToPart called with partNumber: ${partNumber}, currentPassage: ${currentPassage}`);
            
            currentPassage = partNumber;

            // Hide all passages and questions
            document.querySelectorAll('.reading-passage, .question-set, .part-header').forEach(el => {
                el.classList.add('hidden');
            });

            // Show the correct passage, questions, and header
            document.getElementById(`passage-text-${partNumber}`).classList.remove('hidden');
            document.getElementById(`questions-${partNumber}`).classList.remove('hidden');
            document.getElementById(`part-header-${partNumber}`).classList.remove('hidden');

            // Update bottom navigation 'selected' state
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.toggle('selected', (index + 1) === partNumber);
            });

            // Show/hide explanation buttons based on part
            const explanationButton = document.getElementById('show-explanation-btn');
            const explanationButtonPart3 = document.getElementById('show-explanation-btn-part3');
            
            if (explanationButton) {
                if (partNumber === 2) {
                    explanationButton.style.display = 'block';
                } else {
                    explanationButton.style.display = 'none';
                    // Hide explanation section when switching away from part 2
                    const explanationSection = document.getElementById('part-2-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButton.textContent = 'Show Explanation';
                        explanationButton.style.backgroundColor = '#4a90e2';
                    }
                }
            }
            
            if (explanationButtonPart3) {
                if (partNumber === 3) {
                    explanationButtonPart3.style.display = 'block';
                } else {
                    explanationButtonPart3.style.display = 'none';
                    // Hide explanation section when switching away from part 3
                    const explanationSection = document.getElementById('part-3-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButtonPart3.textContent = 'Show Explanation';
                        explanationButtonPart3.style.backgroundColor = '#4a90e2';
                    }
                }
            }

            console.log(`✅ switchToPart completed - switched to part ${partNumber}`);
            
            // Only go to first question when switching parts, not when staying in same part
            // This allows goToQuestion to work properly for specific question navigation
            // const firstQuestionOfPart = {1: 1, 2: 14, 3: 27}[partNumber];
            // goToQuestion(firstQuestionOfPart);
        }
        
        function goToQuestion(questionNumber) {
            console.log(`🎯 goToQuestion called with questionNumber: ${questionNumber}, currentQuestion: ${currentQuestion}, currentPassage: ${currentPassage}`);
            
            currentQuestion = questionNumber;

            let passageNumber = 1;
            if (questionNumber >= 14 && questionNumber <= 26) passageNumber = 2;
            else if (questionNumber >= 27) passageNumber = 3;
            
            console.log(`📍 Calculated passageNumber: ${passageNumber} for question ${questionNumber}`);
            
            if (currentPassage !== passageNumber) {
                console.log(`🔄 Switching from part ${currentPassage} to part ${passageNumber} for question ${questionNumber}`);
                switchToPart(passageNumber);
                return; 
            }

            console.log(`✅ Staying in same part (${currentPassage}) for question ${questionNumber}`);

            if (activeQuestionElement) {
                // Remove active style from previous block
                activeQuestionElement.classList.remove('active-question', 'active-input');
                // Also remove from the container block if we previously set it
                const prevBlock = activeQuestionElement.closest('[data-q-start]');
                if (prevBlock) prevBlock.classList.remove('active-question');
            }

            // First, try to find the specific input element for questions 33-36
            let targetEl = document.getElementById(`q${questionNumber}`);
            if (targetEl) {
                activeQuestionElement = targetEl;
                console.log(`✅ Found specific input element:`, targetEl);
                targetEl.classList.add('active-input');
                scrollIntoViewIfNeeded(targetEl);
            } else {
                // Fall back to looking for question containers
                targetEl = document.querySelector(`[data-q-start="${questionNumber}"]`) || document.querySelector(`[data-question="${questionNumber}"]`);
                console.log(`🔍 Looking for target element with data-q-start="${questionNumber}" or data-question="${questionNumber}":`, targetEl);

                if (targetEl) {
                    activeQuestionElement = targetEl;
                    console.log(`✅ Found target element:`, targetEl);
                    
                    if (targetEl.matches('input[type="text"]') || targetEl.matches('select')) {
                        targetEl.classList.add('active-input');
                        console.log(`📝 Added active-input class to input/select element`);
                    } else {
                        targetEl.classList.add('active-question');
                        console.log(`📋 Added active-question class to question element`);
                    }
                    scrollIntoViewIfNeeded(targetEl);
                } else {
                    console.log(`⚠️ Target element not found, looking for paragraph matching question`);
                    const pMatch = document.querySelector(`.paragraph-matching-question select[id="q${questionNumber}"]`);
                    if(pMatch) {
                        activeQuestionElement = pMatch;
                        pMatch.classList.add('active-input');
                        scrollIntoViewIfNeeded(pMatch);
                        console.log(`✅ Found paragraph matching question:`, pMatch);
                    } else {
                        console.log(`❌ No target element found for question ${questionNumber}`);
                    }
                }
            }

            updateNavigation();
            console.log(`✅ goToQuestion completed for question ${questionNumber}`);
        }
        
        // --- UI & NAVIGATION ---

        function updateNavigation() {
            console.log(`🔄 updateNavigation called for currentQuestion: ${currentQuestion}`);
            
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => btn.classList.remove('active'));
            const activeNav = document.querySelector(`.subQuestion[onclick="goToQuestion(${currentQuestion})"]`);
            if (activeNav) {
                activeNav.classList.add('active');
                console.log(`✅ Updated navigation - active nav button:`, activeNav);
            } else {
                console.log(`⚠️ No active navigation button found for question ${currentQuestion}`);
            }

            const inputs = document.querySelectorAll('.answer-input, .drop-zone.filled, .summary-drop-zone.filled');
            inputs.forEach(input => input.classList.remove('active-input'));
            
            const activeInput = document.getElementById(`q${currentQuestion}`);
            if (activeInput) {
                activeInput.classList.add('active-input');
                if (typeof activeInput.focus === 'function') {
                    activeInput.focus();
                }
                console.log(`✅ Focused on input element:`, activeInput);
            } else {
                console.log(`⚠️ No direct input found for question ${currentQuestion}, looking in question block`);
                // Prefer the specific question element for styling (TF/MCQ), fallback to any data-q-start or data-question container
                let activeQuestionBlock = document.querySelector(`.tf-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`.multi-choice-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`[data-q-start="${currentQuestion}"]`)
                    || document.querySelector(`[data-question="${currentQuestion}"]`);
                if (activeQuestionBlock) {
                    // Add active-question class to style number badge
                    activeQuestionBlock.classList.add('active-question');
                    const firstInput = activeQuestionBlock.querySelector('input, select');
                    if(firstInput) {
                        firstInput.classList.add('active-input');
                         if (typeof firstInput.focus === 'function') {
                            firstInput.focus();
                        }
                        console.log(`✅ Focused on input in question block:`, firstInput);
                    } else {
                        console.log(`⚠️ No input found in question block for question ${currentQuestion}`);
                    }
                } else {
                    console.log(`❌ No question block found for question ${currentQuestion}`);
                }
            }
            
            console.log(`✅ updateNavigation completed`);
        }
        
        function selectDragItem(item) {
            if (selectedDragItem) {
                selectedDragItem.classList.remove('selected');
            }
            selectedDragItem = item;
            if (selectedDragItem) {
                selectedDragItem.classList.add('selected');
            }
        }
        
        window.nextQuestion = () => currentQuestion < 40 && goToQuestion(currentQuestion + 1);
        window.previousQuestion = () => currentQuestion > 1 && goToQuestion(currentQuestion - 1);

        function updateAllIndicators() {
            updateAttemptedCount(1, 1, 13);
            updateAttemptedCount(2, 14, 26);
            updateAttemptedCount(3, 27, 40);
            updateAnsweredNav();
        }
        
            function updateAnsweredNav() {
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => {
                const qNum = parseInt(btn.textContent, 10);
                if (isQuestionAnswered(qNum)) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            });
        }
        
            function isQuestionAnswered(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            if (textInput && (textInput.value.trim() !== '' || (textInput.classList.contains('drop-zone') && textInput.children.length > 0))) {
                return true;
            }
            const radio = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (radio) {
                return true;
            }
            // Special handling for the combined checkbox group (Q20 & Q21)
            if (qNum === 20 || qNum === 21) {
                const checked = document.querySelectorAll('input[name="q20-21"]:checked');
                if (checked.length > 0) return true;
            }
            // Special handling for the checkbox group (Q24-26)
            if (qNum >= 24 && qNum <= 26) {
                const checked = document.querySelectorAll('input[name="q24"]:checked');
                if (checked.length > 0) return true;
            }
            // Special handling for the checkbox group (Q32-34)
            if (qNum >= 32 && qNum <= 34) {
                const checked = document.querySelectorAll('input[name^="q32"]:checked');
                if (checked.length > 0) return true;
            }
            // Handle drag & drop questions (e.g., 20-23, 27-32)
            const dz = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`) || document.querySelector(`.drop-zone[data-question="${qNum}"]`);
            if (dz && dz.querySelector('.drag-item')) {
                return true;
            }
            // Handle clickable-cell matrix questions (any question using clickable cells)
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return true;
            }
            return false;
        }

        function scrollIntoViewIfNeeded(element) {
            const panel = element.closest('.questions-panel, .passage-panel');
            const panelRect = panel.getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();
            if (elementRect.top < panelRect.top || elementRect.bottom > panelRect.bottom) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // --- DRAG AND DROP ---
        
        function initializeDragAndDrop() {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('click', () => selectDragItem(item));
            });
            
            // Special handling for questions 18-21 (matching people to statements)
            document.querySelectorAll('#drop18, #drop19, #drop20, #drop21').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleMatchingDrop);
                zone.addEventListener('dblclick', clearMatchingDropZone);
            });
            
            // General drag and drop for other questions
            document.querySelectorAll('.drop-zone:not(#drop18):not(#drop19):not(#drop20):not(#drop21), .drag-options-container').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            if (draggedItem && draggedItem.dataset.dndGroup === targetZone.dataset.dndGroup) {
                targetZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            targetZone.classList.remove('drag-over');

            if (!draggedItem || draggedItem.dataset.dndGroup !== targetZone.dataset.dndGroup) {
                return;
            }

            const sourceZone = draggedItem.parentElement;
            if (sourceZone === targetZone) return; // Prevent dropping on itself

            const existingItemInTarget = targetZone.classList.contains('drop-zone') 
                ? targetZone.querySelector('.drag-item') 
                : null;

            // First, clear the target drop-zone of any text (like question numbers) before adding the new item.
            if (targetZone.classList.contains('drop-zone')) {
                Array.from(targetZone.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        node.remove();
                    }
                });
            }

            // Move the item that was in the target (if any) to the source zone.
            if (existingItemInTarget) {
                sourceZone.appendChild(existingItemInTarget);
            }
            
            // Finally, move the dragged item to the target zone.
            targetZone.appendChild(draggedItem);
            targetZone.classList.add('filled');
            // Lock the pill-like appearance for items dropped into zones
            if (draggedItem) {
                draggedItem.style.cursor = 'default';
            }
            // Hide placeholder text (question number) once filled
            if (targetZone.textContent && /^\d+$/.test(targetZone.textContent.trim())) {
                targetZone.textContent = '';
            }

            // After the move, clean up the source zone if it's a drop-zone and is now empty.
            if (sourceZone.classList.contains('drop-zone') && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
                 const qNum = sourceZone.dataset.qStart;
                 sourceZone.innerText = qNum; // Restore the question number
            }
            
            updateAllIndicators();
        }

        // Special handling for questions 18-21 (matching people to statements)
        function handleMatchingDrop(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            targetZone.classList.remove('drag-over');

            if (!draggedItem) return;

            // Get the question number from the drop zone ID
            const questionNumber = targetZone.id.replace('drop', '');
            
            // Check if this drop zone is already filled
            if (targetZone.classList.contains('filled')) {
                const previousAnswer = targetZone.getAttribute('data-answer');
                const previousElement = document.querySelector(`[data-value="${previousAnswer}"]`);
                
                if (previousElement) {
                    previousElement.classList.remove('used');
                    previousElement.setAttribute('draggable', 'true');
                    previousElement.style.display = 'block';
                }
            }

            // Update the drop zone content
            targetZone.textContent = draggedItem.textContent;
            targetZone.classList.add('filled');
            targetZone.setAttribute('data-answer', draggedItem.getAttribute('data-value'));
            
            // Hide the dragged element completely (remove from options list)
            draggedItem.style.display = 'none';
            draggedItem.classList.add('used');
            draggedItem.setAttribute('draggable', 'false');
            
            // Update the corresponding hidden input
            const inputElement = document.getElementById(`q${questionNumber}`);
            if (inputElement) {
                inputElement.value = draggedItem.getAttribute('data-value');
            }
            
            console.log(`Dropped ${draggedItem.getAttribute('data-value')} on question ${questionNumber}`);
            updateAllIndicators();
        }

        // Function to clear drop zones by double-clicking (for questions 18-21)
        function clearMatchingDropZone(event) {
            if (event.target.classList.contains('drop-zone') && event.target.classList.contains('filled')) {
                const questionNumber = event.target.id.replace('drop', '');
                const answer = event.target.getAttribute('data-answer');
                const draggedElement = document.querySelector(`[data-value="${answer}"]`);
                
                if (draggedElement) {
                    // Reset the drop zone
                    event.target.textContent = '';
                    event.target.classList.remove('filled');
                    event.target.removeAttribute('data-answer');
                    
                    // Show the dragged element back in options list
                    draggedElement.classList.remove('used');
                    draggedElement.setAttribute('draggable', 'true');
                    draggedElement.style.display = 'block';
                    
                    // Clear the corresponding hidden input
                    const inputElement = document.getElementById(`q${questionNumber}`);
                    if (inputElement) {
                        inputElement.value = '';
                    }
                    
                    updateAllIndicators();
                }
            }
        }
        
        // --- MISC HELPERS ---
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval); // Ensure no multiple intervals
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    // checkAnswers(); // Disabled to prevent modal from opening automatically.
                }
            }, 1000);
            timerToggleButton.innerHTML = pauseIcon;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerToggleButton.innerHTML = playIcon;
        }

        function toggleTimer() {
            // Check based on the icon currently displayed
            if (timerToggleButton.innerHTML.includes('M6 19h4V5H6v14z')) { // Check for pause icon shape
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function resetTimer() {
            timeInSeconds = 3600;
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            startTimer();
            timerToggleButton.innerHTML = pauseIcon;
        }
        
        function setupCheckboxLimits() {
            const checkboxGroups = [
                { name: 'q20-21', limit: 2 },
                { name: 'q32', limit: 3, pattern: 'q32[A-F]' },
                { name: 'q38-40', limit: 3 },
                { name: 'q24', limit: 3 }
            ];
            checkboxGroups.forEach(group => {
                let checkboxes;
                if (group.pattern) {
                    // Use regex pattern for questions like 32-34
                    checkboxes = document.querySelectorAll(`input[name^="${group.name.replace(/[A-F]$/, '')}"]`);
                } else {
                    checkboxes = document.querySelectorAll(`input[name="${group.name}"]`);
                }
                
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        let checkedCount;
                        if (group.pattern) {
                            checkedCount = document.querySelectorAll(`input[name^="${group.name.replace(/[A-F]$/, '')}"]:checked`).length;
                        } else {
                            checkedCount = document.querySelectorAll(`input[name="${group.name}"]:checked`).length;
                        }
                        
                        if (checkedCount >= group.limit) {
                            // Disable all unchecked checkboxes
                            checkboxes.forEach(cb => {
                                if (!cb.checked) {
                                    cb.disabled = true;
                                    cb.parentElement.style.opacity = '0.5';
                                    cb.parentElement.style.cursor = 'not-allowed';
                                }
                            });
                        } else {
                            // Enable all checkboxes
                            checkboxes.forEach(cb => {
                                cb.disabled = false;
                                cb.parentElement.style.opacity = '1';
                                cb.parentElement.style.cursor = 'pointer';
                            });
                        }
                        
                        if (checkedCount > group.limit) {
                            checkbox.checked = false;
                        }
                        
                        updateAllIndicators();
                    });
                });
            });
        }

        function setupExampleHeading() {
            const exampleBox = document.querySelector('.example-box');
            if(exampleBox){
                const title = document.createElement('p');
                title.style.fontWeight = 'bold';
                title.textContent = 'List of Statements';
                // exampleBox.insertBefore(title, exampleBox.firstChild);
            }
        }
        
        function initResize(e) {
            e.preventDefault();
            const startX = e.clientX;
            const startWidth = passagePanel.offsetWidth;
            
            const doDrag = (e) => {
                const newWidth = startWidth + e.clientX - startX;
                if (newWidth > 200 && (document.body.clientWidth - newWidth - resizer.offsetWidth) > 200) {
                    passagePanel.style.flex = `0 0 ${newWidth}px`;
                }
            };
            const stopDrag = () => {
                window.removeEventListener('mousemove', doDrag, false);
                window.removeEventListener('mouseup', stopDrag, false);
            };
            
            window.addEventListener('mousemove', doDrag, false);
            window.addEventListener('mouseup', stopDrag, false);
        }
        
        // --- CONTEXT MENU (Highlighting) ---
        
        function initializeContextMenu() {
            const panels = [passagePanel, questionsPanel];
            let targetElementForClear = null;

            // This listener simply tracks the last valid text selection in either panel.
            document.addEventListener('selectionchange', () => {
                const selection = window.getSelection();
                if (selection && !selection.isCollapsed && selection.toString().trim().length > 0) {
                    const range = selection.getRangeAt(0);
                    if (panels.some(panel => panel.contains(range.commonAncestorContainer))) {
                        selectedRange = range;
                        targetElementForClear = null; // New selection overrides clearing a specific element
                    }
                }
            });

            const showContextMenu = (e) => {
                const target = e.target;
                const isClickOnHighlight = target.closest('.highlight, .comment-highlight');
                const isSelectionActive = selectedRange && selectedRange.toString().trim().length > 0;
                
                let showMenu = false;

                if (isClickOnHighlight) {
                    document.getElementById('menu-highlight').style.display = 'none';
                    document.getElementById('menu-note').style.display = 'none';
                    document.getElementById('menu-clear').style.display = 'block';
                    document.getElementById('menu-clear-all').style.display = 'block';
                    contextMenu.targetElementForClear = isClickOnHighlight;
                    showMenu = true;
                } else if (isSelectionActive && panels.some(panel => panel.contains(selectedRange.commonAncestorContainer))) {
                    document.getElementById('menu-highlight').style.display = 'flex';
                    document.getElementById('menu-note').style.display = 'flex';
                    document.getElementById('menu-clear').style.display = 'none';
                    document.getElementById('menu-clear-all').style.display = 'block'; // Always show clear all
                    showMenu = true;
                }

                if (showMenu) {
                    e.preventDefault();
                    contextMenu.style.display = 'block';
                    const menuHeight = contextMenu.offsetHeight;
                    const menuWidth = contextMenu.offsetWidth;
                    let left = e.pageX;
                    let top = e.pageY;
                    if (left + menuWidth > window.innerWidth) left = window.innerWidth - menuWidth - 5;
                    if (top + menuHeight > window.innerHeight) top = e.pageY - menuHeight - 5;
                    else top = e.pageY - menuHeight - 5;
                    
                    contextMenu.style.left = `${left}px`;
                    contextMenu.style.top = `${top}px`;
                }
            };

            panels.forEach(panel => {
                panel.addEventListener('contextmenu', showContextMenu);
            });

            document.addEventListener('click', (e) => {
                if (contextMenu.style.display === 'block' && !contextMenu.contains(e.target)) {
                    closeContextMenu();
                }
            });
        }

        function closeContextMenu() {
            contextMenu.style.display = 'none';
            selectedRange = null; // Clear range after menu closes
        }

        function unwrapElement(element) {
            const parent = element.parentNode;
            if (!parent) return;
            while (element.firstChild) {
                parent.insertBefore(element.firstChild, element);
            }
            parent.removeChild(element);
            parent.normalize();
        }

        window.highlightText = () => {
            if (selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'highlight';
                span.appendChild(selectedRange.extractContents());
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.addNote = () => {
            const note = prompt('Enter your note:');
            if (note && selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = note;
                span.appendChild(selectedRange.extractContents());
                span.appendChild(tooltip);
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.clearHighlight = () => {
             const elementToClear = contextMenu.targetElementForClear;
             if (elementToClear) {
                 unwrapElement(elementToClear);
             }
             closeContextMenu();
             window.getSelection().removeAllRanges();
        };
        
        window.clearAllHighlights = () => {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(unwrapElement);
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        function updateAttemptedCount(part, startQ, endQ) {
            let answeredCount = 0;
            for (let i = startQ; i <= endQ; i++) {
                if (isQuestionAnswered(i)) {
                    answeredCount++;
                }
            }
            const partHeader = document.querySelector(`.footer__questionNo___3WNct[onclick="switchToPart(${part})"]`);
            if (partHeader) {
                const countSpan = partHeader.querySelector('.attemptedCount');
                if (countSpan) {
                     countSpan.textContent = `${answeredCount} of ${endQ - startQ + 1}`;
                }
            }
        }

        // --- GLOBAL FUNCTION EXPOSURE ---
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.goToQuestion = goToQuestion;
        window.switchToPart = switchToPart;
        window.closeResultsModal = closeResultsModal;
        window.highlightText = highlightText;
        window.addNote = addNote;
        window.clearHighlight = clearHighlight;
        window.clearAllHighlights = clearAllHighlights;
        
        // Explanation toggle function for Part 2
        window.toggleExplanation = function() {
            const explanationSection = document.getElementById('part-2-explanation');
            const button = document.getElementById('show-explanation-btn');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };
        
        // Explanation toggle function for Part 3
        window.toggleExplanationPart3 = function() {
            const explanationSection = document.getElementById('part-3-explanation');
            const button = document.getElementById('show-explanation-btn-part3');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };

        // --- START THE APP ---
        initialize();

        // Add event listeners for table radio buttons
        document.addEventListener('DOMContentLoaded', function() {
            const tableRadios = document.querySelectorAll('.table-radio');
            tableRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // Remove background color from all cells in the same row
                    const row = this.closest('tr');
                    const cells = row.querySelectorAll('td:not(.statement)');
                    cells.forEach(cell => {
                        cell.style.backgroundColor = '';
                    });
                    
                    // Add background color to the selected cell
                    if (this.checked) {
                        this.closest('td').style.backgroundColor = '#e3f2fd';
                    }
                    
                    updateAllIndicators();
                });
            });
            

        });

        // Global function for selecting cells
        window.selectCell = function(cell, questionNum, value) {
            console.log('selectCell called:', questionNum, value);
            
            // Remove selected class from all cells in the same row
            const row = cell.closest('tr');
            const cellsInRow = row.querySelectorAll('.clickable-cell');
            cellsInRow.forEach(c => {
                c.classList.remove('selected');
                c.removeAttribute('data-selected');
                c.removeAttribute('data-answer');
            });
            
            // Add selected class to clicked cell
            cell.classList.add('selected');
            cell.setAttribute('data-selected', 'true');
            cell.setAttribute('data-answer', value);
            
            console.log('Cell selected:', questionNum, value);
            updateAllIndicators();
        };



        // Note: switchToPart function is defined earlier in the code
        // This duplicate function has been removed to prevent conflicts

        // Drag and Drop Functions for Questions 14-20 and 27-32
        window.drag = function(event) {
            // Only allow dragging if the element is visible
            if (event.target.style.display === 'none') {
                event.preventDefault();
                return false;
            }
            event.dataTransfer.setData("text", event.target.getAttribute('data-value'));
            event.target.classList.add('dragging');
        };

        window.allowDrop = function(event) {
            event.preventDefault();
            event.target.classList.add('drag-over');
        };

        window.dragFromZone = function(event) {
            if (event.target.classList.contains('filled')) {
                const headingId = event.target.getAttribute('data-answer');
                event.dataTransfer.setData("text", headingId);
                event.dataTransfer.setData("source", "zone");
                event.dataTransfer.setData("sourceParagraph", event.target.getAttribute('data-paragraph'));
                event.target.classList.add('dragging');
            } else {
                event.preventDefault();
                return false;
            }
        };

        window.drop = function(event) {
            event.preventDefault();
            event.target.classList.remove('drag-over');
            
            const headingId = event.dataTransfer.getData("text");
            const source = event.dataTransfer.getData("source");
            const sourceParagraph = event.dataTransfer.getData("sourceParagraph");
            const dropZone = event.target;
            const paragraph = dropZone.getAttribute('data-paragraph');
            const questionNumber = dropZone.getAttribute('data-question');
            
            // Handle both paragraph drop zones (passage side) and question drop zones (question side)
            if (dropZone.classList.contains('paragraph-drop-zone')) {
                // This is a paragraph drop zone (passage side)
                if (!paragraph) return;
                
                // Find the dragged element (from options list)
                const draggedElement = document.querySelector(`[data-value="${headingId}"]`);
                
                if (source === "zone") {
                    // Dragging from zone to zone (swapping)
                    const sourceZone = document.querySelector(`[data-paragraph="${sourceParagraph}"]`);
                    const currentAnswer = dropZone.getAttribute('data-answer');
                    
                    if (currentAnswer && currentAnswer !== headingId) {
                        // Swap the items
                        const currentElement = document.querySelector(`[data-value="${currentAnswer}"]`);
                        
                        // Move current item to source zone
                        sourceZone.textContent = currentElement.textContent;
                        sourceZone.setAttribute('data-answer', currentAnswer);
                        
                        // Update inputs for Questions 27-32
                        const sourceInput = document.getElementById(`q${27 + ['A','B','C','D','E','F'].indexOf(sourceParagraph)}`);
                        if (sourceInput) sourceInput.value = currentAnswer;
                    } else {
                        // Clear source zone if no swap needed
                        sourceZone.textContent = sourceParagraph;
                        sourceZone.classList.remove('filled');
                        sourceZone.removeAttribute('data-answer');
                        sourceZone.setAttribute('draggable', 'false');
                        
                        // Clear source input for Questions 27-32
                        const sourceInput = document.getElementById(`q${27 + ['A','B','C','D','E','F'].indexOf(sourceParagraph)}`);
                        if (sourceInput) sourceInput.value = '';
                    }
                    
                    // Update drop zone
                    if (draggedElement) {
                        dropZone.textContent = draggedElement.textContent;
                        dropZone.classList.add('filled');
                        dropZone.setAttribute('data-answer', headingId);
                        dropZone.setAttribute('draggable', 'true');
                    }
                    
                } else {
                    // Dragging from options list to zone
                    if (draggedElement) {
                        // Check if this drop zone already has an answer
                        const previousAnswer = dropZone.getAttribute('data-answer');
                        if (previousAnswer && previousAnswer !== headingId) {
                            // Return the previous option to the options list
                            const previousElement = document.querySelector(`[data-value="${previousAnswer}"]`);
                            if (previousElement) {
                                previousElement.classList.remove('used');
                                previousElement.setAttribute('draggable', 'true');
                                previousElement.style.display = 'block';
                            }
                        }
                        
                        // Update the drop zone content
                        dropZone.textContent = draggedElement.textContent;
                        dropZone.classList.add('filled');
                        dropZone.setAttribute('data-answer', headingId);
                        dropZone.setAttribute('draggable', 'true');
                        
                        // Hide the dragged element completely (remove from options list)
                        draggedElement.style.display = 'none';
                        draggedElement.classList.add('used');
                        draggedElement.setAttribute('draggable', 'false');
                    }
                }
                
                // Update the corresponding input for Questions 27-32
                const inputElement = document.getElementById(`q${27 + ['A','B','C','D','E','F'].indexOf(paragraph)}`);
                if (inputElement) {
                    inputElement.value = headingId;
                }
                
                console.log(`Dropped ${headingId} on paragraph ${paragraph}`);
                
            } else if (dropZone.classList.contains('drop-zone') && questionNumber) {
                // This is a question drop zone (question side)
                const draggedElement = document.querySelector(`[data-value="${headingId}"]`);
                
                if (draggedElement) {
                    // Check if this drop zone already has an answer
                    const previousAnswer = dropZone.getAttribute('data-answer');
                    if (previousAnswer && previousAnswer !== headingId) {
                        // Return the previous option to the options list
                        const previousElement = document.querySelector(`[data-value="${previousAnswer}"]`);
                        if (previousElement) {
                            previousElement.classList.remove('used');
                            previousElement.setAttribute('draggable', 'true');
                            previousElement.style.display = 'block';
                        }
                    }
                    
                    // Update the drop zone content
                    dropZone.textContent = draggedElement.textContent;
                    dropZone.classList.add('filled');
                    dropZone.setAttribute('data-answer', headingId);
                    
                    // Hide the dragged element completely (remove from options list)
                    draggedElement.style.display = 'none';
                    draggedElement.classList.add('used');
                    draggedElement.setAttribute('draggable', 'false');
                    
                    // Update the corresponding hidden input
                    const inputElement = document.getElementById(`q${questionNumber}`);
                    if (inputElement) {
                        inputElement.value = headingId;
                    }
                    
                    console.log(`Dropped ${headingId} on question ${questionNumber}`);
                }
            }
            
            updateAllIndicators();
        };

        // Remove drag-over class when drag leaves
        document.addEventListener('dragleave', function(event) {
            if (event.target.classList.contains('paragraph-drop-zone') || event.target.classList.contains('drop-zone')) {
                event.target.classList.remove('drag-over');
            }
        });

        // Remove dragging class when drag ends
        document.addEventListener('dragend', function(event) {
            if (event.target.classList.contains('drag-item')) {
                event.target.classList.remove('dragging');
            }
        });

        // Allow clearing drop zones by double-clicking
        document.addEventListener('dblclick', function(event) {
            if (event.target.classList.contains('paragraph-drop-zone') && event.target.classList.contains('filled')) {
                const headingId = event.target.getAttribute('data-answer');
                const draggedElement = document.querySelector(`[data-value="${headingId}"]`);
                
                if (draggedElement) {
                    // Reset the drop zone
                    const paragraph = event.target.getAttribute('data-paragraph');
                    const questionNumber = 27 + ['A','B','C','D','E','F'].indexOf(paragraph);
                    event.target.textContent = paragraph;
                    event.target.classList.remove('filled');
                    event.target.removeAttribute('data-answer');
                    
                    // Show the dragged element back in options list
                    draggedElement.classList.remove('used');
                    draggedElement.setAttribute('draggable', 'true');
                    draggedElement.style.display = 'block';
                    
                    // Clear the corresponding input
                    const inputElement = document.getElementById(`q${questionNumber}`);
                    if (inputElement) {
                        inputElement.value = '';
                    }
                    
                    updateAllIndicators();
                }
            } else if (event.target.classList.contains('drop-zone') && event.target.classList.contains('filled') && event.target.getAttribute('data-question')) {
                // Clear question drop zones (Questions 27-32)
                const headingId = event.target.getAttribute('data-answer');
                const draggedElement = document.querySelector(`[data-value="${headingId}"]`);
                
                if (draggedElement) {
                    // Reset the drop zone
                    const questionNumber = event.target.getAttribute('data-question');
                    event.target.textContent = '';
                    event.target.classList.remove('filled');
                    event.target.removeAttribute('data-answer');
                    
                    // Show the dragged element back in options list
                    draggedElement.classList.remove('used');
                    draggedElement.setAttribute('draggable', 'true');
                    draggedElement.style.display = 'block';
                    
                    // Clear the corresponding hidden input
                    const inputElement = document.getElementById(`q${questionNumber}`);
                    if (inputElement) {
                        inputElement.value = '';
                    }
                    
                    updateAllIndicators();
                }
            }
        });
    });
    </script>
</body>
</html>