<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Reading Passage 3 ‚Äì Insight or evolution?</title>
<style>
  :root{--brand:#2563eb;--ink:#111827;--bg:#f7f7fb;--ok:#16a34a;--bad:#dc2626;--muted:#6b7280}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#111}
  .container{display:flex;gap:20px;max-width:1200px;margin:0 auto;padding:20px 20px 96px}
  .card{background:#fff;border-radius:12px;box-shadow:0 4px 14px rgba(0,0,0,.08);padding:20px;overflow:auto;max-height:90vh}
  .passage{flex:1}
  .questions{flex:1}
  h1{color:var(--ink);border-bottom:2px solid var(--brand);padding-bottom:10px;margin:0 0 14px}
  h2{color:var(--brand);margin:22px 0 10px}
  h3{margin:8px 0 0}
  .muted{color:var(--muted)}

  /* Timer */
  .timerWrap{position:fixed;top:16px;right:16px;display:flex;align-items:center;gap:8px;z-index:10}
  .timer{background:var(--brand);color:#fff;padding:10px 14px;border-radius:8px;font-weight:700}
  .tbtn{border:1px solid #e5e7eb;background:#fff;color:#111;padding:8px 10px;border-radius:8px;cursor:pointer}

  /* Questions */
  .qsection{margin:14px 0 6px}
  .qblock{padding:14px;border:1px solid #e5e7eb;border-radius:12px;margin:12px 0}
  .qhead{font-weight:600;margin-bottom:8px}
  .options{margin-top:8px}
  .options label{display:block;margin:6px 0}
  select,input[type="text"]{padding:8px;border-radius:8px;border:1px solid #e5e7eb;width:100%;max-width:520px}
  .submit{background:var(--brand);color:#fff;border:0;padding:12px 18px;border-radius:8px;cursor:pointer;font-size:16px;margin-top:16px}
  .submit:hover{filter:brightness(.95)}

  /* Results */
  .results{display:none;margin-top:18px;background:#f8f9fa;border-radius:10px;padding:16px}
  .results ul{list-style:none;padding:0;margin:8px 0 0}
  .results li{margin:6px 0;padding:8px;border-radius:8px}
  .results li.ok{background:#ecfdf5;color:#065f46}
  .results li.bad{background:#fef2f2;color:#991b1b}
  .results .meta{font-size:13px;color:var(--muted)}

  /* Footer chips */
  .footerNav{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #e5e7eb;padding:10px 12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;z-index:9}
  .chip{border:1px solid #d1d5db;background:#fff;color:#111;padding:6px 10px;border-radius:999px;cursor:pointer;font-size:14px}
  .chip.answered{border-color:#9ca3af;background:#f3f4f6}

  /* Highlights */
  .palette{position:fixed;background:#fff;padding:8px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.12);display:none;z-index:9}
  .hbtn{background:var(--brand);color:#fff;border:0;padding:6px 10px;border-radius:6px;margin:4px 4px 0 0;cursor:pointer}
  .highlight{background:yellow}

  .tg{position:fixed;bottom:96px;right:16px;background:#0088cc;color:#fff;border:0;padding:12px 16px;border-radius:9999px;display:flex;align-items:center;gap:8px;cursor:pointer;box-shadow:0 8px 20px rgba(0,136,204,.35)}
</style>
</head>
<body>
  <div class="timerWrap">
    <div class="timer" id="timer">20:00</div>
    <button class="tbtn" id="pauseBtn">‚è∏Ô∏è Pause</button>
    <button class="tbtn" id="resumeBtn" disabled>‚ñ∂Ô∏è Resume</button>
  </div>

  <!-- Highlight palettes -->
  <div class="palette" id="pPalette">
    <button class="hbtn" data-color="yellow">Yellow</button>
    <button class="hbtn" data-color="lightgreen">Green</button>
    <button class="hbtn" data-color="lightblue">Blue</button>
    <button class="hbtn" data-color="pink">Pink</button>
    <button class="hbtn" data-color="orange">Orange</button>
    <button class="hbtn" id="clearPMarks">Clear</button>
  </div>
  <div class="palette" id="qPalette">
    <button class="hbtn" data-color="yellow">Yellow</button>
    <button class="hbtn" data-color="lightgreen">Green</button>
    <button class="hbtn" data-color="lightblue">Blue</button>
    <button class="hbtn" data-color="pink">Pink</button>
    <button class="hbtn" data-color="orange">Orange</button>
    <button class="hbtn" id="clearQMarks">Clear</button>
  </div>

  <div class="container">
    <div class="card passage" id="passageCard">
      <h1 id="title"></h1>
      <div id="subtitle" class="muted"></div>

      <div id="passage">
        <h2>Reading Passage 3</h2>
        <h3>Insight or evolution?</h3>
        <h4>Two scientists consider the origins of discoveries and other innovative behavior</h4>

        <p>Scientific discovery is popularly believed to result from the sheer genius of such intellectual stars as naturalist Charles Darwin and theoretical physicist Albert Einstein. Our view of such unique contributions to science often disregards the person's prior experience and the efforts of their lesser-known predecessors. Conventional wisdom also places great weight on insight in promoting breakthrough scientific achievements, as if ideas spontaneously pop into someone's head ‚Äî fully formed and functional.</p>

        <p>There may be some limited truth to this view. However, we believe that it largely misrepresents the real nature of scientific discovery, as well as that of creativity and innovation in many other realms of human endeavor.</p>

        <p>Setting aside such greats as Darwin and Einstein ‚Äî whose monumental contributions are duly celebrated ‚Äî we suggest that innovation is more a process of trial and error, where two steps forward may sometimes come with one step back, as well as one or more steps to the right or left. This evolutionary view of human innovation undermines the notion of creative genius and recognizes the cumulative nature of scientific progress.</p>

        <p>Consider one unheralded scientist: <strong>John Nicholson</strong>, a mathematical physicist working in the 1910s who postulated the existence of "proto-elements" in outer space. By combining different numbers of weights of these proto-elements' atoms, Nicholson could recover the weights of all the elements in the then-known periodic table. These successes are all the more noteworthy given the fact that Nicholson was wrong about the presence of proto-elements: they do not actually exist. Yet, amid his often fanciful theories and wild speculations, Nicholson also proposed a novel theory about the structure of atoms. <strong>Niels Bohr</strong>, the Nobel prize-winning father of modern atomic theory, jumped off from this interesting idea to conceive his now-famous model of the atom.</p>

        <p>What are we to make of this story? One might simply conclude that science is a collective and cumulative enterprise. That may be true, but there may be a deeper insight to be gleaned. We propose that science is constantly evolving, much as species of animals do. In biological systems, organisms may display new characteristics that result from random genetic mutations. In the same way, random, arbitrary or accidental mutations of ideas may help pave the way for advances in science. If mutations prove beneficial, then the animal or the scientific theory will continue to thrive and perhaps reproduce.</p>

        <p>Support for this evolutionary view of behavioral innovation comes from many domains. Consider one example of an influential innovation in US horseracing. The so-called '<strong>acey-deucy</strong>' stirrup placement, in which the rider's foot in his left stirrup is placed as much as 25 centimeters lower than the right, is believed to confer important speed advantages when turning on oval tracks. It was developed by a relatively unknown jockey named <strong>Jackie Westrope</strong>. Had Westrope conducted methodical investigations or examined extensive film records in a shrewd plan to outrun his rivals? Had he foreseen the speed advantage that would be conferred by riding acey-deucy? No. He suffered a leg injury, which left him unable to fully bend his left knee. His modification just happened to coincide with enhanced left-hand turning performance. This led to the rapid and widespread adoption of riding acey-deucy by many riders, a racing style which continues in today's thoroughbred racing.</p>

        <p>Plenty of other stories show that fresh advances can arise from error, misadventure, and also pure serendipity ‚Äî a happy accident. For example, in the early 1970s, two employees of the company 3M each had a problem: <strong>Spencer Silver</strong> had a product ‚Äî a glue which was only slightly sticky ‚Äî and no use for it, while his colleague <strong>Art Fry</strong> was trying to figure out how to affix temporary bookmarks in his hymn book without damaging its pages. The solution to both these problems was the invention of the brilliantly simple yet phenomenally successful Post-It note.</p>

        <p>Such examples give lie to the claim that ingenious, designing minds are responsible for human creativity and invention. Far more banal and mechanical forces may be at work; forces that are fundamentally connected to the laws of science.</p>

        <p>The notions of insight, creativity and genius are often invoked, but they remain vague and of doubtful scientific utility, especially when one considers the diverse and enduring contributions of individuals such as Plato, Leonardo da Vinci, Shakespeare, Beethoven, Galileo, Newton, Kepler, Curie, Pasteur and Edison. These notions merely label rather than explain the evolution of human innovations. We need another approach, and there is a promising candidate.</p>

        <p><strong>The Law of Effect</strong> was advanced by psychologist <strong>Edward Thorndike</strong> in 1898, some 40 years after Charles Darwin published his groundbreaking work on biological evolution, <em>On the Origin of Species</em>. This simple law holds that organisms tend to repeat successful behaviors and to refrain from performing unsuccessful ones. Just like Darwin's Law of Natural Selection, the Law of Effect involves an entirely mechanical process of variation and selection, without any end objective in sight.</p>

        <p>Of course, the origin of human innovation demands much further study. In particular, the provenance of the raw material on which the Law of Effect operates is not as clearly known as that of the genetic mutations on which the Law of Natural Selection operates. The generation of novel ideas and behaviors may not be entirely random, but constrained by prior successes and failures ‚Äî of the current individual (such as Bohr) or of predecessors (such as Nicholson).</p>

        <p>The time seems right for abandoning the naive notions of intelligent design and genius, and for scientifically exploring the true origins of creative behavior.</p>
      </div>
    </div>

    <div class="card questions">
      <h1>Questions</h1>
      <div id="qroot"></div>
      <button class="submit" id="submitBtn">Submit Answers</button>
      <div class="results" id="results">
        <h2>Your Results</h2>
        <div id="score" class="meta"></div>
        <ul id="answers"></ul>
      </div>
    </div>
  </div>

  <div class="footerNav" id="footerNav"></div>
  <button class="tg" id="tgBtn">üì¢ Join my Telegram</button>

<script>
/* =======================
   CONFIG
   ======================= */
const CONFIG = {
  title: "READING PASSAGE 3 ‚Äì Insight or evolution?",
  subtitle: "You should spend about 20 minutes on Questions 27‚Äì40.",
  durationMinutes: 20,
  telegramLink: "https://t.me/yourchannel",
  showFooterNavigator: true,

  sections: [
    /* 27‚Äì31 MCQ */
    {
      type: "mcq",
      heading: "Questions 27‚Äì31",
      instructions: ["Choose the correct letter, A, B, C or D."],
      items: [
        { id: 27, text: "The purpose of the first paragraph is to", options:{
          A:"defend particular ideas.",
          B:"compare certain beliefs.",
          C:"disprove a widely held view.",
          D:"outline a common assumption."
        }, correct: "D" },
        { id: 28, text: "What are the writers doing in the second paragraph?", options:{
          A:"criticising an opinion",
          B:"justifying a standpoint",
          C:"explaining an approach",
          D:"supporting an argument"
        }, correct: "C" },
        { id: 29, text: "In the third paragraph, what do the writers suggest about Darwin and Einstein?", options:{
          A:"They represent an exception to a general rule.",
          B:"Their way of working has been misunderstood.",
          C:"They are an ideal which others should aspire to.",
          D:"Their achievements deserve greater recognition."
        }, correct: "A" },
        { id: 30, text: "John Nicholson is an example of a person whose idea", options:{
          A:"established his reputation as an influential scientist.",
          B:"was only fully understood at a later point in history.",
          C:"laid the foundations for someone else's breakthrough.",
          D:"initially met with scepticism from the scientific community."
        }, correct: "C" },
        { id: 31, text: "What is the key point of interest about the 'acey-deucy' stirrup placement?", options:{
          A:"the simple reason why it was invented",
          B:"the enthusiasm with which it was adopted",
          C:"the research that went into its development",
          D:"the cleverness of the person who first used it"
        }, correct: "A" }
      ]
    },

    /* 32‚Äì36 YES/NO/NOT GIVEN */
    {
      type: "yesno",
      heading: "Questions 32‚Äì36",
      instructions: [
        "Do the following statements agree with the claims of the writer in Reading Passage 3?",
        "YES if the statement agrees with the claims of the writer",
        "NO if the statement contradicts the claims of the writer",
        "NOT GIVEN if it is impossible to say what the writer thinks about this"
      ],
      items: [
        { id: 32, text: "Acknowledging people such as Plato or da Vinci as geniuses will help us understand the process by which great minds create new ideas.", correct: "NO" },
        { id: 33, text: "The Law of Effect was discovered at a time when psychologists were seeking a scientific reason why creativity occurs.", correct: "NOT GIVEN" },
        { id: 34, text: "The Law of Effect states that no planning is involved in the behaviour of organisms.", correct: "YES" },
        { id: 35, text: "The Law of Effect sets out clear explanations about the sources of new ideas and behaviours.", correct: "NO" },
        { id: 36, text: "Many scientists are now turning away from the notion of intelligent design and genius.", correct: "YES" }
      ]
    },

    /* 37‚Äì40 Summary completion */
    {
      type: "summary",
      heading: "Questions 37‚Äì40",
      instructions: [
        "Complete the summary using the list of words, A‚ÄìG, below."
      ],
      text: "The traditional view of scientific discovery is that breakthroughs happen when a single great mind has sudden 37 _____. Although this can occur, it is not often the case. Advances are more likely to be the result of a longer process. In some cases, this process involves 38 _____, such as Nicholson's theory about proto-elements. In others, simple necessity may provoke innovation, as with Westrope's decision to modify the position of his riding stirrups. There is also often an element of 39 _____, for example, the coincidence of ideas that led to the invention of the Post-It note. With both the Law of Natural Selection and the Law of Effect, there may be no clear 40 _____ involved, but merely a process of variation and selection.",
      options: {
        A: "invention",
        B: "goals", 
        C: "compromise",
        D: "mistakes",
        E: "luck",
        F: "inspiration",
        G: "experiments"
      },
      items: [
        { id: 37, correct: "F" },
        { id: 38, correct: "D" },
        { id: 39, correct: "E" },
        { id: 40, correct: "B" }
      ]
    }
  ]
};

/* =======================
   RENDER
   ======================= */
document.getElementById('title').textContent = CONFIG.title;
document.getElementById('subtitle').textContent = CONFIG.subtitle || '';

const qroot = document.getElementById('qroot');
const navIds = [];
const answersMap = {};

function sectionHeader(t){ const h=document.createElement('h2'); h.className='qsection'; h.textContent=t; return h; }

/* MCQ renderer */
function renderMCQ(sec){
  qroot.appendChild(sectionHeader(sec.heading));
  (sec.instructions||[]).forEach(tx=>{ const p=document.createElement('p'); p.className='muted'; p.textContent=tx; qroot.appendChild(p); });
  sec.items.forEach(it=>{
    const b=document.createElement('div'); b.className='qblock'; b.id=`anchor-${it.id}`;
    const opts=Object.entries(it.options).map(([k,v])=>`<label><input type="radio" name="q${it.id}" value="${k}"> ${k}. ${v}</label>`).join('');
    b.innerHTML=`<div class="qhead"><strong>${it.id}.</strong> ${it.text}</div><div class="options">${opts}</div>`;
    qroot.appendChild(b); navIds.push(it.id); answersMap[it.id]=it.correct||'';
  });
}

/* YES/NO/NOT GIVEN renderer */
function renderYesNo(sec){
  qroot.appendChild(sectionHeader(sec.heading));
  (sec.instructions||[]).forEach(tx=>{ const p=document.createElement('p'); p.className='muted'; p.textContent=tx; qroot.appendChild(p); });
  
  sec.items.forEach(it=>{
    const b=document.createElement('div'); b.className='qblock'; b.id=`anchor-${it.id}`;
    const opts=['YES','NO','NOT GIVEN'].map(v=>`<label><input type="radio" name="q${it.id}" value="${v}"> ${v}</label>`).join('');
    b.innerHTML=`<div class="qhead"><strong>${it.id}.</strong> ${it.text}</div><div class="options">${opts}</div>`;
    qroot.appendChild(b); navIds.push(it.id); answersMap[it.id]=it.correct||'';
  });
}

/* Summary completion renderer */
function renderSummary(sec){
  qroot.appendChild(sectionHeader(sec.heading));
  (sec.instructions||[]).forEach(tx=>{ const p=document.createElement('p'); p.className='muted'; p.textContent=tx; qroot.appendChild(p); });
  
  const summaryBlock=document.createElement('div'); summaryBlock.className='qblock';
  summaryBlock.innerHTML=`<div class="qhead"><strong>The origins of creative behaviour</strong></div>
    <div>${sec.text}</div>`;
  qroot.appendChild(summaryBlock);
  
  const optionsBlock=document.createElement('div'); optionsBlock.className='qblock';
  optionsBlock.innerHTML=`<div class="qhead"><strong>Options</strong></div>
    <div class="options">${Object.entries(sec.options).map(([k,v])=>`<div><b>${k}</b> ‚Äî ${v}</div>`).join('')}</div>`;
  qroot.appendChild(optionsBlock);

  sec.items.forEach(it=>{
    const b=document.createElement('div'); b.className='qblock'; b.id=`anchor-${it.id}`;
    const sel=`<select id="q${it.id}" name="q${it.id}">
      <option value="">‚Äî</option>${Object.keys(sec.options).map(k=>`<option value="${k}">${k}</option>`).join('')}
    </select>`;
    b.innerHTML=`<div class="qhead"><strong>${it.id}.</strong> Choose from options A‚ÄìG above</div><div class="options">${sel}</div>`;
    qroot.appendChild(b); navIds.push(it.id); answersMap[it.id]=it.correct||'';
  });
}

/* Build UI */
CONFIG.sections.forEach(sec=>{
  if (sec.type==='mcq') renderMCQ(sec);
  if (sec.type==='yesno') renderYesNo(sec);
  if (sec.type==='summary') renderSummary(sec);
});

/* Footer chips */
const footerNav=document.getElementById('footerNav');
(function(){
  if(!CONFIG.showFooterNavigator){ footerNav.style.display='none'; return; }
  footerNav.innerHTML='<strong class="muted">Questions:</strong>';
  [...new Set(navIds)].sort((a,b)=>a-b).forEach(id=>{
    const chip=document.createElement('button'); chip.className='chip'; chip.id=`chip-${id}`; chip.textContent=id;
    chip.addEventListener('click',()=>{ document.getElementById(`anchor-${id}`).scrollIntoView({behavior:'smooth',block:'center'}); });
    footerNav.appendChild(chip);
  });
})();
function markChipAnswered(id, answered){
  const chip=document.getElementById(`chip-${id}`); if(chip) chip.classList.toggle('answered', !!answered);
}
document.addEventListener('change',(e)=>{
  const m=String(e.target.name||e.target.id||'').match(/q(\d+)/);
  const id=m?+m[1]:null; if(!id) return;
  const answered=(e.target.type==='radio') ? (!!document.querySelector(`input[name='q${id}']:checked`))
                 : (e.target.value.trim().length>0);
  markChipAnswered(id, answered);
});

/* Timer */
let timeLeft=Math.max(1,+CONFIG.durationMinutes||20)*60;
const timer=document.getElementById('timer');
const pauseBtn=document.getElementById('pauseBtn');
const resumeBtn=document.getElementById('resumeBtn');
let paused=false, iv;
const fmt=s=>`${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
function startTick(){ if(iv) clearInterval(iv);
  iv=setInterval(()=>{ if(paused) return; timer.textContent=fmt(timeLeft); if(timeLeft<=0){ clearInterval(iv); alert("Time's up! Submitting."); submit(); } timeLeft--; },1000);
}
timer.textContent=fmt(timeLeft); startTick();
pauseBtn.addEventListener('click',()=>{ paused=true; pauseBtn.disabled=true; resumeBtn.disabled=false; });
resumeBtn.addEventListener('click',()=>{ paused=false; pauseBtn.disabled=false; resumeBtn.disabled=true; });

/* Submit & grading */
document.getElementById('submitBtn').addEventListener('click', submit);
function submit(){
  paused=true; pauseBtn.disabled=true; resumeBtn.disabled=false;
  let total=0, graded=0, correctCount=0;
  const itemsOut=[];
  const ids=Object.keys(answersMap);

  ids.forEach(key=>{
    const ans=answersMap[key];
    const label=key;
    let user='';
    const picked=document.querySelector(`input[name="q${key}"]:checked`);
    if(picked){ user=picked.value; }
    else if(document.getElementById('q'+key)){ user=document.getElementById('q'+key).value; }
    const shown=user||'No answer';

    if(String(ans).trim()===''){ total++; itemsOut.push({label, status:'‚Äî not graded ‚Äî', user:shown, correct:'(no key)'}); return; }

    total++; graded++;
    const ok = shown.trim().toUpperCase() === String(ans).trim().toUpperCase();
    if(ok) correctCount++;
    itemsOut.push({label, status: ok? '‚úì Correct' : '‚úó Incorrect', user:shown, correct:String(ans)});
  });

  document.getElementById('score').innerHTML = `Graded ${graded} of ${total} ‚Ä¢ Score: ${correctCount}/${graded}`;
  document.getElementById('answers').innerHTML = itemsOut.map(it=>`<li class="${/Correct/.test(it.status)?'ok':'bad'}">Q${it.label}: ${it.status} ‚Äî Your: <b>${it.user}</b> | Correct: <b>${it.correct}</b></li>`).join('');
  const r=document.getElementById('results'); r.style.display='block'; r.scrollIntoView({behavior:'smooth'});
}

/* Highlights */
const passageCard=document.getElementById('passageCard');
const pPalette=document.getElementById('pPalette');
passageCard.addEventListener('mouseup',(e)=>{
  const sel=window.getSelection(); if(!sel||sel.toString().trim().length===0) return;
  if(!passageCard.contains(sel.getRangeAt(0).commonAncestorContainer)) return;
  const r=passageCard.getBoundingClientRect(), x=Math.min(e.clientX-r.left,r.width-10), y=Math.max(0,e.clientY-r.top-40);
  pPalette.style.left=(r.left+x)+'px'; pPalette.style.top=(r.top+y)+'px'; pPalette.style.display='block';
});
document.addEventListener('mousedown',(e)=>{ if(!pPalette.contains(e.target)) pPalette.style.display='none'; });
pPalette.querySelectorAll('.hbtn[data-color]').forEach(btn=>{
  btn.addEventListener('click',()=>{ markSelection(btn.dataset.color, passageCard); pPalette.style.display='none'; });
});
document.getElementById('clearPMarks').addEventListener('click',()=>{
  passageCard.querySelectorAll('span.highlight').forEach(n=>{ const p=n.parentNode; while(n.firstChild) p.insertBefore(n.firstChild,n); p.removeChild(n); p.normalize(); });
  pPalette.style.display='none';
});

/* Questions highlight */
const qCard=document.querySelector('.card.questions');
const qPalette=document.getElementById('qPalette');
qCard.addEventListener('mouseup',(e)=>{
  const sel=window.getSelection(); if(!sel||sel.toString().trim().length===0) return;
  if(!qCard.contains(sel.getRangeAt(0).commonAncestorContainer)) return;
  const node = sel.getRangeAt(0).commonAncestorContainer.nodeType===1 ? sel.getRangeAt(0).commonAncestorContainer : sel.getRangeAt(0).commonAncestorContainer.parentNode;
  if (node.closest && node.closest('input,textarea,select')) return;
  const r=qCard.getBoundingClientRect(), x=Math.min(e.clientX-r.left,r.width-10), y=Math.max(0,e.clientY-r.top-40);
  qPalette.style.left=(r.left+x)+'px'; qPalette.style.top=(r.top+y)+'px'; qPalette.style.display='block';
});
document.addEventListener('mousedown',(e)=>{ if(!qPalette.contains(e.target)) qPalette.style.display='none'; });
qPalette.querySelectorAll('.hbtn[data-color]').forEach(btn=>{
  btn.addEventListener('click',()=>{ markSelection(btn.dataset.color, qCard); qPalette.style.display='none'; });
});
document.getElementById('clearQMarks').addEventListener('click',()=>{
  qCard.querySelectorAll('span.highlight').forEach(n=>{ const p=n.parentNode; while(n.firstChild) p.insertBefore(n.firstChild,n); p.removeChild(n); p.normalize(); });
  qPalette.style.display='none';
});

/* Helper */
function markSelection(color, scope){
  const sel=window.getSelection(); if(!sel||!sel.rangeCount) return;
  const range=sel.getRangeAt(0);
  if(!scope.contains(range.commonAncestorContainer)) return;
  const container=range.commonAncestorContainer.nodeType===1? range.commonAncestorContainer : range.commonAncestorContainer.parentNode;
  if (container.closest && container.closest('input, textarea, select')) return;
  const frag=range.extractContents();
  const span=document.createElement('span'); span.className='highlight'; span.style.backgroundColor=color; span.appendChild(frag);
  range.insertNode(span); sel.removeAllRanges();
}

/* TG button */
document.querySelector('.tg').addEventListener('click',()=>window.open(CONFIG.telegramLink,'_blank'));
</script>
</body>
</html>