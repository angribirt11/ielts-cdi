<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }



        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;  
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
            color: #3e3e3e;
    text-decoration: none;
    font-weight: 700;
    font-size: 16px;
    display: flex
;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border: 2px solid #3e3e3e;
    border-radius: 9999px;
    background-color: #ffffff;
    line-height: 1;
        }

        .telegram-link:hover {
            text-decoration: underline;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: calc(100vh - 60px); /* Full height minus header */
            position: relative;
        }

        /* Page watermark */
        body::after {
            content: "@MINDLESS_WRITER";
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 72px;
            font-weight: 800;
            letter-spacing: 2px;
            color: #000000;
            opacity: 0.04; /* subtle */
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        .panels-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
        }

        /* Passage Content */
        .text-center {
            text-align: center;
        }
        .reading-passage h4 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
       
        .reading-passage p {
            margin-bottom: 1.2em;
        }

        .question ul li label {
            display: block;
            margin-top: 8px;
            cursor: pointer;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }

        .resizer {
            width: 10px;
            cursor: col-resize;
            background-color: #f0f0f0;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="30" viewBox="0 0 10 30"><path d="M4 11h2v2H4zM4 15h2v2H4zM4 19h2v2H4z" fill="%23888"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            flex-shrink: 0;
            flex-grow: 0;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .map-svg {
            border: 2px solid #333;
            background: white;
        }

        .map-room {
            fill: #f9f9f9;
            stroke: #333;
            stroke-width: 1;
        }

        .map-text {
            font-family: Arial, sans-serif;
            font-size: 13px;
            text-anchor: middle;
            fill: #333;
        }

        .map-number {
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            fill: #333;
        }

        .room-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .room-label {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .room-label:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .room-label.dragging {
            opacity: 0.5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 6px;
            z-index: 101;
        }

        .nav-arrow {
            width: 48px;
            height: 48px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            transition: transform 0.1s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            outline: none;
        }
        .nav-arrow.prev { background-color: #4b5563; }
        .nav-arrow.next { background-color: #000000; }

        .nav-arrow:hover { transform: translateY(-1px); }
        .nav-arrow:active { transform: translateY(0); }
        .nav-arrow:focus-visible { box-shadow: 0 0 0 3px rgba(59,130,246,0.4); }

        .nav-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 768px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f3f4f6;
            color: #111827;
            border: 1px solid #d1d5db;
            padding: 10px 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.08s ease, background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            min-width: 160px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #ebedf0;
            border-color: #c7ccd4;
        }

        .footer__deliverButton___3FM07:active {
            transform: translateY(1px);
        }

        .footer__deliverButton___3FM07:focus-visible {
            box-shadow: 0 0 0 3px rgba(59,130,246,0.35);
            outline: none;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #eef0f3;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
            box-shadow: none;
        }

        

        .hidden {
            display: none !important;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #bfbfbf;
            border-radius: 4px;
            background-color: #fff;
            padding: 2px 8px;
            font-size: 16px;
            text-align: left;
            font-weight: 700;
            margin-right: 6px;
            margin-left: 6px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            height: 28px;
            min-width: 150px;
        }
        .answer-input.active-input,
        .answer-input:focus {
            border-color: #3581d8;
            border-width: 2px;
            outline: none;
        }
        .answer-input::placeholder {
            color: #666;
            font-weight: 700;
            text-align: center;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .summary-text .answer-input {
            width: 120px;
            height: 24px;
            font-size: 14px;
            margin: 0 4px;
        }
        .answer-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .answer-inputs .answer-input {
            width: 200px;
            height: 30px;
            font-size: 16px;
        }
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 200px;
        }
        .drag-item {
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
        }
        .drag-item.selected {
            /* border-color: #4a90e2; */
            /* box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5); */
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            width: 50%;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone.disabled {
            pointer-events: none;
        }
        .drop-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            padding: 2px;
        }
        .drag-options-container {
            margin-top: 10px;
        }
        .drag-options-container .drag-item {
            display: block;
            width: fit-content;
            font-size: 15px;
            padding: 0.5px 10px;
            margin-bottom: 5px;
        }
        .drag-options-container .drag-item:last-child {
            margin-bottom: 0;
        }
        
        .passage-drag-zone {
            margin-bottom: 10px;
            padding: 8px;
            border: 2px dashed #ccc;
            border-radius: 4px;
            background-color: #f9f9f9;
            /* text-align: center; */
            color: #666;
            font-size: 14px;
            transition: all 0.2s ease;
            max-height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* width: 50%; */
        }
        
        .passage-drag-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
            border-style: solid;
        }
        
        .passage-drag-zone.filled {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
            color: #155724;
            font-weight: bold;
        }
        
        .passage-drag-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            /* align-items: center; */
            justify-content: center;
            font-size: 14px;
            padding: 4px;
            background-color: transparent;
            border: none;
            margin: 0;
        }
        
        .passage-drag-zone.disabled {
            pointer-events: none;
            opacity: 0.7;
        }
        .q-number {
            color: #888;
            font-size: 14px;
            font-weight: bold;
        }
        .questions-container {
            width: 100%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px 20px;
            border: 1px solid #e0e0e0;
            text-align: left;
            margin: 10px 20px;
            border-radius: 5px;
        }
        .part-header p {
            margin: 0;
        }
        .part-header p:first-child {
            margin-bottom: 5px;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .timer-container {
            display: flex;
            position: relative;
            cursor: default;
            color: #333;
            font-size: 16px;
            font-weight: 500;
            align-items: center;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .timer-controls button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .timer-controls button:hover {
            background: #e0e0e0;
        }

        .timer-controls button svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles for TRUE/FALSE/NOT GIVEN questions */
        .tf-question {
            margin-bottom: 25px;
            padding: 10px 0px;
            border-radius: 4px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .tf-question-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 5px 0px;
            border-radius: 4px;
        }
        .tf-question-number, .question-number-box {
            border: 2px solid #ccc;
            padding: 2px 8px;
            margin-right: 10px;
            border-radius: 3px;
            font-weight: bold;
            transition: border-color 0.3s;
            display: inline-block;
        }
        /* Active question blue outline for TF (clears when navigating away) */
        .tf-question.active-question .tf-question-number {
            border-color: #4a90e2;
        }
        .tf-question-text {
            padding-top: 3px;
        }
        .tf-options {
            padding-left: 5px;
        }
        .tf-option {
            display: block;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 10px 12px;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            background-color: #fff;
        }
        .tf-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .tf-option:has(input[type="radio"]:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for TF/NG */
        .tf-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            border-width: 1px;
        }
        .tf-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            border-width: 1px;
        }
        /* Ensure selected-blue visuals don't conflict once results are shown */
        body.results-mode .tf-option:has(input[type="radio"]:checked) {
            box-shadow: none;
        }
        .tf-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .tf-question.correct .tf-question-line {
            background-color: #e9f7ef;
        }
        .tf-question.incorrect .tf-question-line {
            background-color: #f8d7da;
        }
        .matching-question-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .matching-options-bank {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .matching-questions {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .matching-question-item {
            display: flex;
            align-items: center;
            gap: 15px;

            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.3s;
        }
        
        .matching-question-item.correct {
            background-color: #e9f7ef;
            border-color: #28a745 !important;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone {
            width: auto;
            min-width: 200px;
            flex-shrink: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-weight: bold;
            color: #aaa;
        }
        .matching-options-bank .drag-item {
            font-size: 15px;
            border: 1px solid #ccc;
            background: #f9f9f9;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .summary-completion-container {
            margin-top: 20px;
        }
        .summary-text p {
            line-height: 3.0;
            font-size: 16px;
            margin-bottom: 12px;
        }
        .summary-text li {
            line-height: 2.2;
            margin-bottom: 10px;
        }
        .summary-drop-zone {
            display: inline-flex
;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
    min-width: 200px;
            height: 25px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            padding: 0 5px;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            color: #aaa;
            font-weight: bold;
    text-align: center;
        }
        .summary-drop-zone.filled {
            border-color: #4a90e2;
        }
        .summary-drop-zone.active-input {
             border-color: #4a90e2;
             box-shadow: none;
        }
        .summary-drop-zone .drag-item {
            font-size: 15px;
            font-weight: bold;
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .summary-options-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .summary-options-bank .drag-item {
            flex-grow: 1;
            min-width: 100px;
            text-align: center;
        }

        /* Filled drop-zone pill styling */
        .drop-zone.filled {
            background-color: transparent;
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            padding: 0;
        }
        .drop-zone.filled .drag-item {
            width: auto;
            height: auto;
            display: inline-block;
            border: 2px solid #4a90e2;
            border-radius: 10px;
            padding: 4px 10px;
            font-weight: 700;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.15);
            cursor: default;
            white-space: nowrap;
        }
        .multi-choice-question {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
            border: 3px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }
        /* MCQ number badge: style first strong within prompt */
        .multi-choice-question .question-prompt p > strong:first-child {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            padding: 2px 6px;
            margin-right: 8px;
            border: 1px solid #d0d7e2;
            border-radius: 6px;
            background: #fff;
        }
        /* Active question blue outline for MCQ (clears when navigating away) */
        .multi-choice-question.active-question .question-prompt p > strong:first-child {
            border-color: #4a90e2;
            border-width: 2px;
        }
        .multi-choice-option {
            padding: 10px 12px;
            background-color: #fff;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .multi-choice-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .multi-choice-option:has(input:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for MCQ */
        .multi-choice-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            box-shadow: inset 0 0 0 2px rgba(40, 167, 69, 0.25) !important;
            border-width: 1px;
            border-radius: 6px;
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            box-shadow: inset 0 0 0 2px rgba(220, 53, 69, 0.25) !important;
            border-width: 1px;
            border-radius: 6px;
        }
        /* Correct answer reveal for unselected option after checking */
        .tf-option.correct-answer-highlight,
        .multi-choice-option.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }
        body.results-mode .multi-choice-option:has(input:checked) { box-shadow: none; }
        .multi-choice-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }
        .multi-choice-option input[type="checkbox"],
        .multi-choice-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4a90e2;
        }
        .multi-choice-option.correct {
            background-color: #e9f7ef;
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone.filled {
            border-color: #4a90e2;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            height: 40px;
        }
        .paragraph-matching-question {
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 12px;
        }
        .paragraph-matching-question .answer-input {
            width: 80px;
            flex-shrink: 0;
        }

        .matching-form-container {
            margin-top: 20px;
        }
        .matching-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .matching-form-label {
            flex-shrink: 0;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content {
            background: #ffffff;
            padding: 24px;
            border-radius: 14px;
            width: 92%;
            max-width: 780px;
            max-height: 86vh;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #e5e7eb;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        .modal-content h2 {
            text-align: center;
            margin-bottom: 18px;
            color: #111827;
        }
        .results-summary {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 16px;
            text-align: center;
            border-bottom: 1px solid #eef2f7;
            padding-bottom: 12px;
        }
        .results-summary p {
            margin: 0;
            font-size: 14px;
            color: #374151;
        }
        .results-summary p span {
            display: inline-block;
            padding: 4px 10px;
            margin-left: 6px;
            border-radius: 999px;
            background: #f3f4f6;
            font-weight: 700;
            color: #111827;
        }
        .results-details-container {
            overflow-y: auto;
            padding-right: 10px; /* For scrollbar */
            border-radius: 8px;
        }
        .result-row {
            display: grid;
            grid-template-columns: 56px 1fr 1fr 120px;
            gap: 12px;
            padding: 10px 8px;
            border-bottom: 1px solid #eef2f7;
            font-size: 15px;
            align-items: center;
        }
        .result-row.correct {
            background-color: #f3faf5;
        }
        .result-row.incorrect {
            background-color: #fff5f5;
        }
        .result-row .q-num {
            font-weight: 700;
            color: #111827;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 42px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .result-row .user-ans {
            color: #374151;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .result-row .correct-ans {
            color: #065f46;
            font-weight: 600;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .status-badge {
            justify-self: end;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            border: 1px solid transparent;
        }
        .status-badge.ok {
            background: #ecfdf5;
            color: #065f46;
            border-color: #a7f3d0;
        }
        .status-badge.bad {
            background: #fff5f5;
            color: #7f1d1d;
            border-color: #f5c6cb;
        }
        .correct-answer-display {
            font-weight: bold;
            color: #28a745;
            margin-left: 10px;
            font-size: 14px;
        }
        
        
        .centered-title {
    text-align: center;
    font-size: 50px;
    font-weight: bold;
    margin-bottom: 15px;
}

        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .matching-table th {
            background-color: #007bff;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }
        
        .matching-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .matching-table .statement {
            text-align: left;
            width: 60%;
        }
        
        .matching-table .table-radio {
            margin: 0;
            transform: scale(1.2);
        }
        
        .matching-table td:not(.statement) {
            text-align: center;
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table th:not(:first-child) {
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table td:not(.statement):has(input:checked) {
            background-color: #e3f2fd;
        }
        
        .matching-table input[type="radio"]:checked {
            accent-color: #007bff;
        }
        
        .matching-table td.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table td.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .options-row {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .matching-table .options-row td {
            font-weight: 500;
            text-align: center;
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .matching-table .options-row td:first-child {
            text-align: left;
            font-weight: normal;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell {
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 40px;
            border: 2px solid #e0e0e0;
            position: relative;
            background-color: #fafafa;
            /* Debug styling - make cells very obvious */
            min-width: 40px;
            text-align: center;
            vertical-align: middle;
            font-size: 12px;
            color: #333;
            font-weight: bold;
        }
        
        .matching-table .clickable-cell:hover {
            background-color: #f0f8ff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
        }
        
        .matching-table .clickable-cell.selected {
            background-color: #e3f2fd;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.3);
        }
        
        .matching-table .clickable-cell.correct {
            background-color: #d4edda !important;
        }
        
        .matching-table .clickable-cell.incorrect {
            background-color: #f8d7da !important;
        }
        
        
        
        .matching-table .clickable-cell.selected::after { background-color: #007bff; }
        
        /* Explanation Section Styles */
        .explanation-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .explanation-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .explanation-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .explanation-content strong {
            color: #4a90e2;
            font-weight: 600;
        }
        
        #show-explanation-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        #show-explanation-btn:hover {
            background-color: #357abd;
        }
        /* Flow Chart Styling */
        .flow-chart {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            margin: 20px 0;
            padding: 20px;
            /* background: #f8f9fa; */
            /* border-radius: 8px; */
            /* border: 1px solid #dee2e6; */
        }

        .flow-step {
            background: white;
            border: 2px solid #333;
            border-radius: 0;
            padding: 15px 20px;
            /* width: 400px; */
            text-align: left;
            position: relative;
            font-size: 14px;
            line-height: 2.5;
            margin: 0;
        }

        .flow-step.input-step {
            background: white;
            border-color: #333;
        }

        .flow-arrow {
            font-size: 24px;
            color: #333;
            font-weight: 600;
            margin: 0;
            padding: 5px 0;
            line-height: 1;
        }

        .flow-step .answer-input {
            margin: 0 2px;
            width: 40px;
            height: 24px;
            background: #fff;
            font-weight: bold;
            font-size: 14px;
        }

        .flow-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
            text-align: left;
            width: 400px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="timer-container">
            <span class="timer-display">60:00</span>
            <div class="timer-controls">
                <button id="timer-toggle-btn" title="Pause/Resume Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>
                </button>
                <button id="timer-reset-btn" title="Reset Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
                </button>
            </div>
        </div>
        <a href="https://t.me/+Zt6UezFDG6U2MTdl" target="_blank" class="telegram-link">
            MINDLESS_WRITER
        </a>
    </div>

    <div class="main-container" id="main-container">
        <div id="passage-header-container">
            <div id="part-header-1" class="part-header">
                <p><strong>Part 1</strong></p>
                <p>Read the text and answer questions 1-13.</p>
            </div>
            <div id="part-header-2" class="part-header hidden">
                <p><strong>Part 2</strong></p>
                <p>Read the text and answer questions 14-26.</p>
            </div>
            <div id="part-header-3" class="part-header hidden">
                <p><strong>Part 3</strong></p>
                <p>Read the text and answer questions 27-40.</p>
            </div>
        </div>
        <div class="panels-container">
            <div class="passage-panel" id="passage-panel">
                <div id="passage-text-1" class="reading-passage">
                    <h4 class="text-center">The Paradox of Choice</h4>
                    <p><strong>A</strong> Americans today choose among more options in more parts of life than has ever been possible before. To an extent, the opportunity to choose enhances our lives. It is only logical to think that if some choices are good, more is better; people who care about having infinite options will benefit from them, and those who do not can always just ignore the 273 versions of cereal they have never tried. Yet recent research strongly suggests that, psychologically, this assumption is wrong, with 5% lower percentage announcing they are happy. Although some choices are undoubtedly better than none, more is not always better than less.</p>
                    <p><strong>B</strong> Recent research offers insight into why many people end up unhappy rather than pleased when their options expand. We began by making a distinction between "maximizers" (those who always aim to make the best possible choice) and "satisficers" (those who aim for "good enough," whether or not better selections might be out there).</p>
                    <p><strong>C</strong> In particular, we composed a set of statements—the Maximization Scale—to diagnose people's propensity to maximize. Then we had several thousand people rate themselves from 1 to 7 (from "completely disagree" to "completely agree") on such statements as "I never settle for second best." We also evaluated their sense of satisfaction with their decisions. We did not define a sharp cutoff to separate maximizers from satisficers, but in general, we think of individuals whose average scores are higher than 4 (the scale's midpoint) as maximisers and those whose scores are lower than the midpoint as satisficers. People who score highest on the test—the greatest maximizers—engage in more product comparisons than the lowest scorers, both before and after they make purchasing decisions, and they take longer to decide what to buy. When satisficers find an item that meets their standards, they stop looking. But maximizers exert enormous effort reading labels, checking out consumer magazines and trying new products. They also spend more time comparing their purchasing decisions with those of others.</p>
                    <p><strong>D</strong> We found that the greatest maximizers are the least happy with the fruits of their efforts. When they compare themselves with others, they get little pleasure from finding out that they did better and substantial dissatisfaction from finding out that they did worse. They are more prone to experiencing regret after a purchase, and if their acquisition disappoints them, their sense of well-being takes longer to recover. They also tend to brood or ruminate more than satisficers do.</p>
                    <p><strong>E</strong> Does it follow that maximizers are less happy in general than satisficers? We tested this by having people fill out a variety of questionnaires known to be reliable indicators of wellbeing. As might be expected, individuals with high maximization scores experienced less satisfaction with life and were less happy, less optimistic and more depressed than people with low maximization scores. Indeed, those with extreme maximization ratings had depression scores that placed them in the borderline of clinical range.</p>
                    <p><strong>F</strong> Several factors explain why more choice is not always better than less, especially for maximisers. High among these are "opportunity costs." The quality of any given option cannot be assessed in isolation from its alternatives. One of the "costs" of making a selection is losing the opportunities that a different option would have afforded. Thus, an opportunity cost of vacationing on the beach in Cape Cod might be missing the fabulous restaurants in the Napa Valley. Early Decision Making Research by Daniel Kahneman and Amos Tversky showed that people respond much more strongly to losses than gains. If we assume that opportunity costs reduce the overall desirability of the most preferred choice, then the more alternatives there are, the deeper our sense of loss will be and the less satisfaction we will derive from our ultimate decision.</p>
                    <p><strong>G</strong> The problem of opportunity costs will be better for a satisficer. The latter's "good enough" philosophy can survive thoughts about opportunity costs. In addition, the "good enough" standard leads to much less searching and inspection of alternatives than the maximizer's "best" standard. With fewer choices under consideration, a person will have fewer opportunity costs to subtract.</p>
                    <p><strong>H</strong> Just as people feel sorrow about the opportunities they have forgone, they may also suffer regret about the option they settled on. My colleagues and I devised a scale to measure proneness to feeling regret, and we found that people with high sensitivity to regret are less happy, less satisfied with life, less optimistic and more depressed than those with low sensitivity. Not surprisingly, we also found that people with high regret sensitivity tend to be maximizers. Indeed, we think that worry over future regret is a major reason that individuals become maximizers. The only way to be sure you will not regret a decision is by making the best possible one. Unfortunately, the more options you have and the more opportunity costs you incur, the more likely you are to experience regret.</p>
                    <p><strong>I</strong> In a classic demonstration of the power of sunk costs, people were offered season subscriptions to a local theatre company. Some were offered the tickets at full price and others at a discount. Then the researchers simply kept track of how often the ticket purchasers actually attended the plays over the course of the season. Full-price payers were more likely to show up at performances than discount payers. The reason for this, the investigators argued, was that the full-price payers would experience more regret if they did not use the tickets because not using the more costly tickets would constitute a bigger loss. To increase sense of happiness, we can decide to restrict our options when the decision is not crucial. For example, make a rule to visit no more than two stores when shopping for clothing.</p>
                </div>
                <div id="passage-text-2" class="reading-passage hidden">
                    <h4 class="text-center">Implication of False Belief Experiments</h4>
                    <p><strong>A</strong> A considerable amount of research since the mid 1980s has been concerned with what has been termed children's theory of mind. This involves children's ability to understand that people can have different beliefs and representations of the world– a capacity that is shown by four years of age. Furthermore, this ability appears to be absent in children with autism. The ability to work out that another person is thinking is clearly an important aspect of both cognitive and social development. Furthermore, one important explanation for autism is that children suffering from this condition do not have a theory of mind(TOM). Consequently, the development of children's TOM has attracted considerable attention.</p>
                    <p><strong>B</strong> Wimmer and Perner devised a 'false belief task' to address this question. They used some toys to act out the following story. Maxi left some chocolate in a blue cupboard before he went out. When he was away his mother moved the chocolate to a green cupboard. Children were asked to predict where Maxi willlook for his chocolate when he returns. Most children under four years gave the incorrect answer, that Maxi will look in the green cupboard. Those over four years tended to give the correct answer, that Maxi will look in the blue cupboard. The incorrect answers indicated that the younger children did not understand that Maxi's beliefs and representations no longer matched the actual state of the world, and they failed to appreciate that Maxi will act on the basis of his beliefs rather than the way that the world is actually organised.</p>
                    <p><strong>C</strong> A simpler version of the Maxi task was devised by Baron-Cohen to take account of criticisms that younger children may have been affected by the complexity and too much information of the story in the task described above. For example, the child is shown two dolls, Sally and Anne, who have a basket and a box， respectively. Sally also has a marble, which she places in her basket，and then leaves to take a walk. While she is out of the room, Anne takes the marble from the basket, eventually putting it in the box. Sally returns，and child is then asked where Sally will look for the marble. The child passes the task if she answers that Sally will look in the basket, where she put the marble; the child fails the task if she answers that Sally will look in the box，where the child knows the marble is hidden， even though Sally cannot know, since she did not see it hidden there. In order to pass the task, the child must be able to understand that another's mental representation of the situation is different from their own, and the child must be able to predict behavior based on that understanding. The results of research using false-belief tasks have been fairly consistent: most normally-developing children are unable to pass the tasks until around age four.</p>
                    <p><strong>D</strong> Leslie argues that, before 18 months, children treat the world in a literal way and rarely demonstrate pretence. He also argues that it is necessary for the cognitive system to distinguish between what is pretend and what is real. If children were not able to do this, they would not be able to distinguish between imagination and reality. Leslie suggested that this pretend play becomes possible because of the presence of a de-coupler that copies primary representations to secondary representations. For example, children, when pretending a banana is a telephone, would make a secondary representation of a banana. They would manipulate this representation and they would use their stored knowledge of 'telephone' to build on this pretence.</p>
                    <p><strong>E</strong> There is also evidence that social processes play a part in the development of TOM. Meins and her colleagues have found that what they term mind mindedness in maternal speech to six-month old infants is related to both security of attachment and to TOM abilities. Mind Mindedness involves speech that discusses infants' feelings and explains their behaviour in terms of mental stages(e.g "you1 re feeling hungry")</p>
                    <p><strong>F</strong> Lewis investigated older children living in extended families in Crete and Cyprus. They found that children who socially interact with more adults，who have more friends. And who have more older siblings tend to pass TOM tasks at a slightly earlier age than other children. Furthermore, because young children are more likely to talk about their thoughts and feelings with peers than with their mothers, peer interaction may provide a special impetus to the development of a TOM. A similar point has been made by Dunn, who argues that peer interaction is more likely to contain pretend play and that it is likely to be more challenging because other children, unlike adults, do not make large adaptations to the communicative needs of other children.</p>
                    <p><strong>G</strong> In addition, there has been concern that some aspects of the TOM approach underestimate children's understanding of other people. After all，infants will point to objects apparently in an effort to change a person's direction of gaze and interest; they can interact quite effectively with other people; they will express their ideas in opposition to the wishes of others; and they will show empathy for the feeling of others. Schatz studied the spontaneous speech of three-year-olds and found that these children used mental terms，and used them in circumstances where there was a contrast between, for example, not being sure where an object was located and finding it, or between pretending and reality. Thus the social abilities of children indicate that they are aware of the difference between mental states and external reality at ages younger than four.</p>
                    <p><strong>H</strong> A different explanation has been put forward by Harris. He proposed that children use 'simulation'. This involves putting yourself in the other person's position, and then trying to predict what the other person would do. Thus success on false belief tasks can be explained by children trying to imagine what they would do if they were a character in the stories, rather than children being able to appreciate the beliefs of other people. Such thinking about situations that do not exist involves what is termed counterfactual reasoning.</p>
                    <p><strong>I</strong> A different explanation has been put forward by Harris. He proposed that children use "simula­tion". This involves putting yourself in the other person's position, and then trying to predict what the other person would do. Thus, success on false belief tasks can be explained by children trying to imagine what they would do if they were a character in the stories, rather than children being able to appreciate the beliefs of other people. Such thinking about situations that do not exist involves what is termed counterfactual reasoning.</p>
                </div>
                <div id="passage-text-3" class="reading-passage hidden">
                    <h4 class="text-center">Musical Maladies</h4>
                    <p>Norman M. Weinberger reviews the latest work of Oliver Sacks on music.</p>
                    <p>Music and the brain are both endlessly fascinating subjects, and as a neuroscientist specialising in auditory learning and memory, I find them especially intriguing. So I had high expectations of Musicophilia, the latest offering from neurologist and prolific author Oliver Sacks. And I confess to feeling a little guilty reporting that my reactions to the book are mixed.</p>
                    <p>Sacks himself is the best part of Musicophilia. He richly documents his own life in the book and reveals highly personal experiences. The photograph of him on the cover of the book— which shows him wearing headphones, eyes closed, clearly enchanted as he listens to Alfred Brendel perform Beethoven's Pathétique Sonata—makes a positive impression that is borne out by the contents of the book. Sacks's voice throughout is steady and erudite but never pontifical. He is neither self-conscious nor self-promoting.</p>
                    <p>The preface gives a good idea of what the book will deliver. In it Sacks explains that he wants to convey the insights gleaned from the "enormous and rapidly growing body of work on the neural underpinnings of musical perception and imagery, and the complex and often bizarre disorders to which these are prone" He also stresses the importance of "the simple art of observation" and "the richness of the human context." He wants to combine "observation and description with the latest in technology," he says, and to imaginatively enter into the experience of his patients and subjects. The reader can see that Sacks, who has been practicing neurology for 40 years, is torn between the "old-fashioned" path of observation and the new-fangled, high-tech approach: He knows that he needs to take heed of the latter, but his heart lies with the former.</p>
                    <p>The book consists mainly of detailed descriptions of cases, most of them involving patients whom Sacks has seen in his practice. Brief discussions of contemporary neuroscientific reports are sprinkled liberally throughout the text. Part I, "Haunted by Music," begins with the strange case of Tony Cicoria, a nonmusical, middle-aged surgeon who was consumed by a love of music after being hit by lightning. He suddenly began to crave listening to piano music, which he had never cared for in the past. He started to play the piano and then to compose music, which arose spontaneously in his mind in a "torrent" of notes. How could this happen? Was the cause psychological? (He had had a near-death experience when the lightning struck him.) Or was it the direct result of a change in the auditory regions of his cerebral cortex? Electro encephalography (EEG) showed his brain waves to be normal in the mid-1990s, just after his trauma and subsequent "conversion" to music. There are now more sensitive tests, but Cicoria has declined to undergo them; he does not want to delve into the causes of his musicality. What a shame!</p>
                    <p>Part II, "A Range of Musicality," covers a wider variety of topics, but unfortunately, some of the chapters offer little or nothing that is new. For example, chapter 13, which is five pages long, merely notes that the blind often have better hearing than the sighted. The most interesting chapters are those that present the strangest cases. Chapter 8 is about "amusia," an inability to hear sounds as music, and "dysharmonia," a highly specific impairment of the ability to hear harmony, with the ability to understand melody left intact. Such specific "dissociations" are found throughout the cases Sacks recounts.</p>
                    <p>To Sacks's credit, part III, "Memory, Movement and Music," brings us into the underappreciated realm of music therapy. Chapter 16 explains how "melodic intonation therapy" is being used to help expressive aphasic patients (those unable to express their thoughts verbally following a stroke or other cerebral incident) once again become capable of fluent speech. In chapter 20, Sacks demonstrates the near-miraculous power of music to animate Parkinson's patients and other people with severe movement disorders, even those who are frozen into odd postures. Scientists cannot yet explain how music achieves this effect.</p>
                    <p>To readers who are unfamiliar with neuroscience and music behavior, Musicophilia may be something of a revelation. But the book will not satisfy those seeking the causes and implications of the phenomena Sacks describes. For one thing, Sacks appears to be more at ease discussing patients than discussing experiments. And he tends to be rather uncritical in accepting scientific findings and theories.</p>
                    <p>It's true that the causes of music-brain oddities remain poorly understood. However, Sacks could have done more to draw out some of the implications of the careful observations that he and other neurologists have made and of the treatments that have been successful. For example, he might have noted that the many specific dissociations among components of music comprehension, such as loss of the ability to perceive harmony but not melody, indicate that there is no music center in the brain. Because many people who read the book are likely to believe in the brain localisation of all mental functions, this was a missed educational opportunity.</p>
                    <p>Another conclusion one could draw is that there seem to be no "cures" for neurological problems involving music. A drug can alleviate a symptom in one patient and aggravate it in another, or can have both positive and negative effects in the same patient. Treatments mentioned seem to be almost exclusively antiepileptic medications, which "damp down" the excitability of the brain in general; their effectiveness varies widely.</p>
                    <p>Finally, in many of the cases described here the patient with music-brain symptoms is reported to have "normal" EEG results. Although Sacks recognises the existence of new technologies, among them far more sensitive ways to analyze brain waves than the standard neurological EEG test, he does not call for their use. In fact, although he exhibits the greatest compassion for patients, he conveys no sense of urgency about the pursuit of new avenues in the diagnosis and treatment of music-brain disorders. This absence echoes the hook's preface, in which Sacks expresses fear that "the simple art of observation may be lost" if we rely too much on new technologies. He does call for both approaches, though, and we can only hope that the neurological community will respond.</p>
                </div>
            </div>
            <div class="resizer" id="resizer"></div>
            <div class="questions-panel" id="questions-panel">
                <div id="questions-1" class="question-set">
                    <div class="questions-container">
                        <div class="question" data-q-start="1" data-q-end="4">
                            <div class="question-prompt">
                                <p><strong>Questions 1-4</strong></p>
                                <p>Look at the following descriptions and the list of categories below.</p>
                                <p>Match each description or deed with the correct category.</p>
                            </div>
                            <div class="matching-table-container">
                                <p><strong>List of Categories</strong></p>
                                <p><strong>A</strong> "maximizers"</p>
                                <p><strong>B</strong> "satisficers"</p>
                                <p><strong>C</strong> neither "maximizers" nor "satisficers"</p>
                                <p><strong>D</strong> both "maximizers" and "satisficers"</p>

                                <table class="matching-table">
                                    <thead>
                                        <tr>
                                            <th>Questions</th>
                                            <th>A</th>
                                            <th>B</th>
                                            <th>C</th>
                                            <th>D</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="statement"><strong>1.</strong> rated to the Maximization Scale of making choice</td>
                                            <td class="clickable-cell" data-value="A" data-question="1"></td>
                                            <td class="clickable-cell" data-value="B" data-question="1"></td>
                                            <td class="clickable-cell" data-value="C" data-question="1"></td>
                                            <td class="clickable-cell" data-value="D" data-question="1"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>2.</strong> don't take much time before making a decision</td>
                                            <td class="clickable-cell" data-value="A" data-question="2"></td>
                                            <td class="clickable-cell" data-value="B" data-question="2"></td>
                                            <td class="clickable-cell" data-value="C" data-question="2"></td>
                                            <td class="clickable-cell" data-value="D" data-question="2"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>3.</strong> are likely to regret about the choice in the future</td>
                                            <td class="clickable-cell" data-value="A" data-question="3"></td>
                                            <td class="clickable-cell" data-value="B" data-question="3"></td>
                                            <td class="clickable-cell" data-value="C" data-question="3"></td>
                                            <td class="clickable-cell" data-value="D" data-question="3"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>4.</strong> choose the highest price in the range of purchase</td>
                                            <td class="clickable-cell" data-value="A" data-question="4"></td>
                                            <td class="clickable-cell" data-value="B" data-question="4"></td>
                                            <td class="clickable-cell" data-value="C" data-question="4"></td>
                                            <td class="clickable-cell" data-value="D" data-question="4"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="question" data-q-start="5" data-q-end="8">
                            <div class="question-prompt">
                                <p><strong>Questions 5-8</strong></p>
                                <p>Do the following statements agree with the information given in the text?</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>TRUE</strong> if the statement is true</li>
                                    <li><strong>FALSE</strong> if the statement is false</li>
                                    <li><strong>NOT GIVEN</strong> if the information is not given in the passage</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="5" data-q-end="5">
                                <div class="tf-question-line"><span class="tf-question-number">5</span><span class="tf-question-text">In today's world, since the society is becoming wealthier, people are happier.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q5" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q5" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q5" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="6" data-q-end="6">
                                <div class="tf-question-line"><span class="tf-question-number">6</span><span class="tf-question-text">In society, there are more maximisers than satisficers.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q6" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q6" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q6" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="7" data-q-end="7">
                                <div class="tf-question-line"><span class="tf-question-number">7</span><span class="tf-question-text">People tend to react more to loses than gains.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q7" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q7" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q7" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="8" data-q-end="8">
                                <div class="tf-question-line"><span class="tf-question-number">8</span><span class="tf-question-text">Females and males acted differently in the study of choice making.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q8" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q8" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q8" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="9" data-q-end="13">
                            <div class="question-prompt">
                                <p><strong>Questions 9-13</strong></p>
                                <p>Choose the correct answer.</p>
                            </div>
                            <div class="tf-question" data-q-start="9" data-q-end="9">
                                <div class="tf-question-line"><span class="tf-question-number">9</span><span class="tf-question-text">The Maximization Scale is aimed to</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q9" value="A"> know the happiness when they have more choices.</label>
                                    <label class="tf-option"><input type="radio" name="q9" value="B"> measure how people are likely to feel after making choices.</label>
                                    <label class="tf-option"><input type="radio" name="q9" value="C"> help people make better choices.</label>
                                    <label class="tf-option"><input type="radio" name="q9" value="D"> reduce the time of purchasing.</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="10" data-q-end="10">
                                <div class="tf-question-line"><span class="tf-question-number">10</span><span class="tf-question-text">According to the text, what is the result of more choices?</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q10" value="A"> People can make choices more easily</label>
                                    <label class="tf-option"><input type="radio" name="q10" value="B"> Maximizers are happier to make choices.</label>
                                    <label class="tf-option"><input type="radio" name="q10" value="C"> Satisficers are quicker to make wise choices.</label>
                                    <label class="tf-option"><input type="radio" name="q10" value="D"> People have more tendency to experience regret.</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="11" data-q-end="11">
                                <div class="tf-question-line"><span class="tf-question-number">11</span><span class="tf-question-text">The example of theatre ticket is to suggest that</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q11" value="A"> they prefer to use more money when buying tickets.</label>
                                    <label class="tf-option"><input type="radio" name="q11" value="B"> they don't like to spend more money on theatre.</label>
                                    <label class="tf-option"><input type="radio" name="q11" value="C"> higher-priced things would induce more regret if not used properly</label>
                                    <label class="tf-option"><input type="radio" name="q11" value="D"> full-price payers are real theatre lovers.</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="12" data-q-end="12">
                                <div class="tf-question-line"><span class="tf-question-number">12</span><span class="tf-question-text">How to increase the happiness when making a better choice?</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q12" value="A"> use less time</label>
                                    <label class="tf-option"><input type="radio" name="q12" value="B"> make more comparisons</label>
                                    <label class="tf-option"><input type="radio" name="q12" value="C"> buy more expensive products</label>
                                    <label class="tf-option"><input type="radio" name="q12" value="D"> limit the number of choices in certain situations</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="13" data-q-end="13">
                                <div class="tf-question-line"><span class="tf-question-number">13</span><span class="tf-question-text">What is the best title for Reading Passage 1?</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q13" value="A"> easoning of Worse Choice Making</label>
                                    <label class="tf-option"><input type="radio" name="q13" value="B"> Making Choices in Today's World</label>
                                    <label class="tf-option"><input type="radio" name="q13" value="C"> The Influence of More Choices</label>
                                    <label class="tf-option"><input type="radio" name="q13" value="D"> Complexity in Choice Making</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="questions-2" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="14" data-q-end="20">
                            <div class="question-prompt">
                                <p><strong>Questions 14-20</strong></p>
                                <p>Look at the following statements and the list of researchers below.</p>
                                <p>Match each statement with the correct researcher=.</p>
                            </div>
                            <div class="matching-table-container">
                                <p><strong>List of Researchers</strong></p>
                                <p><strong>A</strong> Baron-Cohen</p>
                                <p><strong>B</strong> Meins</p>
                                <p><strong>C</strong> Wimmer and Pemer</p>
                                <p><strong>D</strong> Lewis</p>
                                <p><strong>E</strong> Dunn</p>
                                <p><strong>F</strong> Schatz</p>
                                <p><strong>G</strong> Harris</p>

                                <table class="matching-table">
                                    <thead>
                                        <tr>
                                            <th>Questions</th>
                                            <th>A</th>
                                            <th>B</th>
                                            <th>C</th>
                                            <th>D</th>
                                            <th>E</th>
                                            <th>F</th>
                                            <th>G</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="statement"><strong>14.</strong> gave an alternative explanation that children may not be understanding other's belief</td>
                                            <td class="clickable-cell" data-value="A" data-question="14"></td>
                                            <td class="clickable-cell" data-value="B" data-question="14"></td>
                                            <td class="clickable-cell" data-value="C" data-question="14"></td>
                                            <td class="clickable-cell" data-value="D" data-question="14"></td>
                                            <td class="clickable-cell" data-value="E" data-question="14"></td>
                                            <td class="clickable-cell" data-value="F" data-question="14"></td>
                                            <td class="clickable-cell" data-value="G" data-question="14"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>15.</strong> found that children under certain age can tell difference between reality and mentality</td>
                                            <td class="clickable-cell" data-value="A" data-question="15"></td>
                                            <td class="clickable-cell" data-value="B" data-question="15"></td>
                                            <td class="clickable-cell" data-value="C" data-question="15"></td>
                                            <td class="clickable-cell" data-value="D" data-question="15"></td>
                                            <td class="clickable-cell" data-value="E" data-question="15"></td>
                                            <td class="clickable-cell" data-value="F" data-question="15"></td>
                                            <td class="clickable-cell" data-value="G" data-question="15"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>16.</strong> conducted a well-known experiment and drew conclusion that young children were unable to comprehend the real state of the world</td>
                                            <td class="clickable-cell" data-value="A" data-question="16"></td>
                                            <td class="clickable-cell" data-value="B" data-question="16"></td>
                                            <td class="clickable-cell" data-value="C" data-question="16"></td>
                                            <td class="clickable-cell" data-value="D" data-question="16"></td>
                                            <td class="clickable-cell" data-value="E" data-question="16"></td>
                                            <td class="clickable-cell" data-value="F" data-question="16"></td>
                                            <td class="clickable-cell" data-value="G" data-question="16"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>17.</strong> found that children who get along with adults often comparatively got through the test more easily</td>
                                            <td class="clickable-cell" data-value="A" data-question="17"></td>
                                            <td class="clickable-cell" data-value="B" data-question="17"></td>
                                            <td class="clickable-cell" data-value="C" data-question="17"></td>
                                            <td class="clickable-cell" data-value="D" data-question="17"></td>
                                            <td class="clickable-cell" data-value="E" data-question="17"></td>
                                            <td class="clickable-cell" data-value="F" data-question="17"></td>
                                            <td class="clickable-cell" data-value="G" data-question="17"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>18.</strong> revised an easier experiment to rule out the possibility that children might be influenced by sophisticated reasoning</td>
                                            <td class="clickable-cell" data-value="A" data-question="18"></td>
                                            <td class="clickable-cell" data-value="B" data-question="18"></td>
                                            <td class="clickable-cell" data-value="C" data-question="18"></td>
                                            <td class="clickable-cell" data-value="D" data-question="18"></td>
                                            <td class="clickable-cell" data-value="E" data-question="18"></td>
                                            <td class="clickable-cell" data-value="F" data-question="18"></td>
                                            <td class="clickable-cell" data-value="G" data-question="18"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>19.</strong> related social factor such as mother-child communication to capability act in TOM</td>
                                            <td class="clickable-cell" data-value="A" data-question="19"></td>
                                            <td class="clickable-cell" data-value="B" data-question="19"></td>
                                            <td class="clickable-cell" data-value="C" data-question="19"></td>
                                            <td class="clickable-cell" data-value="D" data-question="19"></td>
                                            <td class="clickable-cell" data-value="E" data-question="19"></td>
                                            <td class="clickable-cell" data-value="F" data-question="19"></td>
                                            <td class="clickable-cell" data-value="G" data-question="19"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>20.</strong> explained children are less likely to tell something interactive to their mother than to their friends</td>
                                            <td class="clickable-cell" data-value="A" data-question="20"></td>
                                            <td class="clickable-cell" data-value="B" data-question="20"></td>
                                            <td class="clickable-cell" data-value="C" data-question="20"></td>
                                            <td class="clickable-cell" data-value="D" data-question="20"></td>
                                            <td class="clickable-cell" data-value="E" data-question="20"></td>
                                            <td class="clickable-cell" data-value="F" data-question="20"></td>
                                            <td class="clickable-cell" data-value="G" data-question="20"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="question" data-q-start="21" data-q-end="26">
                            <div class="question-prompt">
                                <p><strong>Questions 21-26</strong></p>
                                <p>Complete the summary below. Write <strong>ONE WORD ONLY</strong> from the text for each answer.</p>
                            </div>
                            <div class="summary-text">
                                <p>In 1980s, research studies were designed to test the subject called Theory of Mind that if children have the ability to represent the reality. First experiments were carried out on this subject on a boy. And questions had been made on where the boy can find the location of the <input type="text" class="answer-input" id="q21" placeholder="21" data-q-start="21" data-q-end="21">. But it was accused that it had excessive <input type="text" class="answer-input" id="q22" placeholder="22" data-q-start="22" data-q-end="22">. So second modified experiment was conducted involving two dolls, and most children passed the test at the age of <input type="text" class="answer-input" id="q23" placeholder="23" data-q-start="23" data-q-end="23">. Then Lewis and Dunn researched <input type="text" class="answer-input" id="q24" placeholder="24" data-q-start="24" data-q-end="24"> children in a certain place, and found children who have more interaction such as more conversation with <input type="text" class="answer-input" id="q25" placeholder="25" data-q-start="25" data-q-end="25"> have better performance in the test, and peer interaction is <input type="text" class="answer-input" id="q26" placeholder="26" data-q-start="26" data-q-end="26"> because of consisting pretending elements.</p>
                            </div>
                        </div>

                    </div>
                </div>
                <div id="questions-3" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="27" data-q-end="30">
                            <div class="question-prompt">
                                <p><strong>Questions 27-30</strong></p>
                                <p>Choose the correct answer.</p>
                            </div>
                            <div class="tf-question" data-q-start="27" data-q-end="27">
                                <div class="tf-question-line"><span class="tf-question-number">27</span><span class="tf-question-text">Why does the writer have a mixed feeling about the book?</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q27" value="A"> The guilty feeling made him so.</label>
                                    <label class="tf-option"><input type="radio" name="q27" value="B"> The writer expected it to be better than it was.</label>
                                    <label class="tf-option"><input type="radio" name="q27" value="C"> Sacks failed to include his personal stories in the book.</label>
                                    <label class="tf-option"><input type="radio" name="q27" value="D"> This is the only book written by Sacks.</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="28" data-q-end="28">
                                <div class="tf-question-line"><span class="tf-question-number">28</span><span class="tf-question-text">What is the best part of the book?</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q28" value="A"> the photo of Sacks listening to music</label>
                                    <label class="tf-option"><input type="radio" name="q28" value="B"> the tone of voice of the book</label>
                                    <label class="tf-option"><input type="radio" name="q28" value="C"> the autobiographical description in the book</label>
                                    <label class="tf-option"><input type="radio" name="q28" value="D"> the description of Sacks's wealth</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="29" data-q-end="29">
                                <div class="tf-question-line"><span class="tf-question-number">29</span><span class="tf-question-text">In the preface, what did Sacks try to achieve?</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q29" value="A"> make terms with the new technologies</label>
                                    <label class="tf-option"><input type="radio" name="q29" value="B"> give detailed description of various musical disorders</label>
                                    <label class="tf-option"><input type="radio" name="q29" value="C"> explain how people understand music</label>
                                    <label class="tf-option"><input type="radio" name="q29" value="D"> explain why he needs to do away with simple observation</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="30" data-q-end="30">
                                <div class="tf-question-line"><span class="tf-question-number">30</span><span class="tf-question-text">What is disappointing about Tony Cicoria's case?</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q30" value="A"> He refuses to have further tests.</label>
                                    <label class="tf-option"><input type="radio" name="q30" value="B"> He can't determine the cause of his sudden musicality.</label>
                                    <label class="tf-option"><input type="radio" name="q30" value="C"> He nearly died because of the lightening.</label>
                                    <label class="tf-option"><input type="radio" name="q30" value="D"> His brain waves were too normal to show anything.</label>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="31" data-q-end="36">
                            <div class="question-prompt">
                                <p><strong>Questions 31-36</strong></p>
                                <p>Do the following statements agree with the views of the writer in the text?</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>YES</strong> if the statement agrees with the views of the writer</li>
                                    <li><strong>NO</strong> if the statement contradicts the views of the writer</li>
                                    <li><strong>NOT GIVEN</strong> if it is impossible to say what the writer thinks about this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="31" data-q-end="31">
                                <div class="tf-question-line"><span class="tf-question-number">31</span><span class="tf-question-text">It is difficult to give a well-reputable writer a less than favorable review.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q31" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q31" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q31" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="32" data-q-end="32">
                                <div class="tf-question-line"><span class="tf-question-number">32</span><span class="tf-question-text">Beethoven's Pathétique Sonata is a good treatment for musical disorders.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q32" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q32" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q32" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="33" data-q-end="33">
                                <div class="tf-question-line"><span class="tf-question-number">33</span><span class="tf-question-text">Sacks believes technological methods is not important compared with observation when studying his patients.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q33" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q33" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q33" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="34" data-q-end="34">
                                <div class="tf-question-line"><span class="tf-question-number">34</span><span class="tf-question-text">It is difficult to understand why music therapy is undervalued.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q34" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q34" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q34" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="35" data-q-end="35">
                                <div class="tf-question-line"><span class="tf-question-number">35</span><span class="tf-question-text">Sacks should have more skepticism about other theories and findings.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q35" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q35" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q35" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="36" data-q-end="36">
                                <div class="tf-question-line"><span class="tf-question-number">36</span><span class="tf-question-text">Sacks is impatient to use new testing methods.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q36" value="YES"> YES</label>
                                    <label class="tf-option"><input type="radio" name="q36" value="NO"> NO</label>
                                    <label class="tf-option"><input type="radio" name="q36" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                        </div>
                                
                        <div class="question" data-q-start="37" data-q-end="40">
                            <div class="question-prompt">
                                <p><strong>Questions 37-40</strong></p>
                                <p>Complete each sentence with the correct ending.</p>
                            </div>
                            <div class="matching-table-container">
                                <p><strong>List of Endings</strong></p>
                                <p><strong>A</strong> show no music-brain disorders.</p>
                                <p><strong>B</strong> indicates that medication can have varied results.</p>
                                <p><strong>C</strong> is key for the neurological community to unravel the mysteries.</p>
                                <p><strong>D</strong> should not be used in isolation.</p>
                                <p><strong>E</strong> indicate that not everyone can receive good education.</p>
                                <p><strong>F</strong> show that music is not localised in the brain.</p>

                                <table class="matching-table">
                                    <thead>
                                        <tr>
                                            <th>Questions</th>
                                            <th>A</th>
                                            <th>B</th>
                                            <th>C</th>
                                            <th>D</th>
                                            <th>E</th>
                                            <th>F</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="statement"><strong>37.</strong> The dissociations between harmony and melody</td>
                                            <td class="clickable-cell" data-value="A" data-question="37"></td>
                                            <td class="clickable-cell" data-value="B" data-question="37"></td>
                                            <td class="clickable-cell" data-value="C" data-question="37"></td>
                                            <td class="clickable-cell" data-value="D" data-question="37"></td>
                                            <td class="clickable-cell" data-value="E" data-question="37"></td>
                                            <td class="clickable-cell" data-value="F" data-question="37"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>38.</strong> The study of treating musical disorders</td>
                                            <td class="clickable-cell" data-value="A" data-question="38"></td>
                                            <td class="clickable-cell" data-value="B" data-question="38"></td>
                                            <td class="clickable-cell" data-value="C" data-question="38"></td>
                                            <td class="clickable-cell" data-value="D" data-question="38"></td>
                                            <td class="clickable-cell" data-value="E" data-question="38"></td>
                                            <td class="clickable-cell" data-value="F" data-question="38"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>39.</strong> The EEG scans of Sacks's patients</td>
                                            <td class="clickable-cell" data-value="A" data-question="39"></td>
                                            <td class="clickable-cell" data-value="B" data-question="39"></td>
                                            <td class="clickable-cell" data-value="C" data-question="39"></td>
                                            <td class="clickable-cell" data-value="D" data-question="39"></td>
                                            <td class="clickable-cell" data-value="E" data-question="39"></td>
                                            <td class="clickable-cell" data-value="F" data-question="39"></td>
                                        </tr>
                                        <tr>
                                            <td class="statement"><strong>40.</strong> Sacks believes testing based on new technologies</td>
                                            <td class="clickable-cell" data-value="A" data-question="40"></td>
                                            <td class="clickable-cell" data-value="B" data-question="40"></td>
                                            <td class="clickable-cell" data-value="C" data-question="40"></td>
                                            <td class="clickable-cell" data-value="D" data-question="40"></td>
                                            <td class="clickable-cell" data-value="E" data-question="40"></td>
                                            <td class="clickable-cell" data-value="F" data-question="40"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow prev" onclick="previousQuestion()" id="prevBtn" aria-label="Previous question">
            <!-- Left arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="nav-arrow next" onclick="nextQuestion()" id="nextBtn" aria-label="Next question">
            <!-- Right arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)"><span class="sr-only">Question 12</span><span aria-hidden="true">12</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)"><span class="sr-only">Question 13</span><span aria-hidden="true">13</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)"><span class="sr-only">Question 14</span><span aria-hidden="true">14</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)"><span class="sr-only">Question 15</span><span aria-hidden="true">15</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)"><span class="sr-only">Question 16</span><span aria-hidden="true">16</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(17)"><span class="sr-only">Question 17</span><span aria-hidden="true">17</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)"><span class="sr-only">Question 18</span><span aria-hidden="true">18</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)"><span class="sr-only">Question 19</span><span aria-hidden="true">19</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)"><span class="sr-only">Question 20</span><span aria-hidden="true">20</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 14</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div id="menu-highlight" class="context-menu-item" onclick="highlightText()">
            Highlight
        </div>
        <div id="menu-note" class="context-menu-item" onclick="addNote()">
            Note
        </div>
        <div id="menu-clear" class="context-menu-item" onclick="clearHighlight()">
            Clear
        </div>
        <div id="menu-clear-all" class="context-menu-item" onclick="clearAllHighlights()">
            Clear All
        </div>
    </div>

    <div id="results-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeResultsModal()">&times;</button>
            <h2>Results</h2>
            <div class="results-summary">
                <p>Score: <span id="results-score"></span> / 40</p>
                <p>IELTS Band: <span id="results-band"></span></p>
            </div>
            <div id="results-details" class="results-details-container">
                <!-- Results for each question will be injected here -->
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- STATE VARIABLES ---
        let currentPassage = 1;
        let currentQuestion = 1;
        let selectedRange = null;
        let timeInSeconds = 3600;
        let timerInterval;
        let draggedItem = null;
        let activeQuestionElement = null;
        let selectedDragItem = null;

        // --- GLOBAL FUNCTIONS ---
        function getFirstQuestionOfPart(part) {
            switch(part) {
                case 1: return 1;
                case 2: return 14;
                case 3: return 27;
                default: return 1;
            }
        }

        // --- DOM ELEMENTS ---
        const timerDisplay = document.querySelector('.timer-display');
        const timerToggleButton = document.getElementById('timer-toggle-btn');
        const timerResetButton = document.getElementById('timer-reset-btn');
        const deliverButton = document.getElementById('deliver-button');
        const resizer = document.getElementById('resizer');
        const passagePanel = document.getElementById('passage-panel');
        const questionsPanel = document.getElementById('questions-panel');
        const contextMenu = document.getElementById('contextMenu');

        // --- ICON SVGs ---
        const playIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>';
        const pauseIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

        // --- ANSWERS ---
        const correctAnswers = {
            // Part 1 (1-13)
            '1': 'D',
            '2': 'B',
            '3': 'A',
            '4': 'C',
            '5': 'FALSE',
            '6': 'NOT GIVEN',
            '7': 'TRUE',
            '8': 'NOT GIVEN',
            '9': 'B',
            '10': 'D',
            '11': 'C',
            '12': 'D',
            '13': 'C',
            // Part 2 (14-26)
            '14': 'G',
            '15': 'F',
            '16': 'C',
            '17': 'D',
            '18': 'A',
            '19': 'B',
            '20': 'E',
            '21': 'chocolate',
            '22': 'information',
            '23': 'four',
            '24': 'older',
            '25': 'adults',
            '26': 'challenging',
            // Part 3 (27-40)
            '27': 'B',
            '28': 'C',
            '29': 'A',
            '30': 'A',
            '31': 'YES',
            '32': 'NOT GIVEN',
            '33': 'NO',
            '34': 'NOT GIVEN',
            '35': 'YES',
            '36': 'NO',
            '37': 'F',
            '38': 'B',
            '39': 'A',
            '40': 'D'
        };

        // --- INITIALIZATION ---
        function initialize() {
            console.log(`🚀 Initializing application...`);
            startTimer();
            initializeDragAndDrop();
            setupCheckboxLimits();
            setupExampleHeading();
            console.log(`📋 Setting up initial state - switching to part 1`);
            switchToPart(1); // Also calls goToQuestion(1) and updateNavigation
            
            document.body.addEventListener('input', updateAllIndicators);
            document.body.addEventListener('change', updateAllIndicators);
            deliverButton.addEventListener('click', checkAnswers);
            timerToggleButton.addEventListener('click', toggleTimer);
            timerResetButton.addEventListener('click', resetTimer);

            // Auto-close dropdowns for Questions 14-17 on selection
            ['q14','q15','q16','q17'].forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    sel.addEventListener('change', () => sel.blur());
                }
            });

            // Add click listeners to question containers for navigation
            document.querySelectorAll('[data-q-start]').forEach(el => {
                el.addEventListener('click', (event) => {
                    // Stop event propagation to prevent parent container clicks
                    event.stopPropagation();
                    
                    const qNum = parseInt(el.dataset.qStart, 10);
                    const qEnd = parseInt(el.dataset.qEnd, 10);
                    
                    console.log(`🖱️ Question container clicked - qNum: ${qNum}, qEnd: ${qEnd}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without valid question number, ignoring navigation`);
                        return;
                    }
                    
                    // Only navigate if this is a single question (qStart === qEnd) or if we're clicking on a specific question within a group
                    if (qNum === qEnd || el.classList.contains('tf-question')) {
                        if (currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum}`);
                            goToQuestion(qNum);
                        } else {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed`);
                        }
                    } else {
                        console.log(`ℹ️ Ignoring click on group container (${qNum}-${qEnd})`);
                    }
                });
            });
            
            // Add specific click listeners for individual question elements to prevent parent container interference
            document.querySelectorAll('.tf-question, .summary-text').forEach(el => {
                el.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(el.dataset.qStart, 10);
                    console.log(`🎯 Individual question element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN (like .summary-text containers)
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without specific question number, ignoring navigation`);
                        return;
                    }
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (individual element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (individual element)`);
                    }
                });
            });
            
            // Add specific click listeners for individual input elements in questions 21-26 and 33-36
            document.querySelectorAll('.answer-input[id^="q2"], .answer-input[id^="q3"]').forEach(input => {
                input.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(input.id.replace('q', ''), 10);
                    console.log(`📝 Input element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, input:`, input);
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (input element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (input element)`);
                    }
                });
            });
            
            // Add click listeners for the paragraph elements containing questions 21-26 and 33-36
            document.querySelectorAll('.summary-text p').forEach(p => {
                p.addEventListener('click', (event) => {
                    event.stopPropagation();
                    // Extract question number from the paragraph text (e.g., "21" from "<strong>21</strong>")
                    const strongElement = p.querySelector('strong');
                    if (strongElement) {
                        const qNum = parseInt(strongElement.textContent, 10);
                        console.log(`📄 Summary paragraph clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, paragraph:`, p);
                        
                        if (!isNaN(qNum) && currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (summary paragraph)`);
                            goToQuestion(qNum);
                        } else if (!isNaN(qNum)) {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed (summary paragraph)`);
                        }
                    }
                });
            });

            resizer.addEventListener('mousedown', initResize, false);
            initializeContextMenu();

            // Ensure indicators (answered states, counts) are correct on initial load
            updateAllIndicators();

            // Ensure the bottom menu reflects the currently focused input as active
            // 1) For text/select inputs with ids like q<number>
            document.querySelectorAll('.answer-input').forEach(inputEl => {
                const attach = (evtName) => inputEl.addEventListener(evtName, (e) => {
                    const id = inputEl.id || '';
                    if (id.startsWith('q')) {
                        const qNum = parseInt(id.replace('q',''), 10);
                        if (!isNaN(qNum)) {
                            goToQuestion(qNum);
                        }
                    } else {
                        // Fallback: find nearest container with data-q-start
                        const container = inputEl.closest('[data-q-start]');
                        if (container) {
                            const qNum = parseInt(container.dataset.qStart, 10);
                            if (!isNaN(qNum)) goToQuestion(qNum);
                        }
                    }
                });
                attach('focus');
                attach('click');
                attach('input');
                attach('change');
            });

            // 2) For radio buttons (TF/NG and MCQ)
            document.querySelectorAll('input[type="radio"]').forEach(radioEl => {
                const update = () => {
                    const name = radioEl.name || '';
                    if (name.startsWith('q')) {
                        const qNum = parseInt(name.replace('q',''), 10);
                        if (!isNaN(qNum)) {
                            goToQuestion(qNum);
                        }
                    }
                };
                radioEl.addEventListener('focus', update);
                radioEl.addEventListener('change', update);
                radioEl.addEventListener('click', update);
            });
            
            // 3) For clickable cells in questions 1-6 (matching table)
            const clickableCells = document.querySelectorAll('.clickable-cell');
            console.log('Found clickable cells:', clickableCells.length);
            
            // Temporary debug alert
            if (clickableCells.length === 0) {
                alert('No clickable cells found! This might indicate a problem.');
            } else {
                console.log('Successfully found clickable cells');
            }
            
            // Debug: Log each cell to see what we found
            clickableCells.forEach((cell, index) => {
                console.log(`Cell ${index}:`, cell);
                console.log(`  - data-question:`, cell.getAttribute('data-question'));
                console.log(`  - data-value:`, cell.getAttribute('data-value'));
                console.log(`  - classes:`, cell.className);
                
                cell.addEventListener('click', function() {
                    console.log('Cell clicked:', this);
                    const questionNum = this.getAttribute('data-question');
                    const value = this.getAttribute('data-value');
                    console.log('Question:', questionNum, 'Value:', value);
                    if (questionNum && value) {
                        selectCell(this, questionNum, value);
                    } else {
                        console.log('Missing data attributes:', { questionNum, value });
                    }
                });
            });
        }

        // --- CORE TEST LOGIC ---

        function checkAnswers() {
            // Disable all inputs to prevent changes
            const allInputs = document.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => {
                input.disabled = true;
            });

            // Disable all drag and drop functionality
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.cursor = 'not-allowed';
                item.style.pointerEvents = 'none';
            });

            document.querySelectorAll('.drop-zone, .passage-drag-zone').forEach(zone => {
                zone.style.pointerEvents = 'none';
                zone.classList.add('disabled');
            });

            // Disable submit button
            deliverButton.disabled = true;
            deliverButton.style.cursor = 'not-allowed';
            
            clearInterval(timerInterval);
            let score = 0;
            const totalQuestions = 40;
            const resultsDetailsContainer = document.getElementById('results-details');
            resultsDetailsContainer.innerHTML = '';

            document.querySelectorAll('.correct, .incorrect, .correct-answer-highlight').forEach(el => {
                el.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
            });
            document.querySelectorAll('.correct-answer-display').forEach(el => el.remove());

            for (let i = 1; i <= totalQuestions; i++) {
                const questionKey = String(i);
                const correctAnswer = correctAnswers[questionKey];
                let userAnswer = '';
                let isCorrect = false;
                
                let userAnswerDisplay = 'Not Answered';
                const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer;

                const textInput = document.getElementById(`q${i}`);
                const radioGroup = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);
                
                // Handle Text and Select Inputs
                if (textInput && (textInput.tagName === 'INPUT' || textInput.tagName === 'SELECT')) {
                    const element = textInput.closest('.matching-form-row') || textInput;
                    userAnswer = textInput.value.trim();
                    userAnswerDisplay = userAnswer || 'Not Answered';

                    const normalize = (s) => (s || '')
                        .toString()
                        .toLowerCase()
                        .replace(/[^a-z0-9\s]/g, '')
                        .replace(/\s+/g, ' ')
                        .trim();

                    if (textInput.tagName === 'SELECT') {
                        isCorrect = userAnswer === correctAnswer;
                    } else {
                        const normUser = normalize(userAnswer);
                        if (Array.isArray(correctAnswer)) {
                            isCorrect = correctAnswer.some(ans => normalize(ans) === normUser);
                        } else {
                            isCorrect = normalize(correctAnswer) === normUser;
                        }
                    }
                    
                    if (isCorrect) {
                        score++;
                        element.classList.add('correct');
                    } else {
                        element.classList.add('incorrect');
                        const correctAnswerSpan = document.createElement('span');
                        correctAnswerSpan.className = 'correct-answer-display';
                        correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswerText}</span>`;
                        textInput.parentNode.insertBefore(correctAnswerSpan, textInput.nextSibling);
                    }
                }
                // Handle drag and drop questions (any with a drop-zone for this question)
                else if (document.querySelector(`.drop-zone[data-q-start="${i}"]`)) {
                    console.log(`🔍 Checking drag-and-drop question ${i}`);
                    const dropZone = document.querySelector(`.drop-zone[data-q-start="${i}"]`);
                    const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;
                    
                    console.log(`📍 Drop zone for question ${i}:`, dropZone);
                    console.log(`📍 Dropped item for question ${i}:`, droppedItem);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (droppedItem) {
                        userAnswer = droppedItem.dataset.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        // Mark the drop zone as correct or incorrect
                        dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                        
                        // Show correct answer if wrong
                        if (!isCorrect && correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    } else {
                        // No answer provided - mark as incorrect
                        console.log(`⚠️ No answer provided for question ${i}`);
                        if (dropZone) {
                            dropZone.classList.add('incorrect');
                        }
                        if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    }
                }
                // Handle summary drag-and-drop questions (27-31) using summary-drop-zone
                else if (document.querySelector(`.summary-drop-zone[data-question="${i}"]`)) {
                    console.log(`🔍 Checking summary drag-and-drop question ${i}`);
                    const dropZone = document.querySelector(`.summary-drop-zone[data-question="${i}"]`);
                    const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;
                    const correctAnswer = correctAnswers[questionKey];

                    if (droppedItem) {
                        userAnswer = droppedItem.dataset.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;

                        dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                        if (isCorrect) {
                            score++;
                        } else if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    } else {
                        userAnswerDisplay = 'Not Answered';
                        dropZone.classList.add('incorrect');
                        if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    }
                }
                // Handle passage drag-and-drop questions (27-34) using passage-drag-zone
                else if (document.querySelector(`.passage-drag-zone[data-question="${i}"]`)) {
                    console.log(`🔍 Checking passage drag-and-drop question ${i}`);
                    const dropZone = document.querySelector(`.passage-drag-zone[data-question="${i}"]`);
                    const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;
                    const correctAnswer = correctAnswers[questionKey];

                    if (droppedItem) {
                        userAnswer = droppedItem.dataset.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;

                        dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                        if (isCorrect) {
                            score++;
                        } else if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    } else {
                        userAnswerDisplay = 'Not Answered';
                        dropZone.classList.add('incorrect');
                        if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    }
                }
                // Handle Radio Button Inputs (T/F, MCQs)
                else if (radioGroup.length > 0) {
                    const questionContainer = radioGroup[0]?.closest('.tf-question') || radioGroup[0]?.closest('.multi-choice-question');
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);

                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;

                        const userLabel = checkedRadio.closest('.tf-option, .multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        // Handle table radio buttons
                        if (checkedRadio.classList.contains('table-radio')) {
                            const tableCell = checkedRadio.closest('td');
                            if (tableCell) {
                                tableCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                            }
                        }
                    }

                    if (isCorrect) {
                        score++;
                    } else {
                        if (questionContainer){
                            const correctOptionEl = questionContainer.querySelector(`input[name="q${i}"][value="${correctAnswerText}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.tf-option, .multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    }
                }
                // Handle clickable-cell matrix questions (generic for any i that has clickable cells)
                else if (document.querySelector(`.clickable-cell[data-question="${i}"]`)) {
                    console.log(`🔍 Checking clickable cell question ${i}`);
                    const selectedCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-selected="true"]`);
                    console.log(`📍 Selected cell for question ${i}:`, selectedCell);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (selectedCell) {
                        userAnswer = selectedCell.dataset.answer;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        selectedCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                    
                    // Handle highlighting correct answers for incorrect responses
                    if (!isCorrect) {
                        const correctCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-value="${correctAnswerText}"]`);
                        if (correctCell) {
                            correctCell.classList.add('correct-answer-highlight');
                            console.log(`✅ Highlighted correct answer for question ${i}:`, correctCell);
                        } else {
                            console.log(`⚠️ Could not find correct cell for question ${i} with value "${correctAnswerText}"`);
                        }
                    }
                }
                // Handle text input questions (33-39)
                else if (i >= 33 && i <= 39) {
                    console.log(`🔍 Checking text input question ${i}`);
                    const textInput = document.getElementById(`q${i}`);
                    
                    if (textInput) {
                        userAnswer = textInput.value.trim().toLowerCase();
                        userAnswerDisplay = userAnswer || 'Not Answered';
                        
                        // Handle special case for question 33 which has two answers
                        if (i === 33) {
                            const answers = userAnswer.split('&').map(ans => ans.trim());
                            isCorrect = answers.includes('breathing') && answers.includes('eating');
                        } else {
                            isCorrect = userAnswer === correctAnswer.toLowerCase();
                        }
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        if (isCorrect) {
                            score++;
                            textInput.classList.add('correct');
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            textInput.classList.add('incorrect');
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle question 40 (multiple choice)
                else if (i === 40) {
                    console.log(`🔍 Checking multiple choice question ${i}`);
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);
                    
                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        const userLabel = checkedRadio.closest('.multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                            
                            // Highlight correct answer
                            const correctOptionEl = document.querySelector(`input[name="q${i}"][value="${correctAnswer}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle Checkbox Inputs (Multiple choice questions like 24-26)

                 
                // For showing results in the modal
                 const resultRow = `
                    <div class="result-row ${isCorrect ? 'correct' : 'incorrect'}">
                        <span class="q-num">${i}</span>
                        <span class="user-ans">${userAnswerDisplay}</span>
                        <span class="correct-ans">${correctAnswerText}</span>
                        <span class="status-badge ${isCorrect ? 'ok' : 'bad'}">${isCorrect ? 'Correct' : 'Incorrect'}</span>
                    </div>`;
                resultsDetailsContainer.innerHTML += resultRow;
                
                // Update nav button color
                const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${i})"]`);
                if (navButton) {
                    navButton.classList.remove('answered', 'active');
                    navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            }

            document.getElementById('results-score').textContent = score;
            document.getElementById('results-band').textContent = calculateBandScore(score);
            document.body.classList.add('results-mode');
            document.getElementById('results-modal').classList.remove('hidden');
            
            // Change button to "My Result" with green styling
            deliverButton.innerHTML = `<span>My Result</span>`;
            deliverButton.style.backgroundColor = '#4CAF50';
            deliverButton.style.color = 'white';
            deliverButton.style.borderColor = '#4CAF50';
            deliverButton.disabled = false;
            deliverButton.style.cursor = 'pointer';
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.addEventListener('click', showResultsModal);
            
            // Highlight correct answers in the passage
            highlightCorrectAnswersInPassage();
        }

        function calculateBandScore(score) {
            if (score >= 39) return '9.0';
            const mapping = {
                40: 9.0, 39: 9.0, 38: 8.5, 37: 8.5, 36: 8.0, 35: 8.0, 34: 7.5,
                33: 7.5, 32: 7.0, 31: 7.0, 30: 7.0, 29: 6.5, 28: 6.5, 27: 6.5,
                26: 6.0, 25: 6.0, 24: 6.0, 23: 5.5, 22: 5.5, 21: 5.5, 20: 5.5,
                19: 5.0, 18: 5.0, 17: 5.0, 16: 5.0, 15: 5.0, 14: 4.5, 13: 4.5,
                12: 4.0, 11: 4.0, 10: 4.0, 9: 3.5, 8: 3.5, 7: 3.0, 6: 3.0,
                5: 2.5, 4: 2.5
            };
            if (score <= 0) return 0.0;
            if (score === 1) return 1.0;
            if (score <= 3) return 2.0;
            if (score <= 5) return 2.5;
            return mapping[score] || 0.0;
        }

        function highlightCorrectAnswersInPassage() {
            // Define highlights for Part 1 (The Paradox of Choice)
            // Part 1: The Paradox of Choice
            const part1Highlights = [
                { question: 1, text: "we composed a set of statements—the Maximization Scale—to diagnose people's propensity to maximize".toLowerCase() },
                { question: 2, text: "When satisficers find an item that meets their standards, they stop looking".toLowerCase() },
                { question: 3, text: "We found that the greatest maximizers are the least happy with the fruits of their efforts".toLowerCase() },
                { question: 4, text: "To increase sense of happiness, we can decide to restrict our options when the decision is not crucial".toLowerCase() },
                { question: 5, text: "Yet recent research strongly suggests that, psychologically, this assumption is wrong, with 5% lower percentage announcing they are happy".toLowerCase() },
                { question: 6, text: "we think of individuals whose average scores are higher than 4 (the scale's midpoint) as maximisers and those whose scores are lower than the midpoint as satisficers".toLowerCase() },
                { question: 7, text: "Early Decision Making Research by Daniel Kahneman and Amos Tversky showed that people respond much more strongly to losses than gains".toLowerCase() },
                { question: 8, text: "Does it follow that maximizers are less happy in general than satisficers?".toLowerCase() },
                { question: 9, text: "we composed a set of statements—the Maximization Scale—to diagnose people's propensity to maximize".toLowerCase() },
                { question: 10, text: "The problem of opportunity costs will be better for a satisficer".toLowerCase() },
                { question: 11, text: "The reason for this, the investigators argued, was that the full-price payers would experience more regret if they did not use the tickets because not using the more costly tickets would constitute a bigger loss".toLowerCase() },
                { question: 12, text: "To increase sense of happiness, we can decide to restrict our options when the decision is not crucial".toLowerCase() },
                { question: 13, text: "The Influence of More Choices".toLowerCase() }
            ];

            // Part 2: Implication of False Belief Experiments
            const part2Highlights = [
                { question: 14, text: "A different explanation has been put forward by Harris. He proposed that children use 'simulation'".toLowerCase() },
                { question: 15, text: "Schatz studied the spontaneous speech of three-year-olds and found that these children used mental terms".toLowerCase() },
                { question: 16, text: "Wimmer and Perner devised a 'false belief task' to address this question".toLowerCase() },
                { question: 17, text: "Lewis investigated older children living in extended families in Crete and Cyprus. They found that children who socially interact with more adults".toLowerCase() },
                { question: 18, text: "A simpler version of the Maxi task was devised by Baron-Cohen to take account of criticisms that younger children may have been affected by the complexity and too much information".toLowerCase() },
                { question: 19, text: "Meins and her colleagues have found that what they term mind mindedness in maternal speech to six-month old infants is related to both security of attachment and to TOM abilities".toLowerCase() },
                { question: 20, text: "Dunn, who argues that peer interaction is more likely to contain pretend play and that it is likely to be more challenging because other children, unlike adults, do not make large adaptations to the communicative needs of other children".toLowerCase() },
                { question: 21, text: "Maxi left some chocolate in a blue cupboard before he went out".toLowerCase() },
                { question: 22, text: "younger children may have been affected by the complexity and too much information of the story in the task described above".toLowerCase() },
                { question: 23, text: "most normally-developing children are unable to pass the tasks until around age four".toLowerCase() },
                { question: 24, text: "Lewis investigated older children living in extended families in Crete and Cyprus".toLowerCase() },
                { question: 25, text: "children who socially interact with more adults，who have more friends. And who have more older siblings tend to pass TOM tasks at a slightly earlier age than other children".toLowerCase() },
                { question: 26, text: "peer interaction is more likely to contain pretend play and that it is likely to be more challenging".toLowerCase() }
            ];

            // Part 3: Musical Maladies
            const part3Highlights = [
                { question: 27, text: "I confess to feeling a little guilty reporting that my reactions to the book are mixed".toLowerCase() },
                { question: 28, text: "Sacks himself is the best part of Musicophilia. He richly documents his own life in the book and reveals highly personal experiences".toLowerCase() },
                { question: 29, text: "He wants to combine observation and description with the latest in technology".toLowerCase() },
                { question: 30, text: "There are now more sensitive tests, but Cicoria has declined to undergo them; he does not want to delve into the causes of his musicality".toLowerCase() },
                { question: 31, text: "I confess to feeling a little guilty reporting that my reactions to the book are mixed".toLowerCase() },
                { question: 32, text: "The photograph of him on the cover of the book— which shows him wearing headphones, eyes closed, clearly enchanted as he listens to Alfred Brendel perform Beethoven's Pathétique Sonata".toLowerCase() },
                { question: 33, text: "He knows that he needs to take heed of the latter, but his heart lies with the former".toLowerCase() },
                { question: 34, text: "brings us into the underappreciated realm of music therapy".toLowerCase() },
                { question: 35, text: "he tends to be rather uncritical in accepting scientific findings and theories".toLowerCase() },
                { question: 36, text: "he conveys no sense of urgency about the pursuit of new avenues in the diagnosis and treatment of music-brain disorders".toLowerCase() },
                { question: 37, text: "the many specific dissociations among components of music comprehension, such as loss of the ability to perceive harmony but not melody, indicate that there is no music center in the brain".toLowerCase() },
                { question: 38, text: "A drug can alleviate a symptom in one patient and aggravate it in another, or can have both positive and negative effects in the same patient".toLowerCase() },
                { question: 39, text: "in many of the cases described here the patient with music-brain symptoms is reported to have normal EEG results".toLowerCase() },
                { question: 40, text: "he does not call for their use".toLowerCase() }
            ];

            // --- Make highlight matching case-insensitive ---
            // (This is done in the applyHighlights function, not here. 
            // To make the matching case-insensitive, ensure the RegExp uses the 'i' flag in applyHighlights.)

            // Function to apply highlights to a passage
            function applyHighlights(passageElement, highlights) {
                if (!passageElement) return;

                // Clear any existing highlights
                passageElement.querySelectorAll('.answer-highlight').forEach(el => {
                    const parent = el.parentNode;
                    parent.replaceChild(document.createTextNode(el.textContent), el);
                    parent.normalize();
                });

                // Add highlights for each answer
                highlights.forEach(item => {
                    const paragraphs = passageElement.querySelectorAll('p');
                    paragraphs.forEach(paragraph => {
                        const html = paragraph.innerHTML;
                        if (!html || typeof html !== 'string') return;
                        if (html.toLowerCase().includes(item.text)) {
                            const escapeRegExp = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const re = new RegExp(escapeRegExp(item.text), 'i');
                            const badge = (item.question !== undefined && item.question !== null && item.question !== '')
                                ? `<span style="
                                    position: absolute;
                                    top: -8px;
                                    right: -8px;
                                    background-color: #2196f3;
                                    color: white;
                                    border-radius: 50%;
                                    width: 20px;
                                    height: 20px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 12px;
                                    font-weight: bold;
                                ">${item.question}</span>`
                                : '';
                            const replaced = html.replace(
                                re,
                                `<span class="answer-highlight" data-question="${item.question || ''}" style="
                                    background-color: #ffeb3b;
                                    padding: 2px 4px;
                                    border-radius: 3px;
                                    font-weight: bold;
                                    position: relative;
                                ">${item.text}${badge}</span>`
                            );
                            paragraph.innerHTML = replaced;
                        }
                    });
                });
            }

            // Apply highlights to Part 1 (The Green Revolution in China)
            const passageText1 = document.getElementById('passage-text-1');
            applyHighlights(passageText1, part1Highlights);

            // Apply highlights to Part 2 (Reclaiming the Night)
            const passageText2 = document.getElementById('passage-text-2');
            applyHighlights(passageText2, part2Highlights);

            // Apply highlights to Part 3 (Communicating Styles and Conflict)
            const passageText3 = document.getElementById('passage-text-3');
            applyHighlights(passageText3, part3Highlights);
        }

        function getUserAnswer(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
            const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);

            if (textInput) { // Handles <input type="text"> and <select>
                return { value: textInput.value, text: textInput.value || 'N/A' };
            }
            if (radioInput) {
                return { value: radioInput.value, text: radioInput.value };
            }
            if (dropZone) {
                const droppedItem = dropZone.querySelector('.drag-item');
                return { 
                    value: droppedItem ? droppedItem.dataset.value : null, 
                    text: droppedItem ? droppedItem.textContent.trim() : 'N/A' 
                };
            }
            // Handle clickable cells for questions 23-26
            if (qNum >= 23 && qNum <= 26) {
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return { value: selectedCell.dataset.answer, text: selectedCell.dataset.answer };
                }
            }
            return { value: null, text: 'N/A' };
        }

        function displayCorrectAnswer(qNum, correctAnswer) {
            // Handle multi-choice group questions (e.g., 24-26, 38-40)
            // No special checkbox groups used; fall through

            // Handle radio button questions by highlighting the correct label
            const correctRadioInput = document.querySelector(`input[name="q${qNum}"][value="${correctAnswer}"]`);
            if (correctRadioInput) {
                const parentOption = correctRadioInput.closest('.tf-option, .multi-choice-option');
                if (parentOption) {
                    parentOption.classList.add('correct-answer-highlight');
                    return;
                }
            }

            // Handle text inputs, select dropdowns, and others by showing the answer next to them
            const inputEl = document.getElementById(`q${qNum}`);
            if (inputEl) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                inputEl.insertAdjacentElement('afterend', displaySpan);
                return; // Done
            }
            
            // Fallback for questions identified by a container (e.g., some T/F/NG questions)
            const element = findQuestionElement(qNum);
            if (element) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                const itemContainer = element.querySelector('.tf-question-text');
                if (itemContainer) {
                     itemContainer.appendChild(displaySpan);
                } else {
                     element.appendChild(displaySpan);
                }
            }
        }
        
        function findQuestionElement(qNum) {
             return document.querySelector(`[data-q-start="${qNum}"]`);
        }

        function addResultToModal(qNum, userAnswer, correctAnswer, isCorrect) {
            const resultsDetails = document.getElementById('results-details');
            const row = document.createElement('div');
            row.className = 'result-row';
            if (!isCorrect) {
                row.classList.add('incorrect');
            }
            row.innerHTML = `
                <span class="q-num">${qNum}</span>
                <span class="user-ans">${userAnswer}</span>
                <span class="correct-ans">${correctAnswer}</span>
            `;
            resultsDetails.appendChild(row);
        }

        function showResultsModal() {
            document.getElementById('results-modal').classList.remove('hidden');
        }

        window.closeResultsModal = function() {
            document.getElementById('results-modal').classList.add('hidden');
            document.body.classList.remove('results-mode');
        }
        
        function disableInputs() {
            deliverButton.innerHTML = `<span>Checked! View Results.</span>`;
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.onclick = showResultsModal;

            document.querySelectorAll('input, select').forEach(el => {
                el.disabled = true;
                 if (el.matches('input[type=radio], input[type=checkbox]')) {
                     el.style.cursor = 'not-allowed';
                     el.parentElement.style.cursor = 'not-allowed';
                 }
            });
            document.querySelectorAll('.drag-item').forEach(el => {
                el.setAttribute('draggable', 'false');
                el.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(el => {
                el.classList.add('disabled');
            });
        }

        function checkValue(userValue, correctValue) {
            if (userValue === null || userValue === undefined) return false;
            const formattedUserValue = userValue.trim().toLowerCase();
            if (Array.isArray(correctValue)) {
                return correctValue.map(v => v.toLowerCase()).includes(formattedUserValue);
            } else {
                return formattedUserValue === String(correctValue).toLowerCase();
            }
        }

        function markQuestion(qNum, isCorrect) {
            const subQuestionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
            subQuestionBtn?.classList.add(isCorrect ? 'correct' : 'incorrect');

            const elementsToMark = [
                document.querySelector(`.tf-question[data-q-start="${qNum}"]`),
                document.querySelector(`.multi-choice-question[data-q-start="${qNum}"]`),
                document.querySelector(`.matching-question-item[data-q-start="${qNum}"]`),
                document.querySelector(`.drop-zone[data-q-start="${qNum}"]`),
                document.getElementById(`q${qNum}`),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.tf-option'),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.multi-choice-option')
            ];
            
            elementsToMark.forEach(el => {
                if (el) el.classList.add(isCorrect ? 'correct' : 'incorrect');
            });

             if (qNum === 14 || qNum === 15) {
                const multiChoiceContainer = document.querySelector('.multi-choice-question[data-q-start="14"]');
                if (multiChoiceContainer) multiChoiceContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
             } else if (qNum >= 1 && qNum <= 5) {
                const pMatchInput = document.getElementById(`q${qNum}`);
                if (pMatchInput) pMatchInput.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
        }

        function switchToPart(partNumber) {
            console.log(`🔀 switchToPart called with partNumber: ${partNumber}, currentPassage: ${currentPassage}`);
            
            currentPassage = partNumber;

            // Hide all passages and questions
            document.querySelectorAll('.reading-passage, .question-set, .part-header').forEach(el => {
                el.classList.add('hidden');
            });

            // Show the correct passage, questions, and header
            document.getElementById(`passage-text-${partNumber}`).classList.remove('hidden');
            document.getElementById(`questions-${partNumber}`).classList.remove('hidden');
            document.getElementById(`part-header-${partNumber}`).classList.remove('hidden');

            // Update bottom navigation 'selected' state
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.toggle('selected', (index + 1) === partNumber);
            });

            // Show/hide explanation buttons based on part
            const explanationButton = document.getElementById('show-explanation-btn');
            const explanationButtonPart3 = document.getElementById('show-explanation-btn-part3');
            
            if (explanationButton) {
                if (partNumber === 2) {
                    explanationButton.style.display = 'block';
                } else {
                    explanationButton.style.display = 'none';
                    // Hide explanation section when switching away from part 2
                    const explanationSection = document.getElementById('part-2-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButton.textContent = 'Show Explanation';
                        explanationButton.style.backgroundColor = '#4a90e2';
                    }
                }
            }
            
            if (explanationButtonPart3) {
                if (partNumber === 3) {
                    explanationButtonPart3.style.display = 'block';
                } else {
                    explanationButtonPart3.style.display = 'none';
                    // Hide explanation section when switching away from part 3
                    const explanationSection = document.getElementById('part-3-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButtonPart3.textContent = 'Show Explanation';
                        explanationButtonPart3.style.backgroundColor = '#4a90e2';
                    }
                }
            }

            console.log(`✅ switchToPart completed - switched to part ${partNumber}`);
            
            // Only go to first question when switching parts, not when staying in same part
            // This allows goToQuestion to work properly for specific question navigation
            // const firstQuestionOfPart = {1: 1, 2: 14, 3: 27}[partNumber];
            // goToQuestion(firstQuestionOfPart);
        }
        
        function goToQuestion(questionNumber) {
            console.log(`🎯 goToQuestion called with questionNumber: ${questionNumber}, currentQuestion: ${currentQuestion}, currentPassage: ${currentPassage}`);
            
            currentQuestion = questionNumber;

            let passageNumber = 1;
            if (questionNumber >= 14 && questionNumber <= 26) passageNumber = 2;
            else if (questionNumber >= 27) passageNumber = 3;
            
            console.log(`📍 Calculated passageNumber: ${passageNumber} for question ${questionNumber}`);
            
            if (currentPassage !== passageNumber) {
                console.log(`🔄 Switching from part ${currentPassage} to part ${passageNumber} for question ${questionNumber}`);
                switchToPart(passageNumber);
                return; 
            }

            console.log(`✅ Staying in same part (${currentPassage}) for question ${questionNumber}`);

            if (activeQuestionElement) {
                // Remove active style from previous block
                activeQuestionElement.classList.remove('active-question', 'active-input');
                // Also remove from the container block if we previously set it
                const prevBlock = activeQuestionElement.closest('[data-q-start]');
                if (prevBlock) prevBlock.classList.remove('active-question');
            }

            // First, try to find the specific input element for questions 33-36
            let targetEl = document.getElementById(`q${questionNumber}`);
            if (targetEl) {
                activeQuestionElement = targetEl;
                console.log(`✅ Found specific input element:`, targetEl);
                targetEl.classList.add('active-input');
                scrollIntoViewIfNeeded(targetEl);
            } else {
                // Fall back to looking for question containers
                targetEl = document.querySelector(`[data-q-start="${questionNumber}"]`);
                console.log(`🔍 Looking for target element with data-q-start="${questionNumber}":`, targetEl);

                if (targetEl) {
                    activeQuestionElement = targetEl;
                    console.log(`✅ Found target element:`, targetEl);
                    
                    if (targetEl.matches('input[type="text"]') || targetEl.matches('select')) {
                        targetEl.classList.add('active-input');
                        console.log(`📝 Added active-input class to input/select element`);
                    } else {
                        targetEl.classList.add('active-question');
                        console.log(`📋 Added active-question class to question element`);
                    }
                    scrollIntoViewIfNeeded(targetEl);
                } else {
                    console.log(`⚠️ Target element not found, looking for paragraph matching question`);
                    const pMatch = document.querySelector(`.paragraph-matching-question select[id="q${questionNumber}"]`);
                    if(pMatch) {
                        activeQuestionElement = pMatch;
                        pMatch.classList.add('active-input');
                        scrollIntoViewIfNeeded(pMatch);
                        console.log(`✅ Found paragraph matching question:`, pMatch);
                    } else {
                        console.log(`❌ No target element found for question ${questionNumber}`);
                    }
                }
            }

            updateNavigation();
            console.log(`✅ goToQuestion completed for question ${questionNumber}`);
        }
        
        // --- UI & NAVIGATION ---

        function updateNavigation() {
            console.log(`🔄 updateNavigation called for currentQuestion: ${currentQuestion}`);
            
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => btn.classList.remove('active'));
            const activeNav = document.querySelector(`.subQuestion[onclick="goToQuestion(${currentQuestion})"]`);
            if (activeNav) {
                activeNav.classList.add('active');
                console.log(`✅ Updated navigation - active nav button:`, activeNav);
            } else {
                console.log(`⚠️ No active navigation button found for question ${currentQuestion}`);
            }

            const inputs = document.querySelectorAll('.answer-input, .drop-zone.filled, .summary-drop-zone.filled');
            inputs.forEach(input => input.classList.remove('active-input'));
            
            const activeInput = document.getElementById(`q${currentQuestion}`);
            if (activeInput) {
                activeInput.classList.add('active-input');
                if (typeof activeInput.focus === 'function') {
                    activeInput.focus();
                }
                console.log(`✅ Focused on input element:`, activeInput);
            } else {
                console.log(`⚠️ No direct input found for question ${currentQuestion}, looking in question block`);
                // Prefer the specific question element for styling (TF/MCQ), fallback to any data-q-start container
                let activeQuestionBlock = document.querySelector(`.tf-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`.multi-choice-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`[data-q-start="${currentQuestion}"]`);
                if (activeQuestionBlock) {
                    // Add active-question class to style number badge
                    activeQuestionBlock.classList.add('active-question');
                    const firstInput = activeQuestionBlock.querySelector('input, select');
                    if(firstInput) {
                        firstInput.classList.add('active-input');
                         if (typeof firstInput.focus === 'function') {
                            firstInput.focus();
                        }
                        console.log(`✅ Focused on input in question block:`, firstInput);
                    } else {
                        console.log(`⚠️ No input found in question block for question ${currentQuestion}`);
                    }
                } else {
                    console.log(`❌ No question block found for question ${currentQuestion}`);
                }
            }
            
            console.log(`✅ updateNavigation completed`);
        }
        
        function selectDragItem(item) {
            if (selectedDragItem) {
                selectedDragItem.classList.remove('selected');
            }
            selectedDragItem = item;
            if (selectedDragItem) {
                selectedDragItem.classList.add('selected');
            }
        }
        
        window.nextQuestion = () => currentQuestion < 40 && goToQuestion(currentQuestion + 1);
        window.previousQuestion = () => currentQuestion > 1 && goToQuestion(currentQuestion - 1);

        function updateAllIndicators() {
            updateAttemptedCount(1, 1, 13);
            updateAttemptedCount(2, 14, 26);
            updateAttemptedCount(3, 27, 40);
            updateAnsweredNav();
        }
        
        function updateAnsweredNav() {
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => {
                let qNum = NaN;
                // Prefer parsing from onclick attribute to avoid SR-only text interference
                const onclickAttr = btn.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/goToQuestion\((\d+)\)/);
                    if (match) {
                        qNum = parseInt(match[1], 10);
                    }
                }

                // Fallback: try the visible number span
                if (isNaN(qNum)) {
                    const visibleSpan = btn.querySelector('span[aria-hidden="true"]');
                    if (visibleSpan) {
                        qNum = parseInt(visibleSpan.textContent.trim(), 10);
                    }
                }

                if (!isNaN(qNum) && isQuestionAnswered(qNum)) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            });
        }
        
        function isQuestionAnswered(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            if (textInput && (textInput.value.trim() !== '' || (textInput.classList.contains('drop-zone') && textInput.children.length > 0))) {
                return true;
            }
            const radio = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (radio) {
                return true;
            }
            const checkbox = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (checkbox) {
                return true;
            }
            // Handle drag & drop questions (e.g., 20-23)
            const dz = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);
            if (dz && dz.querySelector('.drag-item')) {
                return true;
            }
            // Handle summary drag & drop questions (27-31)
            const sdz = document.querySelector(`.summary-drop-zone[data-question="${qNum}"]`);
            if (sdz && sdz.querySelector('.drag-item')) {
                return true;
            }
            // Handle passage drag & drop questions (27-34)
            const pdz = document.querySelector(`.passage-drag-zone[data-question="${qNum}"]`);
            if (pdz && pdz.querySelector('.drag-item')) {
                return true;
            }
            // Handle clickable-cell matrix questions (any question using clickable cells)
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return true;
            }
            return false;
        }

        function scrollIntoViewIfNeeded(element) {
            const panel = element.closest('.questions-panel, .passage-panel');
            const panelRect = panel.getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();
            if (elementRect.top < panelRect.top || elementRect.bottom > panelRect.bottom) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // --- DRAG AND DROP ---
        
        function initializeDragAndDrop() {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('click', () => selectDragItem(item));
            });
            document.querySelectorAll('.drop-zone, .summary-drop-zone, .passage-drag-zone, .drag-options-container').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            if (draggedItem && draggedItem.dataset.dndGroup === targetZone.dataset.dndGroup) {
                targetZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            targetZone.classList.remove('drag-over');

            if (!draggedItem || draggedItem.dataset.dndGroup !== targetZone.dataset.dndGroup) {
                return;
            }

            const sourceZone = draggedItem.parentElement;
            if (sourceZone === targetZone) return; // Prevent dropping on itself

            const isTargetAcceptingZone = targetZone.classList.contains('drop-zone') || targetZone.classList.contains('summary-drop-zone') || targetZone.classList.contains('passage-drag-zone');
            const existingItemInTarget = isTargetAcceptingZone ? targetZone.querySelector('.drag-item') : null;

            // First, clear the target drop-zone of any text (like question numbers) before adding the new item.
            if (targetZone.classList.contains('drop-zone') || targetZone.classList.contains('summary-drop-zone')) {
                Array.from(targetZone.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        node.remove();
                    }
                });
            }

            // Handle passage drag zones - clear placeholder text
            if (targetZone.classList.contains('passage-drag-zone')) {
                targetZone.innerHTML = '';
            }

            // Move the item that was in the target (if any) to the source zone.
            if (existingItemInTarget) {
                sourceZone.appendChild(existingItemInTarget);
            }
            
            // Finally, move the dragged item to the target zone.
            targetZone.appendChild(draggedItem);
            targetZone.classList.add('filled');
            // Lock the pill-like appearance for items dropped into zones
            if (draggedItem) {
                draggedItem.style.cursor = 'default';
            }
            // Hide placeholder text (question number) once filled
            if (targetZone.textContent && /^\d+$/.test(targetZone.textContent.trim())) {
                targetZone.textContent = '';
            }

            // After the move, clean up the source zone if it's a drop-zone and is now empty.
            if (sourceZone.classList.contains('drop-zone') && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
                 const qNum = sourceZone.dataset.qStart;
                 sourceZone.innerText = qNum; // Restore the question number
            }
            // Also handle summary drop-zones when emptied
            if (sourceZone.classList.contains('summary-drop-zone') && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
            }
            // Handle passage drag zones when emptied
            if (sourceZone.classList.contains('passage-drag-zone') && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
                 const questionNum = sourceZone.dataset.question;
                 const sectionLetter = String.fromCharCode(64 + parseInt(questionNum) - 26); // Convert 27->A, 28->B, etc.
                 sourceZone.innerHTML = `Drag heading here for Section ${sectionLetter}`;
            }
            
            updateAllIndicators();
        }
        
        // --- MISC HELPERS ---
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval); // Ensure no multiple intervals
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    // checkAnswers(); // Disabled to prevent modal from opening automatically.
                }
            }, 1000);
            timerToggleButton.innerHTML = pauseIcon;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerToggleButton.innerHTML = playIcon;
        }

        function toggleTimer() {
            // Check based on the icon currently displayed
            if (timerToggleButton.innerHTML.includes('M6 19h4V5H6v14z')) { // Check for pause icon shape
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function resetTimer() {
            timeInSeconds = 3600;
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            startTimer();
            timerToggleButton.innerHTML = pauseIcon;
        }
        
        function setupCheckboxLimits() {
            const checkboxGroups = [
                { name: 'q38-40', limit: 3 }
            ];
            checkboxGroups.forEach(group => {
                const checkboxes = document.querySelectorAll(`input[name="${group.name}"]`);
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        const checkedCount = document.querySelectorAll(`input[name="${group.name}"]:checked`).length;
                        if (checkedCount > group.limit) checkbox.checked = false;
                        updateAllIndicators();
                    });
                });
            });
        }

        function setupExampleHeading() {
            const exampleBox = document.querySelector('.example-box');
            if(exampleBox){
                const title = document.createElement('p');
                title.style.fontWeight = 'bold';
                title.textContent = 'List of Statements';
                // exampleBox.insertBefore(title, exampleBox.firstChild);
            }
        }
        
        function initResize(e) {
            e.preventDefault();
            const startX = e.clientX;
            const startWidth = passagePanel.offsetWidth;
            
            const doDrag = (e) => {
                const newWidth = startWidth + e.clientX - startX;
                if (newWidth > 200 && (document.body.clientWidth - newWidth - resizer.offsetWidth) > 200) {
                    passagePanel.style.flex = `0 0 ${newWidth}px`;
                }
            };
            const stopDrag = () => {
                window.removeEventListener('mousemove', doDrag, false);
                window.removeEventListener('mouseup', stopDrag, false);
            };
            
            window.addEventListener('mousemove', doDrag, false);
            window.addEventListener('mouseup', stopDrag, false);
        }
        
        // --- CONTEXT MENU (Highlighting) ---
        
        function initializeContextMenu() {
            const panels = [passagePanel, questionsPanel];
            let targetElementForClear = null;

            // This listener simply tracks the last valid text selection in either panel.
            document.addEventListener('selectionchange', () => {
                const selection = window.getSelection();
                if (selection && !selection.isCollapsed && selection.toString().trim().length > 0) {
                    const range = selection.getRangeAt(0);
                    if (panels.some(panel => panel.contains(range.commonAncestorContainer))) {
                        selectedRange = range;
                        targetElementForClear = null; // New selection overrides clearing a specific element
                    }
                }
            });

            const showContextMenu = (e) => {
                const target = e.target;
                const isClickOnHighlight = target.closest('.highlight, .comment-highlight');
                const isSelectionActive = selectedRange && selectedRange.toString().trim().length > 0;
                
                let showMenu = false;

                if (isClickOnHighlight) {
                    document.getElementById('menu-highlight').style.display = 'none';
                    document.getElementById('menu-note').style.display = 'none';
                    document.getElementById('menu-clear').style.display = 'block';
                    document.getElementById('menu-clear-all').style.display = 'block';
                    contextMenu.targetElementForClear = isClickOnHighlight;
                    showMenu = true;
                } else if (isSelectionActive && panels.some(panel => panel.contains(selectedRange.commonAncestorContainer))) {
                    document.getElementById('menu-highlight').style.display = 'flex';
                    document.getElementById('menu-note').style.display = 'flex';
                    document.getElementById('menu-clear').style.display = 'none';
                    document.getElementById('menu-clear-all').style.display = 'block'; // Always show clear all
                    showMenu = true;
                }

                if (showMenu) {
                    e.preventDefault();
                    contextMenu.style.display = 'block';
                    const menuHeight = contextMenu.offsetHeight;
                    const menuWidth = contextMenu.offsetWidth;
                    let left = e.pageX;
                    let top = e.pageY;
                    if (left + menuWidth > window.innerWidth) left = window.innerWidth - menuWidth - 5;
                    if (top + menuHeight > window.innerHeight) top = e.pageY - menuHeight - 5;
                    else top = e.pageY - menuHeight - 5;
                    
                    contextMenu.style.left = `${left}px`;
                    contextMenu.style.top = `${top}px`;
                }
            };

            panels.forEach(panel => {
                panel.addEventListener('contextmenu', showContextMenu);
            });

            document.addEventListener('click', (e) => {
                if (contextMenu.style.display === 'block' && !contextMenu.contains(e.target)) {
                    closeContextMenu();
                }
            });
        }

        function closeContextMenu() {
            contextMenu.style.display = 'none';
            selectedRange = null; // Clear range after menu closes
        }

        function unwrapElement(element) {
            const parent = element.parentNode;
            if (!parent) return;
            while (element.firstChild) {
                parent.insertBefore(element.firstChild, element);
            }
            parent.removeChild(element);
            parent.normalize();
        }

        window.highlightText = () => {
            if (selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'highlight';
                span.appendChild(selectedRange.extractContents());
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.addNote = () => {
            const note = prompt('Enter your note:');
            if (note && selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = note;
                span.appendChild(selectedRange.extractContents());
                span.appendChild(tooltip);
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.clearHighlight = () => {
             const elementToClear = contextMenu.targetElementForClear;
             if (elementToClear) {
                 unwrapElement(elementToClear);
             }
             closeContextMenu();
             window.getSelection().removeAllRanges();
        };
        
        window.clearAllHighlights = () => {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(unwrapElement);
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        function updateAttemptedCount(part, startQ, endQ) {
            let answeredCount = 0;
            for (let i = startQ; i <= endQ; i++) {
                if (isQuestionAnswered(i)) {
                    answeredCount++;
                }
            }
            const partHeader = document.querySelector(`.footer__questionNo___3WNct[onclick="switchToPart(${part})"]`);
            if (partHeader) {
                const countSpan = partHeader.querySelector('.attemptedCount');
                if (countSpan) {
                     countSpan.textContent = `${answeredCount} of ${endQ - startQ + 1}`;
                }
            }
        }

        // --- GLOBAL FUNCTION EXPOSURE ---
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.goToQuestion = goToQuestion;
        window.switchToPart = switchToPart;
        window.closeResultsModal = closeResultsModal;
        window.highlightText = highlightText;
        window.addNote = addNote;
        window.clearHighlight = clearHighlight;
        window.clearAllHighlights = clearAllHighlights;
        
        // Explanation toggle function for Part 2
        window.toggleExplanation = function() {
            const explanationSection = document.getElementById('part-2-explanation');
            const button = document.getElementById('show-explanation-btn');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };
        
        // Explanation toggle function for Part 3
        window.toggleExplanationPart3 = function() {
            const explanationSection = document.getElementById('part-3-explanation');
            const button = document.getElementById('show-explanation-btn-part3');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };

        // --- START THE APP ---
        initialize();

        // Add event listeners for table radio buttons
        document.addEventListener('DOMContentLoaded', function() {
            const tableRadios = document.querySelectorAll('.table-radio');
            tableRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // Remove background color from all cells in the same row
                    const row = this.closest('tr');
                    const cells = row.querySelectorAll('td:not(.statement)');
                    cells.forEach(cell => {
                        cell.style.backgroundColor = '';
                    });
                    
                    // Add background color to the selected cell
                    if (this.checked) {
                        this.closest('td').style.backgroundColor = '#e3f2fd';
                    }
                    
                    updateAllIndicators();
                });
            });
        });

        // Global function for selecting cells
        window.selectCell = function(cell, questionNum, value) {
            console.log('selectCell called:', questionNum, value);
            
            // Remove selected class from all cells in the same row
            const row = cell.closest('tr');
            const cellsInRow = row.querySelectorAll('.clickable-cell');
            cellsInRow.forEach(c => {
                c.classList.remove('selected');
                c.removeAttribute('data-selected');
                c.removeAttribute('data-answer');
            });
            
            // Add selected class to clicked cell
            cell.classList.add('selected');
            cell.setAttribute('data-selected', 'true');
            cell.setAttribute('data-answer', value);
            
            console.log('Cell selected:', questionNum, value);
            updateAllIndicators();
        };



        // Note: switchToPart function is defined earlier in the code
        // This duplicate function has been removed to prevent conflicts
    });
    </script>
</body>
</html>