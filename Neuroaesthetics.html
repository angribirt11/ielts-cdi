<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Reading Passage 3 ‚Äî Neuroaesthetics</title>
<style>
  :root{--brand:#2563eb;--ink:#111827;--bg:#f7f7fb;--ok:#16a34a;--bad:#dc2626;--muted:#6b7280}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#111}
  .container{display:flex;gap:20px;max-width:1200px;margin:0 auto;padding:20px 20px 96px}
  .card{background:#fff;border-radius:12px;box-shadow:0 4px 14px rgba(0,0,0,.08);padding:20px;overflow:auto;max-height:90vh}
  .passage{flex:1}
  .questions{flex:1}
  h1{color:var(--ink);border-bottom:2px solid var(--brand);padding-bottom:10px;margin:0 0 14px}
  h2{color:var(--brand);margin:22px 0 10px}
  h3{margin:8px 0 0}
  .muted{color:var(--muted)}

  /* Timer */
  .timerWrap{position:fixed;top:16px;right:16px;display:flex;align-items:center;gap:8px;z-index:10}
  .timer{background:var(--brand);color:#fff;padding:10px 14px;border-radius:8px;font-weight:700}
  .tbtn{border:1px solid #e5e7eb;background:#fff;color:#111;padding:8px 10px;border-radius:8px;cursor:pointer}

  /* Questions */
  .qsection{margin:14px 0 6px}
  .qblock{padding:14px;border:1px solid #e5e7eb;border-radius:12px;margin:12px 0}
  .qhead{font-weight:600;margin-bottom:8px}
  .options{margin-top:8px}
  .options label{display:block;margin:6px 0}
  select,input[type="text"]{padding:8px;border-radius:8px;border:1px solid #e5e7eb;width:100%;max-width:520px}
  .submit{background:var(--brand);color:#fff;border:0;padding:12px 18px;border-radius:8px;cursor:pointer;font-size:16px;margin-top:16px}
  .submit:hover{filter:brightness(.95)}

  /* Results */
  .results{display:none;margin-top:18px;background:#f8f9fa;border-radius:10px;padding:16px}
  .results ul{list-style:none;padding:0;margin:8px 0 0}
  .results li{margin:6px 0;padding:8px;border-radius:8px}
  .results li.ok{background:#ecfdf5;color:#065f46}
  .results li.bad{background:#fef2f2;color:#991b1b}
  .results .meta{font-size:13px;color:var(--muted)}

  /* Footer chips */
  .footerNav{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #e5e7eb;padding:10px 12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;z-index:9}
  .chip{border:1px solid #d1d5db;background:#fff;color:#111;padding:6px 10px;border-radius:999px;cursor:pointer;font-size:14px}
  .chip.answered{border-color:#9ca3af;background:#f3f4f6}

  /* Highlights */
  .palette{position:fixed;background:#fff;padding:8px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.12);display:none;z-index:9}
  .hbtn{background:var(--brand);color:#fff;border:0;padding:6px 10px;border-radius:6px;margin:4px 4px 0 0;cursor:pointer}
  .highlight{background:yellow}

  .tg{position:fixed;bottom:96px;right:16px;background:#0088cc;color:#fff;border:0;padding:12px 16px;border-radius:9999px;display:flex;align-items:center;gap:8px;cursor:pointer;box-shadow:0 8px 20px rgba(0,136,204,.35)}
</style>
</head>
<body>
  <div class="timerWrap">
    <div class="timer" id="timer">20:00</div>
    <button class="tbtn" id="pauseBtn">‚è∏Ô∏è Pause</button>
    <button class="tbtn" id="resumeBtn" disabled>‚ñ∂Ô∏è Resume</button>
  </div>

  <!-- Highlight palettes -->
  <div class="palette" id="pPalette">
    <button class="hbtn" data-color="yellow">Yellow</button>
    <button class="hbtn" data-color="lightgreen">Green</button>
    <button class="hbtn" data-color="lightblue">Blue</button>
    <button class="hbtn" data-color="pink">Pink</button>
    <button class="hbtn" data-color="orange">Orange</button>
    <button class="hbtn" id="clearPMarks">Clear</button>
  </div>
  <div class="palette" id="qPalette">
    <button class="hbtn" data-color="yellow">Yellow</button>
    <button class="hbtn" data-color="lightgreen">Green</button>
    <button class="hbtn" data-color="lightblue">Blue</button>
    <button class="hbtn" data-color="pink">Pink</button>
    <button class="hbtn" data-color="orange">Orange</button>
    <button class="hbtn" id="clearQMarks">Clear</button>
  </div>

  <div class="container">
    <div class="card passage" id="passageCard">
      <h1 id="title"></h1>
      <div id="subtitle" class="muted"></div>

      <div id="passage">
        <h2>Reading Passage 3</h2>
        <h3>Neuroaesthetics</h3>

        <p>An emerging discipline called neuroaesthetics is seeking to bring scientific objectivity to the study of art, and has already given us a better understanding of many masterpieces. The blurred imagery of Impressionist paintings seems to stimulate the brain's amygdala, for instance. Since the amygdala plays a crucial role in our feelings, that finding might explain why many people find these pieces so moving.</p>

        <p>Could the same approach also shed light on abstract twentieth-century pieces, from Mondrian's geometrical blocks of colour, to Pollock's seemingly haphazard arrangements of splashed paint on canvas? Sceptics believe that people claim to like such works simply because they are famous. We certainly do have an inclination to follow the crowd. When asked to make simple perceptual decisions such as matching a shape to its rotated image, for example, people often choose a definitively wrong answer if they see others doing the same. It is easy to imagine that this mentality would have even more impact on a fuzzy concept like art appreciation, where there is no right or wrong answer.</p>

        <p><strong>Angelina Hawley-Dolan</strong>, of Boston College, Massachusetts, responded to this debate by asking volunteers to view pairs of paintings ‚Äì either the creations of famous abstract artists or the doodles of infants, chimps and elephants. They then had to judge which they preferred. A third of the paintings were given no captions, while many were labelled incorrectly ‚Äì volunteers might think they were viewing a chimp's messy brushstrokes when they were actually seeing an acclaimed masterpiece. In each set of trials, volunteers generally preferred the work of renowned artists, even when they believed it was by an animal or a child. It seems that the viewer can sense the artist's vision in paintings, even if they can't explain why.</p>

        <p><strong>Robert Pepperell</strong>, an artist based at Cardiff University, creates ambiguous works that are neither entirely abstract nor clearly representational. In one study, Pepperell and his collaborators asked volunteers to decide how 'powerful' they considered an artwork to be, and whether they saw anything familiar in the piece. The longer they took to answer these questions, the more highly they rated the piece under scrutiny, and the greater their neural activity. It would seem that the brain sees these images as puzzles, and the harder it is to decipher the meaning, the more rewarding is the moment of recognition.</p>

        <p>And what about artists such as <strong>Mondrian</strong>, whose paintings consist exclusively of horizontal and vertical lines encasing blocks of colour? Mondrian's works are deceptively simple, but eye-tracking studies confirm that they are meticulously composed, and that simply rotating a piece radically changes the way we view it. With the originals, volunteers' eyes tended to stay longer on certain places in the image, but with the altered versions they would flit across a piece more rapidly. As a result, the volunteers considered the altered versions less pleasurable when they later rated the work.</p>

        <p>In a similar study, <strong>Oshin Vartanian</strong> of Toronto University asked volunteers to compare original paintings with ones which he had altered by moving objects around within the frame. He found that almost everyone preferred the original, whether it was a Van Gogh still life or an abstract by Mir√≥. Vartanian also found that changing the composition of the paintings reduced activation in those brain areas linked with meaning and interpretation.</p>

        <p>In another experiment, <strong>Alex Forsythe</strong> of the University of Liverpool analysed the visual intricacy of different pieces of art, and her results suggest that many artists use a key level of detail to please the brain. Too little and the work is boring, but too much results in a kind of 'perceptual overload', according to Forsythe. What's more, appealing pieces both abstract and representational, show signs of 'fractals' ‚Äì repeated motifs recurring in different scales. Fractals are common throughout nature, for example in the shapes of mountain peaks or the branches of trees. It is possible that our visual system, which evolved in the great outdoors, finds it easier to process such patterns.</p>

        <p>It is also intriguing that the brain appears to process movement when we see a handwritten letter, as if we are replaying the writer's moment of creation. This has led some to wonder whether Pollock's works feel so dynamic because the brain reconstructs the energetic actions the artist used as he painted. This may be down to our brain's 'mirror neurons', which are known to mimic others' actions. The hypothesis will need to be thoroughly tested, however. It might even be the case that we could use neuroaesthetic studies to understand the longevity of some pieces of artwork. While the fashions of the time might shape what is currently popular, works that are best adapted to our visual system may be the most likely to linger once the trends of previous generations have been forgotten.</p>

        <p>It's still early days for the field of neuroaesthetics ‚Äì and these studies are probably only a taste of what is to come. It would, however, be foolish to reduce art appreciation to a set of scientific laws. We shouldn't underestimate the importance of the style of a particular artist, their place in history and the artistic environment of their time. Abstract art offers both a challenge and the freedom to play with different interpretations. In some ways, it's not so different to science, where we are constantly looking for systems and decoding meaning so that we can view and appreciate the world in a new way.</p>
      </div>
    </div>

    <div class="card questions">
      <h1>Questions</h1>
      <div id="qroot"></div>
      <button class="submit" id="submitBtn">Submit Answers</button>
      <div class="results" id="results">
        <h2>Your Results</h2>
        <div id="score" class="meta"></div>
        <ul id="answers"></ul>
      </div>
    </div>
  </div>

  <div class="footerNav" id="footerNav"></div>
  <button class="tg" id="tgBtn">üì¢ Join my Telegram</button>

<script>
/* =======================
   CONFIG
   ======================= */
const CONFIG = {
  title: "READING PASSAGE 3 ‚Äî Neuroaesthetics",
  subtitle: "You should spend about 20 minutes on Questions 27‚Äî40.",
  durationMinutes: 20,
  telegramLink: "https://t.me/yourchannel",
  showFooterNavigator: true,

  sections: [
    /* 27-30 MCQ */
    {
      type: "mcq",
      heading: "Questions 27‚Äî30",
      instructions: ["Choose the correct letter, A, B, C or D."],
      items: [
        { 
          id: 27, 
          text: "In the second paragraph, the writer refers to a shape-matching test in order to illustrate", 
          options:{
            A:"the subjective nature of art appreciation.",
            B:"the reliance of modern art on abstract forms.",
            C:"our tendency to be influenced by the opinions of others.",
            D:"a common problem encountered when processing visual data."
          }, 
          correct: "C" 
        },
        { 
          id: 28, 
          text: "Angelina Hawley-Dolan's findings indicate that people", 
          options:{
            A:"mostly favour works of art which they know well.",
            B:"hold fixed ideas about what makes a good work of art.",
            C:"are often misled by their initial expectations of a work of art.",
            D:"have the ability to perceive the intention behind works of art."
          }, 
          correct: "D" 
        },
        { 
          id: 29, 
          text: "Results of studies involving Robert Pepperell's pieces suggest that people", 
          options:{
            A:"can appreciate a painting without fully understanding it.",
            B:"find it satisfying to work out what a painting represents.",
            C:"vary widely in the time they spend looking at paintings.",
            D:"generally prefer representational art to abstract art."
          }, 
          correct: "B" 
        },
        { 
          id: 30, 
          text: "What do the experiments described in the fifth paragraph suggest about the paintings of Mondrian?", 
          options:{
            A:"They are more carefully put together than they appear.",
            B:"They can be interpreted in a number of different ways.",
            C:"They challenge our assumptions about shape and colour.",
            D:"They are easier to appreciate than many other abstract works."
          }, 
          correct: "A" 
        }
      ]
    },

    /* 31-33 Summary completion */
    {
      type: "summary",
      heading: "Questions 31‚Äî33",
      instructions: [
        "Complete the summary using the list of words, A‚ÄîH, below.",
        "A = interpretation ‚Ä¢ B = complexity ‚Ä¢ C = emotions ‚Ä¢ D = movements ‚Ä¢ E = skill ‚Ä¢ F = layout ‚Ä¢ G = concern ‚Ä¢ H = images"
      ],
      items: [
        { id: 31, prompt: "The discipline of neuroaesthetics aims to bring scientific objectivity to the study of art. Neurological studies of the brain, for example, demonstrate the impact which Impressionist paintings have on our __________.", correct: "C" },
        { id: 32, prompt: "Alex Forsythe of the University of Liverpool believes many artists give their works the precise degree of __________ which most appeals to the viewer's brain.", correct: "B" },
        { id: 33, prompt: "She also observes that pleasing works of art often contain certain repeated __________ which occur frequently in the natural world.", correct: "H" }
      ]
    },

    /* 34-39 YES/NO/NOT GIVEN */
    {
      type: "ynng",
      heading: "Questions 34‚Äî39",
      instructions: [
        "Do the following statements agree with the views of the writer in Reading Passage 3?",
        "YES if the statement agrees with the views of the writer",
        "NO if the statement contradicts the views of the writer",
        "NOT GIVEN if there is no information on this"
      ],
      items: [
        { id: 34, text: "Forsythe's findings contradicted previous beliefs on the function of 'fractals' in art.", correct: "NOT GIVEN" },
        { id: 35, text: "Certain ideas regarding the link between 'mirror neurons' and art appreciation require further verification.", correct: "YES" },
        { id: 36, text: "People's taste in paintings depends entirely on the current artistic trends of the period.", correct: "NO" },
        { id: 37, text: "Scientists should seek to define the precise rules which govern people's reactions to works of art.", correct: "NO" },
        { id: 38, text: "Art appreciation should always involve taking into consideration the cultural context in which an artist worked.", correct: "YES" },
        { id: 39, text: "It is easier to find meaning in the field of science than in that of art.", correct: "NO" }
      ]
    },

    /* 40 Single MCQ */
    {
      type: "mcq_single",
      heading: "Question 40",
      instructions: ["Choose the correct letter, A, B, C or D."],
      items: [
        { 
          id: 40, 
          text: "What would be the most appropriate subtitle for the article?", 
          options:{
            A:"Some scientific insights into how the brain responds to abstract art",
            B:"Recent studies focusing on the neural activity of abstract artists",
            C:"A comparison of the neurological bases of abstract and representational art",
            D:"How brain research has altered public opinion about abstract art"
          }, 
          correct: "A" 
        }
      ]
    }
  ]
};

/* =======================
   RENDER
   ======================= */
document.getElementById('title').textContent = CONFIG.title;
document.getElementById('subtitle').textContent = CONFIG.subtitle || '';

const qroot = document.getElementById('qroot');
const navIds = [];
const answersMap = {};

function sectionHeader(t){ const h=document.createElement('h2'); h.className='qsection'; h.textContent=t; return h; }

/* MCQ renderer */
function renderMCQ(sec){
  qroot.appendChild(sectionHeader(sec.heading));
  (sec.instructions||[]).forEach(tx=>{ const p=document.createElement('p'); p.className='muted'; p.textContent=tx; qroot.appendChild(p); });
  sec.items.forEach(it=>{
    const b=document.createElement('div'); b.className='qblock'; b.id=`anchor-${it.id}`;
    const opts=Object.entries(it.options).map(([k,v])=>`<label><input type="radio" name="q${it.id}" value="${k}"> ${k}. ${v}</label>`).join('');
    b.innerHTML=`<div class="qhead"><strong>${it.id}.</strong> ${it.text}</div><div class="options">${opts}</div>`;
    qroot.appendChild(b); navIds.push(it.id); answersMap[it.id]=it.correct||'';
  });
}

/* Single MCQ renderer */
function renderMCQSingle(sec){
  qroot.appendChild(sectionHeader(sec.heading));
  (sec.instructions||[]).forEach(tx=>{ const p=document.createElement('p'); p.className='muted'; p.textContent=tx; qroot.appendChild(p); });
  sec.items.forEach(it=>{
    const b=document.createElement('div'); b.className='qblock'; b.id=`anchor-${it.id}`;
    const opts=Object.entries(it.options).map(([k,v])=>`<label><input type="radio" name="q${it.id}" value="${k}"> ${k}. ${v}</label>`).join('');
    b.innerHTML=`<div class="qhead"><strong>${it.id}.</strong> ${it.text}</div><div class="options">${opts}</div>`;
    qroot.appendChild(b); navIds.push(it.id); answersMap[it.id]=it.correct||'';
  });
}

/* Summary completion renderer */
function renderSummary(sec){
  qroot.appendChild(sectionHeader(sec.heading));
  (sec.instructions||[]).forEach(tx=>{ const p=document.createElement('p'); p.className='muted'; p.textContent=tx; qroot.appendChild(p); });
  
  // Add summary title
  const summaryTitle = document.createElement('h3');
  summaryTitle.textContent = "Art and the Brain";
  qroot.appendChild(summaryTitle);
  
  sec.items.forEach(it=>{
    const b=document.createElement('div'); b.className='qblock'; b.id=`anchor-${it.id}`;
    const sel=`<select id="q${it.id}" name="q${it.id}">
      <option value="">‚Äî</option>
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
      <option value="D">D</option>
      <option value="E">E</option>
      <option value="F">F</option>
      <option value="G">G</option>
      <option value="H">H</option>
    </select>`;
    b.innerHTML=`<div class="qhead"><strong>${it.id}.</strong> ${it.prompt}</div><div class="options">${sel}</div>`;
    qroot.appendChild(b); navIds.push(it.id); answersMap[it.id]=it.correct||'';
  });
}

/* YES/NO/NOT GIVEN renderer */
function renderYNNG(sec){
  qroot.appendChild(sectionHeader(sec.heading));
  (sec.instructions||[]).forEach(tx=>{ const p=document.createElement('p'); p.className='muted'; p.textContent=tx; qroot.appendChild(p); });
  sec.items.forEach(it=>{
    const b=document.createElement('div'); b.className='qblock'; b.id=`anchor-${it.id}`;
    const opts=['YES','NO','NOT GIVEN'].map(v=>`<label><input type="radio" name="q${it.id}" value="${v}"> ${v}</label>`).join('');
    b.innerHTML=`<div class="qhead"><strong>${it.id}.</strong> ${it.text}</div><div class="options">${opts}</div>`;
    qroot.appendChild(b); navIds.push(it.id); answersMap[it.id]=it.correct||'';
  });
}

/* Build UI */
CONFIG.sections.forEach(sec=>{
  if (sec.type==='mcq') renderMCQ(sec);
  if (sec.type==='mcq_single') renderMCQSingle(sec);
  if (sec.type==='summary') renderSummary(sec);
  if (sec.type==='ynng') renderYNNG(sec);
});

/* Footer chips */
const footerNav=document.getElementById('footerNav');
(function(){
  if(!CONFIG.showFooterNavigator){ footerNav.style.display='none'; return; }
  footerNav.innerHTML='<strong class="muted">Questions:</strong>';
  [...new Set(navIds)].sort((a,b)=>a-b).forEach(id=>{
    const chip=document.createElement('button'); chip.className='chip'; chip.id=`chip-${id}`; chip.textContent=id;
    chip.addEventListener('click',()=>{ document.getElementById(`anchor-${id}`).scrollIntoView({behavior:'smooth',block:'center'}); });
    footerNav.appendChild(chip);
  });
})();

function markChipAnswered(id, answered){
  const chip=document.getElementById(`chip-${id}`); if(chip) chip.classList.toggle('answered', !!answered);
}

document.addEventListener('change',(e)=>{
  const m=String(e.target.name||e.target.id||'').match(/q(\d+)/);
  const id=m?+m[1]:null; if(!id) return;
  const answered=(e.target.type==='radio') ? (!!document.querySelector(`input[name='q${id}']:checked`))
                 : (e.target.value.trim().length>0);
  markChipAnswered(id, answered);
});

/* Timer */
let timeLeft=Math.max(1,+CONFIG.durationMinutes||20)*60;
const timer=document.getElementById('timer');
const pauseBtn=document.getElementById('pauseBtn');
const resumeBtn=document.getElementById('resumeBtn');
let paused=false, iv;
const fmt=s=>`${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
function startTick(){ if(iv) clearInterval(iv);
  iv=setInterval(()=>{ if(paused) return; timer.textContent=fmt(timeLeft); if(timeLeft<=0){ clearInterval(iv); alert("Time's up! Submitting."); submit(); } timeLeft--; },1000);
}
timer.textContent=fmt(timeLeft); startTick();
pauseBtn.addEventListener('click',()=>{ paused=true; pauseBtn.disabled=true; resumeBtn.disabled=false; });
resumeBtn.addEventListener('click',()=>{ paused=false; pauseBtn.disabled=false; resumeBtn.disabled=true; });

/* Submit & grading */
document.getElementById('submitBtn').addEventListener('click', submit);
function submit(){
  paused=true; pauseBtn.disabled=true; resumeBtn.disabled=false;
  let total=0, graded=0, correctCount=0;
  const itemsOut=[];
  const ids=Object.keys(answersMap);

  ids.forEach(key=>{
    const ans=answersMap[key];
    const label=key;
    let user='';
    const picked=document.querySelector(`input[name="q${key}"]:checked`);
    if(picked){ user=picked.value; }
    else if(document.getElementById('q'+key)){ user=document.getElementById('q'+key).value; }
    const shown=user||'No answer';

    if(String(ans).trim()===''){ total++; itemsOut.push({label, status:'‚Äî not graded ‚Äî', user:shown, correct:'(no key)'}); return; }

    total++; graded++;
    const ok = shown.trim().toUpperCase() === String(ans).trim().toUpperCase();
    if(ok) correctCount++;
    itemsOut.push({label, status: ok? '‚úì Correct' : '‚úó Incorrect', user:shown, correct:String(ans)});
  });

  document.getElementById('score').innerHTML = `Graded ${graded} of ${total} ‚Ä¢ Score: ${correctCount}/${graded}`;
  document.getElementById('answers').innerHTML = itemsOut.map(it=>`<li class="${/Correct/.test(it.status)?'ok':'bad'}">Q${it.label}: ${it.status} ‚Äî Your: <b>${it.user}</b> | Correct: <b>${it.correct}</b></li>`).join('');
  const r=document.getElementById('results'); r.style.display='block'; r.scrollIntoView({behavior:'smooth'});
}

/* Highlights */
const passageCard=document.getElementById('passageCard');
const pPalette=document.getElementById('pPalette');
passageCard.addEventListener('mouseup',(e)=>{
  const sel=window.getSelection(); if(!sel||sel.toString().trim().length===0) return;
  if(!passageCard.contains(sel.getRangeAt(0).commonAncestorContainer)) return;
  const r=passageCard.getBoundingClientRect(), x=Math.min(e.clientX-r.left,r.width-10), y=Math.max(0,e.clientY-r.top-40);
  pPalette.style.left=(r.left+x)+'px'; pPalette.style.top=(r.top+y)+'px'; pPalette.style.display='block';
});
document.addEventListener('mousedown',(e)=>{ if(!pPalette.contains(e.target)) pPalette.style.display='none'; });
pPalette.querySelectorAll('.hbtn[data-color]').forEach(btn=>{
  btn.addEventListener('click',()=>{ markSelection(btn.dataset.color, passageCard); pPalette.style.display='none'; });
});
document.getElementById('clearPMarks').addEventListener('click',()=>{
  passageCard.querySelectorAll('span.highlight').forEach(n=>{ const p=n.parentNode; while(n.firstChild) p.insertBefore(n.firstChild,n); p.removeChild(n); p.normalize(); });
  pPalette.style.display='none';
});

/* Questions highlight */
const qCard=document.querySelector('.card.questions');
const qPalette=document.getElementById('qPalette');
qCard.addEventListener('mouseup',(e)=>{
  const sel=window.getSelection(); if(!sel||sel.toString().trim().length===0) return;
  if(!qCard.contains(sel.getRangeAt(0).commonAncestorContainer)) return;
  const node = sel.getRangeAt(0).commonAncestorContainer.nodeType===1 ? sel.getRangeAt(0).commonAncestorContainer : sel.getRangeAt(0).commonAncestorContainer.parentNode;
  if (node.closest && node.closest('input,textarea,select')) return;
  const r=qCard.getBoundingClientRect(), x=Math.min(e.clientX-r.left,r.width-10), y=Math.max(0,e.clientY-r.top-40);
  qPalette.style.left=(r.left+x)+'px'; qPalette.style.top=(r.top+y)+'px'; qPalette.style.display='block';
});
document.addEventListener('mousedown',(e)=>{ if(!qPalette.contains(e.target)) qPalette.style.display='none'; });
qPalette.querySelectorAll('.hbtn[data-color]').forEach(btn=>{
  btn.addEventListener('click',()=>{ markSelection(btn.dataset.color, qCard); qPalette.style.display='none'; });
});
document.getElementById('clearQMarks').addEventListener('click',()=>{
  qCard.querySelectorAll('span.highlight').forEach(n=>{ const p=n.parentNode; while(n.firstChild) p.insertBefore(n.firstChild,n); p.removeChild(n); p.normalize(); });
  qPalette.style.display='none';
});

/* Helper */
function markSelection(color, scope){
  const sel=window.getSelection(); if(!sel||!sel.rangeCount) return;
  const range=sel.getRangeAt(0);
  if(!scope.contains(range.commonAncestorContainer)) return;
  const container=range.commonAncestorContainer.nodeType===1? range.commonAncestorContainer : range.commonAncestorContainer.parentNode;
  if (container.closest && container.closest('input, textarea, select')) return;
  const frag=range.extractContents();
  const span=document.createElement('span'); span.className='highlight'; span.style.backgroundColor=color; span.appendChild(frag);
  range.insertNode(span); sel.removeAllRanges();
}

/* TG button */
document.querySelector('.tg').addEventListener('click',()=>window.open(CONFIG.telegramLink,'_blank'));
</script>
</body>
</html>