<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }



        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;  
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
    color: #FFD700;              /* yellow text */
    text-decoration: none;
    font-weight: 700;            /* already bold */
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border: 2px solid #FFD700;   /* yellow border */
    border-radius: 9999px;
    background-color: #222;      /* dark background */
    line-height: 1;
    position: absolute;          /* top-right positioning */
    top: 20px;
    right: 20px;
    z-index: 9999;               /* stays on top */
}

.telegram-link:hover {
    background-color: #333;      /* slightly lighter dark on hover */
    color: #ffea00;              /* brighter yellow on hover */
    border-color: #ffea00;
}

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: calc(100vh - 60px); /* Full height minus header */
            position: relative;
        }

        /* Page watermark */
        body::after {
            content: "@cd_mock_test";
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 72px;
            font-weight: 800;
            letter-spacing: 2px;
            color: #000000;
            opacity: 0.04; /* subtle */
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        .panels-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
        }

        /* Passage Content */
        .text-center {
            text-align: center;
        }
        .reading-passage h4 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
       
        .reading-passage p {
            margin-bottom: 1.2em;
        }

        .question ul li label {
            display: block;
            margin-top: 8px;
            cursor: pointer;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }

        .resizer {
            width: 10px;
            cursor: col-resize;
            background-color: #f0f0f0;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="30" viewBox="0 0 10 30"><path d="M4 11h2v2H4zM4 15h2v2H4zM4 19h2v2H4z" fill="%23888"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            flex-shrink: 0;
            flex-grow: 0;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .map-svg {
            border: 2px solid #333;
            background: white;
        }

        .map-room {
            fill: #f9f9f9;
            stroke: #333;
            stroke-width: 1;
        }

        .map-text {
            font-family: Arial, sans-serif;
            font-size: 13px;
            text-anchor: middle;
            fill: #333;
        }

        .map-number {
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            fill: #333;
        }

        .room-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .room-label {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .room-label:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .room-label.dragging {
            opacity: 0.5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 6px;
            z-index: 101;
        }

        .nav-arrow {
            width: 48px;
            height: 48px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            transition: transform 0.1s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            outline: none;
        }
        .nav-arrow.prev { background-color: #4b5563; }
        .nav-arrow.next { background-color: #000000; }

        .nav-arrow:hover { transform: translateY(-1px); }
        .nav-arrow:active { transform: translateY(0); }
        .nav-arrow:focus-visible { box-shadow: 0 0 0 3px rgba(59,130,246,0.4); }

        .nav-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 768px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #fafbbdf8;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f3f4f6;
            color: #111827;
            border: 1px solid #d1d5db;
            padding: 10px 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.08s ease, background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            min-width: 160px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #ebedf0;
            border-color: #c7ccd4;
        }

        .footer__deliverButton___3FM07:active {
            transform: translateY(1px);
        }

        .footer__deliverButton___3FM07:focus-visible {
            box-shadow: 0 0 0 3px rgba(59,130,246,0.35);
            outline: none;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #eef0f3;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
            box-shadow: none;
        }

        

        .hidden {
            display: none !important;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #bfbfbf;
            border-radius: 4px;
            background-color: #fff;
            padding: 2px 8px;
            font-size: 16px;
            text-align: left;
            font-weight: 700;
            margin-right: 6px;
            margin-left: 6px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            height: 28px;
            min-width: 150px;
        }
        .answer-input.active-input,
        .answer-input:focus {
            border-color: #3581d8;
            border-width: 2px;
            outline: none;
        }
        .answer-input::placeholder {
            color: #666;
            font-weight: 700;
            text-align: center;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .summary-text .answer-input {
            width: 120px;
            height: 24px;
            font-size: 14px;
            margin: 0 4px;
        }
        .answer-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .answer-inputs .answer-input {
            width: 200px;
            height: 30px;
            font-size: 16px;
        }
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 200px;
        }
        .drag-item {
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            width: 50%;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px;
            display: flex;
            align-items: center;
            position: relative;
            color: #afafaf;
            font-weight: 600;
            height: 27px;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone.disabled {
            pointer-events: none;
        }
        .drop-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            padding: 2px;
        }
        .drag-options-container {
            margin-top: 10px;
        }
        .drag-options-container .drag-item {
            display: block;
            width: fit-content;
            font-size: 15px;
            padding: 0.5px 10px;
            margin-bottom: 5px;
        }
        .drag-options-container .drag-item:last-child {
            margin-bottom: 0;
        }
        .q-number {
            color: #888;
            font-size: 14px;
            font-weight: bold;
        }
        .questions-container {
            width: 100%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px 20px;
            border: 1px solid #e0e0e0;
            text-align: left;
            margin: 10px 20px;
            border-radius: 5px;
        }
        .part-header p {
            margin: 0;
        }
        .part-header p:first-child {
            margin-bottom: 5px;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .timer-container {
            display: flex;
            position: relative;
            cursor: default;
            color: #333;
            font-size: 16px;
            font-weight: 500;
            align-items: center;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .timer-controls button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .timer-controls button:hover {
            background: #e0e0e0;
        }

        .timer-controls button svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles for TRUE/FALSE/NOT GIVEN questions */
        .tf-question {
            margin-bottom: 25px;
            padding: 10px 0px;
            border-radius: 4px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .tf-question-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 5px 0px;
            border-radius: 4px;
        }
        .tf-question-number, .question-number-box {
            border: 2px solid #ccc;
            padding: 2px 8px;
            margin-right: 10px;
            border-radius: 3px;
            font-weight: bold;
            transition: border-color 0.3s;
            display: inline-block;
        }
        /* Active question blue outline for TF (clears when navigating away) */
        .tf-question.active-question .tf-question-number {
            border-color: #4a90e2;
        }
        .tf-question-text {
            padding-top: 3px;
        }
        .tf-options {
            padding-left: 5px;
        }
        .tf-option {
            display: block;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 10px 12px;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            background-color: #fff;
        }
        .tf-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .tf-option:has(input[type="radio"]:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for TF/NG */
        .tf-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            border-width: 1px;
        }
        .tf-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            border-width: 1px;
        }
        /* Ensure selected-blue visuals don't conflict once results are shown */
        body.results-mode .tf-option:has(input[type="radio"]:checked) {
            box-shadow: none;
        }
        .tf-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .tf-question.correct .tf-question-line {
            background-color: #e9f7ef;
        }
        .tf-question.incorrect .tf-question-line {
            background-color: #f8d7da;
        }
        .matching-question-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
        }
        .matching-options-bank {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .matching-questions {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .matching-question-item {
            display: flex;
            align-items: center;
            gap: 15px;

            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.3s;
        }
        .matching-question-item > span {
            flex: 1;
        }
        .matching-question-item.correct {
            background-color: #e9f7ef;
            border-color: #28a745 !important;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone {
            width: auto;
            min-width: 200px;
            flex-shrink: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-weight: bold;
            color: #aaa;
        }
        .matching-options-bank .drag-item {
            font-size: 15px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            max-width: 700px;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .summary-completion-container {
            margin-top: 20px;
        }
        .summary-text p {
            line-height: 3.0;
            font-size: 16px;
            margin-bottom: 12px;
        }
        .summary-text li {
            line-height: 2.2;
            margin-bottom: 10px;
        }
        .summary-drop-zone {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            max-width:200px;
            height: 25px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            padding: 0 5px;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            color: #aaa;
            font-weight: bold;
        }
        .summary-drop-zone.filled {
            border-color: #4a90e2;
        }
        .summary-drop-zone.active-input {
             border-color: #4a90e2;
             box-shadow: none;
        }
        .summary-drop-zone .drag-item {
            font-size: 15px;
            font-weight: bold;
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .summary-options-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .summary-options-bank .drag-item {
            flex-grow: 1;
            min-width: 100px;
            text-align: center;
        }

        /* Filled drop-zone pill styling */
        .drop-zone.filled {
            background-color: transparent;
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            padding: 0;
        }
        .drop-zone.filled .drag-item {
            width: auto;
            height: auto;
            display: inline-block;
            border: 2px solid #4a90e2;
            border-radius: 10px;
            padding: 4px 10px;
            font-weight: 700;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.15);
            cursor: default;
            white-space: nowrap;
        }
        .multi-choice-question {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
            border: 3px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }
        /* MCQ number badge: style first strong within prompt */
        .multi-choice-question .question-prompt p > strong:first-child {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            padding: 2px 6px;
            margin-right: 8px;
            border: 1px solid #d0d7e2;
            border-radius: 6px;
            background: #fff;
        }
        /* Active question blue outline for MCQ (clears when navigating away) */
        .multi-choice-question.active-question .question-prompt p > strong:first-child {
            border-color: #4a90e2;
            border-width: 2px;
        }
        .multi-choice-option {
            padding: 10px 12px;
            background-color: #fff;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .multi-choice-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .multi-choice-option:has(input:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for MCQ */
        .multi-choice-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            /* box-shadow: inset 0 0 0 2px rgba(40, 167, 69, 0.25) !important; */
            border-width: 1px;
            /* border-radius: 6px; */
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            /* box-shadow: inset 0 0 0 2px rgba(220, 53, 69, 0.25) !important; */
            border-width: 1px;
            /* border-radius: 6px; */
        }
        /* Correct answer reveal for unselected option after checking */
        .tf-option.correct-answer-highlight,
        .multi-choice-option.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }
        body.results-mode .multi-choice-option:has(input:checked) { box-shadow: none; }
        .multi-choice-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }
        .multi-choice-option input[type="checkbox"],
        .multi-choice-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4a90e2;
        }
        .multi-choice-option.correct {
            background-color: #e9f7ef;
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone.filled {
            border-color: #4a90e2;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            height: 40px;
        }
        .paragraph-matching-question {
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 12px;
        }
        .paragraph-matching-question .answer-input {
            width: 80px;
            flex-shrink: 0;
        }

        .matching-form-container {
            margin-top: 20px;
        }
        .matching-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .matching-form-label {
            flex-shrink: 0;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content {
            background: #ffffff;
            padding: 24px;
            border-radius: 14px;
            width: 92%;
            max-width: 780px;
            max-height: 86vh;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #e5e7eb;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        .modal-content h2 {
            text-align: center;
            margin-bottom: 18px;
            color: #111827;
        }
        .results-summary {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 16px;
            text-align: center;
            border-bottom: 1px solid #eef2f7;
            padding-bottom: 12px;
        }
        .results-summary p {
            margin: 0;
            font-size: 14px;
            color: #374151;
        }
        .results-summary p span {
            display: inline-block;
            padding: 4px 10px;
            margin-left: 6px;
            border-radius: 999px;
            background: #f3f4f6;
            font-weight: 700;
            color: #111827;
        }
        .results-details-container {
            overflow-y: auto;
            padding-right: 10px; /* For scrollbar */
            border-radius: 8px;
        }
        .result-row {
            display: grid;
            grid-template-columns: 56px 1fr 1fr;
            gap: 12px;
            padding: 10px 8px;
            border-bottom: 1px solid #eef2f7;
            font-size: 15px;
            align-items: center;
        }
        .result-row.correct {
            background-color: #f3faf5;
        }
        .result-row.incorrect {
            background-color: #fff5f5;
        }
        .result-row .q-num {
            font-weight: 700;
            color: #111827;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 42px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .result-row .user-ans {
            color: #374151;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .result-row .correct-ans {
            color: #065f46;
            font-weight: 600;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .correct-answer-display {
            font-weight: bold;
            color: #28a745;
            margin-left: 10px;
            font-size: 14px;
        }
        
        
        .centered-title {
    text-align: center;
    font-size: 50px;
    font-weight: bold;
    margin-bottom: 15px;
}

        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .matching-table th {
            background-color: #007bff;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }
        
        .matching-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .matching-table .statement {
            text-align: left;
            width: 60%;
        }
        
        .matching-table .table-radio {
            margin: 0;
            transform: scale(1.2);
        }
        
        .matching-table td:not(.statement) {
            text-align: center;
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table th:not(:first-child) {
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table td:not(.statement):has(input:checked) {
            background-color: #e3f2fd;
        }
        
        .matching-table input[type="radio"]:checked {
            accent-color: #007bff;
        }
        
        .matching-table td.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table td.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .options-row {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .matching-table .options-row td {
            font-weight: 500;
            text-align: center;
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .matching-table .options-row td:first-child {
            text-align: left;
            font-weight: normal;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell {
            cursor: pointer;
            transition: background-color 0.2s ease;
            min-height: 40px;
            border: 1px solid #ddd;
            position: relative;
        }
        
        .matching-table .clickable-cell:hover {
            background-color: #f0f8ff;
            border-color: #007bff;
        }
        
        .matching-table .clickable-cell.selected {
            background-color: #e3f2fd;
        }
        
        .matching-table .clickable-cell.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table .clickable-cell::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }
        
        .matching-table .clickable-cell.selected::after {
        }
        
        /* Explanation Section Styles */
        .explanation-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .explanation-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .explanation-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .explanation-content strong {
            color: #4a90e2;
            font-weight: 600;
        }
        
        #show-explanation-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        #show-explanation-btn:hover {
            background-color: #357abd;
        }

        /* Drag & Drop for Part 2 Paragraph Headings */
        .paragraph-drop-zone {
            border: 2px dashed #ccc;
            border-radius: 6px;
            padding: 6px 8px;
            margin: 8px 0;
            max-height: 28px;
            background-color: #f9f9f9;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            display: flex;
            align-items: center;
            font-weight: bold;
            color: #666;
            width: 97%;
        }
        .paragraph-drop-zone.drag-over {
            border-color: #4a90e2;
            background-color: #e3f2fd;
        }
        .paragraph-drop-zone.filled {
            border-color: #2196f3;
            background-color: #e3f2fd;
            color: #333;
            cursor: move;
        }
        
        /* Ensure correct/incorrect states override filled state */
        .paragraph-drop-zone.filled.correct {
            border-color: #4caf50 !important;
            background-color: #e8f5e8 !important;
        }
        
        .paragraph-drop-zone.filled.incorrect {
            border-color: #f44336 !important;
            background-color: #ffebee !important;
        }
        
        .paragraph-drop-zone.correct {
            border-color: #4caf50 !important;
            background-color: #e8f5e8 !important;
        }
        
        .paragraph-drop-zone.incorrect {
            border-color: #f44336 !important;
            background-color: #ffebee !important;
        }
        .heading-options-container {
            /* border: 1px solid #eeeeee; */
            border-radius: 6px;
            /* padding: 10px; */
            /* background: #fafafa; */
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .heading-drag-item {
            /* background-color: #f5f5f5; */
            /* border: 1px solid #dddddd; */
            /* border-radius: 6px; */
            /* padding: 8px 10px; */
            /* cursor: grab; */
            /* user-select: none; */
            /* font-weight: 500; */
            /* transition: all 0.2s ease; */
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .heading-drag-item:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }
        .heading-drag-item.dragging {
            opacity: 0.6;
        }
        .heading-drag-item.used {
            display: none;
        }

        /* Flow Chart Styling */
        .flow-chart {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            margin: 20px 0;
            padding: 20px;
            /* background: #f8f9fa; */
            /* border-radius: 8px; */
            /* border: 1px solid #dee2e6; */
        }

        .flow-step {
            background: white;
            border: 2px solid #333;
            border-radius: 0;
            padding: 15px 20px;
            /* width: 400px; */
            text-align: left;
            position: relative;
            font-size: 14px;
            line-height: 1.4;
            margin: 0;
        }

        .flow-step.input-step {
            background: white;
            border-color: #333;
        }

        .flow-arrow {
            font-size: 24px;
            color: #333;
            font-weight: 600;
            margin: 0;
            padding: 5px 0;
            line-height: 1;
        }

        .flow-step .answer-input {
            margin: 0 2px;
            width: 40px;
            height: 24px;
            /* background: #fff; */
            /* border: 1px solid #333; */
            font-weight: bold;
            font-size: 14px;
            /* text-align: center; */
            /* padding: 2px; */
        }

        .flow-title {
            font-weight: bold;
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
            text-align: left;
            width: 400px;
        }

/* === Text Size Modes (Non-breaking) === */
body.text-normal {}
body.text-large {}
body.text-xlarge {}

/* Scale key reading/UI text */
body.text-large p,
body.text-large li,
body.text-large .instruction,
body.text-large .question p,
body.text-large .multi-choice-option label,
body.text-large .checkbox-group label,
body.text-large .drag-item,
body.text-large .question-number,
body.text-large .answer-input,
body.text-large .reading-passage p,
body.text-large .summary-text p,
body.text-large .summary-text li {
  font-size: 18px !important;
}

body.text-xlarge p,
body.text-xlarge li,
body.text-xlarge .instruction,
body.text-xlarge .question p,
body.text-xlarge .multi-choice-option label,
body.text-xlarge .checkbox-group label,
body.text-xlarge .drag-item,
body.text-xlarge .question-number,
body.text-xlarge .answer-input,
body.text-xlarge .reading-passage p,
body.text-xlarge .summary-text p,
body.text-xlarge .summary-text li {
  font-size: 20px !important;
}

/* Headings / section titles */
body.text-large .section-title,
body.text-large .reading-passage h4,
body.text-large .part-header p:first-child {
  font-size: 20px !important;
}
body.text-xlarge .section-title,
body.text-xlarge .reading-passage h4,
body.text-xlarge .part-header p:first-child {
  font-size: 22px !important;
}

/* Optional: keep sub-question buttons comfy */
body.text-large .subQuestion { font-size: 16px !important; }
body.text-xlarge .subQuestion { font-size: 18px !important; }

/* === Text size switcher (header) === */
.text-size-switcher {
  position: absolute;
  top: 14px;
  right: 310px;           /* moved ~3 cm further left */
  z-index: 105;
  display: flex;
  align-items: center;
  gap: 6px;
  background: #fff;
  border: 1px solid #e0e0e0;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 14px;
}

.text-size-switcher select {
  padding: 2px 6px;
  font-size: 14px;
}

@media (max-width: 600px) {
  .text-size-switcher { right: 260px; } /* also shift left on smaller screens */
}

    </style>
</head>
<body>
    <div class="header">

<div class="text-size-switcher" aria-label="Text size">
  <label for="textSizeSelect"><strong>Text:</strong></label>
  <select id="textSizeSelect">
    <option value="normal">Normal</option>
    <option value="large">Large</option>
    <option value="xlarge">Extra Large</option>
  </select>
</div>

        <div class="timer-container">
            <span class="timer-display">60:00</span>
            <div class="timer-controls">
                <button id="timer-toggle-btn" title="Pause/Resume Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>
                </button>
                <button id="timer-reset-btn" title="Reset Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
                </button>
            </div>
        </div>
        <a href="https://t.me/cd_mock_test" target="_blank" class="telegram-link">
            For More CD Mocks
        </a>
    </div>

    <div class="main-container" id="main-container">
        <div id="passage-header-container">
            <div id="part-header-1" class="part-header">
                <p><strong>Passage One</strong></p>
                <p>Read the text and answer questions 1-13.</p>
            </div>
            <div id="part-header-2" class="part-header hidden">
                <p><strong>Passage Two</strong></p>
                <p>Read the text and answer questions 14-26.</p>
            </div>
            <div id="part-header-3" class="part-header hidden">
                <p><strong>Passage Three</strong></p>
                <p>Read the text and answer questions 27-40.</p>
            </div>
        </div>


         <div class="panels-container">
  <div class="passage-panel" id="passage-panel">
    
    <!-- ====================== PASSAGE 1 ====================== -->
<div id="passage-text-1" class="reading-passage">
  <h4 class="text-center">Katherine Mansfield</h4>
  <p><em>Katherine Mansfield was a modernist writer of short fiction who was born and brought up in New Zealand</em></p>

  <p><strong>A</strong> Katherine Mansfield Beauchamp Murry was born in 1888, into a prominent family in Wellington, New Zealand. She became one of New Zealand’s best-known writers, using the pen name of Katherine Mansfield. The daughter of a banker, and born into a middle-class family, she was also a first cousin of Countess Elizabeth von Arnim, a distinguished novelist in her time. Mansfield had two older sisters and a younger brother. Her father, Harold Beauchamp, went on to become the chairman of the Bank of New Zealand. In 1893, the Mansfield family moved to Karori, a suburb of Wellington, where Mansfield would spend the happiest years of her childhood; she later used her memories of this time as an inspiration for her <em>Prelude</em> story.</p>

  <p><strong>B</strong> Her first published stories appeared in the <em>High School Reporter</em> at the Wellington Girls’ High School magazine in 1898 and 1899. In 1902, she developed strong feelings for a musician who played the cello, Arnold Trowell, although her feelings were not, for the most part, returned. Mansfield herself was an accomplished cellist, having received lessons from Trowell’s father. Mansfield wrote in her journals of feeling isolated to some extent in New Zealand, and, in general terms, of her interest in the Māori people (New Zealand’s native people), who were often portrayed in a sympathetic light in her later stories, such as “How Pearl Button was Kidnapped”.</p>

  <p><strong>C</strong> She moved to London in 1903, where she attended Queen’s College, along with her two sisters. Mansfield recommenced playing the cello, an occupation that she believed, during her time at Queen’s, she would take up professionally. She also began contributing to the college newspaper, with such a dedication to it that she eventually became its editor. She was particularly interested in the works of the French writers of this period and the 19<sup>th</sup>-century British writer, Oscar Wilde, and she was appreciated amongst fellow students at Queen’s for her witty and charismatic approach to life and work. She met fellow writer Ida Baker, a South African, at the college, and the pair became lifelong friends. Mansfield did not actively support the suffragette movement in the UK. The women in New Zealand had gained the right to vote in 1893.</p>

  <p><strong>D</strong> Mansfield first began journeying onto other parts of Europe in the period 1903–1906, notably to Belgium and Germany. After finishing her schooling in England, she returned to New Zealand late in 1906, only then beginning to write short stories in a more serious way. She had several works published in Australia in a magazine called <em>Native Companion</em>. These works were her first paid writing work, and by this time she had her first story accepted for a professional literary journal. It was also the first occasion on which she used the pseudonym “K. Mansfield”.</p>

  <p><strong>E</strong> Mansfield rapidly grew discontented with the provincial New Zealand lifestyle, and with her family. Two years later she headed again to London. Her father sent her an annual subsidy of £100 for the rest of her life. In her later years, she would express both admiration and disdain for New Zealand in her journals.</p>

  <p><strong>F</strong> In 1911, Mansfield met John Middleton Murry, the Oxford scholar and editor of the literary magazine <em>Rhythm</em>. They were later to marry in 1918. Mansfield became a co-editor of <em>Rhythm</em>, which was subsequently called <em>The Blue Review</em>, in which more of her works were published. She and Murry lived in various houses in England and briefly in Paris. <em>The Blue Review</em> failed to gain enough readers and was no longer published. Their attempt to set up as writers in Paris was cut short by Murry’s bankruptcy, which resulted from the failure of this and other journals. Life back in England meant frequently changed addresses and very limited funds.</p>

  <p><strong>G</strong> Between 1915 and 1918, Mansfield moved between England and Bandol, France. She and Murry developed close contact with other well-known writers of the time such as D. H. Lawrence, Bertrand Russell and Aldous Huxley. By October 1918 Mansfield had become seriously ill; she had been diagnosed with tuberculosis and was advised to enter a sanatorium. She could no longer spend winters in London. In the autumn of 1918 she was so ill that she decided to go to Ospedaletti in Italy. It was the publication of <em>Bliss and Other Stories</em> in 1920 that was to solidify Mansfield’s reputation as a writer.</p>

  <p><strong>H</strong> Mansfield also spent time in Menton, France, as the tenant of her father’s cousin at “The Villa Isola Bella”. There she wrote the piece she pronounced to be “…the only story that satisfies me to any extent”.</p>

  <p><strong>I</strong> Mansfield produced a great deal of work in the final years of her life, and much of her prose and poetry remained unpublished at her death in 1923. After her death, her husband, Murry, took on the task of editing and publishing her works. His efforts resulted in two additional volumes of short stories: <em>The Doves’ Nest</em> and <em>Something Childish</em>, published in 1923 and 1924 respectively, the publication of her <em>Poems</em> as well as a collection of critical writings (<em>Novels and Novelists</em>) and a number of editions of Mansfield’s previously unpublished letters and journals.</p>

  <p><strong>J</strong> Today, Mansfield is widely regarded as one of the most important modernist short-story writers in English. Her precise observation, psychological insight and innovative narrative techniques influenced a generation of writers and ensured her a lasting place in twentieth-century literature.</p>
</div>

    <!-- ====================== PASSAGE 2 ====================== -->
<div id="passage-text-2" class="reading-passage hidden">
  <h4 class="text-center">Australian parrots</h4>
  <p><em>and their adaptation to habitat change</em></p>

  <p><strong>A</strong> Parrots are found across the tropic and in all southern hemisphere continents except Antarctica, but nowhere do they display such a richness of diversity and form as in Australia. One-sixth of the world’s 345 parrot species are found there, and Australia has long been renowned for the number and variety of its parrots.</p>

  <p><strong>B</strong> In the 16<sup>th</sup> century, the German cartographer Mercator made a world map that included a place, somewhere near present-day Australia, that he named <em>Terra Psittacorum</em> — the Land of Parrots — and the first European settlers in Australia often referred to the country as Parrot Land. In 1865, the celebrated British naturalist and wildlife artist John Gould said: “No group of birds gives Australia so typical and benign an air as the numerous species of this great family by which it is tenanted.”</p>

  <p><strong>C</strong> Parrots are descendants of an ancient line. Due to their great diversity, and since most species are found in Africa, Australia and South America, it was once almost certain that parrots originated millions of years ago on the ancient southern continent of Gondwana, before it broke up into the separate southern hemisphere continents we know today. Much of Gondwana comprised dense rainforests watered by huge slow-flowing rivers and expansive lakes, but by eight million years ago, great changes were under way. The centre of the continent of Australia had begun to dry out, and the rainforests that once covered it gradually contracted to the continental margins, where, to a limited extent, they still exist today.</p>

  <p><strong>D</strong> The creatures that remained in those shrinking rainforests had to adapt to the drier conditions or face extinction. Reacting to these desperate circumstances, the parrot family, typically found in jungles in other parts of the world, has populated some of Australia’s harshest environments. The parrots spread from ancestral forests through eucalypt woodlands to colonies in the central deserts of Australia, and as a consequence they diversifed into a wide range of species with adaptations that reflect the many changes animals and plants had to make to survive in these areas.</p>

  <p><strong>E</strong> These evolutionary pressures helped mould their beak, the substance from which (keratin) parrots’ beaks are made into a range of tools capable of gathering the new types of food favoured by various species of parrot. The size of a parrot’s short, blunt beak and the length of that beak’s curved upper section are related to the type of food each species eats. Cockatoos have comparatively long beaks that are perfect for extracting seeds from cones; other species have broader and stronger beaks that are designed for cracking hard seeds.</p>
</div>

    <!-- ====================== PASSAGE 3 ====================== -->
<div id="passage-text-3" class="reading-passage hidden">
  <h4 class="text-center">Yawning</h4>
  <p><em>How and why we yawn still presents problems for researchers in an area which has only recently been opened up to study</em></p>

  <p>When Robert R. Provine began studying yawning in the 1960s, it was difficult for him to convince research students of the merits of “yawning science”. Although it may appear quirky to some, Provine’s decision to study yawning was a logical extension of his research in developmental neuroscience.</p>

  <p>The verb “to yawn” is derived from the Old English <em>ganien</em> or <em>ginian</em>, meaning to gape or open wide. But in addition to gaping jaws, yawning has significant features that are easy to observe and analyse. Provine “collected” yawns to study by using a variation of the contagion response. He asked people to “think about yawning” and, once they began to yawn, to depress a button that would record from the start of the yawn to the exhalation at its end.</p>

  <p>Provine’s early discoveries can be summarised as follows: the yawn is highly stereotyped but not invariant in its duration and form. It is an excellent example of the instinctive “fixed action pattern” of classical animal-behaviour study, or ethology. It is not a reflex (short-duration, rapid, proportional response to a simple stimulus), but, once started, a yawn progresses with the inevitability of a wave. The standard yawn runs its course over about six seconds on average, but its duration can range from about three seconds to much longer than the average. There are no half-yawns: this is an example of the typical intensity of fixed action patterns and a reason why you cannot stifle yawns. Just like a cough, yawns can come in bouts with a highly variable inter-yawn interval, which is generally about 68 seconds but rarely more than 70. There is no relation between yawn frequency and duration: producers of short or long yawns do not compensate by yawning more or less often.</p>

  <p>Furthermore, Provine’s hypotheses about the form and function of yawning can be tested by three informative yawn variants which can be used to look at the roles of the nose, the mouth and the jaws.</p>

  <p><strong>i) The closed-nose yawn</strong><br>
  Subjects are asked to pinch their nose closed when they feel themselves start to yawn. Most subjects report being able to perform perfectly normal closed nose yawns. This indicates that inhalation at the onset of a yawn, and the exhalation at its end, need not involve the nostrils — the mouth provides a sufficient airway.</p>

  <p><strong>ii) The clenched-teeth yawn</strong><br>
  Subjects are asked to clench their teeth when they feel themselves start to yawn but allow themselves to inhale normally through open lips. This variant gives one the sensation of being stuck mid-yawn. This shows that gaping of the jaws is an essential component of the fixed action pattern of the yawn, and unless it is accomplished, the program (or pattern) will not run to completion. The yawn is also shown to be more than a deep breath, because, unlike normal breathing, inhalation and exhalation cannot be performed so well through the clenched teeth as through the nose.</p>

  <p><strong>iii) The nose yawn</strong><br>
  This variant tests the adequacy of the nasal airway to sustain a yawn. Unlike normal breathing, which can be performed equally well through mouth or nose, yawning is impossible via nasal inhalation alone. As with the clenched-teeth yawn, the nose yawn provides the unfulfilling sensation of being stuck in mid-yawn. Exhalation, on the other hand, can be accomplished equally well through nose or mouth. Through this methodology Provine demonstrated that inhalation through the oral airway and the gaping of jaws are necessary for normal yawns. The motor program for yawning will not run to completion without feedback that these parts of the program have been accomplished.</p>

  <p>But yawning is a powerful, generalised movement that involves much more than airway manoeuvres and jaw-gaping. When yawning you also stretch your facial muscles, tilt your head back, narrow or close your eyes, produce tears, salivate, open the Eustachian tubes of your middle ear and perform many other, yet unspecified, ocular-cardiovascular and respiratory acts. Yawning and stretching share properties and may be performed together as parts of a global motor complex.</p>

  <p>Studies by J. I. P. deVries et al. in the early 1980s, charting movement in the developing foetus using ultrasound, observed a link between yawning and stretching. The most extraordinary demonstration of the yawn-stretch linkage occurs in many people paralysed on one side of their body because of brain damage caused by a stroke. The prominent British neurologist Sir Francis Walshe noted in 1923 that when these people yawn, they are startled and mystified to observe that their otherwise paralysed arm rises and flexes automatically in what neurologists term an “associated response”. Yawning apparently activates undamaged, unconsciously controlled connections between the brain and the motor system, causing the paralysed limb to move. It is not known whether the associated response is a positive prognosis for recovery, nor whether yawning is therapeutic for prevention of muscular deterioration.</p>

  <p>Provine speculated that, in general, yawning may have many functions, and selecting a single function from the available options may be an unrealistic goal. Yawning appears to be associated with a change of behavioural state, switching from one activity to another. Yawning is also a reminder that an ancient and unconscious behaviour linking us to the animal world lurks beneath the veneer of culture, rationality and language.</p>
</div>
</div>


<div class="resizer" id="resizer"></div>
<div class="questions-panel" id="questions-panel">
    <div id="questions-1" class="question-set">
        <div class="questions-container">
            <!-- Questions 1-6: True/False/Not Given -->
            <div class="question" data-q-start="1" data-q-end="6">
                <div class="question-prompt">
                    <p><strong>Questions 1–6</strong></p>
                    <p>Do the following statements agree with the information given in Reading Passage 1?</p>
                    <p>In boxes 1–6 on your answer sheet, write</p>
                    <ul style="list-style: none; padding-left: 0;">
                        <li><strong>TRUE</strong> if the statement agrees with the information</li>
                        <li><strong>FALSE</strong> if the statement contradicts the information</li>
                        <li><strong>NOT GIVEN</strong> if there is no information on this</li>
                    </ul>
                </div>
                <div class="tf-question">
                    <p><strong>1 The name Katherine Mansfield, that appears on the writer’s book, was exactly the same as her origin name</strong></p>
                    <label><input type="radio" name="q1" value="TRUE"> TRUE</label><br>
                    <label><input type="radio" name="q1" value="FALSE"> FALSE</label><br>
                    <label><input type="radio" name="q1" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
                <div class="tf-question">
                    <p><strong>2 Mansfield won a prize for a story she wrote for the High School Reporter</strong></p>
                    <label><input type="radio" name="q2" value="TRUE"> TRUE</label><br>
                    <label><input type="radio" name="q2" value="FALSE"> FALSE</label><br>
                    <label><input type="radio" name="q2" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
                <div class="tf-question">
                    <p><strong>3 How Pearl Button Was Kidnapped portrayed Maori people in a favorable way</strong></p>
                    <label><input type="radio" name="q3" value="TRUE"> TRUE</label><br>
                    <label><input type="radio" name="q3" value="FALSE"> FALSE</label><br>
                    <label><input type="radio" name="q3" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
                <div class="tf-question">
                    <p><strong>4 When Mansfield was at Queen’s college, she planned to be a professional writer</strong></p>
                    <label><input type="radio" name="q4" value="TRUE"> TRUE</label><br>
                    <label><input type="radio" name="q4" value="FALSE"> FALSE</label><br>
                    <label><input type="radio" name="q4" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
                <div class="tf-question">
                    <p><strong>5 Mansfield was unpopular with the other students at Queen’s college</strong></p>
                    <label><input type="radio" name="q5" value="TRUE"> TRUE</label><br>
                    <label><input type="radio" name="q5" value="FALSE"> FALSE</label><br>
                    <label><input type="radio" name="q5" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
                <div class="tf-question">
                    <p><strong>6 In London, Mansfield showed little interest in politics</strong></p>
                    <label><input type="radio" name="q6" value="TRUE"> TRUE</label><br>
                    <label><input type="radio" name="q6" value="FALSE"> FALSE</label><br>
                    <label><input type="radio" name="q6" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
            </div>

            <!-- Questions 7-13: Note Completion -->
            <div class="question" data-q-start="7" data-q-end="13">
                <div class="question-prompt">
                    <p><strong>Questions 7–13</strong></p>
                    <p>Complete the notes below</p>
                    <p>Choose <strong>ONE WORD AND/OR A NUMBER</strong> from the passage for each answer</p>
                    <p>Write your answers in boxes 7–13 on your answer sheet</p>
                </div>
                <p><strong>Katherine Mansfield’s adult years</strong></p>
                <ul style="list-style: none; padding-left: 0;">
                    <li>7 <input type="text" id="q7" class="answer-input" placeholder="7" style="width: 100px;"></li>
                    <li>- moved from England back to New Zealand</li>
                    <li>- first paid writing work was in a publication based in 8 <input type="text" id="q8" class="answer-input" placeholder="8" style="width: 100px;"></li>
                    <li>- her 9 <input type="text" id="q9" class="answer-input" placeholder="9" style="width: 100px;"> and the New Zealand way of life made her feel dissatisfied</li>
                    <li>1908</li>
                    <li>- returned to London</li>
                    <li>1911 – 1919</li>
                    <li>- Met John Middleton Murry in 1911</li>
                    <li>- 10 <input type="text" id="q10" class="answer-input" placeholder="10" style="width: 100px;"> prevented Mansfield and Murry from staying together in Paris</li>
                    <li>- spent time with distinguished 11 <input type="text" id="q11" class="answer-input" placeholder="11" style="width: 100px;"></li>
                    <li>- from 1916, tuberculosis restricted the time she spent in London</li>
                    <li>1920</li>
                    <li>- her 12 <input type="text" id="q12" class="answer-input" placeholder="12" style="width: 100px;"> was consolidated when <em>Bliss and Other Stories</em> was published</li>
                    <li>- wrote several stories at “Villa Isola Bella”</li>
                    <li>1923 – 1924</li>
                    <li>Mansfield’s 13 <input type="text" id="q13" class="answer-input" placeholder="13" style="width: 100px;"> published more of her works after her death</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="questions-2" class="question-set">
        <div class="questions-container">
            <!-- Questions 14-19: Matching Information -->
            <div class="question" data-q-start="14" data-q-end="19">
                <div class="question-prompt">
                    <p><strong>Questions 14–19</strong></p>
                    <p>Reading Passage 2 has ten paragraphs, A–J</p>
                    <p>Which paragraph contains the following information?</p>
                    <p>Write the correct letter, A–J, in boxes 14–19 on your answer sheet</p>
                </div>
                <div class="matching-question">
                    <p><strong>14 An example of how one parrot species may survive at the expense of another</strong></p>
                    <select id="q14">
                        <option value="" disabled selected>Select A–J</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                    </select>
                </div>
                <div class="matching-question">
                    <p><strong>15 A description of how plants may adapt to attract birds</strong></p>
                    <select id="q15">
                        <option value="" disabled selected>Select A–J</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                    </select>
                </div>
                <div class="matching-question">
                    <p><strong>16 Example of two parrot species which benefited from changes to the environment</strong></p>
                    <select id="q16">
                        <option value="" disabled selected>Select A–J</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                    </select>
                </div>
                <div class="matching-question">
                    <p><strong>17 How the varied Australian landscape resulted in a great variety of parrot species</strong></p>
                    <select id="q17">
                        <option value="" disabled selected>Select A–J</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                    </select>
                </div>
                <div class="matching-question">
                    <p><strong>18 A reason why most parrot species are native to the southern hemisphere</strong></p>
                    <select id="q18">
                        <option value="" disabled selected>Select A–J</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                    </select>
                </div>
                <div class="matching-question">
                    <p><strong>19 An example of a parrot species which did not survive changes to its habitat</strong></p>
                    <select id="q19">
                        <option value="" disabled selected>Select A–J</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                        <option value="H">H</option>
                        <option value="I">I</option>
                        <option value="J">J</option>
                    </select>
                </div>
            </div>

            <!-- Questions 20-22: Multiple Choice -->
            <div class="question" data-q-start="20" data-q-end="22">
                <div class="question-prompt">
                    <p><strong>Questions 20–22</strong></p>
                    <p>Choose the correct letter, A, B, C, or D</p>
                    <p>Write the correct letter in boxes 20–22 on your answer sheet</p>
                </div>
                <div class="mcq-question">
                    <p><strong>20 The writer believes that most parrot species</strong></p>
                    <label><input type="radio" name="q20" value="A"> A Move from Africa and South America to Australia</label><br>
                    <label><input type="radio" name="q20" value="B"> B Had ancestors in either Africa, Australia or South America</label><br>
                    <label><input type="radio" name="q20" value="C"> C Had ancestors in a continent which later split up</label><br>
                    <label><input type="radio" name="q20" value="D"> D Came from a continent now covered by water</label>
                </div>
                <div class="mcq-question">
                    <p><strong>21 What does the Writer say about parrot’s beak?</strong></p>
                    <label><input type="radio" name="q21" value="A"> A They are longer than those of other birds</label><br>
                    <label><input type="radio" name="q21" value="B"> B They are made of a unique material</label><br>
                    <label><input type="radio" name="q21" value="C"> C They are used more efficiently than those of other species</label><br>
                    <label><input type="radio" name="q21" value="D"> D They are specially adapted to suit the diet</label>
                </div>
                <div class="mcq-question">
                    <p><strong>22 Which of the following is NOT mentioned by the writer as a disadvantage of nesting boxes?</strong></p>
                    <label><input type="radio" name="q22" value="A"> A They cost too much</label><br>
                    <label><input type="radio" name="q22" value="B"> B They need to be maintained</label><br>
                    <label><input type="radio" name="q22" value="C"> C They provide only shelter, not food</label><br>
                    <label><input type="radio" name="q22" value="D"> D They are too few of them</label>
                </div>
            </div>

            <!-- Questions 23-26: Summary Completion -->
            <div class="question" data-q-start="23" data-q-end="26">
                <div class="question-prompt">
                    <p><strong>Questions 23–26</strong></p>
                    <p>Complete the summary below</p>
                    <p>Choose <strong>NO MORE THAN TWO WORDS AND/OR A NUMBER</strong> from the passage for each answer</p>
                    <p>Write your answers in boxes 23–26 on your answer sheet</p>
                </div>
                <p><strong>Parrots in Australia</strong></p>
                <p>There are 345 varieties of parrot in existence and, of these, 23 <input type="text" id="q23" class="answer-input" placeholder="23" style="width: 100px;"> live in Australia. As early as the 24 <input type="text" id="q24" class="answer-input" placeholder="24" style="width: 100px;">, the mapmaker 25 <input type="text" id="q25" class="answer-input" placeholder="25" style="width: 100px;"> recognized that parrots lived in that part of the world. 26 <input type="text" id="q26" class="answer-input" placeholder="26" style="width: 100px;">, the famous painter of animals and birds, commented on the size and beauty of the Australian parrot family.</p>
            </div>
        </div>
    </div>

    <div id="questions-3" class="question-set">
        <div class="questions-container">
            <!-- Questions 27-32: Summary Completion (Matching) -->
            <div class="question" data-q-start="27" data-q-end="32">
                <div class="question-prompt">
                    <p><strong>Questions 27–32</strong></p>
                    <p>Complete the summary below using the list of words, A–K, below</p>
                    <p>Write the correct letter, A–K, in boxes 27–32 on your answer sheet</p>
                </div>
                <p><strong>Provine’s early findings on yawns</strong></p>
                <p>Through his observation of yawns, Provine was able to confirm that 27 <select id="q27"><option value="" disabled selected>Select A–K</option><option value="A">A form and function</option><option value="B">B long yawns</option><option value="C">C 3 seconds</option><option value="D">D fixed action pattern</option><option value="E">E 68 seconds</option><option value="F">F short yawns</option><option value="G">G reflex</option><option value="H">H sneeze</option><option value="I">I short duration</option><option value="J">J 6 seconds</option><option value="K">K half-yawns</option></select> do not exist. Just like a 28 <select id="q28"><option value="" disabled selected>Select A–K</option><option value="A">A form and function</option><option value="B">B long yawns</option><option value="C">C 3 seconds</option><option value="D">D fixed action pattern</option><option value="E">E 68 seconds</option><option value="F">F short yawns</option><option value="G">G reflex</option><option value="H">H sneeze</option><option value="I">I short duration</option><option value="J">J 6 seconds</option><option value="K">K half-yawns</option></select>, yawns cannot be interrupted after they have begun. This is because yawns occur as a 29 <select id="q29"><option value="" disabled selected>Select A–K</option><option value="A">A form and function</option><option value="B">B long yawns</option><option value="C">C 3 seconds</option><option value="D">D fixed action pattern</option><option value="E">E 68 seconds</option><option value="F">F short yawns</option><option value="G">G reflex</option><option value="H">H sneeze</option><option value="I">I short duration</option><option value="J">J 6 seconds</option><option value="K">K half-yawns</option></select> rather than a stimulus response as was previously thought.</p>
                <p>In measuring the time taken to yawn, Provine found that a typical yawn lasts about 30 <select id="q30"><option value="" disabled selected>Select A–K</option><option value="A">A form and function</option><option value="B">B long yawns</option><option value="C">C 3 seconds</option><option value="D">D fixed action pattern</option><option value="E">E 68 seconds</option><option value="F">F short yawns</option><option value="G">G reflex</option><option value="H">H sneeze</option><option value="I">I short duration</option><option value="J">J 6 seconds</option><option value="K">K half-yawns</option></select>. He also found that it is common for people to yawn a number of times in quick succession with the yawns usually being around 31 <select id="q31"><option value="" disabled selected>Select A–K</option><option value="A">A form and function</option><option value="B">B long yawns</option><option value="C">C 3 seconds</option><option value="D">D fixed action pattern</option><option value="E">E 68 seconds</option><option value="F">F short yawns</option><option value="G">G reflex</option><option value="H">H sneeze</option><option value="I">I short duration</option><option value="J">J 6 seconds</option><option value="K">K half-yawns</option></select> apart. When studying whether length and rate were connected, Provine concluded that people who yawn less do not necessarily produce 32 <select id="q32"><option value="" disabled selected>Select A–K</option><option value="A">A form and function</option><option value="B">B long yawns</option><option value="C">C 3 seconds</option><option value="D">D fixed action pattern</option><option value="E">E 68 seconds</option><option value="F">F short yawns</option><option value="G">G reflex</option><option value="H">H sneeze</option><option value="I">I short duration</option><option value="J">J 6 seconds</option><option value="K">K half-yawns</option></select>.</p>
                <p><strong>List of Words</strong></p>
                <p>A form and function</p>
                <p>B long yawns</p>
                <p>C 3 seconds</p>
                <p>D fixed action pattern</p>
                <p>E 68 seconds</p>
                <p>F short yawns</p>
                <p>G reflex</p>
                <p>H sneeze</p>
                <p>I short duration</p>
                <p>J 6 seconds</p>
                <p>K half-yawns</p>
            </div>

            <!-- Questions 33-37: Multiple Choice -->
            <div class="question" data-q-start="33" data-q-end="37">
                <div class="question-prompt">
                    <p><strong>Questions 33–37</strong></p>
                    <p>Choose the correct letter, A, B, C, or D</p>
                    <p>Write the correct letter in boxes 33–37 on your answer sheet</p>
                </div>
                <div class="mcq-question">
                    <p><strong>33 What did Provine conclude from his ‘closed nose yawn’ experiment?</strong></p>
                    <label><input type="radio" name="q33" value="A"> A Ending a yawn requires use of the nostrils</label><br>
                    <label><input type="radio" name="q33" value="B"> B You can yawn without breathing through your nose</label><br>
                    <label><input type="radio" name="q33" value="C"> C Breathing through the nose produces a silent yawn</label><br>
                    <label><input type="radio" name="q33" value="D"> D The role of the nose in yawning needs further investigation</label>
                </div>
                <div class="mcq-question">
                    <p><strong>34 Provine’s clenched teeth yawn’s experiment shows that</strong></p>
                    <label><input type="radio" name="q34" value="A"> A Yawning is unconnected with fatigue</label><br>
                    <label><input type="radio" name="q34" value="B"> B A yawn is the equivalent of a deep intake of breath</label><br>
                    <label><input type="radio" name="q34" value="C"> C You have to be able to open your mouth wide to yawn</label><br>
                    <label><input type="radio" name="q34" value="D"> D Breathing with the teeth together is as efficient as through the nose</label>
                </div>
                <div class="mcq-question">
                    <p><strong>35 The nose yawn experiment was used to test whether yawning</strong></p>
                    <label><input type="radio" name="q35" value="A"> A Can be stopped after it has started</label><br>
                    <label><input type="radio" name="q35" value="B"> B Is the result of motor programing</label><br>
                    <label><input type="radio" name="q35" value="C"> C Involves both inhalation and exhalation</label><br>
                    <label><input type="radio" name="q35" value="D"> D Can be accomplished only through the nose</label>
                </div>
                <div class="mcq-question">
                    <p><strong>36 In people paralyzed on one side because of brain damage</strong></p>
                    <label><input type="radio" name="q36" value="A"> A Yawning may involve only one side of the face</label><br>
                    <label><input type="radio" name="q36" value="B"> B The yawing response indicates that recovery is likely</label><br>
                    <label><input type="radio" name="q36" value="C"> C Movement in paralysed arm is stimulated by yawning</label><br>
                    <label><input type="radio" name="q36" value="D"> D Yawning can be used as an example to prevent muscle wasting</label>
                </div>
                <div class="mcq-question">
                    <p><strong>37 In the last paragraph, the writer concludes that</strong></p>
                    <label><input type="radio" name="q37" value="A"> A Yawning is a sign of boredom</label><br>
                    <label><input type="radio" name="q37" value="B"> B We yawn in spite of the development of our species</label><br>
                    <label><input type="radio" name="q37" value="C"> C Yawning is a more passive activity than we imagine</label><br>
                    <label><input type="radio" name="q37" value="D"> D We are stimulated to yawn when our brain activity is low</label>
                </div>
            </div>

            <!-- Questions 38-40: Yes/No/Not Given -->
            <div class="question" data-q-start="38" data-q-end="40">
                <div class="question-prompt">
                    <p><strong>Questions 38–40</strong></p>
                    <p>Do the following statements agree with the claims of the writer in Reading Passage 3?</p>
                    <p>In boxes 38–40 on your answer sheet, write</p>
                    <ul style="list-style: none; padding-left: 0;">
                        <li><strong>YES</strong> if the statement agrees with the claims of the writer</li>
                        <li><strong>NO</strong> if the statement contradicts the claims of the writer</li>
                        <li><strong>NOT GIVEN</strong> if it is impossible to say what the writer thinks about this</li>
                    </ul>
                </div>
                <div class="tf-question">
                    <p><strong>38 Research students were initially reluctant to appreciate the value of Provine’s studies</strong></p>
                    <label><input type="radio" name="q38" value="YES"> YES</label><br>
                    <label><input type="radio" name="q38" value="NO"> NO</label><br>
                    <label><input type="radio" name="q38" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
                <div class="tf-question">
                    <p><strong>39 When foetuses yawn and stretch they are learning how to control movement</strong></p>
                    <label><input type="radio" name="q39" value="YES"> YES</label><br>
                    <label><input type="radio" name="q39" value="NO"> NO</label><br>
                    <label><input type="radio" name="q39" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
                <div class="tf-question">
                    <p><strong>40 According to Provine, referring to only one function is probably inadequate to explain why people yawn</strong></p>
                    <label><input type="radio" name="q40" value="YES"> YES</label><br>
                    <label><input type="radio" name="q40" value="NO"> NO</label><br>
                    <label><input type="radio" name="q40" value="NOT GIVEN"> NOT GIVEN</label>
                </div>
            </div>
        </div>
    </div>
</div>


    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow prev" onclick="previousQuestion()" id="prevBtn" aria-label="Previous question">
            <!-- Left arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="nav-arrow next" onclick="nextQuestion()" id="nextBtn" aria-label="Next question">
            <!-- Right arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)"><span class="sr-only">Question 12</span><span aria-hidden="true">12</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)"><span class="sr-only">Question 13</span><span aria-hidden="true">13</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)"><span class="sr-only">Question 14</span><span aria-hidden="true">14</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)"><span class="sr-only">Question 15</span><span aria-hidden="true">15</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)"><span class="sr-only">Question 16</span><span aria-hidden="true">16</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(17)"><span class="sr-only">Question 17</span><span aria-hidden="true">17</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)"><span class="sr-only">Question 18</span><span aria-hidden="true">18</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)"><span class="sr-only">Question 19</span><span aria-hidden="true">19</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)"><span class="sr-only">Question 20</span><span aria-hidden="true">20</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 14</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div id="menu-highlight" class="context-menu-item" onclick="highlightText()">
            Highlight
        </div>
        <div id="menu-note" class="context-menu-item" onclick="addNote()">
            Note
        </div>
        <div id="menu-clear" class="context-menu-item" onclick="clearHighlight()">
            Clear
        </div>
        <div id="menu-clear-all" class="context-menu-item" onclick="clearAllHighlights()">
            Clear All
        </div>
    </div>

    <div id="results-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeResultsModal()">&times;</button>
            <h2>Results</h2>
            <div class="results-summary">
                <p>Score: <span id="results-score"></span> / 40</p>
                <p>IELTS Band: <span id="results-band"></span></p>
            </div>
            <div id="results-details" class="results-details-container">
                <!-- Results for each question will be injected here -->
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- STATE VARIABLES ---
        let currentPassage = 1;
        let currentQuestion = 1;
        let selectedRange = null;
        let timeInSeconds = 3600;
        let timerInterval;
        let draggedItem = null;
        let activeQuestionElement = null;
        let selectedDragItem = null;

        // --- GLOBAL FUNCTIONS ---
        function getFirstQuestionOfPart(part) {
            switch(part) {
                case 1: return 1;
                case 2: return 14;
                case 3: return 27;
                default: return 1;
            }
        }

        // --- DOM ELEMENTS ---
        const timerDisplay = document.querySelector('.timer-display');
        const timerToggleButton = document.getElementById('timer-toggle-btn');
        const timerResetButton = document.getElementById('timer-reset-btn');
        const deliverButton = document.getElementById('deliver-button');
        const resizer = document.getElementById('resizer');
        const passagePanel = document.getElementById('passage-panel');
        const questionsPanel = document.getElementById('questions-panel');
        const contextMenu = document.getElementById('contextMenu');

        // --- ICON SVGs ---
        const playIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>';
        const pauseIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

        const correctAnswers = {
  // Passage 1
  '1': 'F', '2': 'D', '3': 'T', '4': 'F', '5': 'F', '6': 'T',
  '7': '1906', '8': 'Australia', '9': 'family', '10': 'bankruptcy',
  '11': 'writers', '12': 'reputation', '13': 'husband',

  // Passage 2
  '14': 'I', '15': 'F', '16': 'G', '17': 'D', '18': 'C', '19': 'H',
  '20': 'C', '21': 'D', '22': 'B', '23': 'one-sixth', '24': '16th century',
  '25': 'Mercator', '26': 'John Gould',

  // Passage 3
  '27': 'K', '28': 'H', '29': 'D', '30': 'J', '31': 'E', '32': 'B',
  '33': 'B', '34': 'C', '35': 'D', '36': 'B', '37': 'B',
  '38': 'YES', '39': 'NGV', '40': 'YES'
};

        // --- INITIALIZATION ---
        function initialize() {
            console.log(`🚀 Initializing application...`);
            startTimer();
            initializeDragAndDrop();
            setupCheckboxLimits();
            setupExampleHeading();
            console.log(`📋 Setting up initial state - switching to part 1`);
            switchToPart(1); // Also calls goToQuestion(1) and updateNavigation
            
            document.body.addEventListener('input', updateAllIndicators);
            document.body.addEventListener('change', updateAllIndicators);
            deliverButton.addEventListener('click', checkAnswers);
            timerToggleButton.addEventListener('click', toggleTimer);
            timerResetButton.addEventListener('click', resetTimer);

            // Auto-close dropdowns for Questions 14-17 on selection
            ['q14','q15','q16','q17'].forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    sel.addEventListener('change', () => sel.blur());
                }
            });

            // Add click listeners to question containers for navigation
            document.querySelectorAll('[data-q-start]').forEach(el => {
                el.addEventListener('click', (event) => {
                    // Stop event propagation to prevent parent container clicks
                    event.stopPropagation();
                    
                    const qNum = parseInt(el.dataset.qStart, 10);
                    const qEnd = parseInt(el.dataset.qEnd, 10);
                    
                    console.log(`🖱️ Question container clicked - qNum: ${qNum}, qEnd: ${qEnd}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without valid question number, ignoring navigation`);
                        return;
                    }
                    
                    // Only navigate if this is a single question (qStart === qEnd) or if we're clicking on a specific question within a group
                    if (qNum === qEnd || el.classList.contains('tf-question')) {
                        if (currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum}`);
                            goToQuestion(qNum);
                        } else {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed`);
                        }
                    } else {
                        console.log(`ℹ️ Ignoring click on group container (${qNum}-${qEnd})`);
                    }
                });
            });
            
            // Add specific click listeners for individual question elements to prevent parent container interference
            document.querySelectorAll('.tf-question, .summary-text').forEach(el => {
                el.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(el.dataset.qStart, 10);
                    console.log(`🎯 Individual question element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN (like .summary-text containers)
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without specific question number, ignoring navigation`);
                        return;
                    }
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (individual element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (individual element)`);
                    }
                });
            });
            
            // Add specific click listeners for individual input elements in questions 33-36
            document.querySelectorAll('.answer-input[id^="q3"]').forEach(input => {
                input.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(input.id.replace('q', ''), 10);
                    console.log(`📝 Input element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, input:`, input);
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (input element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (input element)`);
                    }
                });
            });
            
            // Add click listeners for the paragraph elements containing questions 33-36
            document.querySelectorAll('.summary-text p').forEach(p => {
                p.addEventListener('click', (event) => {
                    event.stopPropagation();
                    // Extract question number from the paragraph text (e.g., "33" from "<strong>33</strong>")
                    const strongElement = p.querySelector('strong');
                    if (strongElement) {
                        const qNum = parseInt(strongElement.textContent, 10);
                        console.log(`📄 Summary paragraph clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, paragraph:`, p);
                        
                        if (!isNaN(qNum) && currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (summary paragraph)`);
                            goToQuestion(qNum);
                        } else if (!isNaN(qNum)) {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed (summary paragraph)`);
                        }
                    }
                });
            });

            resizer.addEventListener('mousedown', initResize, false);
            initializeContextMenu();
        }

        // --- CORE TEST LOGIC ---

        function checkAnswers() {
            // Disable all inputs to prevent changes
            const allInputs = document.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => {
                input.disabled = true;
            });

            // Disable all drag and drop functionality
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.cursor = 'not-allowed';
                item.style.pointerEvents = 'none';
            });

            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.style.pointerEvents = 'none';
                zone.classList.add('disabled');
            });

            // Disable submit button
            deliverButton.disabled = true;
            deliverButton.style.cursor = 'not-allowed';
            
            clearInterval(timerInterval);
            let score = 0;
            const totalQuestions = 40;
            const resultsDetailsContainer = document.getElementById('results-details');
            resultsDetailsContainer.innerHTML = '';

            document.querySelectorAll('.correct, .incorrect, .correct-answer-highlight').forEach(el => {
                el.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
            });
            document.querySelectorAll('.correct-answer-display').forEach(el => el.remove());

            // Helper to evaluate the special TWO-answers checkbox group (Q20 & Q21) - only if present
            const hasQ20to21Group = document.querySelectorAll('input[name="q20-21"]').length > 0;
            function evaluateQ20to21() {
                const checked = Array.from(document.querySelectorAll('input[name="q20-21"]:checked')).map(el => el.value).sort();
                const isCorrect20 = checked.includes('A');
                const isCorrect21 = checked.includes('E');

                // Mark selected labels
                document.querySelectorAll('input[name="q20-21"]').forEach(input => {
                    const label = input.closest('.multi-choice-option');
                    if (!label) return;
                    label.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
                    if (input.checked) {
                        const good = (input.value === 'A' && isCorrect20) || (input.value === 'E' && isCorrect21);
                        label.classList.add(good ? 'correct' : 'incorrect');
                    }
                    if (!isCorrect20 && input.value === 'A') label.classList.add('correct-answer-highlight');
                    if (!isCorrect21 && input.value === 'E') label.classList.add('correct-answer-highlight');
                });

                const selectedText = checked.join(' & ') || 'Not Answered';
                // Q20 row
                resultsDetailsContainer.innerHTML += `
                    <div class="result-row ${isCorrect20 ? '' : 'incorrect'}">
                        <span class="q-num">20</span>
                        <span class="user-ans">${selectedText}</span>
                        <span class="correct-ans">A</span>
                    </div>`;
                // Q21 row
                resultsDetailsContainer.innerHTML += `
                    <div class="result-row ${isCorrect21 ? '' : 'incorrect'}">
                        <span class="q-num">21</span>
                        <span class="user-ans">${selectedText}</span>
                        <span class="correct-ans">E</span>
                    </div>`;

                // Mark nav buttons
                const nav20 = document.querySelector(`.subQuestion[onclick="goToQuestion(20)"]`);
                if (nav20) { nav20.classList.remove('answered', 'active'); nav20.classList.add(isCorrect20 ? 'correct' : 'incorrect'); }
                const nav21 = document.querySelector(`.subQuestion[onclick="goToQuestion(21)"]`);
                if (nav21) { nav21.classList.remove('answered', 'active'); nav21.classList.add(isCorrect21 ? 'correct' : 'incorrect'); }

                if (isCorrect20) score += 1;
                if (isCorrect21) score += 1;
                return (isCorrect20 || isCorrect21);
            }

            let q20to21Evaluated = false;
            for (let i = 1; i <= totalQuestions; i++) {
                const questionKey = String(i);
                const correctAnswer = correctAnswers[questionKey];
                let userAnswer = '';
                let isCorrect = false;
                
                let userAnswerDisplay = 'Not Answered';
                const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer;

                // Special handling: combined checkbox group for Q20 & Q21
                if ((i === 20 || i === 21) && hasQ20to21Group) {
                    if (!q20to21Evaluated) {
                        evaluateQ20to21();
                        q20to21Evaluated = true;
                    }
                    continue; // Already handled rows, scoring, and marking
                }

                const textInput = document.getElementById(`q${i}`);
                const radioGroup = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);
                
                // Handle Text and Select Inputs
                if (textInput && (textInput.tagName === 'INPUT' || textInput.tagName === 'SELECT')) {
                    const element = textInput.closest('.matching-form-row') || textInput;
                    userAnswer = textInput.value.trim();
                    userAnswerDisplay = userAnswer || 'Not Answered';

                    const normalize = (s) => (s || '')
                        .toString()
                        .toLowerCase()
                        .replace(/[^a-z0-9\s]/g, '')
                        .replace(/\s+/g, ' ')
                        .trim();

                    if (textInput.tagName === 'SELECT') {
                        isCorrect = userAnswer === correctAnswer;
                    } else {
                        const normUser = normalize(userAnswer);
                        if (Array.isArray(correctAnswer)) {
                            isCorrect = correctAnswer.some(ans => normalize(ans) === normUser);
                        } else {
                            isCorrect = normalize(correctAnswer) === normUser;
                        }
                    }

                    // Special visual handling for Paragraph Headings (Q14–20): mark the visible drop-zones
                    const isHeadingQuestion = i >= 14 && i <= 20;
                    let targetForMarking = element;
                    if (isHeadingQuestion) {
                        const letters = ['A','B','C','D','E','F','G'];
                        const paragraphLetter = letters[i - 14];
                        const dropZone = document.querySelector(`.paragraph-drop-zone[data-paragraph="${paragraphLetter}"]`);
                        if (dropZone) {
                            targetForMarking = dropZone;
                            // For Questions 14-20, check the actual dropped answer in the drop zone
                            const droppedAnswer = dropZone.getAttribute('data-answer');
                            console.log(`🔍 Checking Questions 14-20: Question ${i}, Paragraph ${paragraphLetter}, DropZone:`, dropZone);
                            console.log(`🔍 Dropped answer: "${droppedAnswer}", Correct answer: "${correctAnswer}"`);
                            if (droppedAnswer) {
                                userAnswer = droppedAnswer;
                                userAnswerDisplay = droppedAnswer;
                                isCorrect = droppedAnswer === correctAnswer;
                                console.log(`✅ Question ${i}: User answer "${droppedAnswer}", Correct: ${isCorrect}`);
                            } else {
                                // No answer provided for Questions 14-20
                                userAnswer = '';
                                userAnswerDisplay = 'Not Answered';
                                isCorrect = false;
                                console.log(`⚠️ Question ${i}: No answer provided, marking as incorrect`);
                            }
                        }
                    }
                    
                    if (isCorrect) {
                        score++;
                        targetForMarking.classList.add('correct');
                        console.log(`✅ Question ${i} is correct! Added 'correct' class to:`, targetForMarking);
                    } else {
                        targetForMarking.classList.add('incorrect');
                        console.log(`❌ Question ${i} is incorrect! Added 'incorrect' class to:`, targetForMarking);
                        // Show correct answer hint next to the visible element if available
                        const correctAnswerSpan = document.createElement('span');
                        correctAnswerSpan.className = 'correct-answer-display';
                        correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswerText}</span>`;
                        if (targetForMarking !== element) {
                            targetForMarking.appendChild(correctAnswerSpan);
                        } else {
                            textInput.parentNode.insertBefore(correctAnswerSpan, textInput.nextSibling);
                        }
                    }
                }
                // Handle drag and drop questions (any with a drop-zone for this question)
                else if (document.querySelector(`.drop-zone[data-q-start="${i}"]`)) {
                    console.log(`🔍 Checking drag-and-drop question ${i}`);
                    const dropZone = document.querySelector(`.drop-zone[data-q-start="${i}"]`);
                    const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;
                    
                    console.log(`📍 Drop zone for question ${i}:`, dropZone);
                    console.log(`📍 Dropped item for question ${i}:`, droppedItem);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (droppedItem) {
                        userAnswer = droppedItem.dataset.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        // Mark the drop zone as correct or incorrect
                        dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                        
                        // Show correct answer if wrong
                        if (!isCorrect && correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    } else {
                        // No answer provided - mark as incorrect
                        console.log(`⚠️ No answer provided for question ${i}`);
                        if (dropZone) {
                            dropZone.classList.add('incorrect');
                        }
                        if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    }
                }
                // Handle Radio Button Inputs (T/F, MCQs)
                else if (radioGroup.length > 0) {
                    const questionContainer = radioGroup[0]?.closest('.tf-question') || radioGroup[0]?.closest('.multi-choice-question');
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);

                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;

                        const userLabel = checkedRadio.closest('.tf-option, .multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        // Handle table radio buttons
                        if (checkedRadio.classList.contains('table-radio')) {
                            const tableCell = checkedRadio.closest('td');
                            if (tableCell) {
                                tableCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                            }
                        }
                    }

                    if (isCorrect) {
                        score++;
                    } else {
                        if (questionContainer){
                            const correctOptionEl = questionContainer.querySelector(`input[name="q${i}"][value="${correctAnswerText}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.tf-option, .multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    }
                }
                // Questions 24-26 are text input questions (completing a summary), not checkboxes
                // They are handled by the normal text input logic above
                // Handle checkboxes for questions 32-34 as a single group
                else if (i === 32) {
                    console.log(`🔍 Checking checkbox group questions 32-34`);
                    const checked = document.querySelectorAll('input[name^="q32"]:checked');
                    const selectedValues = Array.from(checked).map(cb => cb.value).sort();
                    if (selectedValues.length > 0) {
                        userAnswer = selectedValues.join(', ');
                        userAnswerDisplay = userAnswer;
                        const correctValues = ['A', 'E', 'F'];
                        const numCorrect = selectedValues.filter(v => correctValues.includes(v)).length;
                        isCorrect = numCorrect === 3;
                        score += numCorrect; // 1 point per correct selection

                        // Mark selected options
                        checked.forEach(cb => {
                            const parent = cb.closest('.multi-choice-option');
                            if (parent) parent.classList.add(correctValues.includes(cb.value) ? 'correct' : 'incorrect');
                        });

                        // Highlight missed correct answers
                        if (!isCorrect) {
                            correctValues.filter(v => !selectedValues.includes(v)).forEach(val => {
                                const cb = document.querySelector(`input[name^="q32"][value="${val}"]`);
                                if (cb) {
                                    const parent = cb.closest('.multi-choice-option');
                                    if (parent) parent.classList.add('correct-answer-highlight');
                                }
                            });
                        }
                    } else {
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle clickable-cell matrix questions (generic for any i that has clickable cells)
                else if (document.querySelector(`.clickable-cell[data-question="${i}"]`)) {
                    console.log(`🔍 Checking clickable cell question ${i}`);
                    const selectedCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-selected="true"]`);
                    console.log(`📍 Selected cell for question ${i}:`, selectedCell);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (selectedCell) {
                        userAnswer = selectedCell.dataset.answer;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        selectedCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                    
                    // Handle highlighting correct answers for incorrect responses
                    if (!isCorrect) {
                        const correctCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-value="${correctAnswerText}"]`);
                        if (correctCell) {
                            correctCell.classList.add('correct-answer-highlight');
                            console.log(`✅ Highlighted correct answer for question ${i}:`, correctCell);
                        } else {
                            console.log(`⚠️ Could not find correct cell for question ${i} with value "${correctAnswerText}"`);
                        }
                    }
                }
                // Handle text input questions (33-39)
                else if (i >= 33 && i <= 39) {
                    console.log(`🔍 Checking text input question ${i}`);
                    const textInput = document.getElementById(`q${i}`);
                    
                    if (textInput) {
                        userAnswer = textInput.value.trim().toLowerCase();
                        userAnswerDisplay = userAnswer || 'Not Answered';
                        
                        // Handle special case for question 33 which has two answers
                        if (i === 33) {
                            const answers = userAnswer.split('&').map(ans => ans.trim());
                            isCorrect = answers.includes('breathing') && answers.includes('eating');
                        } else {
                            isCorrect = userAnswer === correctAnswer.toLowerCase();
                        }
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        if (isCorrect) {
                            score++;
                            textInput.classList.add('correct');
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            textInput.classList.add('incorrect');
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle question 40 (multiple choice)
                else if (i === 40) {
                    console.log(`🔍 Checking multiple choice question ${i}`);
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);
                    
                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        const userLabel = checkedRadio.closest('.multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                            
                            // Highlight correct answer
                            const correctOptionEl = document.querySelector(`input[name="q${i}"][value="${correctAnswer}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // For showing results in the modal
                // Questions 24-26 are individual text input questions, not a checkbox group
                if (i !== 33 && i !== 34) {
                    // Show normal result for other questions
                 const resultRow = `
                    <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                        <span class="q-num">${i}</span>
                        <span class="user-ans">${userAnswerDisplay}</span>
                        <span class="correct-ans">${correctAnswerText}</span>
                    </div>`;
                resultsDetailsContainer.innerHTML += resultRow;
                }
                // For 32-34 group, show a single row
                if (i === 32) {
                    const resultRow = `
                        <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                            <span class="q-num">32-34</span>
                            <span class="user-ans">${userAnswerDisplay}</span>
                            <span class="correct-ans">A, E, F</span>
                        </div>`;
                    resultsDetailsContainer.innerHTML += resultRow;
                }
                
                // Update nav button color
                // Questions 24-26 are individual text input questions, not a checkbox group
                if (i !== 33 && i !== 34) {
                    // Update navigation button for other questions
                const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${i})"]`);
                if (navButton) {
                    navButton.classList.remove('answered', 'active');
                    navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                    }
                }
                // Update nav buttons for 32-34 group as a whole
                if (i === 32) {
                    for (let q = 32; q <= 34; q++) {
                        const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${q})"]`);
                        if (navButton) {
                            navButton.classList.remove('answered', 'active');
                            navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }
                }
            }

            document.getElementById('results-score').textContent = score;
            document.getElementById('results-band').textContent = calculateBandScore(score);
            document.body.classList.add('results-mode');
            document.getElementById('results-modal').classList.remove('hidden');
            
            // Change button to "My Result" with green styling
            deliverButton.innerHTML = `<span>My Result</span>`;
            deliverButton.style.backgroundColor = '#4CAF50';
            deliverButton.style.color = 'white';
            deliverButton.style.borderColor = '#4CAF50';
            deliverButton.disabled = false;
            deliverButton.style.cursor = 'pointer';
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.addEventListener('click', showResultsModal);
            
            // Highlight correct answers in the passage
            highlightCorrectAnswersInPassage();
        }

        function calculateBandScore(score) {
            if (score >= 39) return '9.0';
            const mapping = {
                40: 9.0, 39: 9.0, 38: 8.5, 37: 8.5, 36: 8.0, 35: 8.0, 34: 7.5,
                33: 7.5, 32: 7.0, 31: 7.0, 30: 7.0, 29: 6.5, 28: 6.5, 27: 6.5,
                26: 6.0, 25: 6.0, 24: 6.0, 23: 5.5, 22: 5.5, 21: 5.5, 20: 5.5,
                19: 5.0, 18: 5.0, 17: 5.0, 16: 5.0, 15: 5.0, 14: 4.5, 13: 4.5,
                12: 4.0, 11: 4.0, 10: 4.0, 9: 3.5, 8: 3.5, 7: 3.0, 6: 3.0,
                5: 2.5, 4: 2.5
            };
            if (score <= 0) return 0.0;
            if (score === 1) return 1.0;
            if (score <= 3) return 2.0;
            if (score <= 5) return 2.5;
            return mapping[score] || 0.0;
        }

        function highlightCorrectAnswersInPassage() {
            // Define the text passages and their corresponding question numbers for Part 1 (Foot Pedal Irrigation)
            const part1Highlights = [
                { question: 1, text: "large-scale projects: gigantic dams, sprawling, irrigation canals and vast new fields", answer: "FALSE" },
                { question: 2, text: "the reservoirs behind dams can quickly fill up with silt", answer: "NOT GIVEN" },
                { question: 3, text: "the Green Revolution has greatly expanded worldwide farm production since 1950", answer: "FALSE" },
                { question: 4, text: "India, for example, has been self- sufficient in food for 15 years", answer: "NOT GIVEN" },
                { question: 5, text: "Polak asked what he needed to move out of poverty. \"Control of water for my crops,\" he said", answer: "TRUE" },
                { question: 6, text: "Over the next 12 years one and a half million farm families purchased treadle pumps", answer: "TRUE" },
                { question: 7, text: "two cylinders which are made of engineering plastic", answer: "bamboo" },
                { question: 8, text: "The diameter of a cylinder is 100.5mm and the height is 280mm", answer: "cylinders" },
                { question: 9, text: "The pump is capable of working up to a maximum depth of 7 meters", answer: "Piston" },
                { question: 10, text: "The pump mechanism has piston and foot valve assemblies", answer: "7" },
                { question: 11, text: "can irrigate half an acre of vegetables", answer: "half an acre" },
                { question: 12, text: "corrugated tin", answer: "corrugated tin" },
                { question: 13, text: "$37.5 million from the farmers themselves", answer: "$37.5 million" }
            ];

            // Define the text passages and their corresponding question numbers for Part 2 (Coastal Archaeology of Britain)
            const part2Highlights = [
                { question: 14, text: "the prospect of rising sea levels over the next century, and their impact on current coastal environments, has been a particular focus for concern", answer: "B" },
                { question: 15, text: "Most of the known wrecks around our coast are not unexpectedly of post-medieval date", answer: "C" },
                { question: 16, text: "Elaborate wooden fish weirs, often of considerable extent and responsive to aerial photography in shallow water", answer: "D" },
                { question: 17, text: "The dominant process affecting the physical form of England in the post- glacial period has been rising in the altitude of sea level relative to the land", answer: "TRUE" },
                { question: 18, text: "the constant reconfiguration of the coastline", answer: "FALSE" },
                { question: 19, text: "Its current location in the coastal zone is the product of later unrelated processes", answer: "TRUE" },
                { question: 20, text: "Boats were some of the most complex artefacts produced by pre-modem societies", answer: "FALSE" },
                { question: 21, text: "Similar boats were also discovered in many other European countries", answer: "NOT GIVEN" },
                { question: 22, text: "These industries are poorly documented", answer: "TRUE" },
                { question: 23, text: "The larger size of ferries has also caused an increase in the damage caused by their wash to fragile deposits in the intertidal zone", answer: "TRUE" },
                { question: 24, text: "we still have much to learn about their production and use", answer: "B" },
                { question: 25, text: "we are not yet in a position to make even preliminary estimates of answers to such fundamental questions as the extent to which the sea and the coast affected human life in the past", answer: "D" },
                { question: 26, text: "Human threats include the redevelopment of historic towns and old dockland areas", answer: "F" }
            ];

            // Define the text passages and their corresponding question numbers for Part 3 (Biology of Bitterness)
            const part3Highlights = [
                { question: 27, text: "Grapefruit and cruciferous vegetable like Brussels sprouts and kale are nutritious despite-and sometimes because of-their bitter-tasting components", answer: "B" },
                { question: 28, text: "In time, some taste researchers believe, compounds like AMP will help make processed foods less unhealthy", answer: "I" },
                { question: 29, text: "They defend plants by warning animals away and protect animals by letting them know when a plant may be poisonous", answer: "C" },
                { question: 30, text: "The G protein involved in the perception of bitterness, sweetness, and umami was identified", answer: "E" },
                { question: 31, text: "Amp has no bitterness of its own, but when put it in foods... it attaches to bitter-taste receptors", answer: "G" },
                { question: 32, text: "Part of the salt could be replaced by another salt, potassium chloride", answer: "H" },
                { question: 33, text: "naringin, a natural chemical compound found in grapefruit, tastes bitter", answer: "A" },
                { question: 34, text: "Some people, known as supertasters, are especially sensitive to 6-n-propylthiouraci because they have an unusually high number of taste buds", answer: "D" },
                { question: 35, text: "a substance called naringin contained in it", answer: "NARINGIN" },
                { question: 36, text: "letting them know when a plant may be poisonous", answer: "POISONOUS" },
                { question: 37, text: "About 75 percent of people are sensitive", answer: "SUPERTASTERS" },
                { question: 38, text: "unusually high number of taste buds", answer: "TASTEBUDS" },
                { question: 39, text: "offset bitter flavour in food", answer: "A" },
                { question: 40, text: "The G protein... triggers a cascade of chemical reactions that lead to changes in ion concentrations within the cell. Ultimately, this delivers a signal to the brain", answer: "D" }
            ];

            // Function to apply highlights to a passage
            function applyHighlights(passageElement, highlights) {
                if (!passageElement) return;

                // Clear any existing highlights
                passageElement.querySelectorAll('.answer-highlight').forEach(el => {
                    const parent = el.parentNode;
                    parent.replaceChild(document.createTextNode(el.textContent), el);
                    parent.normalize();
                });

                // Add highlights for each answer
                highlights.forEach(item => {
                    const paragraphs = passageElement.querySelectorAll('p');
                    paragraphs.forEach(paragraph => {
                        const html = paragraph.innerHTML;
                        if (!html || typeof html !== 'string') return;
                        if (html.includes(item.text)) {
                            const escapeRegExp = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const re = new RegExp(escapeRegExp(item.text));
                            const replaced = html.replace(
                                re,
                                `<span class="answer-highlight" data-question="${item.question}" style="
                                    background-color: #ffeb3b;
                                    padding: 2px 4px;
                                    border-radius: 3px;
                                    font-weight: bold;
                                    position: relative;
                                ">${item.text}<span style="
                                    position: absolute;
                                    top: -8px;
                                    right: -8px;
                                    background-color: #2196f3;
                                    color: white;
                                    border-radius: 50%;
                                    width: 20px;
                                    height: 20px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 12px;
                                    font-weight: bold;
                                ">${item.question}</span></span>`
                            );
                            paragraph.innerHTML = replaced;
                        }
                    });
                });
            }

            // Apply highlights to Part 1 (Kedgeree)
            const passageText1 = document.getElementById('passage-text-1');
            applyHighlights(passageText1, part1Highlights);

            // Apply highlights to Part 2 (Coastal Archaeology of Britain)
            const passageText2 = document.getElementById('passage-text-2');
            applyHighlights(passageText2, part2Highlights);

            // Apply highlights to Part 3 (Biology of Bitterness)
            const passageText3 = document.getElementById('passage-text-3');
            applyHighlights(passageText3, part3Highlights);
        }

        function getUserAnswer(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
            const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);

            if (textInput) { // Handles <input type="text"> and <select>
                return { value: textInput.value, text: textInput.value || 'N/A' };
            }
            if (radioInput) {
                return { value: radioInput.value, text: radioInput.value };
            }
            if (dropZone) {
                const droppedItem = dropZone.querySelector('.drag-item');
                return { 
                    value: droppedItem ? droppedItem.dataset.value : null, 
                    text: droppedItem ? droppedItem.textContent.trim() : 'N/A' 
                };
            }
            
            // Questions 24-26 are individual text input questions, not checkboxes
            
            // Handle clickable cells for questions 23-26
            if (qNum >= 23 && qNum <= 26) {
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return { value: selectedCell.dataset.answer, text: selectedCell.dataset.answer };
                }
            }
            return { value: null, text: 'N/A' };
        }

        function displayCorrectAnswer(qNum, correctAnswer) {
            // Questions 24-26 are individual text input questions, not checkboxes

            // Handle radio button questions by highlighting the correct label
            const correctRadioInput = document.querySelector(`input[name="q${qNum}"][value="${correctAnswer}"]`);
            if (correctRadioInput) {
                const parentOption = correctRadioInput.closest('.tf-option, .multi-choice-option');
                if (parentOption) {
                    parentOption.classList.add('correct-answer-highlight');
                    return;
                }
            }

            // Handle text inputs, select dropdowns, and others by showing the answer next to them
            const inputEl = document.getElementById(`q${qNum}`);
            if (inputEl) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                inputEl.insertAdjacentElement('afterend', displaySpan);
                return; // Done
            }
            
            // Fallback for questions identified by a container (e.g., some T/F/NG questions)
            const element = findQuestionElement(qNum);
            if (element) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                const itemContainer = element.querySelector('.tf-question-text');
                if (itemContainer) {
                     itemContainer.appendChild(displaySpan);
                } else {
                     element.appendChild(displaySpan);
                }
            }
        }
        
        function findQuestionElement(qNum) {
             return document.querySelector(`[data-q-start="${qNum}"]`);
        }

        function addResultToModal(qNum, userAnswer, correctAnswer, isCorrect) {
            const resultsDetails = document.getElementById('results-details');
            const row = document.createElement('div');
            row.className = 'result-row';
            if (!isCorrect) {
                row.classList.add('incorrect');
            }
            row.innerHTML = `
                <span class="q-num">${qNum}</span>
                <span class="user-ans">${userAnswer}</span>
                <span class="correct-ans">${correctAnswer}</span>
            `;
            resultsDetails.appendChild(row);
        }

        function showResultsModal() {
            document.getElementById('results-modal').classList.remove('hidden');
        }

        window.closeResultsModal = function() {
            document.getElementById('results-modal').classList.add('hidden');
            document.body.classList.remove('results-mode');
        }
        
        function disableInputs() {
            deliverButton.innerHTML = `<span>Checked! View Results.</span>`;
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.onclick = showResultsModal;

            document.querySelectorAll('input, select').forEach(el => {
                el.disabled = true;
                 if (el.matches('input[type=radio], input[type=checkbox]')) {
                     el.style.cursor = 'not-allowed';
                     el.parentElement.style.cursor = 'not-allowed';
                 }
            });
            document.querySelectorAll('.drag-item').forEach(el => {
                el.setAttribute('draggable', 'false');
                el.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(el => {
                el.classList.add('disabled');
            });
        }

        function checkValue(userValue, correctValue) {
            if (userValue === null || userValue === undefined) return false;
            const formattedUserValue = userValue.trim().toLowerCase();
            if (Array.isArray(correctValue)) {
                return correctValue.map(v => v.toLowerCase()).includes(formattedUserValue);
            } else {
                return formattedUserValue === String(correctValue).toLowerCase();
            }
        }

        function markQuestion(qNum, isCorrect) {
            const subQuestionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
            subQuestionBtn?.classList.add(isCorrect ? 'correct' : 'incorrect');

            const elementsToMark = [
                document.querySelector(`.tf-question[data-q-start="${qNum}"]`),
                document.querySelector(`.multi-choice-question[data-q-start="${qNum}"]`),
                document.querySelector(`.matching-question-item[data-q-start="${qNum}"]`),
                document.querySelector(`.drop-zone[data-q-start="${qNum}"]`),
                document.getElementById(`q${qNum}`),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.tf-option'),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.multi-choice-option')
            ];
            
            elementsToMark.forEach(el => {
                if (el) el.classList.add(isCorrect ? 'correct' : 'incorrect');
            });

             if (qNum === 14 || qNum === 15) {
                const multiChoiceContainer = document.querySelector('.multi-choice-question[data-q-start="14"]');
                if (multiChoiceContainer) multiChoiceContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
             } else if (qNum >= 1 && qNum <= 5) {
                const pMatchInput = document.getElementById(`q${qNum}`);
                if (pMatchInput) pMatchInput.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
        }

        function switchToPart(partNumber) {
            console.log(`🔀 switchToPart called with partNumber: ${partNumber}, currentPassage: ${currentPassage}`);
            
            currentPassage = partNumber;

            // Hide all passages and questions
            document.querySelectorAll('.reading-passage, .question-set, .part-header').forEach(el => {
                el.classList.add('hidden');
            });

            // Show the correct passage, questions, and header
            document.getElementById(`passage-text-${partNumber}`).classList.remove('hidden');
            document.getElementById(`questions-${partNumber}`).classList.remove('hidden');
            document.getElementById(`part-header-${partNumber}`).classList.remove('hidden');

            // Update bottom navigation 'selected' state
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.toggle('selected', (index + 1) === partNumber);
            });

            // Show/hide explanation buttons based on part
            const explanationButton = document.getElementById('show-explanation-btn');
            const explanationButtonPart3 = document.getElementById('show-explanation-btn-part3');
            
            if (explanationButton) {
                if (partNumber === 2) {
                    explanationButton.style.display = 'block';
                } else {
                    explanationButton.style.display = 'none';
                    // Hide explanation section when switching away from part 2
                    const explanationSection = document.getElementById('part-2-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButton.textContent = 'Show Explanation';
                        explanationButton.style.backgroundColor = '#4a90e2';
                    }
                }
            }
            
            if (explanationButtonPart3) {
                if (partNumber === 3) {
                    explanationButtonPart3.style.display = 'block';
                } else {
                    explanationButtonPart3.style.display = 'none';
                    // Hide explanation section when switching away from part 3
                    const explanationSection = document.getElementById('part-3-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButtonPart3.textContent = 'Show Explanation';
                        explanationButtonPart3.style.backgroundColor = '#4a90e2';
                    }
                }
            }

            console.log(`✅ switchToPart completed - switched to part ${partNumber}`);
            
            // Only go to first question when switching parts, not when staying in same part
            // This allows goToQuestion to work properly for specific question navigation
            // const firstQuestionOfPart = {1: 1, 2: 14, 3: 27}[partNumber];
            // goToQuestion(firstQuestionOfPart);
        }
        
        function goToQuestion(questionNumber) {
            console.log(`🎯 goToQuestion called with questionNumber: ${questionNumber}, currentQuestion: ${currentQuestion}, currentPassage: ${currentPassage}`);
            
            currentQuestion = questionNumber;

            let passageNumber = 1;
            if (questionNumber >= 14 && questionNumber <= 26) passageNumber = 2;
            else if (questionNumber >= 27) passageNumber = 3;
            
            console.log(`📍 Calculated passageNumber: ${passageNumber} for question ${questionNumber}`);
            
            if (currentPassage !== passageNumber) {
                console.log(`🔄 Switching from part ${currentPassage} to part ${passageNumber} for question ${questionNumber}`);
                switchToPart(passageNumber);
                return; 
            }

            console.log(`✅ Staying in same part (${currentPassage}) for question ${questionNumber}`);

            if (activeQuestionElement) {
                // Remove active style from previous block
                activeQuestionElement.classList.remove('active-question', 'active-input');
                // Also remove from the container block if we previously set it
                const prevBlock = activeQuestionElement.closest('[data-q-start]');
                if (prevBlock) prevBlock.classList.remove('active-question');
            }

            // First, try to find the specific input element for questions 33-36
            let targetEl = document.getElementById(`q${questionNumber}`);
            if (targetEl) {
                activeQuestionElement = targetEl;
                console.log(`✅ Found specific input element:`, targetEl);
                targetEl.classList.add('active-input');
                scrollIntoViewIfNeeded(targetEl);
            } else {
                // Fall back to looking for question containers
                targetEl = document.querySelector(`[data-q-start="${questionNumber}"]`);
                console.log(`🔍 Looking for target element with data-q-start="${questionNumber}":`, targetEl);

                if (targetEl) {
                    activeQuestionElement = targetEl;
                    console.log(`✅ Found target element:`, targetEl);
                    
                    if (targetEl.matches('input[type="text"]') || targetEl.matches('select')) {
                        targetEl.classList.add('active-input');
                        console.log(`📝 Added active-input class to input/select element`);
                    } else {
                        targetEl.classList.add('active-question');
                        console.log(`📋 Added active-question class to question element`);
                    }
                    scrollIntoViewIfNeeded(targetEl);
                } else {
                    console.log(`⚠️ Target element not found, looking for paragraph matching question`);
                    const pMatch = document.querySelector(`.paragraph-matching-question select[id="q${questionNumber}"]`);
                    if(pMatch) {
                        activeQuestionElement = pMatch;
                        pMatch.classList.add('active-input');
                        scrollIntoViewIfNeeded(pMatch);
                        console.log(`✅ Found paragraph matching question:`, pMatch);
                    } else {
                        console.log(`❌ No target element found for question ${questionNumber}`);
                    }
                }
            }

            updateNavigation();
updateAllIndicators(); // keep footer “answered” and counts fresh after navigation
console.log(`✅ goToQuestion completed for question ${questionNumber}`);
}
        
        // --- UI & NAVIGATION ---

        function updateNavigation() {
            console.log(`🔄 updateNavigation called for currentQuestion: ${currentQuestion}`);
            
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => btn.classList.remove('active'));
            const activeNav = document.querySelector(`.subQuestion[onclick="goToQuestion(${currentQuestion})"]`);
            if (activeNav) {
                activeNav.classList.add('active');
                console.log(`✅ Updated navigation - active nav button:`, activeNav);
            } else {
                console.log(`⚠️ No active navigation button found for question ${currentQuestion}`);
            }

            const inputs = document.querySelectorAll('.answer-input, .drop-zone.filled, .summary-drop-zone.filled');
            inputs.forEach(input => input.classList.remove('active-input'));
            
            const activeInput = document.getElementById(`q${currentQuestion}`);
            if (activeInput) {
                activeInput.classList.add('active-input');
                if (typeof activeInput.focus === 'function') {
                    activeInput.focus();
                }
                console.log(`✅ Focused on input element:`, activeInput);
            } else {
                console.log(`⚠️ No direct input found for question ${currentQuestion}, looking in question block`);
                // Prefer the specific question element for styling (TF/MCQ), fallback to any data-q-start container
                let activeQuestionBlock = document.querySelector(`.tf-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`.multi-choice-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`[data-q-start="${currentQuestion}"]`);
                if (activeQuestionBlock) {
                    // Add active-question class to style number badge
                    activeQuestionBlock.classList.add('active-question');
                    const firstInput = activeQuestionBlock.querySelector('input, select');
                    if(firstInput) {
                        firstInput.classList.add('active-input');
                         if (typeof firstInput.focus === 'function') {
                            firstInput.focus();
                        }
                        console.log(`✅ Focused on input in question block:`, firstInput);
                    } else {
                        console.log(`⚠️ No input found in question block for question ${currentQuestion}`);
                    }
                } else {
                    console.log(`❌ No question block found for question ${currentQuestion}`);
                }
            }
            
            console.log(`✅ updateNavigation completed`);
        }
        
        function selectDragItem(item) {
            if (selectedDragItem) {
                selectedDragItem.classList.remove('selected');
            }
            selectedDragItem = item;
            if (selectedDragItem) {
                selectedDragItem.classList.add('selected');
            }
        }
        
        window.nextQuestion = () => currentQuestion < 40 && goToQuestion(currentQuestion + 1);
        window.previousQuestion = () => currentQuestion > 1 && goToQuestion(currentQuestion - 1);

        function updateAllIndicators() {
            updateAttemptedCount(1, 1, 13);
            updateAttemptedCount(2, 14, 26);
            updateAttemptedCount(3, 27, 40);
            updateAnsweredNav();
        }
        
            function updateAnsweredNav() {
    const navButtons = document.querySelectorAll('.subQuestion');
    navButtons.forEach(btn => {
        // Get question number from onclick="goToQuestion(N)"
        const m = btn.getAttribute('onclick')?.match(/goToQuestion\((\d+)\)/);
        const qNum = m ? parseInt(m[1], 10) : NaN;

        btn.classList.toggle('answered', !isNaN(qNum) && isQuestionAnswered(qNum));
    });
}
        
            function isQuestionAnswered(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            if (textInput && (textInput.value.trim() !== '' || (textInput.classList.contains('drop-zone') && textInput.children.length > 0))) {
                return true;
            }
            const radio = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (radio) {
                return true;
            }
            // Special handling for the combined checkbox group (Q20 & Q21)
            if (qNum === 20 || qNum === 21) {
                const checked = document.querySelectorAll('input[name="q20-21"]:checked');
                if (checked.length > 0) return true;
            }
            // Questions 24-26 are individual text input questions, not a checkbox group
            // Special handling for the checkbox group (Q32-34)
            if (qNum >= 32 && qNum <= 34) {
                const checked = document.querySelectorAll('input[name^="q32"]:checked');
                if (checked.length > 0) return true;
            }
            // Handle drag & drop questions (e.g., 20-23)
            const dz = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);
            if (dz && dz.querySelector('.drag-item')) {
                return true;
            }
            // Handle clickable-cell matrix questions (any question using clickable cells)
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return true;
            }
            return false;
        }

        function scrollIntoViewIfNeeded(element) {
            const panel = element.closest('.questions-panel, .passage-panel');
            const panelRect = panel.getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();
            if (elementRect.top < panelRect.top || elementRect.bottom > panelRect.bottom) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // --- DRAG AND DROP ---
        
        function initializeDragAndDrop() {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('click', () => selectDragItem(item));
            });
            document.querySelectorAll('.drop-zone, .drag-options-container').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            if (draggedItem && draggedItem.dataset.dndGroup === targetZone.dataset.dndGroup) {
                targetZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            targetZone.classList.remove('drag-over');

            if (!draggedItem || draggedItem.dataset.dndGroup !== targetZone.dataset.dndGroup) {
                return;
            }

            const sourceZone = draggedItem.parentElement;
            if (sourceZone === targetZone) return; // Prevent dropping on itself

            const existingItemInTarget = targetZone.classList.contains('drop-zone') 
                ? targetZone.querySelector('.drag-item') 
                : null;

            // First, clear the target drop-zone of any text (like question numbers) before adding the new item.
            if (targetZone.classList.contains('drop-zone')) {
                Array.from(targetZone.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        node.remove();
                    }
                });
            }

            // Move the item that was in the target (if any) to the source zone.
            if (existingItemInTarget) {
                sourceZone.appendChild(existingItemInTarget);
            }
            
            // Finally, move the dragged item to the target zone.
            targetZone.appendChild(draggedItem);
            targetZone.classList.add('filled');
            // Lock the pill-like appearance for items dropped into zones
            if (draggedItem) {
                draggedItem.style.cursor = 'default';
            }
            // Hide placeholder text (question number) once filled
            if (targetZone.textContent && /^\d+$/.test(targetZone.textContent.trim())) {
                targetZone.textContent = '';
            }

            // After the move, clean up the source zone if it's a drop-zone and is now empty.
            if (sourceZone.classList.contains('drop-zone') && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
                 const qNum = sourceZone.dataset.qStart;
                 sourceZone.innerText = qNum; // Restore the question number
            }
            
            updateAllIndicators();
        }
        
        // --- MISC HELPERS ---
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval); // Ensure no multiple intervals
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    // checkAnswers(); // Disabled to prevent modal from opening automatically.
                }
            }, 1000);
            timerToggleButton.innerHTML = pauseIcon;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerToggleButton.innerHTML = playIcon;
        }

        function toggleTimer() {
            // Check based on the icon currently displayed
            if (timerToggleButton.innerHTML.includes('M6 19h4V5H6v14z')) { // Check for pause icon shape
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function resetTimer() {
            timeInSeconds = 3600;
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            startTimer();
            timerToggleButton.innerHTML = pauseIcon;
        }
        
        function setupCheckboxLimits() {
            const checkboxGroups = [
                { name: 'q20-21', limit: 2 },
                { name: 'q32', limit: 3, pattern: 'q32[A-F]' },
                { name: 'q38-40', limit: 3 }
                // Questions 24-26 are individual text input questions, not checkboxes
            ];
            checkboxGroups.forEach(group => {
                let checkboxes;
                if (group.pattern) {
                    // Use regex pattern for questions like 32-34
                    checkboxes = document.querySelectorAll(`input[name^="${group.name.replace(/[A-F]$/, '')}"]`);
                } else {
                    checkboxes = document.querySelectorAll(`input[name="${group.name}"]`);
                }
                
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        let checkedCount;
                        if (group.pattern) {
                            checkedCount = document.querySelectorAll(`input[name^="${group.name.replace(/[A-F]$/, '')}"]:checked`).length;
                        } else {
                            checkedCount = document.querySelectorAll(`input[name="${group.name}"]:checked`).length;
                        }
                        
                        if (checkedCount >= group.limit) {
                            // Disable all unchecked checkboxes
                            checkboxes.forEach(cb => {
                                if (!cb.checked) {
                                    cb.disabled = true;
                                    cb.parentElement.style.opacity = '0.5';
                                    cb.parentElement.style.cursor = 'not-allowed';
                                }
                            });
                        } else {
                            // Enable all checkboxes
                            checkboxes.forEach(cb => {
                                cb.disabled = false;
                                cb.parentElement.style.opacity = '1';
                                cb.parentElement.style.cursor = 'pointer';
                            });
                        }
                        
                        if (checkedCount > group.limit) {
                            checkbox.checked = false;
                        }
                        
                        updateAllIndicators();
                    });
                });
            });
        }

        function setupExampleHeading() {
            const exampleBox = document.querySelector('.example-box');
            if(exampleBox){
                const title = document.createElement('p');
                title.style.fontWeight = 'bold';
                title.textContent = 'List of Statements';
                // exampleBox.insertBefore(title, exampleBox.firstChild);
            }
        }
        
        function initResize(e) {
            e.preventDefault();
            const startX = e.clientX;
            const startWidth = passagePanel.offsetWidth;
            
            const doDrag = (e) => {
                const newWidth = startWidth + e.clientX - startX;
                if (newWidth > 200 && (document.body.clientWidth - newWidth - resizer.offsetWidth) > 200) {
                    passagePanel.style.flex = `0 0 ${newWidth}px`;
                }
            };
            const stopDrag = () => {
                window.removeEventListener('mousemove', doDrag, false);
                window.removeEventListener('mouseup', stopDrag, false);
            };
            
            window.addEventListener('mousemove', doDrag, false);
            window.addEventListener('mouseup', stopDrag, false);
        }
        
        // --- CONTEXT MENU (Highlighting) ---
        
        function initializeContextMenu() {
            const panels = [passagePanel, questionsPanel];
            let targetElementForClear = null;

            // This listener simply tracks the last valid text selection in either panel.
            document.addEventListener('selectionchange', () => {
                const selection = window.getSelection();
                if (selection && !selection.isCollapsed && selection.toString().trim().length > 0) {
                    const range = selection.getRangeAt(0);
                    if (panels.some(panel => panel.contains(range.commonAncestorContainer))) {
                        selectedRange = range;
                        targetElementForClear = null; // New selection overrides clearing a specific element
                    }
                }
            });

            const showContextMenu = (e) => {
                const target = e.target;
                const isClickOnHighlight = target.closest('.highlight, .comment-highlight');
                const isSelectionActive = selectedRange && selectedRange.toString().trim().length > 0;
                
                let showMenu = false;

                if (isClickOnHighlight) {
                    document.getElementById('menu-highlight').style.display = 'none';
                    document.getElementById('menu-note').style.display = 'none';
                    document.getElementById('menu-clear').style.display = 'block';
                    document.getElementById('menu-clear-all').style.display = 'block';
                    contextMenu.targetElementForClear = isClickOnHighlight;
                    showMenu = true;
                } else if (isSelectionActive && panels.some(panel => panel.contains(selectedRange.commonAncestorContainer))) {
                    document.getElementById('menu-highlight').style.display = 'flex';
                    document.getElementById('menu-note').style.display = 'flex';
                    document.getElementById('menu-clear').style.display = 'none';
                    document.getElementById('menu-clear-all').style.display = 'block'; // Always show clear all
                    showMenu = true;
                }

                if (showMenu) {
                    e.preventDefault();
                    contextMenu.style.display = 'block';
                    const menuHeight = contextMenu.offsetHeight;
                    const menuWidth = contextMenu.offsetWidth;
                    let left = e.pageX;
                    let top = e.pageY;
                    if (left + menuWidth > window.innerWidth) left = window.innerWidth - menuWidth - 5;
                    if (top + menuHeight > window.innerHeight) top = e.pageY - menuHeight - 5;
                    else top = e.pageY - menuHeight - 5;
                    
                    contextMenu.style.left = `${left}px`;
                    contextMenu.style.top = `${top}px`;
                }
            };

            panels.forEach(panel => {
                panel.addEventListener('contextmenu', showContextMenu);
            });

            document.addEventListener('click', (e) => {
                if (contextMenu.style.display === 'block' && !contextMenu.contains(e.target)) {
                    closeContextMenu();
                }
            });
        }

        function closeContextMenu() {
            contextMenu.style.display = 'none';
            selectedRange = null; // Clear range after menu closes
        }

        function unwrapElement(element) {
            const parent = element.parentNode;
            if (!parent) return;
            while (element.firstChild) {
                parent.insertBefore(element.firstChild, element);
            }
            parent.removeChild(element);
            parent.normalize();
        }

        window.highlightText = () => {
            if (selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'highlight';
                span.appendChild(selectedRange.extractContents());
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.addNote = () => {
            const note = prompt('Enter your note:');
            if (note && selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = note;
                span.appendChild(selectedRange.extractContents());
                span.appendChild(tooltip);
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.clearHighlight = () => {
             const elementToClear = contextMenu.targetElementForClear;
             if (elementToClear) {
                 unwrapElement(elementToClear);
             }
             closeContextMenu();
             window.getSelection().removeAllRanges();
        };
        
        window.clearAllHighlights = () => {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(unwrapElement);
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        function updateAttemptedCount(part, startQ, endQ) {
            let answeredCount = 0;
            for (let i = startQ; i <= endQ; i++) {
                if (isQuestionAnswered(i)) {
                    answeredCount++;
                }
            }
            const partHeader = document.querySelector(`.footer__questionNo___3WNct[onclick="switchToPart(${part})"]`);
            if (partHeader) {
                const countSpan = partHeader.querySelector('.attemptedCount');
                if (countSpan) {
                     countSpan.textContent = `${answeredCount} of ${endQ - startQ + 1}`;
                }
            }
        }

        // --- GLOBAL FUNCTION EXPOSURE ---
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.goToQuestion = goToQuestion;
        window.switchToPart = switchToPart;
        window.closeResultsModal = closeResultsModal;
        window.highlightText = highlightText;
        window.addNote = addNote;
        window.clearHighlight = clearHighlight;
        window.clearAllHighlights = clearAllHighlights;
        
        // Explanation toggle function for Part 2
        window.toggleExplanation = function() {
            const explanationSection = document.getElementById('part-2-explanation');
            const button = document.getElementById('show-explanation-btn');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };
        
        // Explanation toggle function for Part 3
        window.toggleExplanationPart3 = function() {
            const explanationSection = document.getElementById('part-3-explanation');
            const button = document.getElementById('show-explanation-btn-part3');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };

        // --- START THE APP ---
        initialize();

        // Add event listeners for table radio buttons
        document.addEventListener('DOMContentLoaded', function() {
            const tableRadios = document.querySelectorAll('.table-radio');
            tableRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // Remove background color from all cells in the same row
                    const row = this.closest('tr');
                    const cells = row.querySelectorAll('td:not(.statement)');
                    cells.forEach(cell => {
                        cell.style.backgroundColor = '';
                    });
                    
                    // Add background color to the selected cell
                    if (this.checked) {
                        this.closest('td').style.backgroundColor = '#e3f2fd';
                    }
                    
                    updateAllIndicators();
                });
            });
            

        });

        // Global function for selecting cells
        window.selectCell = function(cell, questionNum, value) {
            console.log('selectCell called:', questionNum, value);
            
            // Remove selected class from all cells in the same row
            const row = cell.closest('tr');
            const cellsInRow = row.querySelectorAll('.clickable-cell');
            cellsInRow.forEach(c => {
                c.classList.remove('selected');
                c.removeAttribute('data-selected');
                c.removeAttribute('data-answer');
            });
            
            // Add selected class to clicked cell
            cell.classList.add('selected');
            cell.setAttribute('data-selected', 'true');
            cell.setAttribute('data-answer', value);
            
            console.log('Cell selected:', questionNum, value);
            updateAllIndicators();
        };



        // Note: switchToPart function is defined earlier in the code
        // This duplicate function has been removed to prevent conflicts

        // Drag and Drop Functions for Questions 14-20
        window.drag = function(event) {
            // Only allow dragging if the element is visible
            if (event.target.style.display === 'none') {
                event.preventDefault();
                return false;
            }
            event.dataTransfer.setData("text", event.target.getAttribute('data-heading'));
            event.target.classList.add('dragging');
        };

        window.allowDrop = function(event) {
            event.preventDefault();
            event.target.classList.add('drag-over');
        };

        window.dragFromZone = function(event) {
            if (event.target.classList.contains('filled')) {
                const headingId = event.target.getAttribute('data-answer');
                event.dataTransfer.setData("text", headingId);
                event.dataTransfer.setData("source", "zone");
                event.dataTransfer.setData("sourceParagraph", event.target.getAttribute('data-paragraph'));
                event.target.classList.add('dragging');
            } else {
                event.preventDefault();
                return false;
            }
        };

        window.drop = function(event) {
            event.preventDefault();
            event.target.classList.remove('drag-over');
            
            const headingId = event.dataTransfer.getData("text");
            const source = event.dataTransfer.getData("source");
            const sourceParagraph = event.dataTransfer.getData("sourceParagraph");
            const dropZone = event.target;
            const paragraph = dropZone.getAttribute('data-paragraph');
            
            if (!dropZone.classList.contains('paragraph-drop-zone')) return;
            
            // Find the dragged element (from options list)
            const draggedElement = document.querySelector(`[data-heading="${headingId}"]`);
            
            if (source === "zone") {
                // Dragging from zone to zone (swapping)
                const sourceZone = document.querySelector(`[data-paragraph="${sourceParagraph}"]`);
                const currentAnswer = dropZone.getAttribute('data-answer');
                
                if (currentAnswer && currentAnswer !== headingId) {
                    // Swap the items
                    const currentElement = document.querySelector(`[data-heading="${currentAnswer}"]`);
                    
                    // Move current item to source zone
                    sourceZone.textContent = currentElement.textContent;
                    sourceZone.setAttribute('data-answer', currentAnswer);
                    
                    // Update inputs
                    const sourceInput = document.getElementById(`q${14 + ['A','B','C','D','E','F','G'].indexOf(sourceParagraph)}`);
                    if (sourceInput) sourceInput.value = currentAnswer;
                } else {
                    // Clear source zone if no swap needed
                    const sourceQuestionNumber = 14 + ['A','B','C','D','E','F','G'].indexOf(sourceParagraph);
                    sourceZone.textContent = sourceQuestionNumber;
                    sourceZone.classList.remove('filled');
                    sourceZone.removeAttribute('data-answer');
                    sourceZone.setAttribute('draggable', 'false');
                    
                    // Clear source input
                    const sourceInput = document.getElementById(`q${sourceQuestionNumber}`);
                    if (sourceInput) sourceInput.value = '';
                }
                
                // Update drop zone
                if (draggedElement) {
                    dropZone.textContent = draggedElement.textContent;
                    dropZone.classList.add('filled');
                    dropZone.setAttribute('data-answer', headingId);
                    dropZone.setAttribute('draggable', 'true');
                }
                
            } else {
                // Dragging from options list to zone
                if (draggedElement) {
                    // Check if this drop zone already has an answer
                    const previousAnswer = dropZone.getAttribute('data-answer');
                    if (previousAnswer && previousAnswer !== headingId) {
                        // Return the previous option to the options list
                        const previousElement = document.querySelector(`[data-heading="${previousAnswer}"]`);
                        if (previousElement) {
                            previousElement.classList.remove('used');
                            previousElement.setAttribute('draggable', 'true');
                            previousElement.style.display = 'block';
                        }
                    }
                    
                    // Update the drop zone content
                    dropZone.textContent = draggedElement.textContent;
                    dropZone.classList.add('filled');
                    dropZone.setAttribute('data-answer', headingId);
                    dropZone.setAttribute('draggable', 'true');
                    
                    // Hide the dragged element completely (remove from options list)
                    draggedElement.style.display = 'none';
                    draggedElement.classList.add('used');
                    draggedElement.setAttribute('draggable', 'false');
                }
            }
            
            // Update the corresponding input
            const inputElement = document.getElementById(`q${14 + ['A','B','C','D','E','F','G'].indexOf(paragraph)}`);
            if (inputElement) {
                inputElement.value = headingId;
            }
            
            console.log(`Dropped ${headingId} on paragraph ${paragraph}`);
            updateAllIndicators();
        };

        // Remove drag-over class when drag leaves
        document.addEventListener('dragleave', function(event) {
            if (event.target.classList.contains('paragraph-drop-zone')) {
                event.target.classList.remove('drag-over');
            }
        });

        // Remove dragging class when drag ends
        document.addEventListener('dragend', function(event) {
            if (event.target.classList.contains('heading-drag-item')) {
                event.target.classList.remove('dragging');
            }
        });

        // Allow clearing drop zones by double-clicking
        document.addEventListener('dblclick', function(event) {
            if (event.target.classList.contains('paragraph-drop-zone') && event.target.classList.contains('filled')) {
                const headingId = event.target.getAttribute('data-answer');
                const draggedElement = document.querySelector(`[data-heading="${headingId}"]`);
                
                if (draggedElement) {
                    // Reset the drop zone
                    const paragraph = event.target.getAttribute('data-paragraph');
                    const questionNumber = 14 + ['A','B','C','D','E','F','G'].indexOf(paragraph);
                    event.target.textContent = questionNumber;
                    event.target.classList.remove('filled');
                    event.target.removeAttribute('data-answer');
                    
                    // Show the dragged element back in options list
                    draggedElement.classList.remove('used');
                    draggedElement.setAttribute('draggable', 'true');
                    draggedElement.style.display = 'block';
                    
                    // Clear the corresponding input
                    const inputElement = document.getElementById(`q${questionNumber}`);
                    if (inputElement) {
                        inputElement.value = '';
                    }
                    
                    updateAllIndicators();
                }
            }
        });
    });
    </script>

<script>
(function () {
  // Apply saved mode or default to normal
  var saved = localStorage.getItem('textSizeMode') || 'normal';
  document.body.classList.add('text-' + saved);

  // Wire up selector if present
  var select = document.getElementById('textSizeSelect');
  if (select) {
    select.value = saved;
    select.addEventListener('change', function () {
      document.body.classList.remove('text-normal', 'text-large', 'text-xlarge');
      document.body.classList.add('text-' + this.value);
      localStorage.setItem('textSizeMode', this.value);
    });
  }
})();
</script>

</body>
</html>