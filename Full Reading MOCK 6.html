<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Full Reading Practice</title>
    <style>
        /* All CSS styles remain exactly the same as in the original code */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
        }

        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;  
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
            color: #3e3e3e;
    text-decoration: none;
    font-weight: 700;
    font-size: 16px;
    display: flex
;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border: 2px solid #3e3e3e;
    border-radius: 9999px;
    background-color: #ffffff;
    line-height: 1;
}
        

        .telegram-link:hover {
            text-decoration: underline;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            height: calc(100vh - 60px); /* Full height minus header */
            position: relative;
        }

        /* Page watermark */
        body::after {
            content: "@ielts_material_full";
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 72px;
            font-weight: 800;
            letter-spacing: 2px;
            color: #000000;
            opacity: 0.04; /* subtle */
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        .panels-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .passage-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        .passage-panel::-webkit-scrollbar {
            width: 8px;
            background: transparent;
        }
        
        .passage-panel::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .passage-panel::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .passage-panel:hover::-webkit-scrollbar-thumb {
            opacity: 1;
        }

        /* Passage Content */
        .text-center {
            text-align: center;
        }
        .reading-passage h4 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
       
        .reading-passage p {
            margin-bottom: 1.2em;
        }

        .question ul li label {
            display: block;
            margin-top: 8px;
            cursor: pointer;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        .questions-panel::-webkit-scrollbar {
            width: 8px;
            background: transparent;
        }
        
        .questions-panel::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .questions-panel::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .questions-panel:hover::-webkit-scrollbar-thumb {
            opacity: 1;
        }

        .resizer {
            position: relative;
            background: transparent;
            cursor: col-resize;
            flex-shrink: 0;
            flex-grow: 0;
            z-index: 5;
            width: 16px; /* Larger hit area so users don't need to be pixel-perfect */
            touch-action: none; /* Better touch dragging */
            -webkit-user-select: none;
            user-select: none;
        }
        .resizer::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 3px; /* Slightly thicker visual line */
            transform: translateX(-50%);
            background-color: #3e3e3e;
        }
        .resizer::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 36px; /* larger grab handle */
            height: 36px;
            background-color: #ffffff;
            border: 2px solid #3e3e3e;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="%233e3e3e" fill="%233e3e3e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 8l-4 4 4 4"/><path d="M16 8l4 4-4 4"/><line x1="4" y1="12" x2="20" y2="12"/></svg>');
            background-repeat: no-repeat;
            background-size: 60% 60%;
            background-position: center;
            pointer-events: none;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .map-svg {
            border: 2px solid #333;
            background: white;
        }

        .map-room {
            fill: #f9f9f9;
            stroke: #333;
            stroke-width: 1;
        }

        .map-text {
            font-family: Arial, sans-serif;
            font-size: 13px;
            text-anchor: middle;
            fill: #333;
        }

        .map-number {
            font-family: Arial, sans-serif;
            font-size: 16px;
            font-weight: bold;
            text-anchor: middle;
            fill: #333;
        }

        .room-labels {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .room-label {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .room-label:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .room-label.dragging {
            opacity: 0.5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 6px;
            z-index: 101;
        }

        .nav-arrow {
            width: 48px;
            height: 48px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            transition: transform 0.1s ease, background-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
            outline: none;
        }
        .nav-arrow.prev { background-color: #4b5563; }
        .nav-arrow.next { background-color: #000000; }

        .nav-arrow:hover { transform: translateY(-1px); }
        .nav-arrow:active { transform: translateY(0); }
        .nav-arrow:focus-visible { box-shadow: 0 0 0 3px rgba(59,130,246,0.4); }

        .nav-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 768px) {
            .attemptedCount {
                display: none;
            }
            
            /* Mobile resizer improvements */
            .resizer {
                width: 20px; /* Larger touch area */
            }
            
            .resizer::after {
                width: 44px; /* Larger grab handle for mobile */
                height: 44px;
            }
            
            /* Mobile drop zone improvements */
            .drop-zone {
                min-height: 44px;
                padding: 10px;
            }
            
            /* Mobile drag item improvements */
            .drag-item {
                min-height: 44px;
                padding: 10px;
                font-size: 16px;
            }
            
            /* Mobile table improvements */
            .matching-table td {
                padding: 12px 8px;
                min-height: 44px;
            }
            
            .clickable-cell {
                min-height: 44px;
                padding: 10px;
            }
            
            /* Mobile header improvements */
            .header {
                padding: 10px 15px;
                height: 70px; /* Taller for mobile */
            }
            
            .timer-container {
                font-size: 18px;
            }
            
            .telegram-link {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            /* Mobile question navigation */
            .question {
                margin-bottom: 25px;
            }
            
            .question-prompt {
                margin-bottom: 20px;
            }
            
            .question-prompt p {
                font-size: 16px;
                line-height: 1.5;
            }
        }
        
        /* Additional mobile optimizations */
        @media (max-width: 480px) {
            .main-container {
                flex-direction: column;
            }
            
            .passage-panel, .questions-panel {
                width: 100%;
                min-width: auto;
            }
            
            .resizer {
                display: none; /* Hide resizer on very small screens */
            }
            
            .footer__questionWrapper___1tZ46 {
                margin-right: 5px;
            }
            
            .footer__questionNo___3WNct {
                padding: 10px 12px;
                font-size: 16px;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f3f4f6;
            color: #111827;
            border: 1px solid #d1d5db;
            padding: 10px 16px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.08s ease, background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            min-width: 160px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #ebedf0;
            border-color: #c7ccd4;
        }

        .footer__deliverButton___3FM07:active {
            transform: translateY(1px);
        }

        .footer__deliverButton___3FM07:focus-visible {
            box-shadow: 0 0 0 3px rgba(59,130,246,0.35);
            outline: none;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #eef0f3;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
            box-shadow: none;
        }

        

        .hidden {
            display: none !important;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #bfbfbf;
            border-radius: 4px;
            background-color: #fff;
            padding: 2px 8px;
            font-size: 16px;
            text-align: left;
            font-weight: 700;
            margin-right: 6px;
            margin-left: 6px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            height: 28px;
            min-width: 150px;
            -webkit-autocomplete: none;
            -moz-autocomplete: none;
            autocomplete: none;
        }
        
        /* Disable autocomplete suggestions for all input fields */
        input[type="text"], input[type="email"], input[type="password"], input[type="search"], input[type="url"], input[type="tel"], input[type="number"] {
            -webkit-autocomplete: none;
            -moz-autocomplete: none;
            autocomplete: none;
        }
        
        /* Global scrollbar styling - hide by default, show on hover */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        *::-webkit-scrollbar {
            width: 8px;
            background: transparent;
        }
        
        *::-webkit-scrollbar-track {
            background: transparent;
        }
        
        *::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        *:hover::-webkit-scrollbar-thumb {
            opacity: 1;
        }
        .answer-input.active-input,
        .answer-input:focus {
            border-color: #3581d8;
            border-width: 2px;
            outline: none;
        }
        .answer-input::placeholder {
            color: #666;
            font-weight: 700;
            text-align: center;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .summary-text .answer-input {
            width: 120px;
            height: 24px;
            font-size: 14px;
            margin: 0 4px;
        }
        .answer-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .answer-inputs .answer-input {
            width: 200px;
            height: 30px;
            font-size: 16px;
        }
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 200px;
        }
        .drag-item {
            background: white;
            border: 1px solid #9c9c9c;
            font-weight: 600;
            padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            width: 50%;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px;
            display: flex;
            align-items: center;
            position: relative;
            color: #afafaf;
            font-weight: 600;
            height: 27px;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone.disabled {
            pointer-events: none;
        }
        .drop-zone .drag-item {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            padding: 2px;
        }
        .drag-options-container {
            margin-top: 10px;
        }
        .drag-options-container .drag-item {
            display: block;
            width: fit-content;
            font-size: 15px;
            padding: 0.5px 10px;
            margin-bottom: 5px;
        }
        .drag-options-container .drag-item:last-child {
            margin-bottom: 0;
        }
        .q-number {
            color: #888;
            font-size: 14px;
            font-weight: bold;
        }
        .questions-container {
            width: 100%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px 20px;
            border: 1px solid #e0e0e0;
            text-align: left;
            margin: 10px 20px;
            border-radius: 5px;
        }
        .part-header p {
            margin: 0;
        }
        .part-header p:first-child {
            margin-bottom: 5px;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .timer-container {
            display: flex;
            position: relative;
            cursor: default;
            color: #333;
            font-size: 16px;
            font-weight: 500;
            align-items: center;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .timer-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }

        .timer-controls button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .timer-controls button:hover {
            background: #e0e0e0;
        }

        .timer-controls button svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Styles for TRUE/FALSE/NOT GIVEN questions */
        .tf-question {
            margin-bottom: 25px;
            padding: 10px 0px;
            border-radius: 4px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .tf-question-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 5px 0px;
            border-radius: 4px;
        }
        .tf-question-number, .question-number-box {
            border: 2px solid #ccc;
            padding: 2px 8px;
            margin-right: 10px;
            border-radius: 3px;
            font-weight: bold;
            transition: border-color 0.3s;
            display: inline-block;
        }
        /* Active question blue outline for TF (clears when navigating away) */
        .tf-question.active-question .tf-question-number {
            border-color: #4a90e2;
        }
        .tf-question-text {
            padding-top: 3px;
        }
        .tf-options {
            padding-left: 5px;
        }
        .tf-option {
            display: block;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 10px 12px;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
            background-color: #fff;
        }
        .tf-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .tf-option:has(input[type="radio"]:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for TF/NG */
        .tf-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            border-width: 1px;
        }
        .tf-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            border-width: 1px;
        }
        /* Ensure selected-blue visuals don't conflict once results are shown */
        body.results-mode .tf-option:has(input[type="radio"]:checked) {
            box-shadow: none;
        }
        .tf-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .answer-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
            min-width: 120px;
            cursor: pointer;
        }

        .answer-select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        .tf-question.correct .tf-question-line {
            background-color: #e9f7ef;
        }
        .tf-question.incorrect .tf-question-line {
            background-color: #f8d7da;
        }
        .matching-question-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
        }
        .matching-options-bank {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .matching-questions {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .matching-question-item {
            display: flex;
            align-items: center;
            gap: 15px;

            border: 2px solid transparent;
            border-radius: 4px;
            transition: border-color 0.3s;
        }
        .matching-question-item > span {
            flex: 1;
        }
        .matching-question-item.correct {
            background-color: #e9f7ef;
            border-color: #28a745 !important;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone {
            width: auto;
            min-width: 200px;
            flex-shrink: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-weight: bold;
            color: #aaa;
        }
        .matching-options-bank .drag-item {
            font-size: 15px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            max-width: 700px;
        }

        .questions-panel {
            flex: 1;
            padding: 20px 20px 100px;
            overflow-y: auto;
            min-width: 200px; /* Minimum width */
            border-left: 1px solid #e0e0e0;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .summary-completion-container {
            margin-top: 20px;
        }
        .summary-text p {
            line-height: 3.0;
            font-size: 16px;
            margin-bottom: 12px;
        }
        .summary-text li {
            line-height: 2.2;
            margin-bottom: 10px;
        }
        .summary-drop-zone {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            min-width:200px;
            height: 25px;
            border: 2px dashed #999;
            border-radius: 4px;
            margin: 0 5px;
            padding: 0 5px;
            transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
            color: #aaa;
            font-weight: bold;
            text-align: center;
        }
        .summary-drop-zone.filled {
            border-color: #4a90e2;
        }
        .summary-drop-zone.active-input {
             border-color: #4a90e2;
             box-shadow: none;
        }
        .summary-drop-zone .drag-item {
            font-size: 15px;
            font-weight: bold;
            background-color: transparent;
            border: none;
            padding: 0;
            text-align: center;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .summary-options-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .summary-options-bank .drag-item {
            flex-grow: 1;
            min-width: 100px;
            text-align: center;
        }

        /* Filled drop-zone pill styling */
        .drop-zone.filled {
            background-color: transparent;
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
            padding: 0;
        }
        .drop-zone.filled .drag-item {
            width: auto;
            height: auto;
            display: inline-block;
            border: 2px solid #4a90e2;
            border-radius: 10px;
            padding: 4px 10px;
            font-weight: 700;
            background: #fff;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.15);
            cursor: default;
            white-space: nowrap;
        }
        .multi-choice-question {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
            border: 3px solid transparent;
            transition: border-color 0.3s, background-color 0.3s;
        }
        /* MCQ number badge: style first strong within prompt */
        .multi-choice-question .question-prompt p > strong:first-child {
            border: 2px solid #ccc;
    padding: 2px 8px;
    margin-right: 10px;
    border-radius: 3px;
    font-weight: bold;
    transition: border-color 0.3s;
    display: inline-block;
        }
        /* Active question blue outline for MCQ (clears when navigating away) */
        .multi-choice-question.active-question .question-prompt p > strong:first-child {
            border-color: #4a90e2;
            border-width: 2px;
        }
        .multi-choice-option {
            padding: 10px 12px;
            background-color: #fff;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .multi-choice-option:hover {
            background-color: #f1f7ff;
            border-color: #c6dcfb;
        }
        .multi-choice-option:has(input:checked) {
            background-color: #cfe3f9;
            border-color: #7db3f5;
        }
        /* Answer checking states for MCQ */
        .multi-choice-option.correct {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            box-shadow: inset 0 0 0 2px rgba(40, 167, 69, 0.25) !important;
            border-width: 1px;
            border-radius: 6px;
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            box-shadow: inset 0 0 0 2px rgba(220, 53, 69, 0.25) !important;
            border-width: 1px;
            border-radius: 6px;
        }
        /* Correct answer reveal for unselected option after checking */
        .tf-option.correct-answer-highlight,
        .multi-choice-option.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
        }
        body.results-mode .multi-choice-option:has(input:checked) { box-shadow: none; }
        .multi-choice-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }
        .multi-choice-option input[type="checkbox"],
        .multi-choice-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4a90e2;
        }
        .multi-choice-option.correct {
            background-color: #e9f7ef;
        }
        .multi-choice-option.incorrect {
            background-color: #f8d7da;
        }
        .matching-question-item.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545 !important;
        }
        .matching-question-item .drop-zone.filled {
            border-color: #4a90e2;
        }
        .matching-question-item .drop-zone {
            width: 200px;
            height: 40px;
        }
        .paragraph-matching-question {
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 12px;
        }
        .paragraph-matching-question .answer-input {
            width: 80px;
            flex-shrink: 0;
        }

        .matching-form-container {
            margin-top: 20px;
        }
        .matching-form-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .matching-form-label {
            flex-shrink: 0;
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(3px);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.hidden {
            display: none;
        }
        .modal-content {
            background: #ffffff;
            padding: 24px;
            border-radius: 14px;
            width: 92%;
            max-width: 780px;
            max-height: 86vh;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid #e5e7eb;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }
        .modal-content h2 {
            text-align: center;
            margin-bottom: 18px;
            color: #111827;
        }
        .results-summary {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 16px;
            text-align: center;
            border-bottom: 1px solid #eef2f7;
            padding-bottom: 12px;
        }
        .results-summary p {
            margin: 0;
            font-size: 14px;
            color: #374151;
        }
        .results-summary p span {
            display: inline-block;
            padding: 4px 10px;
            margin-left: 6px;
            border-radius: 999px;
            background: #f3f4f6;
            font-weight: 700;
            color: #111827;
        }
        .results-details-container {
            overflow-y: auto;
            padding-right: 10px; /* For scrollbar */
            border-radius: 8px;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        
        .results-details-container::-webkit-scrollbar {
            width: 8px;
            background: transparent;
        }
        
        .results-details-container::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .results-details-container::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .results-details-container:hover::-webkit-scrollbar-thumb {
            opacity: 1;
        }
        .result-row {
            display: grid;
            grid-template-columns: 56px 1fr 1fr;
            gap: 12px;
            padding: 10px 8px;
            border-bottom: 1px solid #eef2f7;
            font-size: 15px;
            align-items: center;
        }
        .result-row.correct {
            background-color: #f3faf5;
        }
        .result-row.incorrect {
            background-color: #fff5f5;
        }
        .result-row .q-num {
            font-weight: 700;
            color: #111827;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            width: 42px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .result-row .user-ans {
            color: #374151;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .result-row .correct-ans {
            color: #065f46;
            font-weight: 600;
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            padding: 4px 8px;
            border-radius: 6px;
        }
        .correct-answer-display {
            font-weight: bold;
            color: #28a745;
            margin-left: 10px;
            font-size: 14px;
        }
        
        
        .centered-title {
    text-align: center;
    font-size: 50px;
    font-weight: bold;
    margin-bottom: 15px;
}

        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }
        
        .matching-table th {
            background-color: #007bff;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
        }
        
        .matching-table td {
            padding: 12px;
            border: 1px solid #ddd;
            vertical-align: top;
        }
        
        .matching-table .statement {
            text-align: left;
            width: 60%;
            font-size: 15px;
        }
        
        .matching-table .table-radio {
            margin: 0;
            transform: scale(1.2);
        }
        
        .matching-table td:not(.statement) {
            text-align: center;
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table th:not(:first-child) {
            width: 6.67%;
            min-width: 60px;
        }
        
        .matching-table td:not(.statement):has(input:checked) {
            background-color: #e3f2fd;
        }
        
        .matching-table input[type="radio"]:checked {
            accent-color: #007bff;
        }
        
        .matching-table td.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table td.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .options-row {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }
        
        .matching-table .options-row td {
            font-weight: 500;
            text-align: center;
            padding: 8px 12px;
            font-size: 13px;
        }
        
        .matching-table .options-row td:first-child {
            text-align: left;
            font-weight: normal;
        }
        
        .matching-table td.correct-answer-highlight {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell {
            cursor: pointer;
            transition: background-color 0.2s ease;
            min-height: 40px;
            border: 1px solid #ddd;
            position: relative;
        }
        
        .matching-table .clickable-cell:hover {
            background-color: #f0f8ff;
            border-color: #007bff;
        }
        
        .matching-table .clickable-cell.selected {
            background-color: #e3f2fd;
        }
        
        .matching-table .clickable-cell.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
        }
        
        .matching-table .clickable-cell.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
        }
        
        .matching-table .clickable-cell::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }
        
        .matching-table .clickable-cell.selected::after {
        }
        
        /* Explanation Section Styles */
        .explanation-section {
            margin-top: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .explanation-section h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .explanation-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .explanation-content strong {
            color: #4a90e2;
            font-weight: 600;
        }
        
        #show-explanation-btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        #show-explanation-btn:hover {
            background-color: #357abd;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="timer-container">
            <span class="timer-display">60:00</span>
            <div class="timer-controls">
                <button id="timer-toggle-btn" title="Pause/Resume Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>
                </button>
                <button id="timer-reset-btn" title="Reset Timer">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
                </button>
            </div>
        </div>
        <a href="https://t.me/ielts_material_full" target="_blank" class="telegram-link">
            Full Exam Materials
        </a>
    </div>

    <div class="main-container" id="main-container">
        <div id="passage-header-container">
            <div id="part-header-1" class="part-header">
                <p><strong>Part 1</strong></p>
                <p>Read the text and answer questions 1-13.</p>
            </div>
            <div id="part-header-2" class="part-header hidden">
                <p><strong>Part 2</strong></p>
                <p>Read the text and answer questions 14-26.</p>
            </div>
            <div id="part-header-3" class="part-header hidden">
                <p><strong>Part 3</strong></p>
                <p>Read the text and answer questions 27-40.</p>
            </div>
        </div>
        <div class="panels-container">
            <div class="passage-panel" id="passage-panel">
                <div id="passage-text-1" class="reading-passage">
                    <h4 class="text-center">THE HISTORY OF MODERN AMERICAN DANCE</h4>
                    <p><strong>A</strong> The birth of modern American dance occurred in the first years of the twentieth century. And, perhaps unusually for academics, dance historians hold remarkably similar views when it comes to identifying the early 1900s, we can see that dancers quite deliberately moved away from previous approaches. This included rejecting both the formal moves of ballet dancing and the entertainment of vaudeville dancing. As a result, dancers began the new century with a fresh start. One important figure at this time was Loie Fuller, who performed largely with her arms, perhaps because she had limited dance training. Fuller emphasized visual effects rather than storytelling, and pioneered the use of artificial lighting to create shadows while dancing.</p>
                    <p><strong>B</strong> Perhaps most influential in the early years was Isadora Duncan, who was well known in both America and Europe. Duncan refused to wear elaborate costumes, preferring to dance in plain dresses and bare feet. She is also notable for preferring music written by classical composers such as Chopin and Beethoven, rather than contemporary compositions. At a similar time, Ruth St Denis was bringing the dance training academy with her husband with the intention of passing on her approach and style to the next generation of American dancers.</p>
                    <p><strong>C</strong> By the 1920s, the modern dance movement in America was well established. Audiences were enthusiastic and dancers were increasingly prepared to experiment with new ideas. Martha Graham was one of an important group who emerged in New York. Graham looked within herself to find her dance style, examining how her body moved as she breathed, but also observing the patterns made by her limbs when walking in order to find a new, naturalistic approach to dance. Doris Humphrey wanted her dance to reflect her personal experience of American life. She explored the concept of gravity, allowing her body to fall, only to recover at the last moment. Her book The Art of Making Dances, which detailed her approach to dance composition, was highly influential with later generations of dancers.</p>
                    <p><strong>D</strong> By the 1930s, modern dance was becoming an accepted, respectable art form. Universities such as Bennington College included modern dance in their performing arts programmes for the first time. In the 1940s, German-born dancer Hanya Holm embraced the changing times by including modern dance in mainstream musicals on the Broadway stage. Among Holm's many other innovations was bringing her own humour to these performances – audiences adored it.</p>
                    <p><strong>E</strong> Modern American dance has seldom stood still. Each new generation of dancers either developed the techniques of their teachers or rejected them outright. So by the 1950s the techniques of traditional European ballet dancing were again influential. This was certainly true of Erick Hawkins, who also incorporated Native American and Asian styles. Similarly, Merce Cunningham emphasized the leg actions and flexibility of the spine associated with ballet moves. Paul Taylor preferred his dance to reflect the experiences and interactions of ordinary people going about their everyday lives. Taylor's career was the subject of a documentary that provided valuable insights into this period of dance.</p>
                    <p><strong>F</strong> The middle decades of the 20th century were certainly a dynamic time. Increasingly, the modern dance movement recognized and reflected the fact that America was a multi-racial, multi-cultural society. Katherine Dunham, an anthropology graduate, used movements from Pacific, African and Caribbean dance to create her unique style. Pearl Primus was another champion of African dance, which she passed on through her dance school in New York. After retirement she travelled widely to universities throughout America lecturing on ethnic dance, which became her main priority.</p>
                    <p><strong>G</strong> Modern dance since the 1980s has become a mix of multiple forms of dance, as well as art more generally. For example, Mark Morris's hugely popular work The Hard Nut includes sensational costumes and a stage design inspired by the comics he'd always enjoyed. Another innovator has been Ohad Naharin, who studied in New York and has worked internationally. Naharin's 'Gaga' style is characterized by highly flexible limbs and backbones, while in rehearsal his dancers have no mirrors, feeling their movements from within themselves, a break from traditional dance custom. In many ways it was a fitting end to a 100-year period that had witnessed a transformation in dance. The emergence of the modern American dance was very much a 20th-century phenomenon. The style drew on influences from home and abroad and in turn, went on to influence global dance culture.</p>
                </div>
                <div id="passage-text-2" class="reading-passage hidden">
                    <h4 class="text-center">Solving the problem of waste disposal</h4>
                    <p style="font-style: italic; text-align: center;">With the amount of rubbish being produced around the world increasing, Mark Rowe asks whether a new generation of incineration plants can help to solve the problem.</p>
                    <p><strong>A</strong> For many years, burning rubbish has been portrayed as the lazy option when it comes to dealing with the problem of waste disposal, since it sends toxic fumes into the air and appears to support a consumerist, throwaway society. Norway, however, appears to be burning its way through a sizable chunk of Europe's municipal waste, using the heat created by this process to warm and power homes in many of its cities. Norway isn't alone: Germany, Sweden, Belgium and the Netherlands all burn significant quantities of rubbish, and across Europe there are 420 plants burning municipal waste. With Europe dumping 150 million tonnes of rubbish into landfill* every year, there would seem to be a limitless supply.</p>
                    <p><strong>B</strong> Those who support burning waste say that a new generation of incinerators has made it a more attractive option. Filters and scrubbing mechanisms now capture harmful substances such as mercury, hydrochloric acid and heavy metals. According to Ted Michaels, president of the US-based Energy Recovery Centre, 'There has been constant evolution in combustion engineering and emissions-control technology, and the output from these facilities is now minuscule.' Above all, however, supporters say that incineration is the only way of preventing the long-term impacts of landfill. In ten years' time, says the World Bank, humans will be generating 2.2 billion tonnes of solid waste per year. Advocates see incineration as a practical way to deal swiftly with an immediate problem.</p>
                    <p><strong>C</strong> Levels of waste generation vary hugely around the world. 'It's a problem for the developed nations,' says Joergen Fenhann, a senior scientist working with the UN Environment Programme in Denmark. 'The more you develop, the more you produce, buy and throw away. But the growth of incineration hasn't been universally welcomed. Lars Haltbrekken, chairman of Friends of the Earth in Norway, is concerned that incineration plants appear to generate demand for their services. 'The problem in Norway,' he explains, 'is that we have built too many waste-burning factories. So we've ended up importing waste from other countries. If you look at this in a very small perspective, it is, of course, better for the climate to burn rubbish from the UK rather than leave it in landfill there,' he continues. 'But in a broader perspective, it's a lazy way of getting rid of waste; you don't stimulate the goals of reducing, reusing and recycling.'</p>
                    <p><strong>D</strong> Incineration is also at odds with EU policy, which promotes a 'recycling hierarchy': ideally, we simply produce less waste in the first place; failing that, we reuse objects more; the next step is recycling; only then should we consider incineration, while dumping in landfill is the last resort. Dealing with the problem of waste disposal involves tracing the whole process that took the material from its inception to landfill. We used to call this the 'cradle to grave' life cycle; now, the talk is of 'cradle to cradle' and an even more comprehensive concept known as 'zero waste'. 'The philosophy of cradle to cradle is about designing products that are actually good for the environment at the end of their life,' says Joan Marc Simon, European spokesman for the environmental movement GAIA. You design a bottle that contains no toxins, is fully recyclable and requires the minimum amount of energy to be produced.' As Simon points out, however, without the right mechanisms in place 'nothing guarantees that this bottle will end up being properly collected and treated in the appropriate recycling facility'.</p>
                    <p><strong>E</strong> Tim Burns, policy manager at Keep Britain Tidy, says, 'In the UK alone, people waste £10 billion of food every year. You can argue about composting that, or not buying it in the first place — if you do that, then that's money the retailers don't get, so it's not always clear-cut. The implications of zero waste are that we're going to have to take a good long look at those well-stocked supermarket shelves, too. 'Supermarkets keep their shelves stocked even when demand isn't there, which means they have to pay to dispose of a lot of food, says Burns. 'But that cost is less to them than the cost in brand damage of having empty shelves.'</p>
                    <p><strong>F</strong> Recent history and changes in trends in recycling suggest that we should be prepared for unexpected developments. 'If someone back in the 1980s had suggested what waste would be like now, they would be completely wrong, says Richard Fisher, a PhD researcher at Cranfield University. 'Consumerism has developed at a pace we never expected. Nobody would have said there would be so much electronic waste. But recycling has grown, too — ten years ago nobody would have predicted today's levels of recycling.' But he points out that the need to reduce waste is still a difficult message to sell to consumers. He suggests that what people are really concerned about is their loved ones and the future they face. 'Perhaps we can align the environmental message to these deep-seated values,' he says. 'We need to look at whether it's business that drives consumers or the other way around. You need government to play a leadership role, whereas countries such as the UK seem to be stepping away from the environment in pursuit of short-term economic goals.'</p>
                    <p style="font-style: italic; margin-top: 20px;">*landfill: a method of disposing of waste material by burying it</p>
                </div>
                <div id="passage-text-3" class="reading-passage hidden">
                    <h4 class="text-center">What Are the 1,000 Foods to Eat Before You Die?</h4>
                    <p style="font-style: italic; text-align: center;">Written by a former New York Times restaurant critic, this tome will keep your appetite satisfied for a lifetime.</p>
                    <p>When was the last time you sat down to a meal of harnam meshwi, a.k.a. grilled pigeon, which is most likely found on a menu in Egypt? Or traveled to Oslo, Norway, for a breakfast of freshly caught shrimp? Chances are probably never. However, thanks to former New York Times restaurant critic, Smithsonian contribution and author Mimi Sheraton's latest book, 1,000 Foods to Eat Before You Die, your foodie life is about to get a whole lot more interesting.</p>
                    <p>Inspired by Patricia Schultz's best-selling 1,000 Places to See Before You Die (also published by Workman Publishing), Sheraton has rounded up 1,000 must-try dishes, restaurants, markets, cultural feasts, and even some relatively universal foods (such as bananas, olive oil, and whipped cream) that transcend regional categorization. Curated from cuisines around the globe, Sheraton has put them together in one large volume, along with details on historic and cultural context, tips on how to prepare or where to try a particular dish, and even several dozen recipes. It's a project that's been 10 years in the making—one that's as much a wonderful display of Sheraton's vast food knowledge (she's been writing about food for 60 years) as it is an ode to the world's sheer culinary diversity.</p>
                    <p>The ultimate gift for the food lover. In the same way that 1,000 Places to See Before You Die reinvented the travel book, 1,000 Foods to Eat Before You Die is a joyous, informative, dazzling, mouthwatering life list of the world's best food.</p>
                    <p>The book is organized not by country or type of food, but rather by the experience of eating itself. Sections guide the reader through "Street Food & Snacks," "Comfort Food," and "Sweets & Treats," among others. This structure encourages serendipitous discovery, where a reader looking for a classic French pastry might stumble upon a traditional Indonesian dessert and become captivated. Sheraton's entries are more than just lists; they are miniature stories. She explains why a specific cheese from a remote village in Greece is worth seeking out, or how a particular noodle dish embodies the history of trade routes in Southeast Asia. This narrative approach transforms the book from a mere checklist into a compelling read about culture, history, and human connection through food.</p>
                    <p>Of course, a list of 1,000 items is bound to include some controversies. Some critics question the inclusion of ubiquitous items like the banana, arguing that it diminishes the exclusivity of the list. Others have noted a possible bias towards European and North American cuisines, though Sheraton defends her selections by pointing to the extensive research and personal travels that informed her choices. She emphasizes that the book is a personal, albeit expert, guide rather than a definitive, objective ranking. The goal, she states, is to inspire curiosity and appreciation, not to end debate.</p>
                    <p>Ultimately, 1,000 Foods to Eat Before You Die serves as a passport to gastronomic adventure. It challenges the reader to look beyond their culinary comfort zone, whether that means seeking out a rare ingredient, attempting a complex recipe at home, or simply ordering something unfamiliar at a local restaurant. For Sheraton, the book is a culmination of a lifetime's passion for food, an invitation to savor the incredible diversity of flavors the world has to offer, one unforgettable bite at a time.</p>
                </div>
            </div>
            <div class="resizer" id="resizer"></div>
            <div class="questions-panel" id="questions-panel">
                <div id="questions-1" class="question-set">
                    <div class="questions-container">
                        <div class="question" data-q-start="1" data-q-end="6">
                            <div class="question-prompt">
                                <p><strong>Questions 1–6</strong></p>
                                <p>Do the following statements agree with the information given in Reading Passage 1?</p>
                                <p>In boxes 1–6 on your answer sheet, write</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>TRUE</strong> if the statement agrees with the information</li>
                                    <li><strong>FALSE</strong> if the statement contradicts the information</li>
                                    <li><strong>NOT GIVEN</strong> if there is no information on this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="1" data-q-end="1">
                                <div class="tf-question-line"><span class="tf-question-number">1</span><span class="tf-question-text">Dance historians agree about the development of modern American dance.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q1" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q1" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q1" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="2" data-q-end="2">
                                <div class="tf-question-line"><span class="tf-question-number">2</span><span class="tf-question-text">Dancers in the early 1900s tended to copy the styles of earlier dancers.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q2" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q2" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q2" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="3" data-q-end="3">
                                <div class="tf-question-line"><span class="tf-question-number">3</span><span class="tf-question-text">Loie Fuller preferred to dance alone on stage.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q3" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q3" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q3" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="4" data-q-end="4">
                                <div class="tf-question-line"><span class="tf-question-number">4</span><span class="tf-question-text">Isadora Duncan wore complicated clothing when dancing.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q4" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q4" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q4" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="5" data-q-end="5">
                                <div class="tf-question-line"><span class="tf-question-number">5</span><span class="tf-question-text">Some dancers criticized Isadora Duncan for her choice of music.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q5" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q5" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q5" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="6" data-q-end="6">
                                <div class="tf-question-line"><span class="tf-question-number">6</span><span class="tf-question-text">Ruth St Denis wished to educate others in her style of dancing.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q6" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q6" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q6" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="7" data-q-end="10">
                            <div class="question-prompt">
                                <p><strong>Questions 7–10</strong></p>
                                <p>Complete the notes below.</p>
                                <p>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                            </div>
                            <div class="summary-text" style="border: 1px solid #000; padding: 10px;">
                                <p><strong>Developments in Modern American Dance</strong></p>
                                <p><strong>1920s–1940s</strong></p>
                                <p>Martha Graham based her dance on human actions such as breathing and <input type="text" class="answer-input" id="q7" placeholder="7" autocomplete="off"></p>
                                <p>Doris Humphrey wrote an important <input type="text" class="answer-input" id="q8" placeholder="8" autocomplete="off"> about her ideas.</p>
                                <p>Dance became a respectable subject to study at university.</p>
                                <p>Hanya Holm introduced <input type="text" class="answer-input" id="q9" placeholder="9" autocomplete="off"> into dance and musicals.</p>
                                <p><strong>1950s–1970s</strong></p>
                                <p>Eric Hawkins and Merce Cunningham reintroduced some ballet techniques.</p>
                                <p>An influential <input type="text" class="answer-input" id="q10" placeholder="10" autocomplete="off"> outlined the working life of Paul Taylor.</p>
                            </div>
                        </div>

                        <div class="question" data-q-start="11" data-q-end="13">
                            <div class="question-prompt">
                                <p><strong>Questions 11–13</strong></p>
                                <p>Answer the questions below.</p>
                                <p>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                            </div>
                            <div class="answer-inputs">
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>11</strong> When Pearl Primus gave up dancing, what did she focus on doing?</span>
                                    <input type="text" class="answer-input" id="q11" placeholder="11" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>12</strong> What was an important influence for Mark Morris's The Hard Nut?</span>
                                    <input type="text" class="answer-input" id="q12" placeholder="12" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>13</strong> Dancers working with Ohad Naharin practise without using what?</span>
                                    <input type="text" class="answer-input" id="q13" placeholder="13" autocomplete="off">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="questions-2" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="14" data-q-end="19">
                            <div class="question-prompt">
                                <p><strong>Questions 14–19</strong></p>
                                <p>Reading Passage 2 has six paragraphs, A-F.</p>
                                <p>Choose the correct heading for each paragraph from the list of headings below.</p>
                                <p>Write the correct number, i-vii, in boxes 14-19 on your answer sheet.</p>
                            </div>
                            <div class="example-box">
                                <p><strong>List of Headings</strong></p>
                                <p><strong>i</strong> New terminology reflecting changing attitudes to waste disposal</p>
                                <p><strong>ii</strong> Fundamental changes in behaviour in the past and future</p>
                                <p><strong>iii</strong> Ways of rewarding the public for recycling</p>
                                <p><strong>iv</strong> A surprising approach to waste disposal by several countries</p>
                                <p><strong>v</strong> Difficult choices for individuals and businesses</p>
                                <p><strong>vi</strong> Arguments against incineration from a country that uses it</p>
                                <p><strong>vii</strong> A number of justifications for the use of incineration</p>
                            </div>
                            <div class="answer-inputs">
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>14</strong> Paragraph A</span>
                                    <input type="text" class="answer-input" id="q14" placeholder="14" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>15</strong> Paragraph B</span>
                                    <input type="text" class="answer-input" id="q15" placeholder="15" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>16</strong> Paragraph C</span>
                                    <input type="text" class="answer-input" id="q16" placeholder="16" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>17</strong> Paragraph D</span>
                                    <input type="text" class="answer-input" id="q17" placeholder="17" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>18</strong> Paragraph E</span>
                                    <input type="text" class="answer-input" id="q18" placeholder="18" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>19</strong> Paragraph F</span>
                                    <input type="text" class="answer-input" id="q19" placeholder="19" autocomplete="off">
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="20" data-q-end="23">
                            <div class="question-prompt">
                                <p><strong>Questions 20–23</strong></p>
                                <p>Look at the following people (Questions 20-23) and the list of opinions below.</p>
                                <p>Match each person with the correct opinion, A-G.</p>
                                <p>Write the correct letter, A-G, in boxes 20-23 on your answer sheet.</p>
                            </div>
                            <div class="example-box">
                                <p><strong>List of Opinions</strong></p>
                                <p><strong>A</strong> Incineration does not encourage responsible attitudes to waste disposal.</p>
                                <p><strong>B</strong> Recycling can sometimes create serious problems for the future.</p>
                                <p><strong>C</strong> Greater consumerism leads to higher levels of waste.</p>
                                <p><strong>D</strong> Proper systems are needed for the recycling of environmentally-friendly products.</p>
                                <p><strong>E</strong> Landfill is better for the environment than incineration.</p>
                                <p><strong>F</strong> Incineration of waste is now relatively harmless to the environment.</p>
                                <p><strong>G</strong> Efforts to reduce waste may affect profits for some types of companies.</p>
                            </div>
                            <div class="answer-inputs">
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>20</strong> Ted Michaels</span>
                                    <input type="text" class="answer-input" id="q20" placeholder="20" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>21</strong> Joergen Fenhann</span>
                                    <input type="text" class="answer-input" id="q21" placeholder="21" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>22</strong> Joan Marc Simon</span>
                                    <input type="text" class="answer-input" id="q22" placeholder="22" autocomplete="off">
                                </div>
                                <div class="matching-form-row">
                                    <span class="matching-form-label"><strong>23</strong> Tim Burns</span>
                                    <input type="text" class="answer-input" id="q23" placeholder="23" autocomplete="off">
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="24" data-q-end="26">
                            <div class="question-prompt">
                                <p><strong>Questions 24–26</strong></p>
                                <p>Complete the summary below.</p>
                                <p>Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                                <p>Write your answers in boxes 24-26 on your answer sheet.</p>
                            </div>
                            <div class="summary-text" style="border: 1px solid #000; padding: 10px;">
                                <p><strong>What recent history tells us about recycling</strong></p>
                                <p>Richard Fisher, a researcher from Cranfield University, points out that the pace of consumerism has increased more quickly than was predicted in the 1980s. There has, for example, been unexpected growth in waste from <input type="text" class="answer-input" id="q24" placeholder="24" autocomplete="off"> products. He suggests that the need to protect the environment should be linked to basic values, and adds that it might be better if consumers had more influence over <input type="text" class="answer-input" id="q25" placeholder="25" autocomplete="off"> and more direction was provided by <input type="text" class="answer-input" id="q26" placeholder="26" autocomplete="off">.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="questions-3" class="question-set hidden">
                    <div class="questions-container">
                        <div class="question" data-q-start="27" data-q-end="31">
                            <div class="question-prompt">
                                <p><strong>Questions 27–31</strong></p>
                                <p>Do the following statements agree with the information given in Reading Passage 3?</p>
                                <p>In boxes 27–31 on your answer sheet, write</p>
                                <ul style="list-style: none; padding-left: 0;">
                                    <li><strong>TRUE</strong> if the statement agrees with the information</li>
                                    <li><strong>FALSE</strong> if the statement contradicts the information</li>
                                    <li><strong>NOT GIVEN</strong> if there is no information on this</li>
                                </ul>
                            </div>
                            <div class="tf-question" data-q-start="27" data-q-end="27">
                                <div class="tf-question-line"><span class="tf-question-number">27</span><span class="tf-question-text">Mimi Sheraton is currently working as a restaurant critic for the New York Times.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q27" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q27" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q27" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="28" data-q-end="28">
                                <div class="tf-question-line"><span class="tf-question-number">28</span><span class="tf-question-text">The book 1,000 Foods to Eat Before You Die was directly inspired by a popular travel guide.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q28" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q28" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q28" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="29" data-q-end="29">
                                <div class="tf-question-line"><span class="tf-question-number">29</span><span class="tf-question-text">Sheraton's book includes recipes for every one of the 1,000 foods mentioned.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q29" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q29" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q29" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="30" data-q-end="30">
                                <div class="tf-question-line"><span class="tf-question-number">30</span><span class="tf-question-text">The book is organized according to the geographic origin of the foods.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q30" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q30" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q30" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                            <div class="tf-question" data-q-start="31" data-q-end="31">
                                <div class="tf-question-line"><span class="tf-question-number">31</span><span class="tf-question-text">Sheraton has been a food writer for six decades.</span></div>
                                <div class="tf-options">
                                    <label class="tf-option"><input type="radio" name="q31" value="TRUE"> TRUE</label>
                                    <label class="tf-option"><input type="radio" name="q31" value="FALSE"> FALSE</label>
                                    <label class="tf-option"><input type="radio" name="q31" value="NOT GIVEN"> NOT GIVEN</label>
                                </div>
                            </div>
                        </div>

                        <div class="question" data-q-start="32" data-q-end="35">
                            <div class="question-prompt">
                                <p><strong>Questions 32–35</strong></p>
                                <p>Choose the correct letter, A, B, C or D.</p>
                                <p>Write the correct letter in boxes 32–35 on your answer sheet.</p>
                            </div>
                            <div class="multi-choice-question" data-q-start="32" data-q-end="32">
                                <div class="question-prompt">
                                    <p><strong>32.</strong> The main purpose of the first paragraph is to</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q32" value="A"> criticize people's boring eating habits.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q32" value="B"> provide specific examples of exotic foods.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q32" value="C"> explain the health benefits of a global diet.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q32" value="D"> introduce the book by highlighting its adventurous nature.</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="33" data-q-end="33">
                                <div class="question-prompt">
                                    <p><strong>33.</strong> According to the passage, the book includes all of the following EXCEPT</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q33" value="A"> historical background for certain dishes.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q33" value="B"> recommendations on where to find specific foods.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q33" value="C"> nutritional information for each food item.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q33" value="D"> a small number of full recipes.</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="34" data-q-end="34">
                                <div class="question-prompt">
                                    <p><strong>34.</strong> How is the book's structure described?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q34" value="A"> It is organized by country to make it easy for travelers.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q34" value="B"> It categorizes foods by their main ingredient.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q34" value="C"> It groups foods by the type of eating experience.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q34" value="D"> It is presented in a simple alphabetical list.</label></div>
                            </div>
                            <div class="multi-choice-question" data-q-start="35" data-q-end="35">
                                <div class="question-prompt">
                                    <p><strong>35.</strong> What is the author's stated goal for the book?</p>
                                </div>
                                <div class="multi-choice-option"><label><input type="radio" name="q35" value="A"> To create an objective and definitive ranking of world foods.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q35" value="B"> To settle debates about the best cuisines.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q35" value="C"> To inspire curiosity and appreciation for diverse foods.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q35" value="D"> To promote European and North American restaurants.</label></div>
                            </div>
                        </div>

                        <div class="question" data-q-start="36" data-q-end="40">
                            <div class="question-prompt">
                                <p><strong>Questions 36–40</strong></p>
                                <p>Complete the summary below.</p>
                                <p>Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
                                <p>Write your answers in boxes 36–40 on your answer sheet.</p>
                            </div>
                            <div class="summary-text" style="border: 1px solid #000; padding: 10px;">
                                <p>Mimi Sheraton's book has been described as a <input type="text" class="answer-input" id="q36" placeholder="36" autocomplete="off"> for anyone who loves food. It is noted for its narrative approach, where each entry is like a mini <input type="text" class="answer-input" id="q37" placeholder="37" autocomplete="off">, explaining the cultural significance of a dish. While the book has faced some <input type="text" class="answer-input" id="q38" placeholder="38" autocomplete="off">, particularly over the inclusion of common items and a potential regional bias, Sheraton clarifies that the selections are based on her own <input type="text" class="answer-input" id="q39" placeholder="39" autocomplete="off"> and expert opinion. The ultimate aim of the book is to encourage readers to expand their <input type="text" class="answer-input" id="q40" placeholder="40" autocomplete="off"> and embark on a gastronomic adventure.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow prev" onclick="previousQuestion()" id="prevBtn" aria-label="Previous question">
            <!-- Left arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
        <button class="nav-arrow next" onclick="nextQuestion()" id="nextBtn" aria-label="Next question">
            <!-- Right arrow icon -->
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)"><span class="sr-only">Question 12</span><span aria-hidden="true">12</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)"><span class="sr-only">Question 13</span><span aria-hidden="true">13</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 13</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)"><span class="sr-only">Question 14</span><span aria-hidden="true">14</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)"><span class="sr-only">Question 15</span><span aria-hidden="true">15</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)"><span class="sr-only">Question 16</span><span aria-hidden="true">16</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(17)"><span class="sr-only">Question 17</span><span aria-hidden="true">17</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)"><span class="sr-only">Question 18</span><span aria-hidden="true">18</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)"><span class="sr-only">Question 19</span><span aria-hidden="true">19</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)"><span class="sr-only">Question 20</span><span aria-hidden="true">20</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 14</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div id="menu-highlight" class="context-menu-item" onclick="highlightText()">
            Highlight
        </div>
        <div id="menu-note" class="context-menu-item" onclick="addNote()">
            Note
        </div>
        <div id="menu-clear" class="context-menu-item" onclick="clearHighlight()">
            Clear
        </div>
        <div id="menu-clear-all" class="context-menu-item" onclick="clearAllHighlights()">
            Clear All
        </div>
    </div>

    <div id="results-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeResultsModal()">&times;</button>
            <h2>Results</h2>
            <div class="results-summary">
                <p>Score: <span id="results-score"></span> / 40</p>
                <p>IELTS Band: <span id="results-band"></span></p>
            </div>
            <div id="results-details" class="results-details-container">
                <!-- Results for each question will be injected here -->
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- STATE VARIABLES ---
        let currentPassage = 1;
        let currentQuestion = 1;
        let selectedRange = null;
        let timeInSeconds = 3600;
        let timerInterval;
        let draggedItem = null;
        let activeQuestionElement = null;
        let selectedDragItem = null;

        // --- GLOBAL FUNCTIONS ---
        function getFirstQuestionOfPart(part) {
            switch(part) {
                case 1: return 1;
                case 2: return 14;
                case 3: return 27;
                default: return 1;
            }
        }

        // --- DOM ELEMENTS ---
        const timerDisplay = document.querySelector('.timer-display');
        const timerToggleButton = document.getElementById('timer-toggle-btn');
        const timerResetButton = document.getElementById('timer-reset-btn');
        const deliverButton = document.getElementById('deliver-button');
        const resizer = document.getElementById('resizer');
        const passagePanel = document.getElementById('passage-panel');
        const questionsPanel = document.getElementById('questions-panel');
        const contextMenu = document.getElementById('contextMenu');

        // --- ICON SVGs ---
        const playIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>';
        const pauseIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

        // --- ANSWERS ---
        const correctAnswers = {
            // Part 1 (1-13) - The History of Modern American Dance
            '1': 'TRUE',      // Dance historians agree about the development of modern American dance
            '2': 'FALSE',     // Dancers in the early 1900s tended to copy the styles of earlier dancers
            '3': 'NOT GIVEN', // Loie Fuller preferred to dance alone on stage
            '4': 'FALSE',     // Isadora Duncan wore complicated clothing when dancing
            '5': 'NOT GIVEN', // Some dancers criticized Isadora Duncan for her choice of music
            '6': 'TRUE',      // Ruth St Denis wished to educate others in her style of dancing
            '7': 'walking',   // Martha Graham based her dance on human actions such as breathing and walking
            '8': 'book',      // Doris Humphrey wrote an important book about her ideas
            '9': 'humour',    // Hanya Holm introduced humour into dance and musicals
            '10': 'documentary', // An influential documentary outlined the working life of Paul Taylor
            '11': 'lecturing', // When Pearl Primus gave up dancing, what did she focus on doing
            '12': 'comics',   // What was an important influence for Mark Morris's The Hard Nut
            '13': 'mirrors',  // Dancers working with Ohad Naharin practise without using what
            // Part 2 (14-26) - Solving the problem of waste disposal
            '14': 'iv',       // Paragraph A - A surprising approach to waste disposal by several countries
            '15': 'vii',      // Paragraph B - A number of justifications for the use of incineration
            '16': 'vi',       // Paragraph C - Arguments against incineration from a country that uses it
            '17': 'i',        // Paragraph D - New terminology reflecting changing attitudes to waste disposal
            '18': 'v',        // Paragraph E - Difficult choices for individuals and businesses
            '19': 'ii',       // Paragraph F - Fundamental changes in behaviour in the past and future
            '20': 'F',        // Ted Michaels - Incineration of waste is now relatively harmless to the environment
            '21': 'C',        // Joergen Fenhann - Greater consumerism leads to higher levels of waste
            '22': 'D',        // Joan Marc Simon - Proper systems are needed for the recycling of environmentally-friendly products
            '23': 'G',        // Tim Burns - Efforts to reduce waste may affect profits for some types of companies
            '24': 'electronic', // There has been unexpected growth in waste from electronic products
            '25': 'business', // It might be better if consumers had more influence over business
            '26': 'government', // More direction was provided by government
            // Part 3 (27-40) - What Are the 1,000 Foods to Eat Before You Die?
            '27': 'FALSE',    // Mimi Sheraton is currently working as a restaurant critic for the New York Times
            '28': 'TRUE',     // The book 1,000 Foods to Eat Before You Die was directly inspired by a popular travel guide
            '29': 'FALSE',    // Sheraton's book includes recipes for every one of the 1,000 foods mentioned
            '30': 'FALSE',    // The book is organized according to the geographic origin of the foods
            '31': 'TRUE',     // Sheraton has been a food writer for six decades
            '32': 'D',        // The main purpose of the first paragraph is to introduce the book by highlighting its adventurous nature
            '33': 'C',        // According to the passage, the book includes all of the following EXCEPT nutritional information for each food item
            '34': 'C',        // How is the book's structure described? It groups foods by the type of eating experience
            '35': 'C',        // What is the author's stated goal for the book? To inspire curiosity and appreciation for diverse foods
            '36': 'passport', // Mimi Sheraton's book has been described as a passport for anyone who loves food
            '37': 'story',    // Each entry is like a mini story
            '38': 'controversies', // While the book has faced some controversies
            '39': 'research', // Sheraton clarifies that the selections are based on her own research
            '40': 'culinary'  // The ultimate aim of the book is to encourage readers to expand their culinary
        };

        // --- INITIALIZATION ---
        function initialize() {
            console.log(`🚀 Initializing application...`);
            startTimer();
            initializeDragAndDrop();
            setupCheckboxLimits();
            setupExampleHeading();
            console.log(`📋 Setting up initial state - switching to part 1`);
            switchToPart(1); // Also calls goToQuestion(1) and updateNavigation
            
            document.body.addEventListener('input', updateAllIndicators);
            document.body.addEventListener('change', updateAllIndicators);
            deliverButton.addEventListener('click', checkAnswers);
            timerToggleButton.addEventListener('click', toggleTimer);
            timerResetButton.addEventListener('click', resetTimer);

            // Auto-close dropdowns for Questions 20-23 on selection
            ['q20','q21','q22','q23'].forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    sel.addEventListener('change', () => sel.blur());
                }
            });

            // Add click listeners to question containers for navigation
            document.querySelectorAll('[data-q-start]').forEach(el => {
                el.addEventListener('click', (event) => {
                    // Stop event propagation to prevent parent container clicks
                    event.stopPropagation();
                    
                    const qNum = parseInt(el.dataset.qStart, 10);
                    const qEnd = parseInt(el.dataset.qEnd, 10);
                    
                    console.log(`🖱️ Question container clicked - qNum: ${qNum}, qEnd: ${qEnd}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without valid question number, ignoring navigation`);
                        return;
                    }
                    
                    // Only navigate if this is a single question (qStart === qEnd) or if we're clicking on a specific question within a group
                    if (qNum === qEnd || el.classList.contains('tf-question')) {
                        if (currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum}`);
                            goToQuestion(qNum);
                        } else {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed`);
                        }
                    } else {
                        console.log(`ℹ️ Ignoring click on group container (${qNum}-${qEnd})`);
                    }
                });
            });
            
            // Add specific click listeners for individual question elements to prevent parent container interference
            document.querySelectorAll('.tf-question, .summary-text').forEach(el => {
                el.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(el.dataset.qStart, 10);
                    console.log(`🎯 Individual question element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, element:`, el);
                    
                    // Handle cases where qNum is NaN (like .summary-text containers)
                    if (isNaN(qNum)) {
                        console.log(`ℹ️ Container without specific question number, ignoring navigation`);
                        return;
                    }
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (individual element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (individual element)`);
                    }
                });
            });
            
            // Add specific click listeners for individual input elements in questions 33-36
            document.querySelectorAll('.answer-input[id^="q3"]').forEach(input => {
                input.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(input.id.replace('q', ''), 10);
                    console.log(`📝 Input element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, input:`, input);
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (input element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (input element)`);
                    }
                });
            });

            // Add click listeners for select elements (Questions 1-5)
            document.querySelectorAll('.answer-select').forEach(select => {
                select.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const qNum = parseInt(select.name.replace('q', ''), 10);
                    console.log(`📝 Select element clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, select:`, select);
                    
                    if (currentQuestion !== qNum) {
                        console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (select element)`);
                        goToQuestion(qNum);
                    } else {
                        console.log(`ℹ️ Already on question ${qNum}, no navigation needed (select element)`);
                    }
                });
            });
            
            // Add click listeners for the paragraph elements containing questions 33-36
            document.querySelectorAll('.summary-text p').forEach(p => {
                p.addEventListener('click', (event) => {
                    event.stopPropagation();
                    // Extract question number from the paragraph text (e.g., "33" from "<strong>33</strong>")
                    const strongElement = p.querySelector('strong');
                    if (strongElement) {
                        const qNum = parseInt(strongElement.textContent, 10);
                        console.log(`📄 Summary paragraph clicked - qNum: ${qNum}, currentQuestion: ${currentQuestion}, paragraph:`, p);
                        
                        if (!isNaN(qNum) && currentQuestion !== qNum) {
                            console.log(`🚀 Navigating from question ${currentQuestion} to question ${qNum} (summary paragraph)`);
                            goToQuestion(qNum);
                        } else if (!isNaN(qNum)) {
                            console.log(`ℹ️ Already on question ${qNum}, no navigation needed (summary paragraph)`);
                        }
                    }
                });
            });

            resizer.addEventListener('mousedown', initResize, false);
            initializeContextMenu();
        }

        // --- CORE TEST LOGIC ---

        function checkAnswers() {
            // Disable all inputs to prevent changes
            const allInputs = document.querySelectorAll('input, select, textarea');
            allInputs.forEach(input => {
                input.disabled = true;
            });

            // Disable all drag and drop functionality
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.cursor = 'not-allowed';
                item.style.pointerEvents = 'none';
            });

            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.style.pointerEvents = 'none';
                zone.classList.add('disabled');
            });

            // Disable submit button
            deliverButton.disabled = true;
            deliverButton.style.cursor = 'not-allowed';
            
            clearInterval(timerInterval);
            let score = 0;
            const totalQuestions = 40;
            const resultsDetailsContainer = document.getElementById('results-details');
            resultsDetailsContainer.innerHTML = '';

            document.querySelectorAll('.correct, .incorrect, .correct-answer-highlight').forEach(el => {
                el.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
            });
            document.querySelectorAll('.correct-answer-display').forEach(el => el.remove());

            // Helper to evaluate the special TWO-answers checkbox group (Q20 & Q21) - only if present
            const hasQ20to21Group = document.querySelectorAll('input[name="q20-21"]').length > 0;
            function evaluateQ20to21() {
                const checked = Array.from(document.querySelectorAll('input[name="q20-21"]:checked')).map(el => el.value).sort();
                const isCorrect20 = checked.includes('A');
                const isCorrect21 = checked.includes('E');

                // Mark selected labels
                document.querySelectorAll('input[name="q20-21"]').forEach(input => {
                    const label = input.closest('.multi-choice-option');
                    if (!label) return;
                    label.classList.remove('correct', 'incorrect', 'correct-answer-highlight');
                    if (input.checked) {
                        const good = (input.value === 'A' && isCorrect20) || (input.value === 'E' && isCorrect21);
                        label.classList.add(good ? 'correct' : 'incorrect');
                    }
                    if (!isCorrect20 && input.value === 'A') label.classList.add('correct-answer-highlight');
                    if (!isCorrect21 && input.value === 'E') label.classList.add('correct-answer-highlight');
                });

                const selectedText = checked.join(' & ') || 'Not Answered';
                // Q20 row
                resultsDetailsContainer.innerHTML += `
                    <div class="result-row ${isCorrect20 ? '' : 'incorrect'}">
                        <span class="q-num">20</span>
                        <span class="user-ans">${selectedText}</span>
                        <span class="correct-ans">A</span>
                    </div>`;
                // Q21 row
                resultsDetailsContainer.innerHTML += `
                    <div class="result-row ${isCorrect21 ? '' : 'incorrect'}">
                        <span class="q-num">21</span>
                        <span class="user-ans">${selectedText}</span>
                        <span class="correct-ans">E</span>
                    </div>`;

                // Mark nav buttons
                const nav20 = document.querySelector(`.subQuestion[onclick="goToQuestion(20)"]`);
                if (nav20) { nav20.classList.remove('answered', 'active'); nav20.classList.add(isCorrect20 ? 'correct' : 'incorrect'); }
                const nav21 = document.querySelector(`.subQuestion[onclick="goToQuestion(21)"]`);
                if (nav21) { nav21.classList.remove('answered', 'active'); nav21.classList.add(isCorrect21 ? 'correct' : 'incorrect'); }

                if (isCorrect20) score += 1;
                if (isCorrect21) score += 1;
                return (isCorrect20 || isCorrect21);
            }

            let q20to21Evaluated = false;
            for (let i = 1; i <= totalQuestions; i++) {
                const questionKey = String(i);
                const correctAnswer = correctAnswers[questionKey];
                let userAnswer = '';
                let isCorrect = false;
                
                let userAnswerDisplay = 'Not Answered';
                const correctAnswerText = Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : correctAnswer;

                // Special handling: combined checkbox group for Q20 & Q21
                if ((i === 20 || i === 21) && hasQ20to21Group) {
                    if (!q20to21Evaluated) {
                        evaluateQ20to21();
                        q20to21Evaluated = true;
                    }
                    continue; // Already handled rows, scoring, and marking
                }

                const textInput = document.getElementById(`q${i}`);
                const selectInput = document.querySelector(`select[name="q${i}"]`);
                const radioGroup = document.querySelectorAll(`input[name="q${i}"][type="radio"]`);
                
                // Handle Text and Select Inputs
                if ((textInput && textInput.tagName === 'INPUT') || (selectInput && selectInput.tagName === 'SELECT')) {
                    const inputElement = textInput || selectInput;
                    const element = inputElement.closest('.matching-form-row') || inputElement.closest('.tf-question') || inputElement;
                    userAnswer = inputElement.value.trim();
                    userAnswerDisplay = userAnswer || 'Not Answered';

                    const normalize = (s) => (s || '')
                        .toString()
                        .toLowerCase()
                        .replace(/[^a-z0-9\s]/g, '')
                        .replace(/\s+/g, ' ')
                        .trim();

                    if (inputElement.tagName === 'SELECT') {
                        isCorrect = userAnswer === correctAnswer;
                        console.log(`🔍 Select validation for Q${i}: userAnswer="${userAnswer}", correctAnswer="${correctAnswer}", isCorrect=${isCorrect}`);
                    } else {
                        const normUser = normalize(userAnswer);
                        if (Array.isArray(correctAnswer)) {
                            isCorrect = correctAnswer.some(ans => normalize(ans) === normUser);
                        } else {
                            isCorrect = normalize(correctAnswer) === normUser;
                        }
                    }
                    
                    if (isCorrect) {
                        score++;
                        element.classList.add('correct');
                        console.log(`✅ Question ${i} is correct! Score: ${score}`);
                    } else {
                        element.classList.add('incorrect');
                        const correctAnswerSpan = document.createElement('span');
                        correctAnswerSpan.className = 'correct-answer-display';
                        correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswerText}</span>`;
                        inputElement.parentNode.insertBefore(correctAnswerSpan, inputElement.nextSibling);
                        console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                    }
                }
                // Handle drag and drop questions (any with a drop-zone for this question)
                else if (document.querySelector(`.drop-zone[data-q-start="${i}"]`)) {
                    console.log(`🔍 Checking drag-and-drop question ${i}`);
                    const dropZone = document.querySelector(`.drop-zone[data-q-start="${i}"]`);
                    const droppedItem = dropZone ? dropZone.querySelector('.drag-item') : null;
                    
                    console.log(`📍 Drop zone for question ${i}:`, dropZone);
                    console.log(`📍 Dropped item for question ${i}:`, droppedItem);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (droppedItem) {
                        userAnswer = droppedItem.dataset.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        // Mark the drop zone as correct or incorrect
                        dropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                        
                        // Show correct answer if wrong
                        if (!isCorrect && correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    } else {
                        // No answer provided - mark as incorrect
                        console.log(`⚠️ No answer provided for question ${i}`);
                        if (dropZone) {
                            dropZone.classList.add('incorrect');
                        }
                        if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            dropZone.appendChild(correctAnswerSpan);
                        }
                    }
                }
                // Handle summary drop zone questions (36-40)
                else if (document.querySelector(`.summary-drop-zone[data-question="${i}"]`)) {
                    console.log(`🔍 Checking summary drop zone question ${i}`);
                    const summaryDropZone = document.querySelector(`.summary-drop-zone[data-question="${i}"]`);
                    const droppedItem = summaryDropZone ? summaryDropZone.querySelector('.drag-item') : null;
                    
                    console.log(`📍 Summary drop zone for question ${i}:`, summaryDropZone);
                    console.log(`📍 Dropped item for question ${i}:`, droppedItem);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (droppedItem) {
                        userAnswer = droppedItem.dataset.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        // Mark the summary drop zone as correct or incorrect
                        summaryDropZone.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                        
                        // Show correct answer if wrong
                        if (!isCorrect && correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            summaryDropZone.appendChild(correctAnswerSpan);
                        }
                    } else {
                        // No answer provided - mark as incorrect
                        console.log(`⚠️ No answer provided for question ${i}`);
                        if (summaryDropZone) {
                            summaryDropZone.classList.add('incorrect');
                        }
                        if (correctAnswer) {
                            const correctAnswerSpan = document.createElement('span');
                            correctAnswerSpan.className = 'correct-answer-display';
                            correctAnswerSpan.innerHTML = `&nbsp;➜&nbsp;<span class="correct-answer-highlight">${correctAnswer}</span>`;
                            summaryDropZone.appendChild(correctAnswerSpan);
                        }
                    }
                }
                // Handle Radio Button Inputs (T/F, MCQs)
                else if (radioGroup.length > 0) {
                    const questionContainer = radioGroup[0]?.closest('.tf-question') || radioGroup[0]?.closest('.multi-choice-question');
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);

                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;

                        const userLabel = checkedRadio.closest('.tf-option, .multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        // Handle table radio buttons
                        if (checkedRadio.classList.contains('table-radio')) {
                            const tableCell = checkedRadio.closest('td');
                            if (tableCell) {
                                tableCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                            }
                        }
                    }

                    if (isCorrect) {
                        score++;
                    } else {
                        if (questionContainer){
                            const correctOptionEl = questionContainer.querySelector(`input[name="q${i}"][value="${correctAnswerText}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.tf-option, .multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    }
                }
                // Handle clickable-cell matrix questions (generic for any i that has clickable cells)
                else if (document.querySelector(`.clickable-cell[data-question="${i}"]`)) {
                    console.log(`🔍 Checking clickable cell question ${i}`);
                    const selectedCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-selected="true"]`);
                    console.log(`📍 Selected cell for question ${i}:`, selectedCell);
                    console.log(`📍 Correct answer for question ${i}:`, correctAnswer);
                    
                    if (selectedCell) {
                        userAnswer = selectedCell.dataset.answer;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        selectedCell.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                    
                    // Handle highlighting correct answers for incorrect responses
                    if (!isCorrect) {
                        const correctCell = document.querySelector(`.clickable-cell[data-question="${i}"][data-value="${correctAnswerText}"]`);
                        if (correctCell) {
                            correctCell.classList.add('correct-answer-highlight');
                            console.log(`✅ Highlighted correct answer for question ${i}:`, correctCell);
                        } else {
                            console.log(`⚠️ Could not find correct cell for question ${i} with value "${correctAnswerText}"`);
                        }
                    }
                }
                // Handle text input questions (33-39)
                else if (i >= 33 && i <= 39) {
                    console.log(`🔍 Checking text input question ${i}`);
                    const textInput = document.getElementById(`q${i}`);
                    
                    if (textInput) {
                        userAnswer = textInput.value.trim().toLowerCase();
                        userAnswerDisplay = userAnswer || 'Not Answered';
                        
                        // Handle special case for question 33 which has two answers
                        if (i === 33) {
                            const answers = userAnswer.split('&').map(ans => ans.trim());
                            isCorrect = answers.includes('breathing') && answers.includes('eating');
                        } else {
                            isCorrect = userAnswer === correctAnswer.toLowerCase();
                        }
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        if (isCorrect) {
                            score++;
                            textInput.classList.add('correct');
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            textInput.classList.add('incorrect');
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle question 40 (multiple choice)
                else if (i === 40) {
                    console.log(`🔍 Checking multiple choice question ${i}`);
                    const checkedRadio = document.querySelector(`input[name="q${i}"]:checked`);
                    
                    if (checkedRadio) {
                        userAnswer = checkedRadio.value;
                        userAnswerDisplay = userAnswer;
                        isCorrect = userAnswer === correctAnswer;
                        
                        console.log(`✅ User answer for question ${i}: "${userAnswer}", Correct: "${correctAnswer}", IsCorrect: ${isCorrect}`);
                        
                        const userLabel = checkedRadio.closest('.multi-choice-option');
                        if (userLabel) {
                            userLabel.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                        
                        if (isCorrect) {
                            score++;
                            console.log(`🎉 Question ${i} is correct! Score: ${score}`);
                        } else {
                            console.log(`❌ Question ${i} is incorrect. Expected: "${correctAnswer}", Got: "${userAnswer}"`);
                            
                            // Highlight correct answer
                            const correctOptionEl = document.querySelector(`input[name="q${i}"][value="${correctAnswer}"]`);
                            if (correctOptionEl) {
                                const correctLabel = correctOptionEl.closest('.multi-choice-option');
                                if (correctLabel) {
                                    correctLabel.classList.add('correct-answer-highlight');
                                }
                            }
                        }
                    } else {
                        console.log(`⚠️ No answer provided for question ${i}`);
                        userAnswerDisplay = 'Not Answered';
                    }
                }
                // Handle Checkbox Inputs (Multiple choice questions like 24-26)

                 
                // For showing results in the modal
                 const resultRow = `
                    <div class="result-row ${isCorrect ? '' : 'incorrect'}">
                        <span class="q-num">${i}</span>
                        <span class="user-ans">${userAnswerDisplay}</span>
                        <span class="correct-ans">${correctAnswerText}</span>
                    </div>`;
                resultsDetailsContainer.innerHTML += resultRow;
                
                // Update nav button color
                const navButton = document.querySelector(`.subQuestion[onclick="goToQuestion(${i})"]`);
                if (navButton) {
                    navButton.classList.remove('answered', 'active');
                    navButton.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            }

            document.getElementById('results-score').textContent = score;
            document.getElementById('results-band').textContent = calculateBandScore(score);
            document.body.classList.add('results-mode');
            document.getElementById('results-modal').classList.remove('hidden');
            
            // Change button to "My Result" with green styling
            deliverButton.innerHTML = `<span>My Result</span>`;
            deliverButton.style.backgroundColor = '#4CAF50';
            deliverButton.style.color = 'white';
            deliverButton.style.borderColor = '#4CAF50';
            deliverButton.disabled = false;
            deliverButton.style.cursor = 'pointer';
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.addEventListener('click', showResultsModal);
            
            // Highlight correct answers in the passage
            highlightCorrectAnswersInPassage();
        }

        function calculateBandScore(score) {
            if (score >= 39) return '9.0';
            const mapping = {
                40: 9.0, 39: 9.0, 38: 8.5, 37: 8.5, 36: 8.0, 35: 8.0, 34: 7.5,
                33: 7.5, 32: 7.0, 31: 7.0, 30: 7.0, 29: 6.5, 28: 6.5, 27: 6.5,
                26: 6.0, 25: 6.0, 24: 6.0, 23: 5.5, 22: 5.5, 21: 5.5, 20: 5.5,
                19: 5.0, 18: 5.0, 17: 5.0, 16: 5.0, 15: 5.0, 14: 4.5, 13: 4.5,
                12: 4.0, 11: 4.0, 10: 4.0, 9: 3.5, 8: 3.5, 7: 3.0, 6: 3.0,
                5: 2.5, 4: 2.5
            };
            if (score <= 0) return 0.0;
            if (score === 1) return 1.0;
            if (score <= 3) return 2.0;
            if (score <= 5) return 2.5;
            return mapping[score] || 0.0;
        }

        function highlightCorrectAnswersInPassage() {
            // Define the text passages and their corresponding question numbers for Part 1 (Modern American Dance)
            const part1Highlights = [
                { question: 1, text: "dance historians hold remarkably similar views", answer: "TRUE" },
                { question: 2, text: "dancers quite deliberately moved away from previous approaches", answer: "FALSE" },
                { question: 4, text: "Duncan refused to wear elaborate costumes", answer: "FALSE" },
                { question: 6, text: "passing on her approach and style to the next generation", answer: "TRUE" },
                { question: 7, text: "observing the patterns made by her limbs when walking", answer: "walking" },
                { question: 8, text: "Her book The Art of Making Dances", answer: "book" },
                { question: 9, text: "bringing her own humour to these performances", answer: "humour" },
                { question: 10, text: "Taylor's career was the subject of a documentary", answer: "documentary" },
                { question: 11, text: "travelled widely to universities throughout America lecturing on ethnic dance", answer: "lecturing" },
                { question: 12, text: "stage design inspired by the comics", answer: "comics" },
                { question: 13, text: "his dancers have no mirrors", answer: "mirrors" }
            ];

            // Define the text passages and their corresponding question numbers for Part 2 (Waste Disposal)
            const part2Highlights = [
                { question: 14, text: "Norway, however, appears to be burning its way through a sizable chunk of Europe's municipal waste", answer: "iv" },
                { question: 15, text: "supporters say that incineration is the only way of preventing the long-term impacts of landfill", answer: "vii" },
                { question: 16, text: "Lars Haltbrekken, chairman of Friends of the Earth in Norway", answer: "vi" },
                { question: 17, text: "now, the talk is of 'cradle to cradle'", answer: "i" },
                { question: 18, text: "that cost is less to them than the cost in brand damage of having empty shelves", answer: "v" },
                { question: 19, text: "Recent history and changes in trends in recycling suggest that we should be prepared for unexpected developments", answer: "ii" },
                { question: 20, text: "the output from these facilities is now minuscule", answer: "F" },
                { question: 21, text: "The more you develop, the more you produce, buy and throw away", answer: "C" },
                { question: 22, text: "without the right mechanisms in place 'nothing guarantees that this bottle will end up being properly collected", answer: "D" },
                { question: 23, text: "that's money the retailers don't get, so it's not always clear-cut", answer: "G" },
                { question: 24, text: "Nobody would have said there would be so much electronic waste", answer: "electronic" },
                { question: 25, text: "We need to look at whether it's business that drives consumers or the other way around", answer: "business" },
                { question: 26, text: "You need government to play a leadership role", answer: "government" }
            ];

            // Define the text passages and their corresponding question numbers for Part 3 (1000 Foods)
            const part3Highlights = [
                { question: 27, text: "former New York Times restaurant critic", answer: "FALSE" },
                { question: 28, text: "Inspired by Patricia Schultz's best-selling 1,000 Places to See Before You Die", answer: "TRUE" },
                { question: 29, text: "even several dozen recipes", answer: "FALSE" },
                { question: 30, text: "The book is organized not by country or type of food", answer: "FALSE" },
                { question: 31, text: "she's been writing about food for 60 years", answer: "TRUE" },
                { question: 32, text: "When was the last time you sat down to a meal of harnam meshwi", answer: "D" },
                { question: 33, text: "nutritional information for each food item", answer: "C" },
                { question: 34, text: "organized not by country or type of food, but rather by the experience of eating itself", answer: "C" },
                { question: 35, text: "The goal, she states, is to inspire curiosity and appreciation", answer: "C" },
                { question: 36, text: "serves as a passport to gastronomic adventure", answer: "passport" },
                { question: 37, text: "Sheraton's entries are more than just lists; they are miniature stories", answer: "story" },
                { question: 38, text: "a list of 1,000 items is bound to include some controversies", answer: "controversies" },
                { question: 39, text: "pointing to the extensive research and personal travels that informed her choices", answer: "research" },
                { question: 40, text: "look beyond their culinary comfort zone", answer: "culinary" }
            ];

            // Function to apply highlights to a passage
            function applyHighlights(passageElement, highlights) {
                if (!passageElement) return;

                // Clear any existing highlights
                passageElement.querySelectorAll('.answer-highlight').forEach(el => {
                    const parent = el.parentNode;
                    parent.replaceChild(document.createTextNode(el.textContent), el);
                    parent.normalize();
                });

                // Add highlights for each answer
                highlights.forEach(item => {
                    const paragraphs = passageElement.querySelectorAll('p');
                    paragraphs.forEach(paragraph => {
                        const html = paragraph.innerHTML;
                        if (!html || typeof html !== 'string') return;
                        if (html.includes(item.text)) {
                            const escapeRegExp = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const re = new RegExp(escapeRegExp(item.text));
                            const replaced = html.replace(
                                re,
                                `<span class="answer-highlight" data-question="${item.question}" style="
                                    background-color: #ffeb3b;
                                    padding: 2px 4px;
                                    border-radius: 3px;
                                    font-weight: bold;
                                    position: relative;
                                ">${item.text}<span style="
                                    position: absolute;
                                    top: -8px;
                                    right: -8px;
                                    background-color: #2196f3;
                                    color: white;
                                    border-radius: 50%;
                                    width: 20px;
                                    height: 20px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 12px;
                                    font-weight: bold;
                                ">${item.question}</span></span>`
                            );
                            paragraph.innerHTML = replaced;
                        }
                    });
                });
            }

            // Apply highlights to Part 1 (Modern American Dance)
            const passageText1 = document.getElementById('passage-text-1');
            applyHighlights(passageText1, part1Highlights);

            // Apply highlights to Part 2 (Waste Disposal)
            const passageText2 = document.getElementById('passage-text-2');
            applyHighlights(passageText2, part2Highlights);

            // Apply highlights to Part 3 (1000 Foods)
            const passageText3 = document.getElementById('passage-text-3');
            applyHighlights(passageText3, part3Highlights);
        }

        function getUserAnswer(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
            const dropZone = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);

            if (textInput) { // Handles <input type="text"> and <select>
                return { value: textInput.value, text: textInput.value || 'N/A' };
            }
            if (radioInput) {
                return { value: radioInput.value, text: radioInput.value };
            }
            if (dropZone) {
                const droppedItem = dropZone.querySelector('.drag-item');
                return { 
                    value: droppedItem ? droppedItem.dataset.value : null, 
                    text: droppedItem ? droppedItem.textContent.trim() : 'N/A' 
                };
            }
            // Handle clickable cells for questions 23-26
            if (qNum >= 23 && qNum <= 26) {
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return { value: selectedCell.dataset.answer, text: selectedCell.dataset.answer };
                }
            }
            return { value: null, text: 'N/A' };
        }

        function displayCorrectAnswer(qNum, correctAnswer) {
            // Handle multi-choice group questions (e.g., 24-26, 38-40)
            // No special checkbox groups used; fall through

            // Handle radio button questions by highlighting the correct label
            const correctRadioInput = document.querySelector(`input[name="q${qNum}"][value="${correctAnswer}"]`);
            if (correctRadioInput) {
                const parentOption = correctRadioInput.closest('.tf-option, .multi-choice-option');
                if (parentOption) {
                    parentOption.classList.add('correct-answer-highlight');
                    return;
                }
            }

            // Handle text inputs, select dropdowns, and others by showing the answer next to them
            const inputEl = document.getElementById(`q${qNum}`);
            if (inputEl) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                inputEl.insertAdjacentElement('afterend', displaySpan);
                return; // Done
            }
            
            // Fallback for questions identified by a container (e.g., some T/F/NG questions)
            const element = findQuestionElement(qNum);
            if (element) {
                const displaySpan = document.createElement('span');
                displaySpan.className = 'correct-answer-display';
                displaySpan.textContent = ` ✓ ${correctAnswer}`;
                const itemContainer = element.querySelector('.tf-question-text');
                if (itemContainer) {
                     itemContainer.appendChild(displaySpan);
                } else {
                     element.appendChild(displaySpan);
                }
            }
        }
        
        function findQuestionElement(qNum) {
             return document.querySelector(`[data-q-start="${qNum}"]`);
        }

        function addResultToModal(qNum, userAnswer, correctAnswer, isCorrect) {
            const resultsDetails = document.getElementById('results-details');
            const row = document.createElement('div');
            row.className = 'result-row';
            if (!isCorrect) {
                row.classList.add('incorrect');
            }
            row.innerHTML = `
                <span class="q-num">${qNum}</span>
                <span class="user-ans">${userAnswer}</span>
                <span class="correct-ans">${correctAnswer}</span>
            `;
            resultsDetails.appendChild(row);
        }

        function showResultsModal() {
            document.getElementById('results-modal').classList.remove('hidden');
        }

        window.closeResultsModal = function() {
            document.getElementById('results-modal').classList.add('hidden');
            document.body.classList.remove('results-mode');
        }
        
        function disableInputs() {
            deliverButton.innerHTML = `<span>Checked! View Results.</span>`;
            deliverButton.removeEventListener('click', checkAnswers);
            deliverButton.onclick = showResultsModal;

            document.querySelectorAll('input, select').forEach(el => {
                el.disabled = true;
                 if (el.matches('input[type=radio], input[type=checkbox]')) {
                     el.style.cursor = 'not-allowed';
                     el.parentElement.style.cursor = 'not-allowed';
                 }
            });
            document.querySelectorAll('.drag-item').forEach(el => {
                el.setAttribute('draggable', 'false');
                el.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(el => {
                el.classList.add('disabled');
            });
        }

        function checkValue(userValue, correctValue) {
            if (userValue === null || userValue === undefined) return false;
            const formattedUserValue = userValue.trim().toLowerCase();
            if (Array.isArray(correctValue)) {
                return correctValue.map(v => v.toLowerCase()).includes(formattedUserValue);
            } else {
                return formattedUserValue === String(correctValue).toLowerCase();
            }
        }

        function markQuestion(qNum, isCorrect) {
            const subQuestionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
            subQuestionBtn?.classList.add(isCorrect ? 'correct' : 'incorrect');

            const elementsToMark = [
                document.querySelector(`.tf-question[data-q-start="${qNum}"]`),
                document.querySelector(`.multi-choice-question[data-q-start="${qNum}"]`),
                document.querySelector(`.matching-question-item[data-q-start="${qNum}"]`),
                document.querySelector(`.drop-zone[data-q-start="${qNum}"]`),
                document.getElementById(`q${qNum}`),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.tf-option'),
                document.querySelector(`input[name="q${qNum}"]:checked`)?.closest('.multi-choice-option')
            ];
            
            elementsToMark.forEach(el => {
                if (el) el.classList.add(isCorrect ? 'correct' : 'incorrect');
            });

             if (qNum === 14 || qNum === 15) {
                const multiChoiceContainer = document.querySelector('.multi-choice-question[data-q-start="14"]');
                if (multiChoiceContainer) multiChoiceContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
             } else if (qNum >= 1 && qNum <= 5) {
                const pMatchInput = document.getElementById(`q${qNum}`);
                const tfQuestionContainer = document.querySelector(`.tf-question[data-q-start="${qNum}"]`);
                if (pMatchInput) pMatchInput.classList.add(isCorrect ? 'correct' : 'incorrect');
                if (tfQuestionContainer) tfQuestionContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
        }

        function switchToPart(partNumber) {
            console.log(`🔀 switchToPart called with partNumber: ${partNumber}, currentPassage: ${currentPassage}`);
            
            currentPassage = partNumber;

            // Hide all passages and questions
            document.querySelectorAll('.reading-passage, .question-set, .part-header').forEach(el => {
                el.classList.add('hidden');
            });

            // Show the correct passage, questions, and header
            document.getElementById(`passage-text-${partNumber}`).classList.remove('hidden');
            document.getElementById(`questions-${partNumber}`).classList.remove('hidden');
            document.getElementById(`part-header-${partNumber}`).classList.remove('hidden');

            // Update bottom navigation 'selected' state
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.toggle('selected', (index + 1) === partNumber);
            });

            // Show/hide explanation buttons based on part
            const explanationButton = document.getElementById('show-explanation-btn');
            const explanationButtonPart3 = document.getElementById('show-explanation-btn-part3');
            
            if (explanationButton) {
                if (partNumber === 2) {
                    explanationButton.style.display = 'block';
                } else {
                    explanationButton.style.display = 'none';
                    // Hide explanation section when switching away from part 2
                    const explanationSection = document.getElementById('part-2-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButton.textContent = 'Show Explanation';
                        explanationButton.style.backgroundColor = '#4a90e2';
                    }
                }
            }
            
            if (explanationButtonPart3) {
                if (partNumber === 3) {
                    explanationButtonPart3.style.display = 'block';
                } else {
                    explanationButtonPart3.style.display = 'none';
                    // Hide explanation section when switching away from part 3
                    const explanationSection = document.getElementById('part-3-explanation');
                    if (explanationSection) {
                        explanationSection.classList.add('hidden');
                        explanationButtonPart3.textContent = 'Show Explanation';
                        explanationButtonPart3.style.backgroundColor = '#4a90e2';
                    }
                }
            }

            console.log(`✅ switchToPart completed - switched to part ${partNumber}`);
            
            // Only go to first question when switching parts, not when staying in same part
            // This allows goToQuestion to work properly for specific question navigation
            // const firstQuestionOfPart = {1: 1, 2: 14, 3: 27}[partNumber];
            // goToQuestion(firstQuestionOfPart);
        }
        
        function goToQuestion(questionNumber) {
            console.log(`🎯 goToQuestion called with questionNumber: ${questionNumber}, currentQuestion: ${currentQuestion}, currentPassage: ${currentPassage}`);
            
            currentQuestion = questionNumber;

            let passageNumber = 1;
            if (questionNumber >= 14 && questionNumber <= 26) passageNumber = 2;
            else if (questionNumber >= 27) passageNumber = 3;
            
            console.log(`📍 Calculated passageNumber: ${passageNumber} for question ${questionNumber}`);
            
            if (currentPassage !== passageNumber) {
                console.log(`🔄 Switching from part ${currentPassage} to part ${passageNumber} for question ${questionNumber}`);
                switchToPart(passageNumber);
                return; 
            }

            console.log(`✅ Staying in same part (${currentPassage}) for question ${questionNumber}`);

            if (activeQuestionElement) {
                // Remove active style from previous block
                activeQuestionElement.classList.remove('active-question', 'active-input');
                // Also remove from the container block if we previously set it
                const prevBlock = activeQuestionElement.closest('[data-q-start]');
                if (prevBlock) prevBlock.classList.remove('active-question');
            }

            // First, try to find the specific input element for questions 33-36
            let targetEl = document.getElementById(`q${questionNumber}`);
            if (targetEl) {
                activeQuestionElement = targetEl;
                console.log(`✅ Found specific input element:`, targetEl);
                targetEl.classList.add('active-input');
                scrollIntoViewIfNeeded(targetEl);
            } else {
                // Fall back to looking for question containers
                targetEl = document.querySelector(`[data-q-start="${questionNumber}"]`);
                console.log(`🔍 Looking for target element with data-q-start="${questionNumber}":`, targetEl);

                if (targetEl) {
                    activeQuestionElement = targetEl;
                    console.log(`✅ Found target element:`, targetEl);
                    
                    if (targetEl.matches('input[type="text"]') || targetEl.matches('select')) {
                        targetEl.classList.add('active-input');
                        console.log(`📝 Added active-input class to input/select element`);
                    } else {
                        targetEl.classList.add('active-question');
                        console.log(`📋 Added active-question class to question element`);
                    }
                    scrollIntoViewIfNeeded(targetEl);
                } else {
                    console.log(`⚠️ Target element not found, looking for paragraph matching question`);
                    const pMatch = document.querySelector(`.paragraph-matching-question select[id="q${questionNumber}"]`);
                    if(pMatch) {
                        activeQuestionElement = pMatch;
                        pMatch.classList.add('active-input');
                        scrollIntoViewIfNeeded(pMatch);
                        console.log(`✅ Found paragraph matching question:`, pMatch);
                    } else {
                        console.log(`❌ No target element found for question ${questionNumber}`);
                    }
                }
            }

            updateNavigation();
            console.log(`✅ goToQuestion completed for question ${questionNumber}`);
        }
        
        // --- UI & NAVIGATION ---

        function updateNavigation() {
            console.log(`🔄 updateNavigation called for currentQuestion: ${currentQuestion}`);
            
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => btn.classList.remove('active'));
            const activeNav = document.querySelector(`.subQuestion[onclick="goToQuestion(${currentQuestion})"]`);
            if (activeNav) {
                activeNav.classList.add('active');
                console.log(`✅ Updated navigation - active nav button:`, activeNav);
            } else {
                console.log(`⚠️ No active navigation button found for question ${currentQuestion}`);
            }

            const inputs = document.querySelectorAll('.answer-input, .drop-zone.filled, .summary-drop-zone.filled');
            inputs.forEach(input => input.classList.remove('active-input'));
            
            const activeInput = document.getElementById(`q${currentQuestion}`);
            if (activeInput) {
                activeInput.classList.add('active-input');
                if (typeof activeInput.focus === 'function') {
                    activeInput.focus();
                }
                console.log(`✅ Focused on input element:`, activeInput);
            } else {
                console.log(`⚠️ No direct input found for question ${currentQuestion}, looking in question block`);
                // Prefer the specific question element for styling (TF/MCQ), fallback to any data-q-start container
                let activeQuestionBlock = document.querySelector(`.tf-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`.multi-choice-question[data-q-start="${currentQuestion}"]`) 
                    || document.querySelector(`[data-q-start="${currentQuestion}"]`);
                if (activeQuestionBlock) {
                    // Add active-question class to style number badge
                    activeQuestionBlock.classList.add('active-question');
                    const firstInput = activeQuestionBlock.querySelector('input, select');
                    if(firstInput) {
                        firstInput.classList.add('active-input');
                         if (typeof firstInput.focus === 'function') {
                            firstInput.focus();
                        }
                        console.log(`✅ Focused on input in question block:`, firstInput);
                    } else {
                        console.log(`⚠️ No input found in question block for question ${currentQuestion}`);
                    }
                } else {
                    console.log(`❌ No question block found for question ${currentQuestion}`);
                }
            }
            
            console.log(`✅ updateNavigation completed`);
        }
        
        function selectDragItem(item) {
            if (selectedDragItem) {
                selectedDragItem.classList.remove('selected');
            }
            selectedDragItem = item;
            if (selectedDragItem) {
                selectedDragItem.classList.add('selected');
            }
        }
        
        window.nextQuestion = () => currentQuestion < 40 && goToQuestion(currentQuestion + 1);
        window.previousQuestion = () => currentQuestion > 1 && goToQuestion(currentQuestion - 1);

        function updateAllIndicators() {
            updateAttemptedCount(1, 1, 13);
            updateAttemptedCount(2, 14, 26);
            updateAttemptedCount(3, 27, 40);
            updateAnsweredNav();
        }
        
            function updateAnsweredNav() {
            const navButtons = document.querySelectorAll('.subQuestion');
            navButtons.forEach(btn => {
                const qNum = parseInt(btn.textContent, 10);
                if (isQuestionAnswered(qNum)) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            });
        }
        
            function isQuestionAnswered(qNum) {
            const textInput = document.getElementById(`q${qNum}`);
            if (textInput && (textInput.value.trim() !== '' || (textInput.classList.contains('drop-zone') && textInput.children.length > 0))) {
                return true;
            }
            // Check for select elements (questions 1-5)
            const selectInput = document.querySelector(`select[name="q${qNum}"]`);
            if (selectInput && selectInput.value.trim() !== '') {
                return true;
            }
            const radio = document.querySelector(`input[name="q${qNum}"]:checked`);
            if (radio) {
                return true;
            }
            // Special handling for the combined checkbox group (Q20 & Q21)
            if (qNum === 20 || qNum === 21) {
                const checked = document.querySelectorAll('input[name="q20-21"]:checked');
                if (checked.length > 0) return true;
            }
            // Handle drag & drop questions (e.g., 20-23)
            const dz = document.querySelector(`.drop-zone[data-q-start="${qNum}"]`);
            if (dz && dz.querySelector('.drag-item')) {
                return true;
            }
            // Handle summary drop zone questions (e.g., 36-40)
            const summaryDz = document.querySelector(`.summary-drop-zone[data-question="${qNum}"]`);
            if (summaryDz && summaryDz.querySelector('.drag-item')) {
                return true;
            }
            // Handle clickable-cell matrix questions (any question using clickable cells)
                const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"][data-selected="true"]`);
                if (selectedCell) {
                    return true;
            }
            return false;
        }

        function scrollIntoViewIfNeeded(element) {
            const panel = element.closest('.questions-panel, .passage-panel');
            const panelRect = panel.getBoundingClientRect();
            const elementRect = element.getBoundingClientRect();
            if (elementRect.top < panelRect.top || elementRect.bottom > panelRect.bottom) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // --- DRAG AND DROP ---
        
        function initializeDragAndDrop() {
            document.querySelectorAll('.drag-item').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('click', () => selectDragItem(item));
            });
            document.querySelectorAll('.drop-zone, .drag-options-container, .summary-drop-zone').forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            setTimeout(() => e.target.classList.add('dragging'), 0);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedItem = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            if (draggedItem && draggedItem.dataset.dndGroup === targetZone.dataset.dndGroup) {
                targetZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const targetZone = e.currentTarget;
            targetZone.classList.remove('drag-over');

            if (!draggedItem || draggedItem.dataset.dndGroup !== targetZone.dataset.dndGroup) {
                return;
            }

            const sourceZone = draggedItem.parentElement;
            if (sourceZone === targetZone) return; // Prevent dropping on itself

            const existingItemInTarget = (targetZone.classList.contains('drop-zone') || targetZone.classList.contains('summary-drop-zone')) 
                ? targetZone.querySelector('.drag-item') 
                : null;

            // First, clear the target drop-zone of any text (like question numbers) before adding the new item.
            if (targetZone.classList.contains('drop-zone') || targetZone.classList.contains('summary-drop-zone')) {
                Array.from(targetZone.childNodes).forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        node.remove();
                    }
                });
            }

            // Move the item that was in the target (if any) to the source zone.
            if (existingItemInTarget) {
                sourceZone.appendChild(existingItemInTarget);
            }
            
            // Finally, move the dragged item to the target zone.
            targetZone.appendChild(draggedItem);
            targetZone.classList.add('filled');
            // Lock the pill-like appearance for items dropped into zones
            if (draggedItem) {
                draggedItem.style.cursor = 'default';
            }
            // Hide placeholder text (question number) once filled
            if (targetZone.textContent && /^\d+$/.test(targetZone.textContent.trim())) {
                targetZone.textContent = '';
            }

            // After the move, clean up the source zone if it's a drop-zone and is now empty.
            if ((sourceZone.classList.contains('drop-zone') || sourceZone.classList.contains('summary-drop-zone')) && !sourceZone.querySelector('.drag-item')) {
                 sourceZone.classList.remove('filled');
                 const qNum = sourceZone.dataset.qStart;
                 if (sourceZone.classList.contains('drop-zone')) {
                     sourceZone.innerText = qNum; // Restore the question number
                 }
            }
            
            updateAllIndicators();
        }
        
        // --- MISC HELPERS ---
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval); // Ensure no multiple intervals
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    // checkAnswers(); // Disabled to prevent modal from opening automatically.
                }
            }, 1000);
            timerToggleButton.innerHTML = pauseIcon;
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerToggleButton.innerHTML = playIcon;
        }

        function toggleTimer() {
            // Check based on the icon currently displayed
            if (timerToggleButton.innerHTML.includes('M6 19h4V5H6v14z')) { // Check for pause icon shape
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function resetTimer() {
            timeInSeconds = 3600;
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            startTimer();
            timerToggleButton.innerHTML = pauseIcon;
        }
        
        function setupCheckboxLimits() {
            const checkboxGroups = [
                { name: 'q20-21', limit: 2 },
                { name: 'q38-40', limit: 3 }
            ];
            checkboxGroups.forEach(group => {
                const checkboxes = document.querySelectorAll(`input[name="${group.name}"]`);
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        const checkedCount = document.querySelectorAll(`input[name="${group.name}"]:checked`).length;
                        if (checkedCount > group.limit) checkbox.checked = false;
                        updateAllIndicators();
                    });
                });
            });
        }

        function setupExampleHeading() {
            const exampleBox = document.querySelector('.example-box');
            if(exampleBox){
                const title = document.createElement('p');
                title.style.fontWeight = 'bold';
                title.textContent = 'List of Statements';
                // exampleBox.insertBefore(title, exampleBox.firstChild);
            }
        }
        
        function initResize(e) {
            e.preventDefault();
            const startX = e.clientX;
            const startWidth = passagePanel.offsetWidth;
            
            const doDrag = (e) => {
                const newWidth = startWidth + e.clientX - startX;
                if (newWidth > 200 && (document.body.clientWidth - newWidth - resizer.offsetWidth) > 200) {
                    passagePanel.style.flex = `0 0 ${newWidth}px`;
                }
            };
            const stopDrag = () => {
                window.removeEventListener('mousemove', doDrag, false);
                window.removeEventListener('mouseup', stopDrag, false);
            };
            
            window.addEventListener('mousemove', doDrag, false);
            window.addEventListener('mouseup', stopDrag, false);
        }
        
        // --- CONTEXT MENU (Highlighting) ---
        
        function initializeContextMenu() {
            const panels = [passagePanel, questionsPanel];
            let targetElementForClear = null;

            // This listener simply tracks the last valid text selection in either panel.
            document.addEventListener('selectionchange', () => {
                const selection = window.getSelection();
                if (selection && !selection.isCollapsed && selection.toString().trim().length > 0) {
                    const range = selection.getRangeAt(0);
                    if (panels.some(panel => panel.contains(range.commonAncestorContainer))) {
                        selectedRange = range;
                        targetElementForClear = null; // New selection overrides clearing a specific element
                    }
                }
            });

            const showContextMenu = (e) => {
                const target = e.target;
                const isClickOnHighlight = target.closest('.highlight, .comment-highlight');
                const isSelectionActive = selectedRange && selectedRange.toString().trim().length > 0;
                
                let showMenu = false;

                if (isClickOnHighlight) {
                    document.getElementById('menu-highlight').style.display = 'none';
                    document.getElementById('menu-note').style.display = 'none';
                    document.getElementById('menu-clear').style.display = 'block';
                    document.getElementById('menu-clear-all').style.display = 'block';
                    contextMenu.targetElementForClear = isClickOnHighlight;
                    showMenu = true;
                } else if (isSelectionActive && panels.some(panel => panel.contains(selectedRange.commonAncestorContainer))) {
                    document.getElementById('menu-highlight').style.display = 'flex';
                    document.getElementById('menu-note').style.display = 'flex';
                    document.getElementById('menu-clear').style.display = 'none';
                    document.getElementById('menu-clear-all').style.display = 'block'; // Always show clear all
                    showMenu = true;
                }

                if (showMenu) {
                    e.preventDefault();
                    contextMenu.style.display = 'block';
                    const menuHeight = contextMenu.offsetHeight;
                    const menuWidth = contextMenu.offsetWidth;
                    let left = e.pageX;
                    let top = e.pageY;
                    if (left + menuWidth > window.innerWidth) left = window.innerWidth - menuWidth - 5;
                    if (top + menuHeight > window.innerHeight) top = e.pageY - menuHeight - 5;
                    else top = e.pageY - menuHeight - 5;
                    
                    contextMenu.style.left = `${left}px`;
                    contextMenu.style.top = `${top}px`;
                }
            };

            panels.forEach(panel => {
                panel.addEventListener('contextmenu', showContextMenu);
            });

            document.addEventListener('click', (e) => {
                if (contextMenu.style.display === 'block' && !contextMenu.contains(e.target)) {
                    closeContextMenu();
                }
            });
        }

        function closeContextMenu() {
            contextMenu.style.display = 'none';
            selectedRange = null; // Clear range after menu closes
        }

        function unwrapElement(element) {
            const parent = element.parentNode;
            if (!parent) return;
            while (element.firstChild) {
                parent.insertBefore(element.firstChild, element);
            }
            parent.removeChild(element);
            parent.normalize();
        }

        window.highlightText = () => {
            if (selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'highlight';
                span.appendChild(selectedRange.extractContents());
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.addNote = () => {
            const note = prompt('Enter your note:');
            if (note && selectedRange && !selectedRange.collapsed) {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = note;
                span.appendChild(selectedRange.extractContents());
                span.appendChild(tooltip);
                selectedRange.insertNode(span);
            }
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        window.clearHighlight = () => {
             const elementToClear = contextMenu.targetElementForClear;
             if (elementToClear) {
                 unwrapElement(elementToClear);
             }
             closeContextMenu();
             window.getSelection().removeAllRanges();
        };
        
        window.clearAllHighlights = () => {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(unwrapElement);
            closeContextMenu();
            window.getSelection().removeAllRanges();
        };

        function updateAttemptedCount(part, startQ, endQ) {
            let answeredCount = 0;
            for (let i = startQ; i <= endQ; i++) {
                if (isQuestionAnswered(i)) {
                    answeredCount++;
                }
            }
            const partHeader = document.querySelector(`.footer__questionNo___3WNct[onclick="switchToPart(${part})"]`);
            if (partHeader) {
                const countSpan = partHeader.querySelector('.attemptedCount');
                if (countSpan) {
                     countSpan.textContent = `${answeredCount} of ${endQ - startQ + 1}`;
                }
            }
        }

        // --- GLOBAL FUNCTION EXPOSURE ---
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.goToQuestion = goToQuestion;
        window.switchToPart = switchToPart;
        window.closeResultsModal = closeResultsModal;
        window.highlightText = highlightText;
        window.addNote = addNote;
        window.clearHighlight = clearHighlight;
        window.clearAllHighlights = clearAllHighlights;
        
        // Explanation toggle function for Part 2
        window.toggleExplanation = function() {
            const explanationSection = document.getElementById('part-2-explanation');
            const button = document.getElementById('show-explanation-btn');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };
        
        // Explanation toggle function for Part 3
        window.toggleExplanationPart3 = function() {
            const explanationSection = document.getElementById('part-3-explanation');
            const button = document.getElementById('show-explanation-btn-part3');
            
            if (explanationSection.classList.contains('hidden')) {
                explanationSection.classList.remove('hidden');
                button.textContent = 'Hide Explanation';
                button.style.backgroundColor = '#dc3545';
            } else {
                explanationSection.classList.add('hidden');
                button.textContent = 'Show Explanation';
                button.style.backgroundColor = '#4a90e2';
            }
        };

        // --- START THE APP ---
        initialize();

        // Add event listeners for table radio buttons
        document.addEventListener('DOMContentLoaded', function() {
            const tableRadios = document.querySelectorAll('.table-radio');
            tableRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    // Remove background color from all cells in the same row
                    const row = this.closest('tr');
                    const cells = row.querySelectorAll('td:not(.statement)');
                    cells.forEach(cell => {
                        cell.style.backgroundColor = '';
                    });
                    
                    // Add background color to the selected cell
                    if (this.checked) {
                        this.closest('td').style.backgroundColor = '#e3f2fd';
                    }
                    
                    updateAllIndicators();
                });
            });
            
            // Initialize mobile features
            initializeMobileFeatures();
        });
        
        // Mobile-specific improvements
        function initializeMobileFeatures() {
            // Add touch event listeners for mobile
            if ('ontouchstart' in window) {
                console.log('📱 Mobile device detected, initializing touch features');
                
                // Improve touch handling for question navigation
                document.querySelectorAll('.subQuestion').forEach(btn => {
                    btn.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(0.95)';
                    }, { passive: false });
                    
                    btn.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1)';
                    }, { passive: false });
                });
                
                // Improve touch handling for part navigation
                document.querySelectorAll('.footer__questionNo___3WNct').forEach(btn => {
                    btn.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(0.95)';
                    }, { passive: false });
                    
                    btn.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1)';
                    }, { passive: false });
                });
                
                // Improve touch handling for radio buttons
                document.querySelectorAll('.tf-option, .multi-choice-option').forEach(option => {
                    option.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(0.98)';
                    }, { passive: false });
                    
                    option.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1)';
                        // Trigger radio button selection
                        const radio = this.querySelector('input[type="radio"]');
                        if (radio) {
                            radio.checked = true;
                            radio.dispatchEvent(new Event('change'));
                        }
                    }, { passive: false });
                });
                
                // Improve touch handling for text inputs
                document.querySelectorAll('input[type="text"], select').forEach(input => {
                    input.addEventListener('touchstart', function(e) {
                        // Prevent zoom on iOS
                        this.style.fontSize = '16px';
                    });
                });
                
                // Improve touch handling for drag and drop on mobile
                document.querySelectorAll('.drag-item').forEach(item => {
                    item.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1.1)';
                        this.style.zIndex = '1000';
                    }, { passive: false });
                    
                    item.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1)';
                        this.style.zIndex = 'auto';
                    }, { passive: false });
                });
                
                // Improve touch handling for drop zones
                document.querySelectorAll('.drop-zone, .summary-drop-zone').forEach(zone => {
                    zone.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1.05)';
                        this.style.borderColor = '#4a90e2';
                    }, { passive: false });
                    
                    zone.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1)';
                        this.style.borderColor = '#ccc';
                    }, { passive: false });
                });
                
                // Improve touch handling for navigation arrows
                document.querySelectorAll('.nav-arrow').forEach(arrow => {
                    arrow.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(0.9)';
                    }, { passive: false });
                    
                    arrow.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1)';
                    }, { passive: false });
                });
                
                // Improve touch handling for check answers button
                const deliverButton = document.getElementById('deliver-button');
                if (deliverButton) {
                    deliverButton.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(0.95)';
                    }, { passive: false });
                    
                    deliverButton.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        this.style.transform = 'scale(1)';
                    }, { passive: false });
                }
            }
            
            // Add mobile-specific scroll improvements
            if (window.innerWidth <= 768) {
                // Smooth scrolling for mobile
                document.documentElement.style.scrollBehavior = 'smooth';
                
                // Improve scroll performance on mobile
                document.addEventListener('scroll', function() {
                    // Throttle scroll events for better performance
                    if (!window.scrollTimeout) {
                        window.scrollTimeout = setTimeout(function() {
                            window.scrollTimeout = null;
                        }, 16); // ~60fps
                    }
                });
            }
        }

        // Global function for selecting cells
        window.selectCell = function(cell, questionNum, value) {
            console.log('selectCell called:', questionNum, value);
            
            // Remove selected class from all cells in the same row
            const row = cell.closest('tr');
            const cellsInRow = row.querySelectorAll('.clickable-cell');
            cellsInRow.forEach(c => {
                c.classList.remove('selected');
                c.removeAttribute('data-selected');
                c.removeAttribute('data-answer');
            });
            
            // Add selected class to clicked cell
            cell.classList.add('selected');
            cell.setAttribute('data-selected', 'true');
            cell.setAttribute('data-answer', value);
            
            console.log('Cell selected:', questionNum, value);
            updateAllIndicators();
        };



        // Note: switchToPart function is defined earlier in the code
        // This duplicate function has been removed to prevent conflicts
    });
    </script>
</body>
</html>