<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS CDI Listening Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
            padding-bottom: 90px; /* nav-row height (80px) + some extra spacing */
        }

        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .telegram-link {
            color: #0088cc;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .telegram-link:hover {
            text-decoration: underline;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            background: #ffffff;
            padding-bottom: 100px; /* Space for bottom nav */
        }

        .main-container.results-mode {
            display: flex;
            flex-direction: row;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
            transition: width 0.4s ease;
        }

        .main-container.results-mode .left-panel {
            width: 75%;
            overflow-y: auto;
            height: calc(100vh - 195px);
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
            height: calc(100vh - 195px);
        }

        #transcription-container h2 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #transcription-text {
            white-space: pre-wrap;
            font-family: inherit;
            font-size: 15px;
            line-height: 1.7;
        }
        
        .transcription-instruction {
            display: block;
            margin: 1em 0;
            font-style: italic;
            color: #444;
        }

        .main-container.results-mode .right-panel {
            display: block;
            width: 25%;
            border-left: 1px solid #e0e0e0;
            border-top: none;
            height: calc(100vh - 195px);
            overflow-y: auto;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        /* Inline correct answer hint (shown after checking) */
        .correct-inline {
            color: #28a745;
            font-weight: 700;
            margin-left: 10px;
            display: inline-block;
            vertical-align: middle;
            white-space: nowrap;
        }
        .correct-inline::before {
            content: "\2192  "; /* right arrow */
            font-weight: 700;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        #part-1 table td {
            line-height: 1.8;
        }
        /* Increase line height for tables in Part 4 */
        #part-4 table td {
            line-height: 2.0;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        #part-4 table td div { margin: 8px 0; }
        /* Increase line height for Part 3 table (Questions 24-30) */
        #part-3 table td {
            line-height: 3.0;
            padding-top: 10px;
            padding-bottom: 10px;
            vertical-align: top;
        }
        /* Geosequestration table styling */
        .geo-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .geo-table th, .geo-table td { border: 1px solid #e5e7eb; padding: 14px; vertical-align: top; }
        .geo-table thead th { background: #f7f9fc; text-align: center; font-weight: 700; }
        .geo-table .arrow-row td { text-align: center; font-size: 20px; color: #6b7280; }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        .centered-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px auto;
            width: 100%;
            max-width: 600px;
            display: block;
        }
        .map-container img {
            width: 100%;
            display: block;
        }
        .map-drop-zone {
            position: absolute;
            width: 13%;
            height: 15%;
            border: 2px dashed #999;
            background-color: rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #555;
            border-radius: 4px;
            padding: 2px;
        }
        .map-drop-zone:hover {
            background-color: rgba(230, 244, 255, 0.7);
            border-color: #4a90e2;
        }
        .map-drop-zone .drag-item {
            font-size: 14px;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
        }
        .map-options-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .map-options-list .drag-item {
            width: calc(25% - 10px);
            text-align: center;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 101;
        }

        .nav-arrow {
            width: 50px;
            height: 50px;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
        }

        .nav-arrow:hover {
            background: #555;
        }

        .nav-arrow:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;

            /* Allow horizontal scrolling on smaller screens */
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent "Score/Band" button text overflow on small screens */
        .footer__deliverButton___3FM07 {
            max-width: 42%;
            white-space: normal;          /* allow wrapping */
            word-break: break-word;       /* break long text if needed */
            line-height: 1.2;
        }
        @media (max-width: 768px) {
            .footer__deliverButton___3FM07 {
                max-width: 55%;
                padding: 10px 12px;
                font-size: 14px;
            }
        }
        @media (max-width: 480px) {
            .footer__deliverButton___3FM07 {
                max-width: 65%;
                padding: 8px 10px;
                font-size: 13px;
            }
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
            flex-shrink: 0;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 1024px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

        .subQuestion.active {
            background-color: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s, border-color 0.2s;
            min-width: 170px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #e0e0e0;
            border-color: #bbb;
        }
        /* Success style for "My Results" button after checking */
        .footer__deliverButton___3FM07.success {
            background-color: #28a745;
            color: #fff;
            border-color: #28a745;
        }
        .footer__deliverButton___3FM07.success:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #ddd;
        }

        .fa-check::before {
            content: "✓";
        }

        .hidden {
            display: none;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #9aa3ad;
            border-radius: 4px;
            background-color: #fff;
            padding: 4px 8px;
            font-size: 16px;
            text-align: left; /* start typing from left */
            margin-right: 4px;
            width: 140px;
            max-width: 160px;
            min-width: 120px;
            word-break: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            height: 28px;
            min-height: 28px;
            line-height: 1.2;
            vertical-align: middle;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }
        .answer-input::placeholder {
            color: #999;
            font-weight: bold;
            text-align: center; /* numbers centered until typing starts */
        }
        .answer-input:focus {
            outline: none;
            border-color: #2c6bed;
            border-width: 2px;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            min-height: 200px;
        }
        .drag-item {
            background: white;
            border: 1px solid #ddd;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.2;
            max-width: 100%;
            box-sizing: border-box;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }
        .drop-zone {
            border: 1px dashed #ccc;
            border-radius: 4px;
            min-height: 40px;
            height: auto;
            max-width: 120px;
            min-width: 100px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            word-break: break-word;
            overflow-wrap: break-word;
            text-align: center;
            line-height: 1.2;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone .drag-item {
            cursor: default;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 1px #4a90e2;
        }
        .questions-container {
            width: 50%;
        }
        /* When transcription (results mode) is visible, give questions container 80% of left panel */
        .main-container.results-mode .questions-container {
            width: 80%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        .part-header p {
            margin: 0;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            margin: 20px 0;
        }

        .timer-container {
            display: none; /* Timer hidden */
            color: #333;
            font-size: 16px;
            font-weight: 500;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        @keyframes flash {
            0% { background-color: #e6f4ff; }
            100% { background-color: transparent; }
        }

        .question.flash {
            animation: flash 1s ease-out;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            font-size: 24px;
            color: #333;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #888;
            line-height: 1;
        }
        .modal-close-btn:hover {
            color: #333;
        }
        #score-summary {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        #result-details table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        #result-details th, #result-details td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            vertical-align: middle;
        }
        #result-details th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        #result-details td:nth-child(1) {
            font-weight: bold;
            text-align: center;
        }
        .result-correct {
            color: #28a745;
            font-weight: bold;
        }
        .result-incorrect {
            color: #dc3545;
            font-weight: bold;
        }

        .context-menu-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        .matching-container {
            display: flex;
            justify-content: space-between;
            gap: 40px;
            margin-top: 20px;
            align-items: flex-start;
        }
        /* Two-column drag-and-drop layout like screenshot */
        .dnd-col-title { font-weight: 700; margin-bottom: 10px; }
        .matching-question-container { display: flex; gap: 30px; align-items: flex-start; }
        .matching-options-bank { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .matching-questions { flex: 2; display: flex; flex-direction: column; gap: 24px; }
        .matching-questions .matching-question-item { display: flex; align-items: center; gap: 16px; padding: 6px 0; }
        .matching-questions .matching-question-item span { min-width: 180px; }
        .matching-questions .drop-zone { width: 100%; min-width: 360px; height: 34px; border: 2px dashed #aab3bd; border-radius: 4px; background: #fff; display: flex; align-items: center; padding: 0 8px; justify-content: flex-start; text-align: left; }
        .matching-questions .drop-zone .placeholder { color: #6b7280; font-weight: 700; }
        .matching-options-bank .drag-item { border-radius: 6px; padding: 6px 12px; background: #ffffff; border: 1px solid #d1d5db; font-weight: 600; box-shadow: 0 1px 0 rgba(0,0,0,0.02); }
        .matching-table {
            flex: 4;
            border-collapse: collapse;
        }
        .matching-table th, .matching-table td {
            padding: 6px 12px;
            text-align: left;
            vertical-align: middle;
        }
        .matching-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .matching-table .drop-zone {
            min-height: 35px;
            height: 35px;
            width: 100%;
            max-width: none;
            min-width: 200px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            flex-wrap: nowrap;
            background-color: #fff;
            border: 1px dashed #ccc;
            border-radius: 4px;
            word-break: break-word;
            overflow-wrap: break-word;
            text-align: left;
            line-height: 1.2;
        }
        .matching-table .drop-zone .drag-item {
            width: auto;
            max-width: none;
            text-align: left;
            padding: 6px 8px;
            font-size: 14px;
            line-height: 1.2;
            word-break: break-word;
            overflow-wrap: break-word;
            box-sizing: border-box;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 2px;
        }
        .matching-options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            background-color: transparent;
            padding: 0;
            border: none;
            min-height: 250px;
            min-width: 280px; /* ensure enough width for long option text to stay on one line */
        }
        .matching-options-list .drag-item {
            width: 100%;
        }
        .matching-question-item .drop-zone .placeholder {
            color: #999;
            font-weight: bold;
        }

        /* Clickable cell styles for matching questions */
        .clickable-cell {
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            min-width: 50px;
            min-height: 50px;
            border: 2px solid #e0e0e0;
            position: relative;
            background-color: #f8f9fa;
            margin: 2px;
        }
       
        .clickable-cell:hover {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .clickable-cell.selected {
            background-color: #75a8e4 !important;
            color: white !important;
        }
       
        .clickable-cell.correct {
            background-color: #28a745 !important;
            color: white !important;
        }
        .clickable-cell.correct::after {
            content: "✓";
            font-weight: bold;
        }
        .clickable-cell.incorrect {
            background-color: #dc3545 !important;
            color: white !important;
        }
        .clickable-cell.incorrect::after {
            content: "✗";
            font-weight: bold;
        }
        

        
        .statement {
            font-weight: 500;
            padding-right: 20px;
        }

        .option strong,
        .question ul li label strong {
            display: none;
        }

        /* Mobile selection toolbar */
        .mobile-selection-menu {
            position: absolute;
            background: #333;
            color: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            display: flex;
            gap: 8px;
            z-index: 3000;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
        }
        .mobile-selection-menu button {
            background: transparent;
            border: 1px solid #fff;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        .mobile-selection-menu.hidden {
            display: none;
        }

        /* === Matching table styling for Questions 13-16 === */
        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .matching-table th,
        .matching-table td {
            border: 1px solid #ddd;
            padding: 8px 4px;
            vertical-align: middle;
            text-align: center;
        }
        .matching-table .clickable-cell {
            padding: 8px 4px;
            min-width: 50px;
            min-height: 50px;
        }
        .matching-table th {
            background-color: #1e6de6;
            color: #ffffff;
            font-weight: 600;
            text-align: center;
        }
        .matching-table th:first-child {
            text-align: left;
            background-color: #f8f9fa;
            color: #333;
        }
        .matching-table tbody td:first-child {
            font-weight: 500;
            text-align: left;
            background-color: #f8f9fa;
        }
        .matching-table tr:nth-child(even) td {
            background-color: #f8faff;
        }

        /* === MCQ table styling for Questions 11-15 === */
        .mcq-table {
            width: 100%;
            border-collapse: collapse;
        }
        .mcq-table th,
        .mcq-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            vertical-align: middle;
            text-align: center;
        }
        .mcq-table th {
            background-color: #1e6de6; /* vibrant blue header like screenshot */
            color: #ffffff;
            font-weight: 600;
            text-align: center;
        }
        .mcq-table th:first-child {
            text-align: left;
        }
        .mcq-table tbody td:first-child {
            font-weight: 500;
            text-align: left;
        }
        .mcq-table tr:nth-child(even) td {
            background-color: #f8faff; /* subtle alternating row colour */
        }
        .mcq-table input[type="radio"] {
            transform: scale(1.1);
            cursor: pointer;
        }
        /* list of options (A, B, C) shown above the table */
        .mcq-options {
            list-style: none;
            padding-left: 0;
            margin: 10px 0;
        }
        .mcq-options li {
            margin-bottom: 4px;
            font-size: 16px;
        }

        /* MCQ design: full-width selectable panels */
        .multi-choice-question { margin: 12px 0 18px; }
        .multi-choice-option { display:block; width:100%; padding: 12px 14px;  background-color: #fff; border: 1px solid transparent;  transition: background-color 0.2s ease, border-color 0.2s ease; }
        .multi-choice-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .multi-choice-option:has(input[type="radio"]:checked) { background-color: #cfe3f9; }
        .multi-choice-option label { display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 16px; width:100%; }

        .aligned-form .question-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .aligned-form .question-label {
            width: 230px;
            padding-right: 10px;
        }

        /* Responsive adjustments for tablets */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .right-panel, .main-container.results-mode .right-panel {
                display: none;
            }
            .left-panel, .main-container.results-mode .left-panel {
                width: 100%;
                padding: 20px 10px;
                height: auto; /* Reset height for mobile */
            }
            .questions-container {
                width: 100%;
            }
        }

        .single-choice label.correct {
            color: #155724;
            font-weight: bold;
        }
        .single-choice label.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .single-choice label.incorrect {
            color: #721c24;
            text-decoration: line-through;
        }
        .single-choice label.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }
        .mcq-table tbody tr.correct {
            background-color: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }
        .mcq-table tbody tr.incorrect {
            background-color: #f8d7da !important;
            text-decoration: line-through;
        }
        .mcq-table tbody tr.incorrect td {
            color: #721c24;
        }

        /* New Audio Player Styles */
        .audio-player-container {
            position: fixed;
            top: 65px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            max-width: 90%;
            height: 40px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 99;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .main-container {
            margin-top: 115px;
        }
        .player-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .player-btn svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }
        .progress-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #progress-bar {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 3px;
            cursor: pointer;
        }
        #progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
        }
        #progress-bar::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
            border: none;
        }
        #current-time, #total-duration {
            font-size: 12px;
            color: #555;
            min-width: 35px;
            text-align: center;
        }
        .controls-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .volume-container {
            display: flex;
            align-items: center;
            position: relative;
        }
        #new-volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 60px;
            height: 3px;
            background: #ccc;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
            margin-left: 8px;
            display: block; 
        }
    
        #new-volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
        }
        #new-volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            border: none;
        }
        .speed-container {
            position: relative;
        }
        #speed-btn {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 4px 8px;
        }
        #speed-options {
            position: absolute;
            top: calc(100% + 5px); /* Position below the button with a small gap */
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 100;
        }
        #speed-options div {
            padding: 8px 15px;
            cursor: pointer;
        }
        #speed-options div:hover {
            background-color: #f0f0f0;
        }

        /* Flowchart styles */
        .flowchart-container {
            border: 1px solid #ccc;
            padding: 0 20px;
        }
        .flowchart-step {
            text-align: center;
            margin: 0;
            padding: 20px 0;
            border-top: 1px solid #ddd;
        }
        .flowchart-step:first-child {
            border-top: none;
            padding-top: 20px;
            margin-top: 0;
        }
        .flowchart-arrow {
            text-align: center;
            margin: 0;
            padding: 15px 0;
            font-size: 20px;
            color: #555;
            border-top: 1px solid #ddd;
        }
        .flowchart-split {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            gap: 20px;
            border-top: 1px solid #ddd;
        }
        .flowchart-split-col {
            width: 48%;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .flowchart-split .flowchart-step {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
        }
        .flowchart-split .flowchart-arrow {
            border-top: none;
            padding: 15px 0;
        }


        /* Responsive adjustments for tablets */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .right-panel, .main-container.results-mode .right-panel {
                display: none;
            }
            .left-panel, .main-container.results-mode .left-panel {
                width: 100%;
                padding: 20px 10px;
                height: auto; /* Reset height for mobile */
            }
            .questions-container {
                width: 100%;
            }
            
            /* Adjust input boxes for tablets */
            .answer-input {
                width: 90px;
                max-width: 110px;
                font-size: 15px;
            }
            
            .drop-zone {
                max-width: 110px;
                min-width: 90px;
            }
            
            .matching-table .drop-zone {
                max-width: 110px;
                min-width: 90px;
            }
        }
        
        /* Responsive adjustments for mobile phones */
        @media (max-width: 768px) {
            .answer-input {
                width: 80px;
                max-width: 100px;
                font-size: 14px;
                padding: 2px 4px;
            }
            
            .drop-zone {
                max-width: 100px;
                min-width: 80px;
                font-size: 14px;
            }
            
            .matching-table .drop-zone {
                max-width: 100px;
                min-width: 80px;
            }
            
            .drag-item {
                font-size: 13px;
                padding: 4px 6px;
            }
            
            .matching-table .drop-zone .drag-item {
                font-size: 12px;
            }
            
            /* Ensure drag-drop containers are more mobile-friendly */
            .drag-drop-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .matching-container {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .answer-input {
                width: 70px;
                max-width: 90px;
                font-size: 13px;
            }
            
            .drop-zone {
                max-width: 90px;
                min-width: 70px;
            }
            
            .matching-table .drop-zone {
                max-width: 90px;
                min-width: 70px;
            }
        }

        /* ===== Imported designs from Reading 4.html ===== */
        /* TRUE/FALSE/NOT GIVEN styles */
        .tf-question { margin-bottom: 25px; padding: 10px 0; border-radius: 4px; }
        .tf-question-line { display: flex; align-items: flex-start; margin-bottom: 15px; padding: 5px 0; border-radius: 4px; }
        .tf-question-number, .question-number-box { border: 2px solid #ccc; padding: 2px 8px; margin-right: 10px; border-radius: 3px; font-weight: bold; display: inline-block; }
        .tf-question.active-question .tf-question-number { border-color: #4a90e2; }
        .tf-question-text { padding-top: 3px; }
        .tf-options { padding-left: 5px; }
        .tf-option { display: flex; align-items: center; padding: 10px 12px; background-color: #fff; transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease; }
        .tf-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .tf-option.correct { background-color: #d4edda !important; border-color: #28a745 !important; }
        .tf-option.incorrect { background-color: #f8d7da !important; border-color: #dc3545 !important; }
        .tf-option input[type="radio"] { margin-right: 10px; transform: scale(1.2); }
        .tf-question.correct .tf-question-line { background-color: #e9f7ef; }
        .tf-question.incorrect .tf-question-line { background-color: #f8d7da; }

        /* Multi-choice question styles */
        .multi-choice-question { margin-bottom: 20px; padding: 10px; border-radius: 4px; border: 3px solid transparent; }
        .multi-choice-question .question-prompt p > strong:first-child { display: inline-flex; align-items: center; justify-content: center; min-width: 24px; padding: 2px 6px; margin-right: 8px; border: 1px solid #d0d7e2; border-radius: 6px; background: #fff; }
        .multi-choice-question.active-question .question-prompt p > strong:first-child { border-color: #4a90e2; border-width: 2px; }
        .multi-choice-option { padding: 10px 12px; background-color: #fff; transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease; }
        .multi-choice-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .multi-choice-option.correct { background-color: #d4edda !important;  }
        .multi-choice-option.incorrect { background-color: #f8d7da !important;  }
        .multi-choice-option label { display: flex; align-items: center; cursor: pointer; font-size: 16px; }
        .multi-choice-option input[type="checkbox"], .multi-choice-option input[type="radio"] { margin-right: 12px; transform: scale(1.3); accent-color: #4a90e2; }

        /* Checkbox TWO-answers block (match screenshot) */
        .checkbox-question .question-prompt p > strong:first-child {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
           
            background: #fff;
        }
        .checkbox-group { display: flex; flex-direction: column;  }
        .checkbox-group label { display: flex; align-items: center; padding: 10px 12px; border: 1px solid transparent; background: #fff; transition: background-color 0.2s, border-color 0.2s; }
        .checkbox-group label:hover { background: #f1f7ff; border-color: #c6dcfb; }
        .checkbox-group label:has(input[type="checkbox"]:checked) { background: #cfe3f9; }
        .checkbox-group input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); }
        .checkbox-group label.correct { background-color: #d4edda !important; }
        .checkbox-group label.incorrect { background-color: #f8d7da !important;  }
        .checkbox-group label.correct::before { content: '✔ '; color: #28a745; font-weight: 600; margin-right: 6px; }
        .checkbox-group label.incorrect::before { content: '✖ '; color: #dc3545; font-weight: 600; margin-right: 6px; }

        /* Drag & Drop enhancements */
        /* Filled zone should look like an input with blue border */
        .drop-zone.filled { background-color: #ffffff; border: 2px solid #2c6bed !important; outline: none !important; box-shadow: none !important; padding: 6px 10px; border-radius: 4px; }
        .drop-zone.filled .drag-item { width: auto; height: auto; display: inline-block; border: none; border-radius: 0; padding: 0; font-weight: 500; background: transparent; box-shadow: none; white-space: nowrap; }

        /* ===== Results Modal UI ===== */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.55); display: flex; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
        .modal-content { background: #ffffff; width: 100%; max-width: 900px; max-height: 85vh; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; border-bottom: 1px solid #e5e7eb; background: #f8fafc; position: sticky; top: 0; z-index: 1; }
        .modal-header h2 { margin: 0; font-size: 20px; font-weight: 700; color: #111827; }
        .modal-close-btn { background: transparent; border: none; font-size: 26px; line-height: 1; cursor: pointer; color: #6b7280; }
        .modal-close-btn:hover { color: #111827; }
        .modal-body { padding: 16px 18px; overflow: auto; }
        #score-summary { font-size: 16px; font-weight: 600; color: #111827; background: #f1f5f9; border: 1px solid #e2e8f0; padding: 10px 12px; border-radius: 8px; display: inline-block; }
        .result-controls { display: flex; align-items: center; gap: 12px; margin: 12px 0; }
        .result-controls .spacer { flex: 1; }
        .result-controls label { display: inline-flex; align-items: center; gap: 6px; color: #374151; }
        .btn-secondary { padding: 6px 10px; border: 1px solid #cbd5e1; border-radius: 6px; background: #ffffff; color: #111827; cursor: pointer; }
        .btn-secondary:hover { background: #f8fafc; }
        #result-details { overflow: auto; }
        #result-details table { width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; }
        #result-details th, #result-details td { padding: 10px 12px; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 14px; }
        #result-details thead th { position: sticky; top: 0; background: #f1f5f9; z-index: 1; }
        #result-details tr:nth-child(even) td { background: #fafafa; }
        #result-details td.result-correct { color: #0f5132; font-weight: 600; }
        #result-details td.result-incorrect { color: #842029; font-weight: 600; }
    </style>
</head>
<body>
    <div class="header">
        <div class="timer-container">
            <span class="timer-display">60:00</span>
        </div>
        <a href="https://t.me/Avazbeks_Media" target="_blank" class="telegram-link">
            Avazbeks_Media
        </a>
        <div class="header-icons">
        
        </div>
    </div>

    <div class="audio-player-container">
        <button id="play-pause-btn" class="player-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
        <div class="progress-container">
            <span id="current-time">0:00</span>
            <input type="range" id="progress-bar" value="0" step="1" style="width: 100%;">
            <span id="total-duration">0:00</span>
        </div>
        <div class="controls-container">
            <div class="volume-container">
                <button id="volume-btn" class="player-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                </button>
                <input type="range" id="new-volume-slider" min="0" max="1" step="0.01" value="1">
            </div>
            <div class="speed-container">
                <button id="speed-btn" class="player-btn">1x</button>
                <div id="speed-options" class="hidden">
                    <div data-speed="0.5">0.5x</div>
                    <div data-speed="0.75">0.75x</div>
                    <div data-speed="1">1x</div>
                    <div data-speed="1.25">1.25x</div>
                    <div data-speed="1.5">1.5x</div>
                    <div data-speed="2">2x</div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Left Panel -->
        <div class="left-panel">
            
            <div id="part-1" class="question-part">
                <div class="part-header">
                    <p><strong>Part 1</strong></p>
                    <p>Listen and answer questions 1–10.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 1-6</strong></p>
                            <p>Which hotels have the following facilities?</p>
                            <p>Write the correct letter, <strong>A</strong>, <strong>B</strong>, <strong>C</strong>, or <strong>D</strong> next to questions 1-6.</p>
                            <div class="people-section">
                                <p><strong>A</strong> Royal Hotel</p>
                                <p><strong>B</strong> Star Hotel</p>
                                <p><strong>C</strong> Winchester Hotel</p>
                                <p><strong>D</strong> All Three Hotels</p>
                        </div>
                            </div>
                            
                        <div class="table-container">
                            <table class="matching-table">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>A</th>
                                        <th>B</th>
                                        <th>C</th>
                                        <th>D</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>1</strong> &nbsp;Sea view</td>
                                        <td class="clickable-cell" data-question="1" data-value="A" onclick="selectCell(this, 1, 'A')"></td>
                                        <td class="clickable-cell" data-question="1" data-value="B" onclick="selectCell(this, 1, 'B')"></td>
                                        <td class="clickable-cell" data-question="1" data-value="C" onclick="selectCell(this, 1, 'C')"></td>
                                        <td class="clickable-cell" data-question="1" data-value="D" onclick="selectCell(this, 1, 'D')"></td>
                                    </tr>
                                    <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>2</strong> &nbsp;Handicap accessibility</td>
                                        <td class="clickable-cell" data-question="2" data-value="A" onclick="selectCell(this, 2, 'A')"></td>
                                        <td class="clickable-cell" data-question="2" data-value="B" onclick="selectCell(this, 2, 'B')"></td>
                                        <td class="clickable-cell" data-question="2" data-value="C" onclick="selectCell(this, 2, 'C')"></td>
                                        <td class="clickable-cell" data-question="2" data-value="D" onclick="selectCell(this, 2, 'D')"></td>
                                    </tr>
                                    <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>3</strong> &nbsp;Multiple meal options</td>
                                        <td class="clickable-cell" data-question="3" data-value="A" onclick="selectCell(this, 3, 'A')"></td>
                                        <td class="clickable-cell" data-question="3" data-value="B" onclick="selectCell(this, 3, 'B')"></td>
                                        <td class="clickable-cell" data-question="3" data-value="C" onclick="selectCell(this, 3, 'C')"></td>
                                        <td class="clickable-cell" data-question="3" data-value="D" onclick="selectCell(this, 3, 'D')"></td>
                                    </tr>
                                    <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>4</strong> &nbsp;Private dining</td>
                                        <td class="clickable-cell" data-question="4" data-value="A" onclick="selectCell(this, 4, 'A')"></td>
                                        <td class="clickable-cell" data-question="4" data-value="B" onclick="selectCell(this, 4, 'B')"></td>
                                        <td class="clickable-cell" data-question="4" data-value="C" onclick="selectCell(this, 4, 'C')"></td>
                                        <td class="clickable-cell" data-question="4" data-value="D" onclick="selectCell(this, 4, 'D')"></td>
                                    </tr>
                                    <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>5</strong> &nbsp;Group discount</td>
                                        <td class="clickable-cell" data-question="5" data-value="A" onclick="selectCell(this, 5, 'A')"></td>
                                        <td class="clickable-cell" data-question="5" data-value="B" onclick="selectCell(this, 5, 'B')"></td>
                                        <td class="clickable-cell" data-question="5" data-value="C" onclick="selectCell(this, 5, 'C')"></td>
                                        <td class="clickable-cell" data-question="5" data-value="D" onclick="selectCell(this, 5, 'D')"></td>
                                    </tr>
                                    <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>6</strong> &nbsp;Children's play area</td>
                                        <td class="clickable-cell" data-question="6" data-value="A" onclick="selectCell(this, 6, 'A')"></td>
                                        <td class="clickable-cell" data-question="6" data-value="B" onclick="selectCell(this, 6, 'B')"></td>
                                        <td class="clickable-cell" data-question="6" data-value="C" onclick="selectCell(this, 6, 'C')"></td>
                                        <td class="clickable-cell" data-question="6" data-value="D" onclick="selectCell(this, 6, 'D')"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- Hidden inputs to support navigation/scrolling -->
                            <input type="hidden" id="q1"><input type="hidden" id="q2"><input type="hidden" id="q3"><input type="hidden" id="q4"><input type="hidden" id="q5"><input type="hidden" id="q6">
                            </div>
                            
                        <div class="question-prompt" style="margin-top: 60px;">
                            <p><strong>Questions 7-10</strong></p>
                            <p>Complete the sentences below.</p>
                            <p>Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                            </div>
                            
                        <div class="example-box">
                            <ul style="list-style-type: none;">
                                <li>&bull;&nbsp;&nbsp;The man needs to send his <input type="text" id="q7" class="answer-input" placeholder="7"> to the hotel.</li>
                                <li>&bull;&nbsp;&nbsp;He also needs to make <input type="text" id="q8" class="answer-input" placeholder="8"> immediately.</li>
                                <li>&bull;&nbsp;&nbsp;The hotel must be alerted in advance if guests will need help with <input type="text" id="q9" class="answer-input" placeholder="9">.</li>
                                <li>&bull;&nbsp;&nbsp;There is no need to prepare <input type="text" id="q10" class="answer-input" placeholder="10"> for hotel drivers.</li>
                                </ul>
                            </div>
                    </div>
                </div>
            </div>

            <div id="part-2" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 2</strong></p>
                    <p>Listen and answer questions 11–20.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 11-16</strong></p>
                            <p>Complete the form below.</p>
                            <p>Write <strong>NO MORE THAN TWO WORDS AND/OR A NUMBER</strong> for each answer.</p>
                        </div>
                        
                        <div class="example-box" style="margin-top: 12px; border: 1px solid black; padding: 10px;">
                            <p class="centered-title">Durham County Car Show</p>
                            <div class="aligned-form" style="margin-top: 10px;">
                                <div class="question-row"><span class="question-label" style="font-weight: 700;">Public grand opening date:</span> <input type="text" id="q11" class="answer-input" placeholder="11"></div>
                                <div class="question-row"><span class="question-label" style="font-weight: 700;">Number of viewers:</span> <input type="text" id="q12" class="answer-input" placeholder="12"></div>
                                <div class="question-row"><span class="question-label" style="font-weight: 700;">Off-peak day price:</span></div>
                                <ul style="list-style-type: none; padding-left: 30px; margin-top: 6px; margin-bottom: 10px;">
                                    <li>&bull;&nbsp;&nbsp;£10 for adults</li>
                                    <li>&bull;&nbsp;&nbsp;£ <input type="text" id="q13" class="answer-input" placeholder="13" style="width: 120px;"> for children</li>
                                </ul>
                                <div class="question-row"><span class="question-label" style="font-weight: 700;">Best day to visit:</span> <input type="text" id="q14" class="answer-input" placeholder="14"></div>
                                <div class="question-row"><span class="question-label" style="font-weight: 700;">New car category:</span> <input type="text" id="q15" class="answer-input" placeholder="15"></div>
                                <div class="question-row"><span class="question-label" style="font-weight: 700;">Entertainment included:</span> <input type="text" id="q16" class="answer-input" placeholder="16"></div>
                                </div>
                                </div>
                            </div>

                    <div class="question">
                        <div class="question-prompt" style="margin-top: 60px;">
                            <p><strong>Questions 17-20</strong></p>
                            <p>When were the following features included in an auto show?</p>
                            <p>Write the correct letter, <strong>A</strong>, <strong>B</strong>, or <strong>C</strong> next to questions 17-20.</p>
                            <ul class="mcq-options" style="margin-top: 8px;">
                                <li><strong>A</strong> last year</li>
                                <li><strong>B</strong> this year</li>
                                <li><strong>C</strong> both</li>
                            </ul>
                            </div>

                        <div class="table-container" style="margin-top: 12px;">
                            <table class="matching-table">
                            <thead>
                                <tr>
                                        <th></th>
                                        <th>A</th>
                                        <th>B</th>
                                        <th>C</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>17</strong> &nbsp;Higher number of seats</td>
                                        <td class="clickable-cell" data-question="17" data-value="A" onclick="selectCell(this, 17, 'A')"></td>
                                        <td class="clickable-cell" data-question="17" data-value="B" onclick="selectCell(this, 17, 'B')"></td>
                                        <td class="clickable-cell" data-question="17" data-value="C" onclick="selectCell(this, 17, 'C')"></td>
                                </tr>
                                <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>18</strong> &nbsp;Fun for children</td>
                                        <td class="clickable-cell" data-question="18" data-value="A" onclick="selectCell(this, 18, 'A')"></td>
                                        <td class="clickable-cell" data-question="18" data-value="B" onclick="selectCell(this, 18, 'B')"></td>
                                        <td class="clickable-cell" data-question="18" data-value="C" onclick="selectCell(this, 18, 'C')"></td>
                                </tr>
                                <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>19</strong> &nbsp;4×4 test drive</td>
                                        <td class="clickable-cell" data-question="19" data-value="A" onclick="selectCell(this, 19, 'A')"></td>
                                        <td class="clickable-cell" data-question="19" data-value="B" onclick="selectCell(this, 19, 'B')"></td>
                                        <td class="clickable-cell" data-question="19" data-value="C" onclick="selectCell(this, 19, 'C')"></td>
                                </tr>
                                <tr>
                                        <td class="statement" style="padding-left: 10px;"><strong>20</strong> &nbsp;Lucky draw for car</td>
                                        <td class="clickable-cell" data-question="20" data-value="A" onclick="selectCell(this, 20, 'A')"></td>
                                        <td class="clickable-cell" data-question="20" data-value="B" onclick="selectCell(this, 20, 'B')"></td>
                                        <td class="clickable-cell" data-question="20" data-value="C" onclick="selectCell(this, 20, 'C')"></td>
                                </tr>
                            </tbody>
                        </table>
                            <!-- Hidden inputs to aid navigation/scrolling -->
                            <input type="hidden" id="q17"><input type="hidden" id="q18"><input type="hidden" id="q19"><input type="hidden" id="q20">
                        </div>
                    </div>
                </div>
            </div>

            <div id="part-3" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 3</strong></p>
                    <p>Listen and answer questions 21–30.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 21-23</strong></p>
                            <p>Complete the table below.</p>
                            <p>Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                        </div>
                        
                        <div class="example-box" >
                            <p class="centered-title" style="font-size: 18px; font-weight: 700;">Research about different energy-saving innovations</p>
                            <table class="people-table" style="margin-top:10px; width:100%;">
                                <tbody>
                                    <tr>
                                        <td style="width: 32%; font-weight: 600;">Kites in Germany</td>
                                        <td>
                                            used in different <input type="text" id="q21" class="answer-input" placeholder="21" style="width: 140px;"> conditions to reduce the<br>
                                            emission of toxic gas
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Vehicles in America</td>
                                        <td>
                                            powered by <input type="text" id="q22" class="answer-input" placeholder="22" style="width: 160px;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight: 600;">Gas canister in South Africa</td>
                                        <td>
                                            invented to reduce its chances to <input type="text" id="q23" class="answer-input" placeholder="23" style="width: 160px;">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="question checkbox-question">
                        <div class="question-prompt" style="margin-top: 60px;">
                            <p><strong>Questions 24–25</strong></p>
                            <p>Choose <strong>TWO</strong> correct answers.</p>
                            <p>Which <strong>TWO</strong> types of interviewees do Greg and Syria choose to do the survey?</p>
                        </div>

                        <div class="checkbox-group" aria-label="Select two options" style="margin-top: 8px;">
                            <label><input type="checkbox" name="q24-25" value="A"> staff on campus</label>
                            <label><input type="checkbox" name="q24-25" value="B"> professors</label>
                            <label><input type="checkbox" name="q24-25" value="C"> local residents</label>
                            <label><input type="checkbox" name="q24-25" value="D"> companies</label>
                            <label><input type="checkbox" name="q24-25" value="E"> university students</label>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-prompt" style="margin-top: 60px;">
                            <p><strong>Questions 26-30</strong></p>
                            <p>Choose the correct answer.</p>
                        </div>

                        <div style="margin-bottom: 18px;">
                            <p><strong>26</strong>&nbsp;&nbsp;What does Syria think about renewable energy?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q26" value="A"> Most people know very little about renewable energy.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q26" value="B"> The general public can distinguish different kinds of renewable energy.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q26" value="C"> The majority of people feel the need to replace fossil fuels with renewable energy.</label></div>
                            </div>

                            <p><strong>27</strong>&nbsp;&nbsp;What do the speakers say about modem windmills?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q27" value="A"> They can be used to pump water from wells.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q27" value="B"> The location to build them should be carefully chosen.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q27" value="C"> Farmers use them to grind grain.</label></div>
                            </div>

                            <p><strong>28</strong>&nbsp;&nbsp;What aspect of traditional fuels are they going to address?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q28" value="A"> how to avoid fossil fuels from being depleted</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q28" value="B"> the possible future of traditional resources</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q28" value="C"> how to prevent pollution of traditional resources</label></div>
                            </div>

                            <p><strong>29</strong>&nbsp;&nbsp;What does Greg say about nuclear plants?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q29" value="A"> They are cleaner and less expensive than fossil fuel.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q29" value="B"> It is the best way to fight climate change.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q29" value="C"> Few people think they are safe</label></div>
                            </div>

                            <p><strong>30</strong>&nbsp;&nbsp;What does Syria think of hydrogen fuel?</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q30" value="A"> The price of it will drop eventually.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q30" value="B"> It entails environmental problems.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q30" value="C"> The benefits of it overweigh its high cost.</label></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="part-4" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 4</strong></p>
                    <p>Listen and answer questions 31–40.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 31-35</strong></p>
                            <p>Complete the notes below.</p>
                            <p>Write <strong>NO MORE THAN TWO WORDS</strong> for each answer.</p>
                        </div>

                        <div class="example-box" style="margin-top: 12px; border: 1px solid black; padding: 10px;">
                            <p class="centered-title">History of time-measurement</p>
                            <p><strong>Primitive measurements by observing</strong></p>
                            <p>Two time keepers:</p>
                            <ul style="list-style-type: disc; margin-left: 20px; padding-left: 20px;" >
                                <li>The <input type="text" id="q31" class="answer-input" placeholder="31" style="width: 200px;"></li>
                                <li>Natural events, such as winds and rains, rivers flooding, plants flowering, and the cycles of breeding or <input type="text" id="q32" class="answer-input" placeholder="32" style="width: 200px;"> behaviour.</li>
                            </ul>
                            <p><strong>Precise measurements</strong></p>
                            <p>They became important for organising activities for:</p>
                            <ul style="list-style-type: disc; margin-left: 20px; padding-left: 20px;">
                                <li><input type="text" id="q33" class="answer-input" placeholder="33" style="width: 220px;"></li>
                                <li><input type="text" id="q34" class="answer-input" placeholder="34" style="width: 220px;"></li>
                            </ul>
                            <p>The oldest time keepers were discovered in Mesopotamia and <input type="text" id="q35" class="answer-input" placeholder="35" style="width: 220px;"></p>
                        </div>

                        <div class="question-prompt" style="margin-top: 60px;">
                            <p><strong>Questions 36-40</strong></p>
                            <p>Complete the table below.</p>
                            <p>Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                        </div>

                        <table style="width:100%; border-collapse: collapse; margin: 20px 0;">
                            <thead>
                                <tr>
                                    <th style="padding:12px; border:1px solid #ddd; text-align:left; background-color: #f8f9fa; font-weight: bold;">Time Keeper</th>
                                    <th style="padding:12px; border:1px solid #ddd; text-align:left; background-color: #f8f9fa; font-weight: bold;">Disadvantages</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding:12px; border:1px solid #ddd;">The sundial</td>
                                    <td style="padding:12px; border:1px solid #ddd;">In different parts of the year, the time for day <input type="text" id="q36" class="answer-input" placeholder="36" style="width: 160px;"></td>
                                </tr>
                                <tr>
                                    <td style="padding:12px; border:1px solid #ddd;">The clepsydra (Water clock)</td>
                                    <td style="padding:12px; border:1px solid #ddd;">The changing pressure and <input type="text" id="q37" class="answer-input" placeholder="37" style="width: 160px;"> were what the flow of water still relied on.</td>
                                </tr>
                                <tr>
                                    <td style="padding:12px; border:1px solid #ddd;">The <input type="text" id="q38" class="answer-input" placeholder="38" style="width: 160px;"></td>
                                    <td style="padding:12px; border:1px solid #ddd;">The time duration was <input type="text" id="q39" class="answer-input" placeholder="39" style="width: 160px;"></td>
                                </tr>
                                <tr>
                                    <td style="padding:12px; border:1px solid #ddd;">Fire candle clock</td>
                                    <td style="padding:12px; border:1px solid #ddd;">The burning <input type="text" id="q40" class="answer-input" placeholder="40" style="width: 160px;"> or the rate of burning, was subject to the candle's wax.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <div id="transcription-container">
                <h2>Transcription</h2>
                <pre id="transcription-text"></pre>
            </div>
        </div>
    </div>

    <div id="transcription-data" style="display:none;">
        <div data-part="1"><strong>SECTION 1</strong>

AGENT: Hello, Elite Travel, this is Emily speaking, how may I assist you today?
CUSTOMER: Hi, I have a group visit to plan, and I wonder whether you could help me decide on which hotel to book. I have narrowed it down to either the Winchester, the Royal Hotel, or the Star Hotel. I am wondering if you have a recommendation.
AGENT: I would be happy to help! Those three are excellent choices. If everyone is booking hotel rooms independently, an easy way to do it is online booking. The Star Hotel offers online bookings at no additional charge.
CUSTOMER: It sounds fine!
AGENT: Yeah, and you can even book the gorgeous sea view rooms (Q1) if you act quickly.
CUSTOMER: Hm, I will consider that. It would be great since we are mostly first-time visitors to the area to get a nice view of the water. Now, are there handicap accessible rooms?
AGENT: Yes, all three options have access for the physically disabled (Q2).
CUSTOMER: Great. I should also mention that we will be on a tight schedule, so we won't have much time to go out for meals. Which of these hotels serve food?
AGENT: There is a limited continental breakfast menu at the Star and at the Winchester. For a full restaurant and room service, the Royal Hotel is your best bet (Q3).
CUSTOMER: Oh wonderful! Could you tell me more about the restaurant?
AGENT: Absolutely. In the morning there is a gourmet buffet or a la carte item, and after 11 a.m. lunch is served in the dining room. Dinners are in a nice, low-key but high quality setting in the hotel's private dining room (Q4) and Fridays feature the house jazz band.
CUSTOMER: How lovely! Is there a group discount?
AGENT: No, sorry. Not at the Royal hotel. Let me check on the others, though. Could I place you on hold for just a second?
CUSTOMER: Sure, thanks.
AGENT: It looks like there is one at the Winchester – 15% off when you book 8 or more rooms (Q5).
CUSTOMER: Really? Sold! We'll book at the Winchester. Wait – is it suitable for children though? We'll have a few little ones in our group, and it would be great to have a way to keep them occupied.
AGENT: Yes. In fact, it has a play place (Q6) that kids just love, with slides, and swings and everything. Definitely a good hotel to bring the kids.
CUSTOMER: Okay, great.
CUSTOMER: So now I know where we'll be staying, what next? Should I go ahead and book transportation and assign rooms and everything?
AGENT: Well, for now, there are only a few things for you to take care of. We will hold a block of rooms for you as soon as you send a deposit (Q7). I recommend booking as soon as possible, so you probably want to send the invitations (Q8) as soon as you know how many rooms to hold.
CUSTOMER: Oh, right. Okay, I'll send the invitations and put down the deposit. Is there anything else I should take care of?
AGENT: Great! And don't worry about this now, but sometime before you arrive do let US know if you'll be requiring our transport (Q9) service to and from the airport.
CUSTOMER: I'll make sure to let you know. Does that incur a service charge? Or perhaps a tip, or some presents to show our gratitude for the personal car service?
AGENT: Oh, don't worry about it. It is a free service, so if you would like to tip you are welcome to do so, but hotel drivers do not accept gifts (Q10).
CUSTOMER: Thanks for your help!
AGENT: My pleasure. Enjoy your stay at the Winchester!
        </div>
        <div data-part="2"><strong>SECTION 2</strong>

Ladies and Gentlemen of Durham, start your engines! Skip Gordon here inviting you to the eleventh annual Durham County Car Exhibition! That's right, it's that time of year again! Mark your calendars – the pre-opening event kicks off on the 18th, and the exhibition officially opens to the public on Saturday, March 19th (Q11). Take it from me – you won't want to miss Durham's most attended public event of the year 5 times running. You don't have to be a motor head to appreciate the finest cars both new and old in existence today, but it helps! Be one of the 70,000 (Q12) people to see everything from big rig monster trucks to good old fashion classic hot rods.
Get your tickets now! Admission is £10 for adults and £5 (Q13) for children during off-peak times, and £20 for adults and £10 for children and senior citizens on weekends and for full-day passes.
Come see vintage classics, bid in the auctions, and even test out a few on the Winner's Circle Racetrack. An insider tip – weekends are the exact time when all of the best attractions take place, but to avoid Saturday crowds join us this Sunday (Q14). You'll see me – Skip Gordon – and all your friends from WKXP there this Sunday at our very own booth, so stop by and say hi and you might just win a prize of your own.
A new attraction this year will be the addition of a new car category – electricity (Q15), namely the electric car class. See displays from Toyota, Honda, and – you guessed it – Tesla! Watch as the first generation of fully electric cars compete on style, ride, and watch the main entertainment as there's going to be a fabulous show of racing car (Q16) to see who takes home fastest battery powered car. While not typically known for their speed, this new class is guaranteed to surprise you.
Get tickets before they sell out! Last year's tickets sold out fast, so we upped the attendance this year. That's right, more seats! But don't wait – act now and save! (Q17) That's right – if you buy your tickets before this Friday, you'll get two for the price of one. That's right, TWO for the price of one!
And don't worry kids, just like last year, there's something specially for you! Wreak havoc on the road with the Kids Krazy Cars ride, and then Race around the Tiny Tykes Track in your favorite child-sized race car (Q18). Meanwhile Mom and Dad can take a spin in a ride a bit more than their size. We're rolling out a massive dirt track so you can get behind the wheel and test drive something a little more adventurous. Put the pedal to the metal in a 4 by 4 SUV (Q19) as you go over bumps and navigate through twists and turns – you'll want to buckle up!
You heard it here – act now to get in on the fun at thé Durham County Car Show before it's too late. Come for prizes, good prices, and good old fashioned family fun. We had a lucky draw for a NEW car last year (Q20), but this year our main event is the Monster Truck Rally, where one lucky fan will win a chance experience the thrill from behind the wheel – well, next to the wheel as they ride with legendary driver Smash Tate! Feel the speed first hand and talk to a living legend in a true once-in-a-lifetime opportunity.
For tickets, go online to www.durhamcountycars.com, or call 1-888-CAR-SHOW now. We'll see you there! And always remember to buckle up!
        </div>
        <div data-part="3"><strong>SECTION 3</strong>

Syria:     Hi, Greg. How did it go w:th the research on renewable energy? Have you found anything?
Greg:     Yes. But I think it's about time we exchange our findings and discuss our next move.
Syria:     You read my mind. Right. I'll start first. Germany is the very first country I dug into in order to find innovative means of creating clean energy because 15% of its national electricity supply conies from renewable sources. I found that apart from the traditional fossil fuel industry, there's a German firm that has initiated a project using kites to generate power.
Greg:     Really, I've never heard of it before. How does it work?
Syria:     As a substitution for traditional fossil fuels that release toxic gas into the atmosphere, the power-generating kites can function in any weather (Q21). Compared to conventional wind turbines, such kites can produce twice as much energy because the overall power density is proportional to altitude.
Greg:     Sounds like an efficient way of producing power. Okay, now let me tell you what I have found. There is an American company manufacturing school buses and city buses depending solely on electricity instead of gasoline (Q22). The all-electric vehicles can save up to 20 gallons of fuel on a daily basis. This could reduce transport budgets by over $10,000 each year, not to mention maintenance savings.
Syria:     Wow, impressive. If only there were more of these electric vehicles around.
Greg:     Well, over the years, South Africa has attached great importance to clean energy. The nation encourages using propane gas, which can either be extracted from natural deposits or be produced organically. It is normally stored in gas canisters as a type of cooking gas. To reduce the number of kitchen accidents, a new type of composite gas canister made of fiber was introduced. It is much safer and less likely to explode even when engulfed in fire. (Q23)
Greg:     Now, about the survey, do you have any clues as to what kind of interviewees we should include?
Syria:     How about local companies doing business on clean energy products?
Greg:     Probably not the best choice of respondents. Remember the last time we asked corporate employees tc do the questionnaire, only about 5% of them were actually willing to participate.
Syria:     That wouldn't be enough then. It seems we have to drop that idea. Then maybe we can ask the professors and administrative staff here to help us. They could provide their insights and understanding on energy production.
Greg:     It would be ideal if they would, but I'm afraid most of them are too busy to respond to the list of questions we've prepared. I guess the students here at the university would be more suitable. (Q24)
Syria:     You're right. And it is a much bigger sample pool too. Also, I think we should include the locals. Their opinion is key to the promotion of renewable energy here in the town. (Q25)
Greg:     But wouldn't it be difficult to collect data? There's no way the two of us could go from door to door to interview all the residents.
Syria:     There's no need to worry about that. We'll make it telephone interviews. That way we'll have enough time to get sufficient data.
Greg:     Good idea. What should we present in our speech?
Syria:     Due to lack of media coverage, the majority of people actually have a limited understanding on renewable energy (Q26). Most of them aren't able to identify various types of renewable sources. So I feel we could start by clarifying what it is and the benefit of it compared to fossil fuels.
Greg:     That makes sense. We could start with wind energy. For centuries, wind has been used to do work. With the help of windmills, farmers used to pump water from wells or turn large grinding stones to grind wheat or corn. The windmills today generate electricity. The only problem is that it might not be windy all the time, so it is crucial to choose the appropriate site for wind farms. (Q27)
Syria:     Well, I think we can also include comparisons between clean energy and traditional energy resources like coal, oil and natural gas.
Greg:     Maybe we can look into the prospect of these conventional sources of energy (Q28). The rising cost of fossil fuels and the threat of climate change is a concern to many
Syria:     Totally. These traditional resources will deplete eventually. Renewable energy currently makes up less than 2% of the world's primary energy supply, and although growing very rapidly, it is not on course to fill the fossil fuel gap.
Greg:     Nuclear energy is another type of energy we ought to mention. Nuclear power plants can produce dependable power constantly and release far less greenhouse gases than other traditional power plants. But most people feel that this type of energy is unsafe because radiation isn't easily dealt with, especially in nuclear waste and maintenance materials. (Q29)
Syria:     What should we end the speech with?
Greg:     Have you heard about a new type of energy called hydrogen fuel? It is an infinitely renewable fuel that doesn't have detrimental environmental effects. The only problem is that it is so expensive that only wealthy individuals can afford it. But I think overall the benefits overshadow its high cost.
Syria:     I think that even though this new type of renewable energy is too expensive to use at the moment, in the long run, its price will go down and become more accessible. (Q30)
        </div>
        <div data-part="4"><strong>SECTION 4</strong>

Good morning, everyone. Today, I'm going to talk about the research project I've been involved in on time measurement.
Do you know how time is measured? Consider how we measure length, and how with time we encounter a difficulty. Before we could grasp it, it would slip through our fingers. In fact, as we can see, we are forced to have the recourse to measure something else—the movement of something in space, or a set of movements in space. All the methods that have been employed so far really measure time by a motion in space. The measurement of time is no easy matter; a scientific unit only arrives at after much thought and reflection.
As the most primitive form of measurement, the sun seems to be natural. Ever since man first noticed the regular movements of the sun and stars, we have wondered about the passage of time. Prehistoric people first recorded time according to the sun's position. To start off, let us take noon, which is when the sun is on the meridian at the highest point of its course across the heavens, and when it casts the shortest shadow. But this measurement, which was regarded as a major one in ancient times, was less important than the natural events that occurred. (Q31)
The earliest natural events that had been recognised were in the heavens, but during the course of the year there were many other events that indicated significant changes in the environment. Seasonal winds and rains, the flooding of rivers, the flowering of trees and plants, and the breeding cycles or migration of animals (Q32), all led to natural divisions of the year, and further observation and local customs led to the recognition of the seasons.
Years later, precise measurements were invented, because the passage of time was extremely important for astronomers and priests who were responsible for determining the exact hour for daily rituals and for important religious festivals. Apart from the connection with religion (Q33), accurate time measurement was also related to the government (Q34), since they divided the day or the night into different periods in order to regulate work and various events. For thousands of years, devices have been used to measure and keep track of time. The current sexagesimal system of time measurement, dates back to approximately 2000 BCE from the Sumerians. It was found that the earliest ancient time keepers were mainly invented and used in Mesopotamia, where the water clock was introduced from, as well as in North Africa (Q35), especially in the area of ancient Egypt.
So now, I'd like to introduce you to some of the most well-known ancient timekeepers, as well as the disadvantages of them, for which they were replaced by various new forms of clocks that were used afterwards.
A sundial is a device that tells the time of day by the apparent positioning of the Sun in the sky. In the narrowest sense of the word, it consists of a flat plate and a gnomon which casts a shadow onto the dial. As the sun appears to move across the sky, the shadow aligns with different hour-lines which are marked on the dial to indicate the time of day. However, it was quickly noted that the length of the day varied at different times of the year (Q36), therefore there could have been a difference between 'clock time' and 'sundial time'. In addition, the sundial was of no use at night, so a water clock was invented.
The water clock, or clepsydra, appeared to have been invented around 1,500 BCE and was a device which relied on the steady flow of water from or into a container. Measurements could be marked on the container or on a receptacle for the water. It was reliable, but the water flow still depended on the variation of pressure and temperature from the top of water in the container. (Q37)
As the technology of glass-blowing developed, from some time in the 14th century, it became possible to make sandglasses (Q38). Originally, they were used as a measure for periods of time like lamps or candles, but as clocks became more accurate they were calibrated to measure specific periods of time. The drawback however, as you can imagine, was the limited length of time they could measure. (Q39)
The last timekeeper to be introduced is the fire candle clock. Candle clocks take advantage of a simple concept: the slow and consistent nature of a burning wax candle. By utilising this process, our ancestors were able to keep steady track of the time. The clocks were created by engraving the length of the candle with evenly spaced markings. Each marking represented a single unit of time, and as the wax burned down, each hour would disappear. However, the draughts and the variable quality of the wax mainly influenced the time of burning (Q40). Like oil lamps, candles were used to mark the passage of time from one event to another, rather than tell the time of day…
        </div>
    </div>

    <audio id="global-audio-player" class="hidden"></audio>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow" onclick="previousPart()" id="prevBtn">‹</button>
        <button class="nav-arrow" onclick="nextPart()" id="nextBtn">›</button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)">
                    <span class="sr-only">Question 12</span>
                    <span aria-hidden="true">12</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)">
                    <span class="sr-only">Question 13</span>
                    <span aria-hidden="true">13</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)">
                    <span class="sr-only">Question 14</span>
                    <span aria-hidden="true">14</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)">
                    <span class="sr-only">Question 15</span>
                    <span aria-hidden="true">15</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)">
                    <span class="sr-only">Question 16</span>
                    <span aria-hidden="true">16</span>
                </button>
                <button class="subQuestion active scorable-item" onclick="goToQuestion(17)">
                    <span class="sr-only">Question 17</span>
                    <span aria-hidden="true">17</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)">
                    <span class="sr-only">Question 18</span>
                    <span aria-hidden="true">18</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)">
                    <span class="sr-only">Question 19</span>
                    <span aria-hidden="true">19</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)">
                    <span class="sr-only">Question 20</span>
                    <span aria-hidden="true">20</span>
                </button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(4)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">4</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" id="highlight-item" onclick="highlightText()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M15.24 12.32L12.28 9.36l-1.04 1.04-1.04-1.04-1.04 1.04-1.04-1.04-1.04 1.04-1.04-1.04-3.12 3.12c-.59.58-1.54.58-2.12 0l-1.04-1.04c-.58-.59-.58-1.54 0-2.12L7.88.88c.59-.58 1.54-.58 2.12 0l1.04 1.04 1.04-1.04 1.04 1.04 1.04-1.04 1.04 1.04 1.04-1.04 3.12 3.12c.58.59.58 1.54 0 2.12l-1.04 1.04c-.58.59-1.54.59-2.12 0zM12 15l-3 3-7-7 3-3 7 7zm-9-5l-2.29 2.29c-.39.39-.39 1.02 0 1.41l8.29 8.29c.39.39 1.02.39 1.41 0L22.7 8.41c.39-.39.39-1.02 0-1.41L14.42.29c-.39-.39-1.02-.39-1.41 0L3 10z"/></svg>
            </span>
            <span>Highlight</span>
        </div>
        <div class="context-menu-item" id="comment-item" onclick="addComment()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 12H5.17L4 15.17V4h16v10z"/></svg>
            </span>
            <span>Comment</span>
        </div>
        <div class="context-menu-item" id="clear-item" onclick="clearHighlight()" style="display:none;">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
            </span>
            <span>Clear</span>
        </div>
        <div class="context-menu-item" onclick="clearAllHighlights()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M16 9h-2.29l3-3-1.42-1.42-3 3V5h-2v2.29l-3-3-1.42 1.42 3 3H5v2h2.29l-3 3 1.42 1.42 3-3V17h2v-2.29l3 3 1.42-1.42-3-3H17V9h-2zm-4 4h-2v-2h2v2z"/></svg>
            </span>
            <span>Clear All</span>
        </div>
    </div>

    <!-- Mobile highlight/comment toolbar -->
    <div id="mobile-selection-menu" class="mobile-selection-menu hidden">
        <button onclick="highlightText()">Highlight</button>
        <button onclick="addComment()">Comment</button>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Your Results</h2>
                <button id="modal-close-button" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p id="score-summary"></p>
                <div id="result-details"></div>
            </div>
        </div>
    </div>

    <script>
        let currentPart = 1;
        let currentQuestion = 1;
        let selectedText = '';
        let selectedRange = null;
        let draggedElement = null;
        let testStarted = false;
        let timeInSeconds = 3600;
        let isHovering = false;
        let timerInterval;
        let contextElement = null;

        function updateAnsweredIndicators() {
            for (let qNum = 1; qNum <= 40; qNum++) {
                const btn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                if (!btn) continue;

                // Do not change style if it's already marked correct or incorrect
                if (btn.classList.contains('correct') || btn.classList.contains('incorrect')) {
                    continue;
                }

                let isAnswered = false;
                const textInput = document.getElementById(`q${qNum}`);
                const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
                const dropZone = document.querySelector(`.drop-zone[data-question-id="${qNum}"]`);
                const clickableCell = document.querySelector(`.clickable-cell[data-question="${qNum}"].selected`);

                if (textInput && textInput.value.trim() !== '') {
                    isAnswered = true;
                } else if (radioInput) {
                    isAnswered = true;
                    if (qNum >= 17 && qNum <= 20) {
                        console.log(`Question ${qNum} radio detected as answered: ${radioInput.value}`);
                    }
                } else if (dropZone && dropZone.querySelector('.drag-item')) {
                    isAnswered = true;
                } else if (clickableCell) {
                    isAnswered = true;
                    if (qNum >= 13 && qNum <= 16) {
                        console.log(`Question ${qNum} clickable cell detected as answered: ${clickableCell.getAttribute('data-value')}`);
                        console.log(`Clickable cell element:`, clickableCell);
                    }
                } else if (qNum >= 24 && qNum <= 25) {
                    const checkedCount2425 = document.querySelectorAll('input[name="q24-25"]:checked').length;
                    if (qNum === 24) {
                        isAnswered = checkedCount2425 >= 1;
                    } else if (qNum === 25) {
                        isAnswered = checkedCount2425 >= 2;
                    }
                }

                if (isAnswered) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            }
            // Keep attempted count in sync with latest interactions
            updateAttemptedCount(currentPart);
        }

        const audioPlayer = document.getElementById('global-audio-player');
        const timerContainer = document.querySelector('.timer-container');
        const timerDisplay = document.querySelector('.timer-display');
        const volumeSlider = document.getElementById('new-volume-slider');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeEl = document.getElementById('current-time');
        const totalDurationEl = document.getElementById('total-duration');
        const speedBtn = document.getElementById('speed-btn');
        const speedOptions = document.getElementById('speed-options');
        const volumeBtn = document.getElementById('volume-btn');

        const audioSource = 'https://ia903203.us.archive.org/29/items/mix-27m-45s-audio-joiner.com-copy-copy-copy-copy-copy-copy-copy-copy/mix_27m45s%20%28audio-joiner.com%29%20-%20CopyCopyCopyCopyCopyCopyCopyCopy.mp3';
        audioPlayer.src = audioSource;

        const correctAnswers = {
            /* --- Part 1 --- */
            'q1': 'B',
            'q2': 'D',
            'q3': 'A',
            'q4': 'A',
            'q5': 'C',
            'q6': 'C',
            'q7': ['deposit'],
            'q8': ['invitations'],
            'q9': ['transport'],
            'q10': ['gifts'],

            /* --- Part 2 --- */
            // Part 2 answers
            'q11': ['march 19th', '19 march', 'march 19', '19th march'],
            'q12': ['70000', 'seventy thousand'],
            'q13': ['5', 'five'],
            'q14': ['this sunday', 'sunday'],
            'q15': ['electricity'],
            'q16': ['racing car'],
            'q17': 'B',
            'q18': 'C',
            'q19': 'C',
            'q20': 'A',

            /* --- Part 3 --- */
            'q21': ['weather'],
            'q22': ['electricity'],
            'q23': ['explode'],
            'q24-25': ['C','E'],
            'q26': 'A',
            'q27': 'B',
            'q28': 'B',
            'q29': 'C',
            'q30': 'A',

            /* --- Part 4 --- */
            'q31': ['sun\'s position'],
            'q32': ['animals'],
            'q33': ['religion'],
            'q34': ['the government', 'government'],
            'q35': ['north africa'],
            'q36': ['varied'],
            'q37': ['temperature'],
            'q38': ['sandglasses'],
            'q39': ['limited'],
            'q40': ['time']
        };
        
        const questionTypes = {
            'q1': 'clickable', 'q2': 'clickable', 'q3': 'clickable', 'q4': 'clickable', 'q5': 'clickable',
            'q6': 'clickable', 'q7': 'text', 'q8': 'text', 'q9': 'text', 'q10': 'text',
            'q11': 'text', 'q12': 'text', 'q13': 'text', 'q14': 'text', 'q15': 'text',
            'q16': 'text', 'q17': 'clickable', 'q18': 'clickable', 'q19': 'clickable', 'q20': 'clickable',
            'q21': 'text', 'q22': 'text', 'q23': 'text', 'q24-25': 'checkbox', 'q26': 'mcq', 'q27': 'mcq', 'q28': 'mcq', 'q29': 'mcq', 'q30': 'mcq',
            'q31': 'text', 'q32': 'text', 'q33': 'text', 'q34': 'text', 'q35': 'text',
            'q36': 'text', 'q37': 'text', 'q38': 'text', 'q39': 'text', 'q40': 'text'
        };


        function setupCheckboxLimits() {
            const checkboxGroups = [
                { name: 'q24-25', limit: 2 },
            ];

            // Track selection order per group to allow robust limiting
            const selectionQueues = {};

            checkboxGroups.forEach(group => {
                selectionQueues[group.name] = [];
                const checkboxes = Array.from(document.querySelectorAll(`input[name="${group.name}"]`));

                // Initialize queue with any pre-checked items (if any)
                checkboxes.forEach(cb => {
                    if (cb.checked) selectionQueues[group.name].push(cb);
                });

                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const name = group.name;
                        const limit = group.limit;

                        // If checked, append to queue; if unchecked, remove from queue
                        if (checkbox.checked) {
                            // Avoid duplicates in queue
                            selectionQueues[name] = selectionQueues[name].filter(cb => cb !== checkbox);
                            selectionQueues[name].push(checkbox);
                        } else {
                            selectionQueues[name] = selectionQueues[name].filter(cb => cb !== checkbox);
                        }

                        // Enforce limit: keep the most recent 'limit' checked, uncheck older ones
                        if (selectionQueues[name].length > limit) {
                            const overflow = selectionQueues[name].length - limit;
                            const toUncheck = selectionQueues[name].splice(0, overflow);
                            toUncheck.forEach(cb => { cb.checked = false; });
                        }

                        updateAnsweredIndicators();
                        updateAttemptedCount(3); // Part 3 affected for q21-23
                    });
                });
            });
        }

        // Test function to verify clickable cells are working
        function testClickableCells() {
            console.log('Testing clickable cells...');
            const cells = document.querySelectorAll('.clickable-cell');
            console.log(`Found ${cells.length} clickable cells`);
            cells.forEach((cell, index) => {
                const question = cell.getAttribute('data-question');
                const value = cell.getAttribute('data-value');
                const onclick = cell.getAttribute('onclick');
                console.log(`Cell ${index}: question=${question}, value=${value}, onclick=${onclick}`);
            });
        }
        
        function selectCell(cell, questionNumber, value) {
            try {
                console.log(`selectCell called: question ${questionNumber}, value ${value}`);
                console.log('Cell element:', cell);
                console.log('Cell classes:', cell.className);
                
                // Remove previous selection for this question
                const row = cell.closest('tr');
                if (!row) {
                    console.error('Could not find row for cell');
                    return;
                }
                
                const cells = row.querySelectorAll('.clickable-cell');
                console.log(`Found ${cells.length} clickable cells in row`);
                cells.forEach(c => {
                    c.classList.remove('selected');
                    console.log(`Removed 'selected' class from cell with value: ${c.getAttribute('data-value')}`);
                });
                
                // Select the clicked cell
                cell.classList.add('selected');
                console.log(`Added 'selected' class to cell with value: ${value}`);
                console.log('Cell classes after selection:', cell.className);
                
                // Store the answer in the hidden input
                const hiddenInput = document.getElementById(`q${questionNumber}`);
                if (hiddenInput) {
                    hiddenInput.value = value;
                    console.log(`Hidden input q${questionNumber} value set to: ${value}`);
                } else {
                    console.error(`Hidden input q${questionNumber} not found`);
                }

                // Update answered indicators
                updateAnsweredIndicators();
                
                // Force a visual update
                cell.style.display = 'none';
                cell.offsetHeight; // Force reflow
                cell.style.display = '';
                
            } catch (error) {
                console.error('Error in selectCell:', error);
            }
        }

        function switchToPart(partNumber, andPlay = false) {
            if (currentPart !== partNumber) {
                const firstQuestionOfPart = (partNumber - 1) * 10 + 1;
                currentQuestion = firstQuestionOfPart;
            }
            
            currentPart = partNumber;

            updateNavigation();
            document.querySelectorAll('.question-part').forEach(part => part.classList.add('hidden'));
            const partToShow = document.getElementById(`part-${partNumber}`);
            if (partToShow) {
                partToShow.classList.remove('hidden');
            }

            if (document.querySelector('.main-container.results-mode')) {
                const transcriptionSource = document.querySelector(`#transcription-data [data-part="${partNumber}"]`);
                const transcriptionTarget = document.getElementById('transcription-text');
                if (transcriptionSource && transcriptionTarget) {
                    transcriptionTarget.innerHTML = transcriptionSource.innerHTML;
                }
            }

            updateNavigation();
        }

        function updateNavigation() {
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.remove('selected');
                updateAttemptedCount(index + 1);
            });
            const currentWrapper = document.querySelectorAll('.footer__questionWrapper___1tZ46')[currentPart - 1];
            if (currentWrapper) {
                currentWrapper.classList.add('selected');
            }
            document.getElementById('prevBtn').disabled = currentQuestion === 1;
            document.getElementById('nextBtn').disabled = currentQuestion === 40;
        }

        function goToQuestion(questionNumber) {
            currentQuestion = questionNumber;
            let partNumber = 1;
            if (questionNumber > 10 && questionNumber <= 20) partNumber = 2;
            else if (questionNumber > 20 && questionNumber <= 30) partNumber = 3;
            else if (questionNumber > 30) partNumber = 4;
            if (currentPart !== partNumber) {
                switchToPart(partNumber);
            }
            document.querySelectorAll('.subQuestion').forEach(btn => btn.classList.remove('active'));
            const questionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${questionNumber})"]`);
            if (questionBtn) questionBtn.classList.add('active');

            // Scroll to the question
            let questionElement;
            if (questionNumber >= 27 && questionNumber <= 28) {
               questionElement = document.querySelector('input[name="q27-28"]');
            } else if (questionNumber >= 29 && questionNumber <= 30) {
               questionElement = document.querySelector('input[name="q29-30"]');
            } else {
                questionElement = document.getElementById(`q${questionNumber}`) || // text inputs
                                document.querySelector(`[data-question-id="${questionNumber}"]`) || // drag-drop
                                document.querySelector(`input[name="q${questionNumber}"]`); // radio buttons
            }
            
            if (questionElement) {
                const questionContainer = questionElement.closest('.question');
                if(questionContainer) {
                    questionContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    questionContainer.classList.add('flash');
                    setTimeout(() => {
                        questionContainer.classList.remove('flash');
                    }, 1000);
                }
            }
            updateNavigation();
        }

        function nextPart() {
            if (currentQuestion < 40) {
                goToQuestion(currentQuestion + 1);
            }
        }

        function previousPart() {
            if (currentQuestion > 1) {
                goToQuestion(currentQuestion - 1);
            }
        }

        function highlightText() {
            if (!selectedRange || selectedRange.collapsed) {
                closeContextMenu();
                return;
            }
            
            try {
                // Check if selection spans multiple elements
                const startContainer = selectedRange.startContainer;
                const endContainer = selectedRange.endContainer;
                
                if (startContainer === endContainer && startContainer.nodeType === Node.TEXT_NODE) {
                    // Simple case: selection within a single text node
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    selectedRange.surroundContents(span);
                } else {
                    // Complex case: selection spans multiple elements
                    // Handle partial text selections and complex DOM structures
                    
                    // First, handle partial text at the start
                    const startOffset = selectedRange.startOffset;
                    const endOffset = selectedRange.endOffset;
                    
                    if (startContainer.nodeType === Node.TEXT_NODE && startOffset > 0) {
                        // Split the start text node if selection starts in the middle
                        const startText = startContainer.textContent;
                        const beforeText = startText.substring(0, startOffset);
                        const selectedStartText = startText.substring(startOffset);
                        
                        const beforeNode = document.createTextNode(beforeText);
                        const selectedNode = document.createTextNode(selectedStartText);
                        
                        const parent = startContainer.parentNode;
                        parent.insertBefore(beforeNode, startContainer);
                        parent.insertBefore(selectedNode, startContainer);
                        parent.removeChild(startContainer);
                        
                        // Update the range to start from the new node
                        selectedRange.setStart(selectedNode, 0);
                    }
                    
                    if (endContainer.nodeType === Node.TEXT_NODE && endOffset < endContainer.textContent.length) {
                        // Split the end text node if selection ends in the middle
                        const endText = endContainer.textContent;
                        const selectedEndText = endText.substring(0, endOffset);
                        const afterText = endText.substring(endOffset);
                        
                        const selectedNode = document.createTextNode(selectedEndText);
                        const afterNode = document.createTextNode(afterText);
                        
                        const parent = endContainer.parentNode;
                        parent.insertBefore(selectedNode, endContainer);
                        parent.insertBefore(afterNode, endContainer);
                        parent.removeChild(endContainer);
                        
                        // Update the range to end at the new node
                        selectedRange.setEnd(selectedNode, selectedNode.textContent.length);
                    }
                    
                    // Now extract the contents and highlight all text nodes
                    const fragment = selectedRange.extractContents();
                    
                    // Create a tree walker to find all text nodes
                    const walker = document.createTreeWalker(
                        fragment,
                        NodeFilter.SHOW_TEXT,
                        {
                            acceptNode: function(node) {
                                // Accept text nodes that have content (not just whitespace)
                                return node.textContent.trim() ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;
                            }
                        },
                        false
                    );
                    
                    const textNodes = [];
                    let node;
                    while (node = walker.nextNode()) {
                        textNodes.push(node);
                    }
                    
                    // Wrap each text node in a highlight span
                    textNodes.forEach(textNode => {
                        const span = document.createElement('span');
                        span.className = 'highlight';
                        const parent = textNode.parentNode;
                        if (parent) {
                            parent.insertBefore(span, textNode);
                            span.appendChild(textNode);
                        }
                    });
                    
                    // Insert the highlighted fragment back
                    selectedRange.insertNode(fragment);
                }
            } catch(err) {
                console.warn('Primary highlighting failed, trying robust fallback:', err);
                
                // Robust fallback for complex selections
                try {
                    const selection = window.getSelection();
                    if (selection.rangeCount > 0) {
                        const range = selection.getRangeAt(0);
                        
                        // Get all nodes in the selection
                        const startContainer = range.startContainer;
                        const endContainer = range.endContainer;
                        const commonAncestor = range.commonAncestorContainer;
                        
                        // Create a temporary range to work with
                        const tempRange = document.createRange();
                        tempRange.selectNodeContents(commonAncestor);
                        
                        // Find the start and end positions
                        const startPos = range.startOffset;
                        const endPos = range.endOffset;
                        
                        // Extract and highlight the content
                        const contents = range.extractContents();
                        
                        // Recursively highlight all text content
                        function highlightAllText(node) {
                            if (node.nodeType === Node.TEXT_NODE) {
                                if (node.textContent.trim()) {
                                    const span = document.createElement('span');
                                    span.className = 'highlight';
                                    span.style.backgroundColor = '#ffff00';
                                    const parent = node.parentNode;
                                    if (parent) {
                                        parent.insertBefore(span, node);
                                        span.appendChild(node);
                                    }
                                }
                            } else if (node.nodeType === Node.ELEMENT_NODE) {
                                Array.from(node.childNodes).forEach(child => {
                                    highlightAllText(child);
                                });
                            }
                        }
                        
                        highlightAllText(contents);
                        range.insertNode(contents);
                    }
                } catch(e2) {
                    console.warn('Robust fallback failed, using final method:', e2);
                    // Final fallback - use execCommand
                    try {
                        document.execCommand('backColor', false, 'yellow');
                    } catch(e3) {
                        console.error('All highlighting methods failed:', e3);
                        // Show user feedback
                        alert('Highlighting failed for this selection. Please try selecting smaller portions of text.');
                    }
                }
            }
            
            window.getSelection().removeAllRanges();
            closeContextMenu();
        }

        function addComment() {
            const commentText = prompt('Enter your comment:');
            if (!commentText || !selectedRange || selectedRange.collapsed) {
                closeContextMenu();
                return;
            }
            try {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = commentText;
                span.appendChild(tooltip);
                selectedRange.surroundContents(span);
            }catch(err){
                console.warn('Complex selection – cannot comment');
            }
            window.getSelection().removeAllRanges();
            closeContextMenu();
        }

        function clearHighlight() {
           const elementToClear = contextElement;
           if (!elementToClear) {
               closeContextMenu();
               return;
           }
           const parent = elementToClear.parentNode;
           
           while (elementToClear.firstChild) {
               if (!elementToClear.firstChild.classList?.contains('comment-tooltip')) {
                   parent.insertBefore(elementToClear.firstChild, elementToClear);
               } else {
                   elementToClear.removeChild(elementToClear.firstChild);
               }
           }
           parent.removeChild(elementToClear);
           parent.normalize();
           closeContextMenu();
        }

        function clearAllHighlights() {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(element => {
                const parent = element.parentNode;
                const fragment = document.createDocumentFragment();

                while (element.firstChild) {
                    if (element.firstChild.nodeType === 1 && element.firstChild.classList.contains('comment-tooltip')) {
                        element.removeChild(element.firstChild);
                    } else {
                        fragment.appendChild(element.firstChild);
                    }
                }
                parent.replaceChild(fragment, element);
            });
            closeContextMenu();
        }
        
        function closeContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
            contextElement = null;
        }

        function updateAttemptedCount(partNumber) {
            const partContainer = document.getElementById(`part-${partNumber}`);
            if (!partContainer) return;
            const inputs = partContainer.querySelectorAll('input.answer-input:not([disabled]):not([type="hidden"]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled])');
            let answeredCount = 0;
            const answeredGroups = {};
            inputs.forEach(input => {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    if (input.name === 'q24-25') {
                        const checkedCount = partContainer.querySelectorAll('input[name="q24-25"]:checked').length;
                        // Represent q24 and q25 as two separate questions in the footer count
                        // Count 1 if at least one selected, and +1 again if two selected
                        const keyFirst = 'q24-25-first';
                        const keySecond = 'q24-25-second';
                        if (checkedCount >= 1 && !answeredGroups[keyFirst]) {
                            answeredCount++;
                            answeredGroups[keyFirst] = true;
                        }
                        if (checkedCount >= 2 && !answeredGroups[keySecond]) {
                            answeredCount++;
                            answeredGroups[keySecond] = true;
                        }
                    } else if (input.checked && !answeredGroups[input.name]) {
                        answeredCount++;
                        answeredGroups[input.name] = true;
                    }
                } else {
                    if (input.value.trim() !== '') answeredCount++;
                }
            });
            // Include drag/drop filled zones as answered
            const zones = partContainer.querySelectorAll('.drop-zone[data-question-id]');
            zones.forEach(zone => {
                if (zone.querySelector('.drag-item')) {
                    answeredCount++;
                }
            });
            
            // Include clickable cells as answered
            const clickableCells = partContainer.querySelectorAll('.clickable-cell.selected');
            clickableCells.forEach(cell => {
                const questionNum = cell.getAttribute('data-question');
                if (questionNum && !answeredGroups[`clickable-${questionNum}`]) {
                    answeredCount++;
                    answeredGroups[`clickable-${questionNum}`] = true;
                }
            });
            const countDisplay = document.querySelector(`.footer__questionWrapper___1tZ46:nth-child(${partNumber}) .attemptedCount`);
            if (countDisplay) countDisplay.textContent = `${answeredCount} of 10`;
        }

        function checkAnswers() {
            let score = 0;
            let resultsData = [];
            document.querySelectorAll('.correct, .incorrect, .correct-answer-text, .correct-inline').forEach(el => {
                if (el.classList.contains('correct-answer-text') || el.classList.contains('correct-inline')) {
                    el.remove();
                } else {
                    el.classList.remove('correct', 'incorrect');
                }
            });
            
            Object.keys(correctAnswers).forEach(key => {
                const correctAnswer = correctAnswers[key];
                let userAnswer = '';
                let isCorrect = false;
                const questionType = questionTypes[key];
                
                // Handle different question types
                if (key.includes('-')) {
                    // Multi-question keys like 'q11-12', 'q13-14'
                    const [startQ, endQ] = key.split('-').map(q => parseInt(q.replace('q', '')));
                    
                    switch(questionType) {
                        case 'checkbox':
                            const checkedBoxes = document.querySelectorAll(`input[name="${key}"]:checked`);
                            const userAnswers = Array.from(checkedBoxes).map(cb => cb.value).sort();
                            userAnswer = userAnswers.join(', ');
                            const correctAnswersSorted = Array.isArray(correctAnswer) ? [...correctAnswer].sort() : [correctAnswer];
                            
                            // Count how many correct answers the user selected
                            const correctUserAnswers = userAnswers.filter(ans => correctAnswersSorted.includes(ans));
                            
                            // Additive-only scoring: 1 point per correct selected; no penalty for incorrect
                            const questionScore = correctUserAnswers.length;
                            score += questionScore;
                            
                            // Mark group as fully correct only if all correct options are selected and no extra are selected
                            isCorrect = (correctUserAnswers.length === correctAnswersSorted.length && userAnswers.length === correctAnswersSorted.length);
                            
                            // Mark individual checkboxes
                            checkedBoxes.forEach(cb => {
                                const label = cb.closest('label');
                                if (label) {
                                    if (correctAnswersSorted.includes(cb.value)) {
                                        label.classList.add('correct');
                                    } else {
                                        label.classList.add('incorrect');
                                    }
                                }
                            });
                            
                            // Mark correct answers that weren't selected
                            correctAnswersSorted.forEach(correctVal => {
                                const correctCheckbox = document.querySelector(`input[name="${key}"][value="${correctVal}"]`);
                                if (correctCheckbox && !correctCheckbox.checked) {
                                    const correctLabel = correctCheckbox.closest('label');
                                    if (correctLabel) {
                                        correctLabel.classList.add('correct');
                                    }
                                }
                            });
                            break;
                    }
                    
                    // Mark buttons for the question range
                    for (let qNum = startQ; qNum <= endQ; qNum++) {
                        const btn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                        if (btn) {
                            btn.classList.remove('answered');
                            btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }
                    
                    resultsData.push({
                        question: `${startQ}-${endQ}`,
                        userAnswer: userAnswer || 'No Answer',
                        correctAnswer: Array.isArray(correctAnswer) ? correctAnswer.join(', ') : String(correctAnswer),
                        isCorrect: isCorrect
                    });
                    
                    // For checkbox questions in multi-question keys, score was already added in switch statement
                    // Don't add additional score here - return early to skip the final score increment
                    return;
                } else {
                   const qNum = parseInt(key.replace('q', ''));
                   const btn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                   const element = document.getElementById(key) || document.querySelector(`input[name="${key}"]`);

                   // Determine question type: prefer explicit mapping over DOM input type
                   let questionType = questionTypes[key];
                   if (!questionType) {
                       if (element?.type === 'radio') questionType = 'mcq';
                       else if (element?.type === 'text') questionType = 'text';
                   }
                   
                    switch (questionType) {
                       case 'text':
                           userAnswer = element.value.trim();
                           const acceptedAnswers = Array.isArray(correctAnswer) ? correctAnswer : [String(correctAnswer)];
                           isCorrect = acceptedAnswers.some(ans => ans.toLowerCase() === userAnswer.toLowerCase());
                           element.classList.add(isCorrect ? 'correct' : 'incorrect');
                           if (!isCorrect) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-inline';
                                correctAnswerSpan.textContent = acceptedAnswers[0];
                                element.insertAdjacentElement('afterend', correctAnswerSpan);
                           }
                           break;
                        case 'mcq':
                            const radioChecked = document.querySelector(`input[name="${key}"]:checked`);
                            userAnswer = radioChecked ? radioChecked.value : 'No Answer';
                            isCorrect = userAnswer === correctAnswer;
                            const radios = document.querySelectorAll(`input[name="${key}"]`);
                            radios.forEach(radio => {
                                const label = radio.closest('label');
                                const wrapper = radio.closest('.multi-choice-option') || label;
                                if (radio.value === correctAnswer) {
                                    wrapper.classList.add('correct');
                                } else if (radio.checked) {
                                    wrapper.classList.add('incorrect');
                                }
                            });
                            break;
                        case 'dragdrop': {
                            const dz = document.querySelector(`.drop-zone[data-question-id="${qNum}"]`);
                            const dropped = dz ? dz.querySelector('.drag-item') : null;
                            // Prefer hidden input (kept in sync on drop), then dataset/attribute
                            const hiddenVal = element ? element.value.trim() : '';
                            if (hiddenVal) {
                                userAnswer = hiddenVal;
                            } else if (dropped) {
                                const dataLetter = dropped.getAttribute('data-letter') || dropped.dataset.letter;
                                userAnswer = (dataLetter && dataLetter.trim()) || dropped.textContent.trim();
                            } else {
                                userAnswer = '';
                            }
                            const accepted = Array.isArray(correctAnswer) ? correctAnswer.map(a=>String(a).toLowerCase()) : [String(correctAnswer).toLowerCase()];
                            isCorrect = userAnswer && accepted.includes(String(userAnswer).toLowerCase());
                            if (!isCorrect) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-inline';
                                // show canonical uppercase answer for letters
                                const showVal = Array.isArray(correctAnswer) ? String(correctAnswer[0]) : String(correctAnswer);
                                correctAnswerSpan.textContent = showVal;
                                // Make sure it sits inline with the question row
                                correctAnswerSpan.style.display = 'inline-block';
                                correctAnswerSpan.style.marginLeft = '8px';
                                const anchor = dz || element; // prefer drop-zone, fallback to hidden input
                                if (anchor) {
                                    anchor.insertAdjacentElement('afterend', correctAnswerSpan);
                                }
                            }
                            break; }
                       case 'clickable':
                           const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"].selected`);
                           userAnswer = selectedCell ? selectedCell.getAttribute('data-value') : 'No Answer';
                           isCorrect = userAnswer === correctAnswer;
                           
                           // Mark cells as correct/incorrect
                           const allCells = document.querySelectorAll(`.clickable-cell[data-question="${qNum}"]`);
                           allCells.forEach(cell => {
                               if (cell.getAttribute('data-value') === correctAnswer) {
                                   cell.classList.add('correct');
                               } else if (cell.classList.contains('selected')) {
                                   cell.classList.add('incorrect');
                               }
                           });
                           break;
                       case 'checkbox':
                           const checkedBoxes = document.querySelectorAll(`input[name="${key}"]:checked`);
                           const userAnswers = Array.from(checkedBoxes).map(cb => cb.value).sort();
                           userAnswer = userAnswers.join(', ');
                           const correctAnswersSorted = Array.isArray(correctAnswer) ? correctAnswer.sort() : [correctAnswer];
                           
                           // Count how many correct answers the user selected
                           const correctUserAnswers = userAnswers.filter(ans => correctAnswersSorted.includes(ans));
                           
                           // Additive-only scoring: 1 point per correct selected; no penalty for incorrect
                           const questionScore = correctUserAnswers.length;
                           score += questionScore;
                           
                           // Mark group as fully correct only if all correct options are selected and no extra are selected
                           isCorrect = (correctUserAnswers.length === correctAnswersSorted.length && userAnswers.length === correctAnswersSorted.length);
                           
                           // Mark individual checkboxes
                           checkedBoxes.forEach(cb => {
                               const label = cb.closest('label');
                               if (label) {
                                   if (correctAnswersSorted.includes(cb.value)) {
                                       label.classList.add('correct');
                                   } else {
                                       label.classList.add('incorrect');
                                   }
                               }
                           });
                           
                           // Mark correct answers that weren't selected
                           correctAnswersSorted.forEach(correctVal => {
                               const correctCheckbox = document.querySelector(`input[name="${key}"][value="${correctVal}"]`);
                               if (correctCheckbox && !correctCheckbox.checked) {
                                   const correctLabel = correctCheckbox.closest('label');
                                   if (correctLabel) {
                                       correctLabel.classList.add('correct');
                                   }
                               }
                           });
                           break;
                   }

                   if (btn) {
                       btn.classList.remove('answered');
                       btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                   }

                   resultsData.push({
                       question: qNum,
                       userAnswer: userAnswer || 'No Answer',
                       correctAnswer: Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : String(correctAnswer),
                       isCorrect: isCorrect
                   });
               }

                // For checkbox questions, score was already added in the switch statement
                // Only add score for non-checkbox questions
                if (questionType !== 'checkbox' && isCorrect) {
                   score++;
               }
            });

            const deliverButton = document.getElementById('deliver-button');
            const band = (function(raw){
                if(raw>=39) return 9;
                if(raw>=37) return 8.5;
                if(raw>=35) return 8;
                if(raw>=32) return 7.5;
                if(raw>=30) return 7;
                if(raw>=26) return 6.5;
                if(raw>=23) return 6;
                if(raw>=18) return 5.5;
                if(raw>=16) return 5;
                if(raw>=13) return 4.5;
                if(raw>=10) return 4;
                if(raw>=8)  return 3.5;
                if(raw>=6)  return 3;
                if(raw>=4)  return 2.5;
                if(raw>=2)  return 2;
                if(raw===1) return 1.5;
                return 0;
            })(score);

            // Disable all inputs after grading
            document.querySelectorAll('.answer-input, input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.disabled = true;
            });
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over'); // Ensure no lingering hover styles
            });

            // Results mode layout with transcription
            document.querySelector('.main-container').classList.add('results-mode');
            switchToPart(currentPart); // Show the transcription for the current part

            // Populate modal content (but do not force-open yet)
            const modal = document.getElementById('result-modal');
            const scoreSummary = document.getElementById('score-summary');
            const resultDetails = document.getElementById('result-details');
            
            scoreSummary.textContent = `You scored ${score} out of 40 (Band ${band}).`;
            
            let tableHTML = '<table><thead><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Result</th></tr></thead><tbody>';
            resultsData.sort((a,b) => parseInt(a.question, 10) - parseInt(b.question, 10)).forEach(res => {
                tableHTML += `
                    <tr>
                        <td>${res.question}</td>
                        <td>${res.userAnswer}</td>
                        <td>${res.correctAnswer}</td>
                        <td class="${res.isCorrect ? 'result-correct' : 'result-incorrect'}">
                            ${res.isCorrect ? '✔ Correct' : '✖ Incorrect'}
                        </td>
                    </tr>
                `;
            });
            tableHTML += '</tbody></table>';
            // Controls: filter toggles and export
            const controls = document.createElement('div');
            controls.className = 'result-controls';
            controls.innerHTML = `
                <label><input type="checkbox" id="toggle-correct" checked> Show correct</label>
                <label><input type="checkbox" id="toggle-incorrect" checked> Show incorrect</label>
                <span class="spacer"></span>
                <button id="export-csv" class="btn-secondary">Export CSV</button>
            `;
            // Apply to modal
            resultDetails.innerHTML = '';
            resultDetails.appendChild(controls);
            const tableContainer = document.createElement('div');
            tableContainer.innerHTML = tableHTML;
            resultDetails.appendChild(tableContainer);
            
            // Wire up filters
            const toggleCorrect = controls.querySelector('#toggle-correct');
            const toggleIncorrect = controls.querySelector('#toggle-incorrect');
            function applyFilters(){
                tableContainer.querySelectorAll('tbody tr').forEach(row => {
                    const isCorrect = row.querySelector('td.result-correct') !== null;
                    const isIncorrect = row.querySelector('td.result-incorrect') !== null;
                    let visible = true;
                    if (isCorrect && !toggleCorrect.checked) visible = false;
                    if (isIncorrect && !toggleIncorrect.checked) visible = false;
                    row.style.display = visible ? '' : 'none';
                });
            }
            toggleCorrect.addEventListener('change', applyFilters);
            toggleIncorrect.addEventListener('change', applyFilters);
            applyFilters();
            
            // CSV export
            controls.querySelector('#export-csv').addEventListener('click', () => {
                const rows = [['Question','Your Answer','Correct Answer','Result']];
                tableContainer.querySelectorAll('tbody tr').forEach(tr => {
                    if (tr.style.display === 'none') return; // respect filters
                    const tds = tr.querySelectorAll('td');
                    const resultCell = tds[3];
                    const resultText = resultCell.classList.contains('result-correct') ? 'Correct' : 'Incorrect';
                    rows.push([tds[0].textContent.trim(), tds[1].textContent.trim(), tds[2].textContent.trim(), resultText]);
                });
                const csv = rows.map(r => r.map(v => '"' + v.replace(/"/g,'""') + '"').join(',')).join('\n');
                const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'listening_results.csv';
                a.click();
                URL.revokeObjectURL(url);
            });
            resultDetails.innerHTML = tableHTML;

            // Turn the deliver button into a green "My Results" button
            deliverButton.classList.add('success');
            deliverButton.innerHTML = '<span>My Results</span>';
            deliverButton.disabled = false;

            // Rebind click handler to open the results modal from now on
            const myResultsBtn = deliverButton.cloneNode(true);
            deliverButton.parentNode.replaceChild(myResultsBtn, deliverButton);
            myResultsBtn.addEventListener('click', () => {
                const modalEl = document.getElementById('result-modal');
                if (modalEl) modalEl.style.display = 'flex';
            });

            // Open the modal immediately after grading
            modal.style.display = 'flex';
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    checkAnswers();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }

        // Event Listeners
        playPauseBtn.addEventListener('click', () => {
            if (!testStarted) {
                testStarted = true; // Timer removed, skip startTimer
                switchToPart(currentPart, true);
            } else {
                if (audioPlayer.paused) {
                    // If paused, ensure the audio source is for the current part
                    if (!audioPlayer.src.includes(audioSource)) {
                        audioPlayer.src = audioSource;
                    }
                    audioPlayer.play();
                } else {
                    audioPlayer.pause();
                }
            }
        });
        
        audioPlayer.addEventListener('play', () => {
            playPauseBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>`;
        });

        audioPlayer.addEventListener('pause', () => {
            playPauseBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
        });

        audioPlayer.addEventListener('ended', () => {
            if (currentPart < 4) {
                switchToPart(currentPart + 1, true);
            }
        });

        audioPlayer.addEventListener('loadedmetadata', () => {
            progressBar.max = audioPlayer.duration;
            totalDurationEl.textContent = formatTime(audioPlayer.duration);
        });

        audioPlayer.addEventListener('timeupdate', () => {
            progressBar.value = audioPlayer.currentTime;
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
        });

        progressBar.addEventListener('input', () => {
            audioPlayer.currentTime = progressBar.value;
        });

        volumeSlider.addEventListener('input', (e) => audioPlayer.volume = e.target.value);

        speedBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            speedOptions.classList.toggle('hidden');
        });

        speedOptions.addEventListener('click', (e) => {
            if (e.target.dataset.speed) {
                const speed = parseFloat(e.target.dataset.speed);
                audioPlayer.playbackRate = speed;
                speedBtn.textContent = `${speed}x`;
                speedOptions.classList.add('hidden');
            }
        });
        
        document.addEventListener('click', () => {
            if (!speedOptions.classList.contains('hidden')) {
                speedOptions.classList.add('hidden');
            }
        });

        document.getElementById('deliver-button').addEventListener('click', checkAnswers);
        
        // Go To Question Widget Logic
        const gotoWidget = document.getElementById('goto-widget');
        const gotoInput = document.getElementById('goto-input');
        const gotoBtn = document.getElementById('goto-btn');

        document.addEventListener('keydown', (e) => {
            if (e.key >= '0' && e.key <= '9' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                gotoWidget.classList.remove('hidden');
                gotoInput.focus();
                gotoInput.value = e.key;
            }
            if (e.key === 'Enter' && document.activeElement === gotoInput) {
                gotoBtn.click();
            }
            if (e.key === 'Escape') {
                gotoWidget.classList.add('hidden');
                gotoInput.value = '';
            }
        });

        if (gotoBtn) {
            gotoBtn.addEventListener('click', () => {
                const qNum = parseInt(gotoInput.value, 10);
                if (qNum >= 1 && qNum <= 40) {
                    goToQuestion(qNum);
                    gotoWidget.classList.add('hidden');
                    gotoInput.value = '';
                } else {
                    alert('Please enter a number between 1 and 40.');
                }
            });
        }

        // Add listener for the modal close button
        document.getElementById('modal-close-button').addEventListener('click', () => {
            document.getElementById('result-modal').style.display = 'none';
        });

        // === Tap-to-select & tap-to-drop for drag items (mobile support) ===
            document.body.addEventListener('click', function(e){
            const item = e.target.closest('.drag-item');
            if(item && item.getAttribute('draggable')){
                // Toggle selection
                document.querySelectorAll('.drag-item.selected').forEach(i=>i.classList.remove('selected'));
                item.classList.add('selected');
                draggedElement = item;
                return;
            }
            const dz = e.target.closest('.drop-zone');
            if(dz && draggedElement){
                // If already filled, move old back
                const container = dz.closest('.matching-container') || dz.closest('.matching-question-container') || document;
                const optionsList = container.querySelector('.matching-options-list') || document.querySelector('.matching-options-list');
                if(dz.children.length>0 && dz.firstElementChild!==draggedElement){
                    // restore original label (with letter) when returning to bank
                    const old = dz.firstElementChild;
                    if (old && old.dataset && old.dataset.fullLabel) {
                        old.textContent = old.dataset.fullLabel;
                    }
                    optionsList.appendChild(old);
                    // clear hidden value for the zone now emptied
                    const qIdOld = dz.getAttribute('data-question-id');
                    const hiddenOld = document.getElementById(`q${qIdOld}`);
                    if (hiddenOld) hiddenOld.value = '';
                }
                // save full label before mutating
                if (!draggedElement.dataset.fullLabel) {
                    draggedElement.dataset.fullLabel = draggedElement.textContent.trim();
                }
                // show only the option text (strip leading "A. ", "B. ", etc.)
                const full = draggedElement.dataset.fullLabel;
                const letter = (full.match(/^\s*([A-G])\s*[\.)-]?/i) || [,''])[1].toUpperCase();
                const plain = full.replace(/^\s*[A-G]\s*[\.)-]?\s*/i, '');
                if (!draggedElement.dataset.letter && letter) {
                    draggedElement.dataset.letter = letter;
                }
                draggedElement.textContent = plain;
                dz.appendChild(draggedElement);
                draggedElement.classList.remove('selected');
                draggedElement=null;
                // style as filled pill and hide placeholder
                dz.classList.add('filled');
                const placeholder = dz.querySelector('.placeholder');
                if (placeholder) placeholder.style.display = 'none';
                // sync hidden input to the letter
                const qId = dz.getAttribute('data-question-id');
                const hiddenInput = document.getElementById(`q${qId}`);
                if (hiddenInput) hiddenInput.value = letter || '';
                updateAnsweredIndicators();
            }
        });

        // === Mobile highlight/comment toolbar ===
        const mobileToolbar = document.getElementById('mobile-selection-menu');
        function positionToolbar(){
            const sel = window.getSelection();
            if(sel.rangeCount===0 || sel.isCollapsed){
                mobileToolbar.classList.add('hidden');
                return;
            }
            const range = sel.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            mobileToolbar.style.top = window.scrollY + rect.top - mobileToolbar.offsetHeight - 8 + 'px';
            mobileToolbar.style.left = window.scrollX + rect.left + 'px';
            mobileToolbar.classList.remove('hidden');
        }
        document.addEventListener('selectionchange', () => {
            const sel = window.getSelection();
            if(sel && sel.rangeCount>0 && !sel.isCollapsed){
                selectedRange = sel.getRangeAt(0);
                selectedText = sel.toString();
            }
            if('ontouchstart' in window || navigator.maxTouchPoints>0){
                setTimeout(positionToolbar, 0);
            }
        });
        document.addEventListener('click', (e)=>{
            if(!e.target.closest('#mobile-selection-menu')){
                mobileToolbar.classList.add('hidden');
            }
        });

        /* ---------------- Drag and Drop for Matching Questions ---------------- */

        (function initDragAndDrop() {
            const container = document.querySelector('.left-panel');
            if (!container) return;

            container.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('drag-item')) {
                    draggedElement = e.target;
                    setTimeout(() => {
                        e.target.classList.add('dragging');
                    }, 0);
                }
            });

            container.addEventListener('dragend', (e) => {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                }
            });

            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                const target = e.target;
                const dropZone = target.closest('.drop-zone');
                const optionsList = target.closest('.matching-options-list');

                if (dropZone || optionsList) {
                    const overElement = dropZone || optionsList;
                    document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                    overElement.classList.add('drag-over');
                }
            });

            container.addEventListener('dragleave', (e) => {
                const target = e.target;
                const dropZone = target.closest('.drop-zone');
                const optionsList = target.closest('.matching-options-list');
                if (dropZone || optionsList) {
                    const overElement = dropZone || optionsList;
                    overElement.classList.remove('drag-over');
                }
            });


            container.addEventListener('drop', (e) => {
                e.preventDefault();
                if (!draggedElement) return;

                const dropTarget = e.target.closest('.drop-zone, .matching-options-list');
                if (!dropTarget) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                    return;
                }

                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                
                const existingItem = dropTarget.matches('.drop-zone') ? dropTarget.querySelector('.drag-item') : null;
                const originalParent = draggedElement.parentNode;

                // If there's an item in the target dropzone, swap them
                if (existingItem) {
                    // when moving existing item back, restore its full label
                    if (existingItem.dataset && existingItem.dataset.fullLabel) {
                        existingItem.textContent = existingItem.dataset.fullLabel;
                    }
                    originalParent.appendChild(existingItem);
                    // If the original parent is a drop-zone and now empty, unfill it
                    if (originalParent.classList && originalParent.classList.contains('drop-zone')) {
                        if (originalParent.children.length === 1 && originalParent.querySelector('.placeholder')) {
                            originalParent.classList.remove('filled');
                            originalParent.querySelector('.placeholder').style.display = '';
                        }
                    }
                }
                
                dropTarget.appendChild(draggedElement);

                if(dropTarget.matches('.drop-zone')) {
                    const placeholder = dropTarget.querySelector('.placeholder');
                    if (placeholder) placeholder.style.display = 'none';
                    dropTarget.classList.add('filled');
                    // save full label once and show plain text only inside zone
                    if (!draggedElement.dataset.fullLabel) {
                        draggedElement.dataset.fullLabel = draggedElement.textContent.trim();
                    }
                    const full = draggedElement.dataset.fullLabel;
                    const letter = (full.match(/^\s*([A-G])\s*[\.)-]?/i) || [,''])[1].toUpperCase();
                    const plain = full.replace(/^\s*[A-G]\s*[\.)-]?\s*/i, '');
                    if (!draggedElement.dataset.letter && letter) {
                        draggedElement.dataset.letter = letter;
                    }
                    draggedElement.textContent = plain;
                    // sync hidden input (use data-letter if present, else text)
                    const qId = dropTarget.getAttribute('data-question-id');
                    const hiddenInput = document.getElementById(`q${qId}`);
                    if (hiddenInput) {
                        const val = draggedElement.getAttribute('data-letter') || letter || (draggedElement.dataset.fullLabel ? draggedElement.dataset.fullLabel.trim().charAt(0).toUpperCase() : draggedElement.textContent.trim());
                        hiddenInput.value = val;
                    }
                }

                draggedElement.classList.remove('dragging');
                draggedElement = null;
                updateAnsweredIndicators();
            });
        })();


        document.addEventListener('DOMContentLoaded', () => {
            switchToPart(1);
            goToQuestion(1);
            setupCheckboxLimits();
            
            // Initialize drag and drop and clickable cells
            initAllDragAndDrop();
            
            // Test clickable cells after a short delay
            setTimeout(() => {
                testClickableCells();
            }, 1000);

            document.body.addEventListener('contextmenu', function (e) {
                const text = window.getSelection().toString();
                if (!text) return;
                e.preventDefault();
                const menu = document.getElementById('contextMenu');
                menu.style.left = e.pageX + 'px';
                menu.style.top = e.pageY + 'px';
                menu.style.display = 'block';

                const target = e.target;
                const clearItem = document.getElementById('clear-item');
                contextElement = target.closest('.highlight, .comment-highlight');
                if(contextElement){
                    clearItem.style.display = 'block';
                } else {
                    clearItem.style.display = 'none';
                }
            });
            
            document.body.addEventListener('click', function(e) {
                if (e.target.closest('.context-menu')) return;
                document.getElementById('contextMenu').style.display = 'none';
            });
        });

        // Initial setup on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            updateAnsweredIndicators();
            
            // Add specific event listeners for questions 17-20 radio buttons
            document.querySelectorAll('input[name="q17"], input[name="q18"], input[name="q19"], input[name="q20"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const questionNumber = this.name.substring(1); // Remove 'q' prefix
                    const hiddenInput = document.getElementById(`q${questionNumber}`);
                    if (hiddenInput) {
                        hiddenInput.value = this.value;
                        console.log(`Question ${questionNumber} selected: ${this.value}`);
                    }
                });
            });
        });

        document.querySelectorAll('.mcq-table td').forEach(cell => {
            cell.addEventListener('click', (e) => {
                if (e.target.tagName !== 'INPUT') {
                    const radio = cell.querySelector('input[type="radio"]');
                    if (radio && !radio.disabled) {
                        radio.checked = true;
                    }
                }
            });
        });

        document.querySelectorAll('.answer-input, input[type="radio"], input[type="checkbox"]').forEach(input => {
            input.addEventListener('input', updateAnsweredIndicators);
            input.addEventListener('change', updateAnsweredIndicators);
        });

        function initAllDragAndDrop() {
            const dragItems = document.querySelectorAll('.drag-item');
            const dropZones = document.querySelectorAll('.drop-zone');

            dragItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });

            // Initialize clickable cells for questions 27-31
            initClickableCells();
        }

        function initClickableCells() {
            const clickableCells = document.querySelectorAll('.clickable-cell');
            clickableCells.forEach(cell => {
                cell.addEventListener('click', function() {
                    const questionNumber = this.getAttribute('data-question');
                    const value = this.getAttribute('data-value');
                    selectCell(this, questionNumber, value);
                });
            });
        }

            function handleDragStart(e) {
                draggedElement = e.target;
                setTimeout(() => e.target.classList.add('dragging'), 0);
            }

            function handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            function handleDragOver(e) {
                e.preventDefault();
                const zone = e.target.closest('.drop-zone');
                if (zone) zone.classList.add('drag-over');
            }

            function handleDragLeave(e) {
                const zone = e.target.closest('.drop-zone');
                if (zone) zone.classList.remove('drag-over');
            }

            function handleDrop(e) {
                e.preventDefault();
                const targetZone = e.target.closest('.drop-zone');
                if (!targetZone || !draggedElement) return;
                
                targetZone.classList.remove('drag-over');

                const sourceContainer = draggedElement.parentNode;
                const itemInTargetZone = targetZone.querySelector('.drag-item');
                
                // Prevent dropping on self or non-droppable area inside zone
                if (e.target.classList.contains('drag-item') && e.target !== draggedElement) {
                    return; // Or handle swap explicitly here if needed
                }
                
                if (itemInTargetZone && itemInTargetZone !== draggedElement) {
                    // If source is an options list, move the existing item back
                    const optionsList = findParentOptionsList(targetZone);
                    if (sourceContainer.classList.contains('matching-options-list') || sourceContainer.classList.contains('map-options-list')) {
                    if (itemInTargetZone.dataset && itemInTargetZone.dataset.fullLabel) {
                        itemInTargetZone.textContent = itemInTargetZone.dataset.fullLabel;
                    }
                    optionsList.appendChild(itemInTargetZone);
                    } 
                    // If source is another drop zone (swapping)
                    else if (sourceContainer.classList.contains('drop-zone')) {
                        if (itemInTargetZone.dataset && itemInTargetZone.dataset.fullLabel) {
                            itemInTargetZone.textContent = itemInTargetZone.dataset.fullLabel;
                        }
                        sourceContainer.appendChild(itemInTargetZone);
                    }
                }

                targetZone.appendChild(draggedElement);
                if (targetZone.querySelector('.placeholder')) {
                    targetZone.querySelector('.placeholder').style.display = 'none';
                }
                // Sync hidden input for drag/drop questions so checking works and counters update
                const qId = targetZone.getAttribute('data-question-id');
                const hiddenInput = document.getElementById(`q${qId}`);
                if (hiddenInput) {
                    // Set to letter using data-letter if available; otherwise infer from full label
                    const letter = draggedElement.getAttribute('data-letter');
                    if (letter) {
                        hiddenInput.value = letter;
                    } else if (draggedElement.dataset.fullLabel) {
                        hiddenInput.value = draggedElement.dataset.fullLabel.trim().charAt(0).toUpperCase();
                    } else {
                        hiddenInput.value = draggedElement.textContent.trim();
                    }
                }
                
                updateAnsweredIndicators();
            }

            function findParentOptionsList(element) {
                // Specific for map
                if (element.closest('#map-drag-container')) {
                    return document.getElementById('map-options-q11-15');
                }
                // Generic for matching
                const container = element.closest('.matching-container');
                if (container) {
                    return container.querySelector('.matching-options-list');
                }
                return null;
            }
        

        let transcriptionHighlighted = false;
        function highlightAnswersInTranscription() {
            if (transcriptionHighlighted) return;

            const highlightedTranscripts = { 1: '', 2: '', 3: '', 4: '' };

            for (let i = 1; i <= 4; i++) {
                const partElement = document.querySelector(`#transcription-data [data-part="${i}"]`);
                if (partElement) highlightedTranscripts[i] = partElement.innerHTML;
            }

            for (const key in correctAnswers) {
                const answers = Array.isArray(correctAnswers[key]) ? correctAnswers[key] : [correctAnswers[key]];
                if (answers.every(answer => /^[A-G]$/.test(answer))) {
                    continue;
                }

                const qNum = parseInt(key.match(/\d+/)[0]);
                let partNumber = 1;
                if (qNum > 10 && qNum <= 20) partNumber = 2;
                else if (qNum > 20 && qNum <= 30) partNumber = 3;
                else if (qNum > 30) partNumber = 4;

                if (!highlightedTranscripts[partNumber]) continue;

                let answersToHighlight = correctAnswers[key];
                if (!Array.isArray(answersToHighlight)) {
                    answersToHighlight = [answersToHighlight];
                }

                for (const answer of answersToHighlight) {
                    if (/^[A-G]$/.test(answer)) continue;
                    
                    let searchTerm = answer.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                    searchTerm = searchTerm.replace(/\\\(s\\\)/g, '(s)?');
                    
                    const regex = new RegExp(`\\b(${searchTerm})\\b`, 'gi');
                    
                    highlightedTranscripts[partNumber] = highlightedTranscripts[partNumber].replace(
                        regex,
                        '<span class="highlight">$1</span>'
                    );
                }
            }

            for (let i = 1; i <= 4; i++) {
                const partElement = document.querySelector(`#transcription-data [data-part="${i}"]`);
                if(partElement) partElement.innerHTML = highlightedTranscripts[i];
            }
            transcriptionHighlighted = true;
        }
        
        function closeContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
            contextElement = null;
        }
    </script>
</body>
</html>
